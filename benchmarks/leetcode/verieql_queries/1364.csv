qid,mysql_can_execute?,mysql_correct?,mysql_query
0,Y,Y,"SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, A.CONTACTS_CNT, COALESCE(B.TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE) A LEFT JOIN (SELECT I.INVOICE_ID, COUNT(C.CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS C ON I.USER_ID = C.USER_ID WHERE C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY I.INVOICE_ID) B ON A.INVOICE_ID = B.INVOICE_ID ORDER BY A.INVOICE_ID"
1,Y,Y,"SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, IFNULL(B.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(B.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, I.USER_ID, C.CUSTOMER_NAME, I.PRICE FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID) AS A LEFT JOIN (SELECT USER_ID, COUNT(1) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) AS B ON A.USER_ID=B.USER_ID ORDER BY 1"
2,Y,N,"SELECT I.INVOICE_ID AS INVOICE_ID, C.CUSTOMER_NAME AS CUSTOMER_NAME, I.PRICE AS PRICE, COUNT(T1.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C JOIN INVOICES I ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS T1 ON I.USER_ID=T1.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL=T1.CONTACT_EMAIL GROUP BY 1, 2 ,3 ORDER BY 1"
3,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C1.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C1 ON C1.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
4,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, SUM(CASE WHEN CT.CONTACT_NAME IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID INNER JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
5,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C3.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C2.USER_ID = C1.CUSTOMER_ID LEFT JOIN CUSTOMERS C3 ON C3.CUSTOMER_NAME = C2.CONTACT_NAME GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
6,Y,N,"SELECT I.INVOICE_ID, M.CUSTOMER_NAME, I.PRICE, IFNULL(T1.CT1,0) CONTACTS_CNT , IFNULL(T2.CT2,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS M ON I.USER_ID = M.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, CONTACT_EMAIL, COUNT(*) CT1 FROM CONTACTS GROUP BY 1) T1 ON I.USER_ID = T1.USER_ID LEFT JOIN (SELECT CT.USER_ID, COUNT(CT.USER_ID) CT2 FROM CUSTOMERS CM, CONTACTS CT WHERE CT.CONTACT_EMAIL = CM.EMAIL GROUP BY 1) T2 ON I.USER_ID = T2.USER_ID ORDER BY 1"
7,Y,Y,"SELECT INV.INVOICE_ID, C.CUSTOMER_NAME, INV.PRICE, COALESCE(CT.CONTACTS_CNT, 0) CONTACTS_CNT, COALESCE(TCT.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) CT ON INV.USER_ID=CT.USER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) TCT ON INV.USER_ID=TCT.USER_ID LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID=INV.USER_ID ORDER BY INV.INVOICE_ID"
8,Y,N,"SELECT T.INVOICE_ID, T.CUSTOMER_NAME, T.PRICE, COUNT(CO.CONTACT_EMAIL) CONTACTS_CNT, COUNT(C2.CUSTOMER_ID) TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, C.CUSTOMER_ID, I.PRICE FROM INVOICES I, CUSTOMERS C WHERE I.USER_ID = C.CUSTOMER_ID) T LEFT OUTER JOIN CONTACTS CO ON T.CUSTOMER_ID = CO.USER_ID LEFT OUTER JOIN CUSTOMERS C2 ON CO.CONTACT_EMAIL = C2.EMAIL GROUP BY T.INVOICE_ID, T.CUSTOMER_NAME, T.PRICE ORDER BY 1"
9,Y,Y,"SELECT T2.INVOICE_ID, T2.CUSTOMER_NAME, T2.PRICE, IFNULL(COUNT(T2.USER_ID),0) AS CONTACTS_CNT, IFNULL(SUM(T2.TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, T1.TRUSTED, T1.USER_ID FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, CONTACT_NAME, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS) T1 ON C.CUSTOMER_ID=T1.USER_ID) T2 GROUP BY T2.INVOICE_ID, T2.CUSTOMER_NAME, T2.PRICE ORDER BY T2.INVOICE_ID ASC"
10,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COUNT(D.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON D.CUSTOMER_NAME = C.CONTACT_NAME GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE ORDER BY A.INVOICE_ID"
11,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(D.CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN (SELECT DISTINCT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) C ON A.USER_ID = C.USER_ID LEFT JOIN (SELECT DISTINCT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) D ON A.USER_ID = D.USER_ID ORDER BY A.INVOICE_ID"
12,Y,Y,"SELECT C.INVOICE_ID, A.CUSTOMER_NAME, C.PRICE, COUNT(B.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A JOIN INVOICES C ON A.CUSTOMER_ID = C.USER_ID LEFT JOIN CONTACTS B ON B.USER_ID = C.USER_ID GROUP BY 1, 2, 3 ORDER BY 1"
13,Y,Y,"SELECT DISTINCT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, COUNT(T.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN (T.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS T ON T.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
14,Y,Y,"SELECT DISTINCT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN (T.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS)) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS T ON T.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
15,Y,N,"SELECT I.INVOICE_ID ,C1.CUSTOMER_NAME ,I.PRICE ,COUNT(M.CONTACT_EMAIL) AS CONTACTS_CNT ,COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS M ON C1.CUSTOMER_ID = M.USER_ID LEFT JOIN CUSTOMERS C2 ON M.CONTACT_NAME = C2.CUSTOMER_NAME AND M.CONTACT_EMAIL = C2.EMAIL GROUP BY I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
16,Y,N,"SELECT I.INVOICE_ID ,C1.CUSTOMER_NAME ,I.PRICE ,COUNT(M.CONTACT_EMAIL) AS CONTACTS_CNT ,SUM(CASE WHEN C2.CUSTOMER_NAME IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS M ON C1.CUSTOMER_ID = M.USER_ID LEFT JOIN CUSTOMERS C2 ON M.CONTACT_NAME = C2.CUSTOMER_NAME AND M.CONTACT_EMAIL = C2.EMAIL GROUP BY I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
17,Y,Y,"SELECT I.INVOICE_ID ,CU.CUSTOMER_NAME ,I.PRICE ,COUNT(C.CONTACT_EMAIL) CONTACTS_CNT ,SUM(CASE WHEN C.CONTACT_EMAIL IN ( SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS C ON CU.CUSTOMER_ID = C.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
18,Y,Y,"SELECT I.INVOICE_ID AS INVOICE_ID,SUB2.CUSTOMER_NAME AS CUSTOMER_NAME,I.PRICE AS PRICE,SUB2.CONTACT_CNT AS CONTACTS_CNT,SUB2.TRUSTED_CONTACTS_CNT AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT SUB1.CUSTOMER_ID AS CUSTOMER_ID,SUB1.CUSTOMER_NAME AS CUSTOMER_NAME,COUNT(SUB1.CONTACT_NAME) AS CONTACT_CNT, COUNT(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM (SELECT T2.CUSTOMER_ID AS CUSTOMER_ID,T2.CUSTOMER_NAME AS CUSTOMER_NAME, T1.CONTACT_NAME AS CONTACT_NAME, CASE WHEN T1.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN Y ELSE NULL END AS TRUSTED_CONTACT FROM CONTACTS T1 RIGHT JOIN CUSTOMERS T2 ON T1.USER_ID=T2.CUSTOMER_ID) SUB1 GROUP BY SUB1.CUSTOMER_ID,SUB1.CUSTOMER_NAME ) SUB2 ON I.USER_ID=SUB2.CUSTOMER_ID ORDER BY 1"
19,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ,COUNT(CO.USER_ID) AS CONTACTS_CNT ,SUM(IF(CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
20,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(COUNT(CT.CONTACT_NAME), 0) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY C.CUSTOMER_NAME, I.INVOICE_ID, I.PRICE ORDER BY I.INVOICE_ID ASC"
21,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(C1.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON (I.USER_ID=C.CUSTOMER_ID) LEFT JOIN CONTACTS C1 ON (C.CUSTOMER_ID=C1.USER_ID) LEFT JOIN CUSTOMERS C2 ON (C2.EMAIL=C1.CONTACT_EMAIL) GROUP BY 1, 2 ORDER BY 1"
22,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CN.USER_ID) CONTACTS_CNT, COUNT(T.CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CN ON CN.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS T ON CN.CONTACT_NAME = T.CUSTOMER_NAME GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
23,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
24,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON(C.CUSTOMER_ID=I.USER_ID) LEFT JOIN CONTACTS CON ON(CON.USER_ID=C.CUSTOMER_ID) LEFT JOIN CUSTOMERS C2 ON (C2.EMAIL=CON.CONTACT_EMAIL) GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
25,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON(C.CUSTOMER_ID=I.USER_ID) LEFT JOIN CONTACTS CON ON(CON.USER_ID=C.CUSTOMER_ID) LEFT JOIN CUSTOMERS C2 ON (C2.EMAIL=CON.CONTACT_EMAIL) GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
26,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
27,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CT.USER_ID) AS CONTACTS_CNT, COUNT(C1.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C1 ON CT.CONTACT_EMAIL = C1.EMAIL GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
28,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CT.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS ) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID=CT.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
29,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(O.CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(O.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS O ON C.CUSTOMER_ID = O.USER_ID GROUP BY 1 ORDER BY 1"
30,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CON.USER_ID),0) AS CONTACTS_CNT, SUM(CASE WHEN CUS.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_EMAIL = CUS.EMAIL GROUP BY C.CUSTOMER_NAME, I.INVOICE_ID ORDER BY I.INVOICE_ID"
31,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CT.CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1 ORDER BY 1"
32,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T.NCONT, 0) AS CONTACTS_CNT, IFNULL(T.NTRUST, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN ( SELECT USER_ID, COUNT(CONTACT_NAME) AS NCONT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS NTRUST FROM CONTACTS GROUP BY USER_ID) T USING(USER_ID) LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
33,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN (SELECT CUS.CUSTOMER_ID, CUS.CUSTOMER_NAME, COUNT(CONT.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CONT ON CUS.CUSTOMER_ID = CONT.USER_ID GROUP BY CUS.CUSTOMER_ID) AS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
34,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME,I.PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF (CONTACT_EMAIL IN(SELECT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID=CO.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID=I.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
35,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COALESCE(COUNT(C2.CONTACT_NAME),0) CONTACTS_CNT, COALESCE((SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END)),0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID=C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID=C2.USER_ID GROUP BY 1,2,3 ORDER BY 1"
36,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(CONT.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS CONT ON C1.CUSTOMER_ID = CONT.USER_ID LEFT JOIN CUSTOMERS C2 ON CONT.CONTACT_EMAIL = C2.EMAIL GROUP BY I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
37,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, IFNULL(C2.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(C2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN ( SELECT CONTACTS.USER_ID, COUNT(CONTACTS.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CUSTOMERS.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL GROUP BY CONTACTS.USER_ID ) C2 ON I.USER_ID = C2.USER_ID ORDER BY I.INVOICE_ID"
38,Y,Y,"SELECT I.INVOICE_ID, CM.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CM ON I.USER_ID = CM.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID GROUP BY I.INVOICE_ID ORDER BY 1"
39,Y,N,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CU2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = CU.CUSTOMER_ID LEFT JOIN CUSTOMERS CU2 ON CO.CONTACT_EMAIL = CU2.EMAIL GROUP BY 1, 2, 3 ORDER BY 1"
40,Y,Y,"SELECT I.INVOICE_ID, CUS.CUSTOMER_NAME, I.PRICE, COUNT(CON.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) AND CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
41,Y,N,"SELECT I.INVOICE_ID, CUST.CUSTOMER_NAME, I.PRICE, SUM(CASE WHEN C.USER_ID IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN CONT_CUST.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS CONT_CUST ON C.CONTACT_EMAIL = CONT_CUST.EMAIL GROUP BY I.INVOICE_ID, CUST.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
42,Y,Y,"SELECT I.INVOICE_ID, CX.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(C.CONTACT_EMAIL), 0) CONTACTS_CNT, SUM( IF (C.CONTACT_EMAIL IN ( SELECT DISTINCT EMAIL FROM CUSTOMERS ), 1, 0) ) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CX ON I.USER_ID = CX.CUSTOMER_ID LEFT JOIN CONTACTS C ON CX.CUSTOMER_ID = C.USER_ID GROUP BY 1, 2 ORDER BY 1"
43,Y,N,"SELECT I.INVOICE_ID, US.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CU.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CONTACTS AS CO ON I.USER_ID = CO.USER_ID LEFT JOIN CUSTOMERS AS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME LEFT JOIN CUSTOMERS AS US ON US.CUSTOMER_ID = I.USER_ID GROUP BY 1,2,3 ORDER BY I.INVOICE_ID"
44,Y,N,"SELECT I1.INVOICE_ID, C1.CUSTOMER_NAME AS CUSTOMER_NAME, I1.PRICE, CASE WHEN B.CONTACTS_CNT IS NULL THEN 0 ELSE B.CONTACTS_CNT END AS CONTACTS_CNT, CASE WHEN B.TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE B.TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM INVOICES I1 LEFT JOIN CUSTOMERS C1 ON I1.USER_ID = C1.CUSTOMER_ID LEFT JOIN( SELECT USER_ID, COUNT(1) AS CONTACTS_CNT, SUM(CASE WHEN CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM( SELECT C2.USER_ID, C3.CUSTOMER_ID FROM CONTACTS C2 LEFT JOIN CUSTOMERS C3 ON C2.CONTACT_NAME = C3.CUSTOMER_NAME AND C2.CONTACT_EMAIL = C3.EMAIL ) A GROUP BY USER_ID ) B ON I1.USER_ID = B.USER_ID ORDER BY I1.INVOICE_ID ASC"
45,Y,Y,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) TRUSTED_CONTACTS_CNT FROM INVOICES I1 JOIN CUSTOMERS C1 ON I1.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS CON1 ON C1.CUSTOMER_ID = CON1.USER_ID GROUP BY INVOICE_ID,C1.CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
46,Y,Y,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I1 JOIN CUSTOMERS C1 ON I1.USER_ID = C1.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) T1 ON C1.CUSTOMER_ID = T1.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) T2 ON C1.CUSTOMER_ID = T2.USER_ID ORDER BY INVOICE_ID"
47,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(IS_TRUSTED) TRUSTED_CONTACTS_CNT FROM (SELECT * , CASE WHEN EMAIL IS NULL THEN 0 ELSE 1 END AS IS_TRUSTED FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL=CU.EMAIL) CO GROUP BY USER_ID) TAMPA ON USER_ID=CUSTOMER_ID INNER JOIN INVOICES ON INVOICES.USER_ID=CUSTOMER_ID ORDER BY INVOICES.INVOICE_ID"
48,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(IS_TRUSTED) TRUSTED_CONTACTS_CNT FROM (SELECT * , CASE WHEN EMAIL IS NULL THEN 0 ELSE 1 END AS IS_TRUSTED FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL=CU.EMAIL) CO GROUP BY USER_ID) TAMPA ON TAMPA.USER_ID=INVOICES.USER_ID INNER JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMER_ID ORDER BY INVOICES.INVOICE_ID"
49,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(T.CNT,0) CONTACTS_CNT, COALESCE(T2.CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, COUNT(*) CNT FROM CONTACTS GROUP BY USER_ID ) T ON I.USER_ID = T.USER_ID LEFT JOIN ( SELECT USER_ID, COUNT(*) CNT FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME, EMAIL FROM CUSTOMERS ) GROUP BY USER_ID ) T2 ON I.USER_ID = T2.USER_ID ORDER BY INVOICE_ID"
50,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.CONTACT_NAME ) AS CONTACTS_CNT, SUM(IF(CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS JOIN INVOICES ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
51,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY INVOICES.INVOICE_ID, CUSTOMER_NAME ORDER BY INVOICES.INVOICE_ID"
52,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME ORDER BY INVOICE_ID"
53,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CONTACTS AS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY INVOICE_ID"
54,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_NAME), 0) AS CONTACTS_CNT, IFNULL(SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY 1 ORDER BY 1"
55,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT FROM CONTACTS GROUP BY 1) AS T1 USING(USER_ID) LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY 1) AS T2 USING(USER_ID) JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
56,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) A ON INVOICES.USER_ID = A.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) B ON INVOICES.USER_ID = B.USER_ID JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY INVOICE_ID"
57,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID=CONTACTS.USER_ID JOIN INVOICES ON CUSTOMERS.CUSTOMER_ID=INVOICES.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
58,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME,PRICE, COUNT(C2.CONTACT_EMAIL) CONTACTS_CNT, SUM(IF(C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1,0)) TRUSTED_CONTACTS_CNT FROM INVOICES I1 JOIN CUSTOMERS C1 ON I1.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON I1.USER_ID = C2.USER_ID GROUP BY INVOICE_ID ORDER BY 1,2,3"
59,Y,N,"SELECT INVOICE_ID, TABLE1.CUSTOMER_NAME, PRICE, IFNULL(TABLE2.COUNT,0) AS CONTACTS_CNT, IFNULL(TABLE3.COUNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID ) AS TABLE1 LEFT JOIN ( SELECT CUSTOMER_NAME, COUNT(CONTACT_NAME) AS COUNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY CUSTOMER_NAME ) AS TABLE2 ON TABLE1.CUSTOMER_NAME = TABLE2.CUSTOMER_NAME LEFT JOIN ( SELECT CUSTOMER_NAME, COUNT(CONTACT_NAME) AS COUNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID WHERE CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_NAME ) AS TABLE3 ON TABLE1.CUSTOMER_NAME = TABLE3.CUSTOMER_NAME ORDER BY TABLE1.INVOICE_ID"
60,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID= CO.USER_ID GROUP BY 1, CU.CUSTOMER_ID ORDER BY 1"
61,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME, PRICE, CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT CTE1.INVOICE_ID,CTE1.CUSTOMER_ID, CTE1.CUSTOMER_NAME, CTE1.PRICE, CTE2.CONTACTS_CNT FROM (SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME,COUNT(CO.USER_ID) AS CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY 1,2) CTE2 LEFT JOIN (SELECT I.INVOICE_ID,CU.CUSTOMER_ID, CU.CUSTOMER_NAME, I.PRICE FROM CUSTOMERS CU LEFT JOIN INVOICES I ON CU.CUSTOMER_ID = I.USER_ID) CTE1 ON CTE1.CUSTOMER_ID = CTE2.CUSTOMER_ID) CTE3 LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1) CTE4 ON CTE3.CUSTOMER_ID = CTE4.USER_ID WHERE INVOICE_ID IS NOT NULL ORDER BY INVOICE_ID"
62,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(USER_ID) AS CONTACTS_CNT,SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) A ON A.USER_ID=C.CUSTOMER_ID ORDER BY INVOICE_ID ASC"
63,Y,N,"SELECT T1.INVOICE_ID , T2.CUSTOMER_NAME , T1.PRICE , COUNT(T3.USER_ID) AS CONTACTS_CNT , COUNT(T4.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS T1 INNER JOIN CUSTOMERS AS T2 ON T2.CUSTOMER_ID = T1.USER_ID LEFT JOIN CONTACTS AS T3 ON T3.USER_ID = T2.CUSTOMER_ID LEFT JOIN CUSTOMERS AS T4 ON T4.EMAIL = T3.CONTACT_EMAIL GROUP BY T1.INVOICE_ID, T2.CUSTOMER_NAME, T1.PRICE ORDER BY T1.INVOICE_ID"
64,Y,N,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, IFNULL(TAB1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TAB1.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C JOIN INVOICES AS I ON C.CUSTOMER_ID=I.USER_ID LEFT JOIN (SELECT CO.USER_ID AS USER_ID,COUNT(CU.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT,COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS AS CO LEFT JOIN CUSTOMERS AS CU ON CO.CONTACT_NAME=CU.CUSTOMER_NAME GROUP BY CO.USER_ID) AS TAB1 ON I.USER_ID=TAB1.USER_ID ORDER BY INVOICE_ID"
65,Y,Y,"SELECT I.INVOICE_ID, A.CUSTOMER_NAME, I.PRICE, A.CONTACTS_CNT, A.TRUSTED_CONTACTS_CNT FROM ( SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, SUM(CASE WHEN C2.CONTACT_EMAIL IS NULL THEN 0 ELSE 1 END) AS CONTACTS_CNT, IFNULL(SUM(TRUSTED_CONTACTS),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN ( SELECT *, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED_CONTACTS FROM CONTACTS ) C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY 1,2 )A JOIN INVOICES I ON I.USER_ID = A.CUSTOMER_ID ORDER BY 1"
66,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CO.USER_ID),0) AS CONTACTS_CNT, IFNULL(SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C INNER JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
67,Y,Y,"SELECT I.INVOICE_ID, T1.CUSTOMER_NAME, I.PRICE, T1.CONTACTS_CNT, T1.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN ( SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CASE WHEN CO.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY CU.CUSTOMER_ID, CU.CUSTOMER_NAME ) T1 ON I.USER_ID = T1.CUSTOMER_ID ORDER BY I.INVOICE_ID"
68,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
69,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(T.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS T ON I.USER_ID=T.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
70,N,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, SUM(CASE WHEN CONTACT_NAME IS NULL THEN 0 ELSE 1 END ) AS CONTACTS_CNT, SUM(CASE WHEN TRUSTED='Y' THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES D LEFT JOIN (SELECT CUSTOMER_ID ,CUSTOMER_NAME,CONTACT_NAME,(SELECT Y FROM CUSTOMERS WHERE CUSTOMER_NAME=B.CONTACT_NAME) AS TRUSTED FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID=B.USER_ID) C ON D.USER_ID=C.CUSTOMER_ID GROUP BY INVOICE_ID,C.CUSTOMER_NAME ORDER BY INVOICE_ID"
71,Y,Y,"SELECT TMP.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, TMP.PRICE, TMP.CONTACTS_CNT, TMP.TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, PRICE, USER_ID, COALESCE(COUNT(DISTINCT CONTACT_EMAIL), 0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CONTACTS USING(USER_ID) GROUP BY INVOICE_ID) TMP INNER JOIN CUSTOMERS ON TMP.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY INVOICE_ID"
72,Y,N,"WITH ALLCONTACTS AS (SELECT USER_ID ,COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), TRUSTEDCONTACTS AS (SELECT C.USER_ID ,IFNULL(COUNT(CUS.CUSTOMER_ID),0) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CUS ON C.CONTACT_NAME = CUS.CUSTOMER_NAME GROUP BY C.USER_ID) SELECT I.INVOICE_ID ,C.CUSTOMER_NAME ,I.PRICE ,IFNULL(AC.CONTACTS_CNT,0) AS CONTACTS_CNT ,IFNULL(TC.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN ALLCONTACTS AC ON AC.USER_ID = I.USER_ID LEFT JOIN TRUSTEDCONTACTS TC ON TC.USER_ID = I.USER_ID ORDER BY 1 ASC"
73,Y,Y,"WITH C AS (SELECT USER_ID, COUNT(*) AS CNT FROM CONTACTS GROUP BY 1), D AS (SELECT USER_ID, COUNT(*) AS CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(C.CNT, 0) AS CONTACTS_CNT, IFNULL(D.CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN D ON B.CUSTOMER_ID = D.USER_ID ORDER BY 1"
74,Y,N,"WITH CTE AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, EMAIL, COALESCE(CONTACT_COUNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN ( SELECT USER_ID, SUM(CASE WHEN EMAIL IS NULL THEN 0 ELSE 1 END) AS TRUSTED, COUNT(USER_ID) AS CONTACT_COUNT FROM CONTACTS LEFT JOIN CUSTOMERS ON EMAIL=CONTACT_EMAIL GROUP BY USER_ID ) A ON CUSTOMER_ID=USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM CTE INNER JOIN INVOICES ON CUSTOMER_ID=USER_ID ORDER BY INVOICE_ID"
75,Y,Y,"WITH CTE1 AS (SELECT CONTACTS.*, (CASE WHEN CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) CUST_COUNT FROM CONTACTS), CTE1A AS (SELECT USER_ID, SUM(CUST_COUNT) AS CC_COUNT FROM CTE1 GROUP BY USER_ID), CTE2 AS (SELECT USER_ID AS CUSTOMER_ID, COUNT(USER_ID) AS NUM_OF_CONTACTS FROM CONTACTS GROUP BY 1 ORDER BY 1) SELECT DISTINCT I.INVOICE_ID AS INVOICE_ID, C.CUSTOMER_NAME AS CUSTOMER_NAME, I.PRICE AS PRICE, IFNULL(CTE2.NUM_OF_CONTACTS, 0) AS CONTACTS_CNT, IFNULL(CTE1A.CC_COUNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS ON C.CUSTOMER_ID=CONTACTS.USER_ID LEFT JOIN CTE2 ON CONTACTS.USER_ID = CTE2.CUSTOMER_ID LEFT JOIN CTE1A ON CONTACTS.USER_ID = CTE1A.USER_ID ORDER BY 1"
76,Y,Y,"WITH CTE2 AS ( SELECT USER_ID, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN Y ELSE N END AS CN_EXISTS FROM CONTACTS ) ,CTE3 AS ( SELECT USER_ID, COUNT(USER_ID) AS COUNT1, SUM(CASE WHEN CN_EXISTS = 'Y' THEN 1 ELSE 0 END) AS COUNT2 FROM CTE2 GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT1,0) AS CONTACTS_CNT, IFNULL(COUNT2,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE3 AS C1 ON I.USER_ID = C1.USER_ID ORDER BY I.INVOICE_ID"
77,Y,Y,"WITH CTE_CONT AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE_TRUSTED_CONTACTS AS ( SELECT USER_ID,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ) SELECT INVOICE_ID,CC.CUSTOMER_NAME,PRICE, IFNULL(CO.CONTACTS_CNT,0) CONTACTS_CNT , IFNULL(TCO.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CC ON I.USER_ID = CC.CUSTOMER_ID LEFT JOIN CTE_CONT CO ON I.USER_ID= CO.USER_ID LEFT JOIN CTE_TRUSTED_CONTACTS TCO ON I.USER_ID = TCO.USER_ID ORDER BY 1"
78,Y,N,"WITH CUSTCONTACTS AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), TRUSTEDCONTACTS AS (SELECT USER_ID, COUNT(CUST.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CUST LEFT JOIN CONTACTS AS CON ON CUST.EMAIL = CON.CONTACT_EMAIL GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CUSTCONTACTS AS CC ON I.USER_ID = CC.USER_ID LEFT JOIN TRUSTEDCONTACTS AS TC ON I.USER_ID = TC.USER_ID ORDER BY INVOICE_ID"
79,Y,Y,"WITH T1 AS( SELECT CUSTOMER_ID,COUNT(C1.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C1 INNER JOIN CUSTOMERS C2 ON C1.USER_ID = C2.CUSTOMER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN T1 ON I.USER_ID = T1.CUSTOMER_ID INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
80,Y,Y,"WITH C1 AS ( SELECT A.CUSTOMER_ID ,A.CUSTOMER_NAME ,COUNT(B.CONTACT_EMAIL) AS CONTACTS_CNT ,SUM(CASE WHEN B.CONTACT_EMAIL IN (SELECT A.EMAIL FROM CUSTOMERS A) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1) SELECT I.INVOICE_ID ,C1.CUSTOMER_NAME ,I.PRICE ,C1.CONTACTS_CNT ,C1.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN C1 ON I.USER_ID = C1.CUSTOMER_ID ORDER BY 1"
81,Y,N,"WITH CONTACT_INFO AS (SELECT I.INVOICE_ID, I.PRICE, I.USER_ID AS USER_ID1, CO.USER_ID AS USER_ID2, CO.CONTACT_NAME FROM INVOICES AS I LEFT JOIN CONTACTS AS CO ON I.USER_ID = CO.USER_ID), TRUST_CONTACT_INFO AS (SELECT C.INVOICE_ID, C.PRICE, C.USER_ID1, C.USER_ID2, C.CONTACT_NAME, CU.CUSTOMER_NAME FROM CONTACT_INFO AS C LEFT JOIN CUSTOMERS AS CU ON C.CONTACT_NAME = CU.CUSTOMER_NAME), GROUP_TABLE AS (SELECT INVOICE_ID, USER_ID1, PRICE, SUM(CASE WHEN USER_ID2 IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN CUSTOMER_NAME IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM TRUST_CONTACT_INFO GROUP BY 1, 2) SELECT G.INVOICE_ID, C.CUSTOMER_NAME, G.PRICE, G.CONTACTS_CNT, G.TRUSTED_CONTACTS_CNT FROM GROUP_TABLE AS G INNER JOIN CUSTOMERS AS C ON G.USER_ID1 = C.CUSTOMER_ID ORDER BY G.INVOICE_ID"
82,Y,Y,"WITH CONTACT_STATS AS (SELECT X.USER_ID, COUNT(DISTINCT X.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT B.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS X LEFT JOIN CUSTOMERS B ON X.CONTACT_NAME = B.CUSTOMER_NAME GROUP BY 1) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(C.CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACT_STATS C ON A.USER_ID = C.USER_ID ORDER BY 1"
83,Y,N,"WITH CONTACTS_NEW AS (SELECT *, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS), CONTACT_AGG AS (SELECT U.CUSTOMER_NAME, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(C.TRUSTED) AS TRUSTED_CONTACTS_CNT FROM CONTACTS_NEW C LEFT JOIN CUSTOMERS U ON C.USER_ID = U.CUSTOMER_ID GROUP BY U.CUSTOMER_NAME) SELECT I.INVOICE_ID, U.CUSTOMER_NAME, I.PRICE, IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS U ON I.USER_ID = U.CUSTOMER_ID LEFT JOIN CONTACT_AGG C ON C.CUSTOMER_NAME = U.CUSTOMER_NAME ORDER BY 1"
84,Y,Y,"WITH CTE AS ( SELECT *, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) AND CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)THEN 1 ELSE 0 END AS REF FROM CONTACTS ), CTE1 AS ( SELECT I.INVOICE_ID, I.PRICE, I.USER_ID, C.REF AS REF FROM INVOICES I LEFT JOIN CTE C ON I.USER_ID = C.USER_ID ) SELECT CTE1.INVOICE_ID, C.CUSTOMER_NAME, CTE1.PRICE, COUNT(REF) AS CONTACTS_CNT, IFNULL(SUM(REF),0) AS TRUSTED_CONTACTS_CNT FROM CTE1 JOIN CUSTOMERS C ON CTE1.USER_ID = C.CUSTOMER_ID GROUP BY 1,2,3 ORDER BY INVOICE_ID"
85,Y,Y,"WITH CTE AS ( SELECT USER_ID, COUNT(CONTACT_NAME) CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), CTE2 AS ( SELECT USER_ID, IFNULL(COUNT(CONTACT_NAME), 0) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT I.INVOICE_ID, CX.CUSTOMER_NAME, I.PRICE, IFNULL(CTE.CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(CTE2.TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CX ON I.USER_ID = CX.CUSTOMER_ID LEFT JOIN CTE ON CX.CUSTOMER_ID = CTE.USER_ID LEFT JOIN CTE2 ON CX.CUSTOMER_ID = CTE2.USER_ID ORDER BY 1"
86,Y,Y,"WITH CTE AS (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(CN.CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(CN.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS CN ON C.CUSTOMER_ID = CN.USER_ID GROUP BY C.CUSTOMER_ID) SELECT I.INVOICE_ID, CTE.CUSTOMER_NAME, I.PRICE, CTE.CONTACTS_CNT, CTE.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CTE ON I.USER_ID = CTE.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
87,Y,Y,"WITH CTE AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CUSTOMER_ID AS USER_ID FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID), CTE2 AS (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CTE2.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(CTE2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CTE2 USING(USER_ID) ORDER BY INVOICE_ID"
88,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
89,Y,Y,"WITH CTE AS( SELECT CUSTOMERS.CUSTOMER_ID AS ID, CUSTOMERS.CUSTOMER_NAME AS NAME, CONTACTS.CONTACT_NAME AS CONTACT_NAME FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID), CTE2 AS( SELECT ID,NAME,COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CTE GROUP BY ID,NAME ) SELECT INVOICES.INVOICE_ID, CTE2.NAME AS CUSTOMER_NAME,INVOICES.PRICE,CTE2.CONTACTS_CNT,CTE2.TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CTE2 ON INVOICES.USER_ID = CTE2.ID ORDER BY INVOICES.INVOICE_ID"
90,Y,N,"WITH CTE AS( SELECT CON.USER_ID, COUNT(CON.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CUS.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_NAME = CUS.CUSTOMER_NAME GROUP BY CON.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CTE.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(CTE.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY INVOICE_ID"
91,Y,Y,"WITH CTE AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1,2) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE ON I.USER_ID = CTE.CUSTOMER_ID ORDER BY 1"
92,Y,Y,"WITH CTE_CONTACTS_CNT AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE_TRUSTED_CONTACTS_CNT AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C1 WHERE C1.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) SELECT I.INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS ON I.USER_ID = CUSTOMER_ID LEFT JOIN CTE_CONTACTS_CNT CTE1 ON I.USER_ID = CTE1.USER_ID LEFT JOIN CTE_TRUSTED_CONTACTS_CNT CTE2 ON I.USER_ID = CTE2.USER_ID ORDER BY INVOICE_ID"
93,Y,Y,"WITH CUSTOMER_CONTACT AS( SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, IFNULL(COUNT(T.CONTACT_NAME), 0) AS CONTACTS_CNT, IFNULL(SUM(T.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID=T.USER_ID GROUP BY C.CUSTOMER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMER_CONTACT AS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
94,Y,Y,"WITH CUSTOMER_CONTACT AS( SELECT CUSTOMER_ID, IFNULL(COUNT(CONTACT_NAME), 0) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_NAME IN( SELECT CUSTOMER_NAME FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMER_ID=USER_ID GROUP BY CUSTOMER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, CC.CONTACTS_CNT, CC.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CUSTOMER_CONTACT AS CC ON I.USER_ID=CC.CUSTOMER_ID ORDER BY I.INVOICE_ID"
95,Y,Y,"WITH CUSTOMER_CONTACTS AS ( SELECT USER_ID, COUNT(*) AS CC_COUNT FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACTS AS ( SELECT USER_ID, COUNT(*) AS TC_COUNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CC.CC_COUNT,0) AS CONTACTS_CNT, IFNULL(TC.TC_COUNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMER_CONTACTS CC ON I.USER_ID = CC.USER_ID LEFT JOIN TRUSTED_CONTACTS TC ON I.USER_ID = TC.USER_ID ORDER BY INVOICE_ID ASC"
96,Y,Y,"WITH CUSTOMER_CONTACTS AS( SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1, 2 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMER_CONTACTS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY 1"
97,Y,Y,"WITH NCONTACTS AS (SELECT CUSTOMER_ID, COUNT(CONTACT_EMAIL) COUNTACT_CNT FROM CUSTOMERS CUS JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUSTOMER_ID), T AS(SELECT CUSTOMER_ID, COUNT(CONTACT_EMAIL) TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID AND CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUS.CUSTOMER_NAME, PRICE, IFNULL(COUNTACT_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN NCONTACTS ON I.USER_ID = NCONTACTS.CUSTOMER_ID LEFT JOIN T ON I.USER_ID = T. CUSTOMER_ID ORDER BY INVOICE_ID"
98,Y,N,"WITH RELATED_CUSTOMERS_CTE AS ( SELECT USER_ID AS CUSTOMER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS INNER JOIN CUSTOMERS ON CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS USING(USER_ID) LEFT JOIN RELATED_CUSTOMERS_CTE USING(CUSTOMER_ID) GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
99,Y,Y,"WITH SHOP_CUSTOMERS AS ( SELECT DISTINCT X.CONTACT_NAME, X.CONTACT_EMAIL FROM CUSTOMERS C JOIN CONTACTS X ON C.CUSTOMER_NAME = X.CONTACT_NAME AND C.EMAIL = X.CONTACT_EMAIL ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(X.CONTACT_NAME) CONTACTS_CNT, COUNT(S.CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS X ON C.CUSTOMER_ID = X.USER_ID LEFT JOIN SHOP_CUSTOMERS S ON X.CONTACT_NAME = S.CONTACT_NAME AND X.CONTACT_EMAIL = S.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
100,Y,N,"WITH SUMMARY AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(IF (CUSTOMER_NAME IS NOT NULL, 1,0)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN SUMMARY ON INVOICES.USER_ID = SUMMARY.USER_ID ORDER BY INVOICE_ID"
101,Y,N,"WITH T AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), T2 AS (SELECT CO.USER_ID, COUNT(C.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS C ON C.CUSTOMER_NAME = CO.CONTACT_NAME AND C.EMAIL = CO.CONTACT_EMAIL GROUP BY CO.USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(T.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(T2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN T ON T.USER_ID = I.USER_ID LEFT JOIN T2 ON T2.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
102,Y,Y,"WITH T AS( SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME, CU.EMAIL, IFNULL(COUNT(DISTINCT C.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(COUNT(DISTINCT TRUST.EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS C ON CU.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS TRUST ON C.CONTACT_NAME = TRUST.CUSTOMER_NAME AND C.CONTACT_EMAIL = TRUST.EMAIL GROUP BY 1, 2, 3) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN T ON T.CUSTOMER_ID = INVOICES.USER_ID ORDER BY 1"
103,Y,Y,"WITH T AS( SELECT CUSTOMERS.CUSTOMER_ID, CUSTOMERS.CUSTOMER_NAME, CUSTOMERS.EMAIL, IFNULL(COUNT(DISTINCT CONTACTS.CONTACT_NAME), 0) CONTACTS_CNT, IFNULL(COUNT(DISTINCT TRUST.EMAIL), 0) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID LEFT JOIN CUSTOMERS TRUST ON CONTACTS.CONTACT_NAME = TRUST.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL = TRUST.EMAIL GROUP BY 1, 2, 3) SELECT INVOICE_ID,CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN T ON INVOICES.USER_ID = T.CUSTOMER_ID ORDER BY 1"
104,Y,Y,"WITH T1 AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) CONTACT_CNT FROM CONTACTS C GROUP BY 1 ), T2 AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) TRUSTED_CONTACT_CNT FROM CONTACTS C WHERE CONTACT_EMAIL IN ( SELECT EMAIL FROM CUSTOMERS ) GROUP BY 1 ) SELECT DISTINCT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(T1.CONTACT_CNT, 0) CONTACTS_CNT, COALESCE(T2.TRUSTED_CONTACT_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN T1 ON I.USER_ID = T1.USER_ID LEFT JOIN T2 ON I.USER_ID = T2.USER_ID ORDER BY INVOICE_ID"
105,Y,Y,"WITH T1 AS (SELECT C1.CUSTOMER_ID ,C1.CUSTOMER_NAME ,COUNT(C2.CONTACT_EMAIL) AS CONTACTS_CNT ,SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT C1.EMAIL FROM CUSTOMERS C1) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY 1) SELECT I.INVOICE_ID ,T1.CUSTOMER_NAME ,I.PRICE ,T1.CONTACTS_CNT ,T1.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN T1 ON I.USER_ID = T1.CUSTOMER_ID ORDER BY 1"
106,Y,Y,"WITH T1 AS (SELECT C1.CUSTOMER_ID ,C1.CUSTOMER_NAME ,COUNT(C2.CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY 1) ,T2 AS ( SELECT USER_ID ,SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) SELECT I.INVOICE_ID ,T1.CUSTOMER_NAME ,I.PRICE ,IFNULL(T1.CONTACTS_CNT,0) AS CONTACTS_CNT ,IFNULL(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN T1 ON I.USER_ID = T1.CUSTOMER_ID LEFT JOIN T2 ON I.USER_ID = T2.USER_ID ORDER BY 1"
107,Y,Y,"WITH TEMP AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY C1.CUSTOMER_ID ) SELECT I.INVOICE_ID, T.CUSTOMER_NAME, I.PRICE, T.CONTACTS_CNT, T.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN TEMP T ON I.USER_ID = T.CUSTOMER_ID ORDER BY I.INVOICE_ID"
108,Y,Y,"WITH TEMP1 AS ( SELECT *, (CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS FROM CONTACTS ), TEMP2 AS ( SELECT * FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID ), TEMP3 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(TRUSTED_CONTACTS) AS TRUSTED_CONTACTS_CNT FROM TEMP1 GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM TEMP2 LEFT JOIN TEMP3 ON TEMP2.USER_ID = TEMP3.USER_ID ORDER BY INVOICE_ID"
109,Y,N,"WITH TMP AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN EMAIL IS NULL THEN 0 ELSE 1 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON EMAIL=CONTACT_EMAIL GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN TMP ON I.USER_ID=TMP.USER_ID ORDER BY INVOICE_ID"
110,Y,N,"WITH TRUSTED_CONTACTS AS (SELECT USER_ID, COUNT(CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS C LEFT JOIN CUSTOMERS AS CUST ON C.CONTACT_NAME = CUST.CUSTOMER_NAME GROUP BY USER_ID), KNOWNS AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS AS C GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN KNOWNS AS K ON I.USER_ID = K.USER_ID LEFT JOIN TRUSTED_CONTACTS AS T ON I.USER_ID = T.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
111,Y,Y,"WITH ABC AS ( SELECT A.CUSTOMER_ID,COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END)AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS A LEFT JOIN CONTACTS AS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1 ), XYZ AS ( SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.USER_ID,A.PRICE FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID = B.CUSTOMER_ID ) SELECT A.INVOICE_ID,A.CUSTOMER_NAME, A.PRICE, B.CONTACTS_CNT,B.TRUSTED_CONTACTS_CNT FROM XYZ AS A JOIN ABC AS B ON A.USER_ID = B.CUSTOMER_ID ORDER BY INVOICE_ID"
112,Y,Y,"WITH CONTACT_COUNT AS (SELECT USER_ID AS USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT A.INVOICE_ID AS INVOICE_ID, B.CUSTOMER_NAME AS CUSTOMER_NAME, A.PRICE AS PRICE, IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACT_COUNT AS C ON A.USER_ID = C.USER_ID ORDER BY INVOICE_ID"
113,Y,Y,"WITH CTE AS (SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME, I.INVOICE_ID, I.PRICE, I.USER_ID FROM CUSTOMERS CU JOIN INVOICES I ON CU.CUSTOMER_ID = I.USER_ID ), CTE2 AS (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT , COUNT(DISTINCT CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_NAME=CO.CONTACT_NAME GROUP BY CO.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0)AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0)AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CTE2 USING (USER_ID) ORDER BY INVOICE_ID"
114,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(C2.USER_ID),0) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON I.USER_ID = C2.USER_ID GROUP BY 1 ORDER BY 1"
115,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY I.INVOICE_ID, CU.CUSTOMER_NAME, CO.USER_ID ORDER BY I.INVOICE_ID"
116,Y,Y,"SELECT INVOICES.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, SUM(IF(CONTACTS.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID = INVOICES.USER_ID GROUP BY INVOICE_ID, INVOICES.USER_ID ORDER BY INVOICES.INVOICE_ID"
117,Y,Y,"SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, (CASE WHEN A.CONTACTS_CNT IS NULL THEN 0 ELSE A.CONTACTS_CNT END) AS CONTACTS_CNT, (CASE WHEN B.TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE B.TRUSTED_CONTACTS_CNT END ) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACTS.CONTACT_EMAIL) AS CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE) A LEFT JOIN (SELECT INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACTS.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID WHERE CONTACTS.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE) B ON A.INVOICE_ID = B.INVOICE_ID AND A.CUSTOMER_ID = B.CUSTOMER_ID ORDER BY A.INVOICE_ID"
118,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACT_CNT,0) CONTACTS_CNT, COALESCE(D.TRUSTED_CONTACT_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACT_CNT FROM CONTACTS GROUP BY 1) C ON A.USER_ID = C.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACT_CNT FROM CONTACTS E INNER JOIN CUSTOMERS F ON E.CONTACT_NAME = F.CUSTOMER_NAME GROUP BY 1)D ON A.USER_ID = D.USER_ID ORDER BY 1"
119,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(C.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
120,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CASE WHEN D.CUSTOMER_NAME IS NOT NULL THEN C.CONTACT_NAME ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID=C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_NAME=D.CUSTOMER_NAME AND C.CONTACT_EMAIL=D.EMAIL GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE ORDER BY A.INVOICE_ID"
121,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(D.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON B.CUSTOMER_ID = A.USER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON D.EMAIL = C.CONTACT_EMAIL GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
122,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) CONTACTS_CNT, COUNT(D.CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_NAME = D.CUSTOMER_NAME AND C.CONTACT_EMAIL = D.EMAIL GROUP BY 1,2,3 ORDER BY 1"
123,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C USING (USER_ID) GROUP BY 1,2,3 ORDER BY 1"
124,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(DISTINCT C.CONTACT_NAME ) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON A.USER_ID = C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
125,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(DISTINCT C.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE"
126,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(COUNT(C.CONTACT_EMAIL),0) CONTACTS_CNT, IFNULL(D.TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) D ON A.USER_ID = D.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
127,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(COUNT(C.CONTACT_EMAIL),0) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
128,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE,COALESCE(C.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(D.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS C ON A.USER_ID=C.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A INNER JOIN CUSTOMERS B ON A.CONTACT_NAME=B.CUSTOMER_NAME GROUP BY USER_ID) AS D ON A.USER_ID= D.USER_ID ORDER BY A.INVOICE_ID"
129,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE,COALESCE(C.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(D.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS C ON A.USER_ID=C.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN ( SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) AS D ON A.USER_ID= D.USER_ID ORDER BY A.INVOICE_ID"
130,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, MIN(PRICE) AS PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COUNT(D.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_NAME = D.CUSTOMER_NAME GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME ORDER BY 1"
131,Y,Y,"SELECT A.INVOICE_ID, C.CUSTOMER_NAME, A.PRICE, COUNT(B.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CONTACTS B ON A.USER_ID = B.USER_ID LEFT JOIN CUSTOMERS C ON A.USER_ID = C.CUSTOMER_ID GROUP BY 1,2,3 ORDER BY 1"
132,Y,Y,"SELECT A.INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT(CO.CONTACT_NAME)) AS CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID) A LEFT JOIN (SELECT INVOICE_ID, COUNT(DISTINCT(C.CONTACT_NAME)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS C ON C.USER_ID = I.USER_ID WHERE C.CONTACT_NAME IN ( SELECT DISTINCT(CUSTOMER_NAME) FROM CUSTOMERS) GROUP BY INVOICE_ID) B ON A.INVOICE_ID = B.INVOICE_ID"
133,Y,Y,"SELECT C.INVOICE_ID , A.CUSTOMER_NAME , C.PRICE , COUNT(B.USER_ID) CONTACTS_CNT , SUM(IF( CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) ,1,0)) TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID INNER JOIN INVOICES C ON C.USER_ID = A.CUSTOMER_ID GROUP BY 1 ORDER BY 1"
134,Y,N,"SELECT C.INVOICE_ID, A.CUSTOMER_NAME, C.PRICE, A.CONTACTS_CNT, B.TRUSTED_CONTACTS_CNT FROM (SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME, IFNULL(COUNT(DISTINCT B.CONTACT_EMAIL),0) AS CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY A.CUSTOMER_ID) AS A INNER JOIN (SELECT C.CUSTOMER_NAME, IFNULL(COUNT(DISTINCT B.CONTACT_EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A INNER JOIN CONTACTS B ON A.CUSTOMER_NAME = B.CONTACT_NAME AND A.EMAIL = B.CONTACT_EMAIL RIGHT JOIN CUSTOMERS C ON C.CUSTOMER_ID = B.USER_ID GROUP BY C.CUSTOMER_ID) AS B ON A.CUSTOMER_NAME = B.CUSTOMER_NAME INNER JOIN INVOICES C ON A.CUSTOMER_ID = C.USER_ID ORDER BY 1"
135,Y,N,"SELECT C.INVOICE_ID, A.CUSTOMER_NAME, C.PRICE, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT D.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES C LEFT JOIN CUSTOMERS A ON A.CUSTOMER_ID = C.USER_ID LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN CUSTOMERS D ON B.CONTACT_NAME = D.CUSTOMER_NAME GROUP BY 1, 2, 3"
136,Y,N,"SELECT C.INVOICE_ID, A.CUSTOMER_NAME, C.PRICE, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT D.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES C LEFT JOIN CUSTOMERS A ON A.CUSTOMER_ID = C.USER_ID LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN CUSTOMERS D ON B.CONTACT_NAME = D.CUSTOMER_NAME GROUP BY C.INVOICE_ID"
137,Y,Y,"SELECT DISTINCT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) OVER (PARTITION BY I.INVOICE_ID) AS CONTACTS_CNT, COUNT(IF(CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS),1,NULL)) OVER (PARTITION BY I.INVOICE_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CU JOIN INVOICES AS I ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON I.USER_ID = CO.USER_ID ORDER BY I.INVOICE_ID"
138,Y,Y,"SELECT I.INVOICE_ID , MAX(C.CUSTOMER_NAME) AS CUSTOMER_NAME , MAX(I.PRICE) AS PRICE , COUNT(DISTINCT A.CONTACT_NAME) AS CONTACTS_CNT , COALESCE(COUNT(CASE WHEN A.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN C.CUSTOMER_NAME END), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS A ON C.CUSTOMER_ID = A.USER_ID GROUP BY 1 ORDER BY 1"
139,Y,Y,"SELECT I.INVOICE_ID , MAX(C.CUSTOMER_NAME) AS CUSTOMER_NAME , MAX(I.PRICE) AS PRICE , COUNT(DISTINCT D.CONTACT_NAME) AS CONTACTS_CNT , COALESCE(COUNT(CASE WHEN D.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN C.CUSTOMER_NAME END), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS D ON C.CUSTOMER_ID = D.USER_ID GROUP BY 1 ORDER BY 1"
140,Y,Y,"SELECT I.INVOICE_ID AS INVOICE_ID, CU.CUSTOMER_NAME AS CUSTOMER_NAME, I.PRICE AS PRICE, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS CU ON CU.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS CON ON CON.USER_ID = CU.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID ASC"
141,Y,Y,"SELECT I.INVOICE_ID INVOICE_ID, C.CUSTOMER_NAME CUSTOMER_NAME, I.PRICE PRICE,COUNT(DISTINCT CO.CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID=CO.USER_ID GROUP BY I.INVOICE_ID"
142,Y,Y,"SELECT I.INVOICE_ID, A.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(DISTINCT B.CONTACT_NAME), 0) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS A ON I.USER_ID = A.CUSTOMER_ID LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1, 2 ORDER BY 1"
143,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE , COUNT(CONT.CONTACT_EMAIL) CONTACTS_CNT , SUM(IF(CONT.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1, 0)) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CONT ON CONT.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
144,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, IFNULL(COUNT(T.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(SUM( CASE WHEN T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS T ON T.USER_ID=C.CUSTOMER_ID GROUP BY C.CUSTOMER_ID ) AS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
145,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, IFNULL(COUNT(T.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(SUM(T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS T ON T.USER_ID=C.CUSTOMER_ID GROUP BY C.CUSTOMER_ID ) AS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
146,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, IFNULL(COUNT(T.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(SUM(T.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS T ON T.USER_ID=C.CUSTOMER_ID GROUP BY C.CUSTOMER_ID ) AS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
147,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT,C.TRUSTED_CONTACTS_CNT FROM (SELECT A.*, IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT CUS.CUSTOMER_ID, CUS.CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID)A LEFT JOIN (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID=CON.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_ID)B ON A.CUSTOMER_ID=B.CUSTOMER_ID)C RIGHT JOIN INVOICES I ON I.USER_ID=C.CUSTOMER_ID ORDER BY INVOICE_ID"
148,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID=C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
149,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID, I.INVOICE_ID ORDER BY I.INVOICE_ID"
150,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS ) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID GROUP BY 1, 2, 3 ORDER BY I.INVOICE_ID"
151,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
152,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CONTACTS.CONTACT_NAME) CONTACTS_CNT, COUNT(C2.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID = I.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CONTACTS.CONTACT_EMAIL GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
153,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CT.CONTACT_EMAIL) AS CONTACTS_CNT , SUM(CASE WHEN CT.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID,C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
154,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CT.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CC.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C INNER JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID LEFT JOIN CUSTOMERS CC ON CC.EMAIL = CT.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
155,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CO.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT C2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS C2 ON CO.CONTACT_NAME = C2.CUSTOMER_NAME AND CO.CONTACT_EMAIL = C2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
156,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CO.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID GROUP BY I.INVOICE_ID ORDER BY 1"
157,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CON.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT TC.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS TC ON CON.CONTACT_NAME = TC.CUSTOMER_NAME GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
158,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID=C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON CT.CONTACT_EMAIL=C2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
159,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT CC.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS CC ON CC.EMAIL = CT.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
160,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT CC.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID= C.CUSTOMER_ID LEFT JOIN CUSTOMERS CC ON CC.EMAIL = CT.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
161,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID"
162,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID"
163,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(AGG.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(AGG.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT CT.USER_ID, COUNT(DISTINCT CONTACT_EMAIL) CONTACTS_CNT, IFNULL(COUNT(DISTINCT CU.CUSTOMER_ID),0) TRUSTED_CONTACTS_CNT FROM CONTACTS CT LEFT JOIN CUSTOMERS CU ON CT.CONTACT_EMAIL = CU.EMAIL GROUP BY CT.USER_ID ) AGG ON I.USER_ID = AGG.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
164,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CN.CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CN.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID = CN.USER_ID GROUP BY 1 ORDER BY 1"
165,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CO.CONTACT_NAME ),0) AS CONTACTS_CNT, IFNULL(COUNT(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE NULL END) ,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
166,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CO.CONTACT_NAME ),0) AS CONTACTS_CNT, IFNULL(COUNT(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE NULL END) ,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = I.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
167,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE,COUNT(CT.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID ASC"
168,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(T.USER_ID) CONTACTS_CNT, COUNT(DISTINCT E.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON T.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS E ON E.EMAIL = T.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
169,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(C3.CNT1,0) AS CONTACTS_CNT, IFNULL(C3.CNT2,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT C1.USER_ID, C1.CNT1, C2.CNT2 FROM (SELECT USER_ID, COUNT(USER_ID) AS CNT1 FROM CONTACTS GROUP BY USER_ID) C1 LEFT JOIN (SELECT USER_ID, COUNT(USER_ID) AS CNT2 FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) C2 ON C1.USER_ID = C2.USER_ID) C3 ON I.USER_ID = C3.USER_ID ORDER BY INVOICE_ID"
170,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, SUM(I.PRICE) AS PRICE, IFNULL(FCNT,0) AS CONTACTS_CNT, IFNULL(CFCNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C JOIN INVOICES I ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS FCNT FROM CONTACTS GROUP BY USER_ID) CO ON I.USER_ID = CO.USER_ID LEFT JOIN ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CFCNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) SQ ON SQ.USER_ID = I.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
171,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COALESCE(ABC.CT,0) AS CONTACTS_CNT, COALESCE(ABC.TCT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CT ,SUM(TRUST) AS TCT FROM ( SELECT USER_ID, (CONTACT_NAME), CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUST FROM CUSTOMERS C INNER JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID) A GROUP BY 1) ABC ON I.USER_ID = ABC.USER_ID INNER JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID = I.USER_ID ORDER BY 1"
172,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS AS C2 ON C.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY 1,2,3 ORDER BY 1"
173,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS C2 ON C2.USER_ID = I.USER_ID GROUP BY 1 ORDER BY 1"
174,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C1.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CO.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
175,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C1.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS C2 ON CO.CONTACT_EMAIL = C2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
176,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(DISTINCT C2.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(COUNT(DISTINCT C_TRUST.CUSTOMER_ID),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C2.USER_ID = C1.CUSTOMER_ID LEFT JOIN CUSTOMERS C_TRUST ON C_TRUST.EMAIL = C2.CONTACT_EMAIL GROUP BY 1,2,3"
177,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COALESCE(B.CONTACTS_CNT,0)CONTACTS_CNT, COALESCE(A.TRUSTED_CONTACTS_CNT,0)TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID=I. USER_ID LEFT JOIN(SELECT USER_ID, COUNT(CONTACT_NAME)TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID)A ON I.USER_ID=A.USER_ID LEFT JOIN(SELECT USER_ID, COUNT(CONTACT_NAME)CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID)B ON B.USER_ID=I.USER_ID ORDER BY INVOICE_ID"
178,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS C USING (USER_ID) LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID GROUP BY 1 ORDER BY 1"
179,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) CONTACTS_CNT , COALESCE(TCO.TRUSTED_COUNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_COUNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) TCO ON TCO.USER_ID = CU.CUSTOMER_ID GROUP BY 1, 2, 3 ORDER BY I.INVOICE_ID"
180,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) CONTACTS_CNT , COALESCE(TCO.TRUSTED_COUNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_COUNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ) TCO ON TCO.USER_ID = CU.CUSTOMER_ID GROUP BY 1, 2, 3 ORDER BY I.INVOICE_ID"
181,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CO.CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID=CO.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
182,Y,N,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(LIST.C_EMAIL) AS CONTACTS_CNT, COUNT(LIST.TRUSTED_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT CO.USER_ID AS CONTACT_ID, CO.CONTACT_EMAIL AS C_EMAIL, CU.EMAIL AS TRUSTED_EMAIL FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CU.EMAIL = CO.CONTACT_EMAIL) LIST ON I.USER_ID=LIST.CONTACT_ID LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID ASC"
183,Y,Y,"SELECT I.INVOICE_ID, CUST.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CONTACTS.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT TRUSTED_CUST.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT OUTER JOIN CONTACTS ON I.USER_ID = CONTACTS.USER_ID LEFT OUTER JOIN CUSTOMERS TRUSTED_CUST ON CONTACTS.CONTACT_EMAIL = TRUSTED_CUST.EMAIL GROUP BY 1, 2 , 3"
184,Y,Y,"SELECT I.INVOICE_ID, CUST.CUSTOMER_NAME,I.PRICE, COUNT(CONT.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONT.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS CONT ON I.USER_ID = CONT.USER_ID GROUP BY 1,2,3 ORDER BY I.INVOICE_ID"
185,Y,Y,"SELECT I.INVOICE_ID, CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, COUNT(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN CONTACT_EMAIL END) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID=CO.USER_ID GROUP BY 1,2,3 ORDER BY 1"
186,Y,Y,"SELECT I.INVOICE_ID, CUSTOMER_NAME, I.PRICE, COUNT(CS.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CS.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CS ON C.CUSTOMER_ID = CS.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
187,Y,N,"SELECT I.INVOICE_ID, MIN(CU.CUSTOMER_NAME) AS CUSTOMER_NAME, MIN(I.PRICE) AS PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CU2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS AS CU2 ON C.CONTACT_NAME = CU2.CUSTOMER_NAME GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
188,Y,N,"SELECT I.INVOICE_ID, T.CUSTOMER_NAME, I.PRICE, T.CONTACTS_CNT, T.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN (SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME , COUNT(DISTINCT C.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT C2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C ON C1.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS C2 ON C.CONTACT_EMAIL = C2.EMAIL GROUP BY C1.CUSTOMER_ID) T ON I.USER_ID = T.CUSTOMER_ID ORDER BY I.INVOICE_ID"
189,Y,Y,"SELECT I.INVOICE_ID, T.CUSTOMER_NAME, I.PRICE, T.CONTACTS_CNT, T.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN (SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME , COUNT(DISTINCT C.CONTACT_EMAIL) AS CONTACTS_CNT, SUM( CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C ON C1.CUSTOMER_ID = C.USER_ID GROUP BY C1.CUSTOMER_ID)T ON I.USER_ID = T.CUSTOMER_ID ORDER BY I.INVOICE_ID"
190,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, IFNULL(COUNT(DISTINCT C1.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT(CUSTOMER_NAME) FROM CUSTOMERS) THEN 1 ELSE 0 END),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID=I.USER_ID LEFT JOIN CONTACTS C1 ON C.CUSTOMER_ID=C1.USER_ID GROUP BY I.INVOICE_ID"
191,Y,Y,"SELECT I.INVOICE_ID,C1.CUSTOMER_NAME,I.PRICE, COUNT(DISTINCT C2.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C1 ON I.USER_ID=C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID=C2.USER_ID GROUP BY 1"
192,Y,Y,"SELECT I.INVOICE_ID,C1.CUSTOMER_NAME,I.PRICE, COUNT(DISTINCT C2.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C1 ON I.USER_ID=C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID=C2.USER_ID GROUP BY 1 ORDER BY 1"
193,Y,Y,"SELECT I.INVOICE_ID,C1.CUSTOMER_NAME,I.PRICE,COUNT(DISTINCT C2.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID=C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID=C2.USER_ID GROUP BY 1 ORDER BY 1"
194,Y,Y,"SELECT I.INVOICE_ID,CON.CUSTOMER_NAME,I.PRICE,CON.CONTACTS_CNT,CON.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN (SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, COUNT(B.CONTACT_EMAIL)CONTACTS_CNT,SUM(CASE WHEN B.CONTACT_EMAIL IN(SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END)AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS B ON C.CUSTOMER_ID=B.USER_ID GROUP BY C.CUSTOMER_ID)CON ON I.USER_ID=CON.CUSTOMER_ID ORDER BY I.INVOICE_ID"
195,Y,N,"SELECT INV.INVOICE_ID AS INVOICE_ID, CUS.CUSTOMER_NAME AS CUSTOMER_NAME, INV.PRICE AS PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(CUS1.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS CUS ON INV.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CUSTOMERS CUS1 ON CUS1.CUSTOMER_NAME = CON.CONTACT_NAME AND CUS1.EMAIL = CON.CONTACT_EMAIL GROUP BY 1 ORDER BY 1 ASC"
196,Y,Y,"SELECT INV.INVOICE_ID, CUS1.CUSTOMER_NAME, INV.PRICE, COUNT(DISTINCT CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT CASE WHEN CUS2.EMAIL IS NOT NULL THEN CON.CONTACT_EMAIL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS CUS1 ON INV.USER_ID = CUS1.CUSTOMER_ID LEFT JOIN CONTACTS CON ON INV.USER_ID = CON.USER_ID LEFT JOIN CUSTOMERS CUS2 ON CON.CONTACT_EMAIL = CUS2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
197,Y,Y,"SELECT INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TCC.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS CC ON I.USER_ID = CC.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) AS TCC ON I.USER_ID = TCC.USER_ID ORDER BY INVOICE_ID"
198,Y,N,"SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME ,PRICE, COALESCE(COUNT(CONTACT_EMAIL),0) AS CONTACTS_CNT, SUM(CASE WHEN C.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID LEFT JOIN CUSTOMERS C ON CONTACTS.CONTACT_EMAIL = C.EMAIL GROUP BY INVOICE_ID, CUSTOMERS.CUSTOMER_ID ORDER BY 1"
199,Y,N,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COUNT(B2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS B2 ON B2.EMAIL = C.CONTACT_EMAIL GROUP BY 1 ORDER BY 1"
200,Y,Y,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, COUNT(CASE WHEN C.CONTACT_EMAIL IS NOT NULL THEN C.CONTACT_EMAIL ELSE NULL END) AS CONTACTS_CNT, COUNT(CASE WHEN C.CONTACT_EMAIL IS NOT NULL AND C.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN C.CONTACT_EMAIL ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID=C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
201,Y,Y,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(O.CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END )TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS O ON C.CUSTOMER_ID = O. USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
202,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(O.CONTACT_NAME) CONTACTS_CNT, COUNT(A.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS O ON C.CUSTOMER_ID = O. USER_ID LEFT JOIN CUSTOMERS A ON A.EMAIL = O.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME,I.PRICE ORDER BY I.INVOICE_ID"
203,Y,Y,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(COUNT(DISTINCT CO.CONTACT_EMAIL),0) CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID=I.USER_ID GROUP BY 1,2 ORDER BY 1,2"
204,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE,COUNT(CO.USER_ID) AS CONTACTS_CNT, COUNT(E.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID=CO.USER_ID LEFT JOIN CUSTOMERS E ON E.EMAIL = CO.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
205,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME,I.PRICE ,A.CONTACTS_CNT,IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT CUSTOMER_NAME,COUNT(USER_ID) AS CONTACTS_CNT FROM CUSTOMERS AS CU LEFT JOIN CONTACTS AS CO ON CU.CUSTOMER_ID=CO.USER_ID GROUP BY CUSTOMER_NAME) A ON C.CUSTOMER_NAME =A.CUSTOMER_NAME LEFT JOIN (SELECT CUSTOMER_NAME,COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CU LEFT JOIN CONTACTS AS CO ON CU.CUSTOMER_ID=CO.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_NAME) B ON A.CUSTOMER_NAME=B.CUSTOMER_NAME ORDER BY INVOICE_ID ASC"
206,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME , PRICE , COUNT(CT.USER_ID) AS CONTACTS_CNT , COUNT(IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS ),1, NULL)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY I.INVOICE_ID ORDER BY INVOICE_ID"
207,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM ( SELECT INVOICE_ID, INVOICES.USER_ID, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) A ON INVOICES.USER_ID = A.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(USER_ID) AS TRUSTED_CONTACTS_CNT FROM CONTACTS, CUSTOMERS WHERE CUSTOMERS.EMAIL = CONTACTS.CONTACT_EMAIL GROUP BY USER_ID) B ON INVOICES.USER_ID = B.USER_ID ORDER BY INVOICE_ID ) AS COMBINE LEFT JOIN CUSTOMERS ON COMBINE.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY INVOICE_ID"
208,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT CUSTOMER_NAME, CUSTOMER_ID, COUNT(USER_ID) AS CONTACTS_CNT, SUM(IFNULL((CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS))=1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS O ON C.CUSTOMER_ID=O.USER_ID GROUP BY CUSTOMER_NAME, CUSTOMER_ID) T ON I.USER_ID=T.CUSTOMER_ID ORDER BY INVOICE_ID"
209,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN(SELECT CUSTOMERS.CUSTOMER_ID, CUSTOMERS.CUSTOMER_NAME, CUSTOMERS.EMAIL, IFNULL(COUNT(DISTINCT CON.CONTACT_NAME), 0) AS CONTACTS_CNT, IFNULL(COUNT(DISTINCT TRUST.EMAIL), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS CON ON CUSTOMERS.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS TRUST ON CON.CONTACT_NAME = TRUST.CUSTOMER_NAME AND CON.CONTACT_EMAIL = TRUST.EMAIL GROUP BY 1, 2, 3) X ON INVOICES.USER_ID = X.CUSTOMER_ID ORDER BY 1"
210,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CASE WHEN C.CONTACT_EMAIL IS NOT NULL THEN CONTACT_EMAIL ELSE NULL END) AS CONTACTS_CNT, COUNT(CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN CONTACT_EMAIL ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID=C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
211,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
212,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, IFNULL(SUM(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)),0) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
213,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
214,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID=USER_ID JOIN INVOICES ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID GROUP BY INVOICE_ID,CUSTOMER_NAME ORDER BY INVOICE_ID"
215,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) CONTACTS_CNT, SUM(TRUSTED) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT C.CUSTOMER_ID, CUSTOMER_NAME, CONTACT_NAME, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END TRUSTED FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID) TEMP ON I.USER_ID = TEMP.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
216,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.CONTACT_EMAIL) CONTACTS_CNT, SUM(IF(CONTACTS.CONTACT_EMAIL IN (SELECT CUSTOMERS.EMAIL FROM CUSTOMERS), 1, 0)) TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID=INVOICES.USER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID=CUSTOMERS.CUSTOMER_ID GROUP BY 1 ORDER BY 1"
217,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0 )) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS USING (USER_ID) GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
218,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CS ON CS.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CN ON CS.CUSTOMER_ID = CN.USER_ID GROUP BY 1"
219,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT(CO.CONTACT_NAME)) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN ( SELECT DISTINCT(CUSTOMER_NAME) FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
220,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACT_CNT,0) AS CONTACTS_CNT, IFNULL(TRUST_CONTACT_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACT_CNT FROM CONTACTS GROUP BY USER_ID) T ON I.USER_ID = T.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TRUST_CONTACT_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) T2 ON I.USER_ID = T2.USER_ID ORDER BY 1"
221,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, USER_ID FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID ) T1 LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) T2 ON T1.USER_ID = T2.USER_ID ORDER BY INVOICE_ID"
222,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(C.USER_ID),0) AS CONTACTS_CNT, IFNULL(SUM(CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CT INNER JOIN INVOICES I ON I.USER_ID= CT.CUSTOMER_ID LEFT JOIN CONTACTS C ON CT.CUSTOMER_ID= C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
223,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_NAME),0) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
224,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME,PRICE,COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF (CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0) )AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C2 LEFT JOIN CONTACTS C1 ON C1.USER_ID=C2.CUSTOMER_ID JOIN INVOICES I ON I.USER_ID=C2.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
225,Y,Y,"SELECT INVOICE_ID, T2.CUSTOMER_NAME, PRICE, COUNT(DISTINCT T3.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT T4.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES T1 LEFT JOIN CUSTOMERS T2 ON T1.USER_ID = T2.CUSTOMER_ID LEFT JOIN CONTACTS T3 ON T1.USER_ID = T3.USER_ID LEFT JOIN CUSTOMERS T4 ON T3.CONTACT_NAME = T4.CUSTOMER_NAME GROUP BY 1,2,3"
226,Y,N,"SELECT INVOICE_ID,CS.CUSTOMER_NAME,PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS CS ON INVOICES.USER_ID = CS.CUSTOMER_ID LEFT JOIN CONTACTS C ON CS.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.CUSTOMER_NAME = C.CONTACT_NAME GROUP BY 1 ORDER BY 1"
227,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SUB ON INVOICES.USER_ID=SUB.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) SUB2 ON INVOICES.USER_ID=SUB2.USER_ID ORDER BY INVOICE_ID"
228,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID LEFT JOIN( SELECT USER_ID AS CI,COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT,SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY CI ) T ON INVOICES.USER_ID=T.CI ORDER BY INVOICE_ID"
229,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,IFNULL(COUNT(CONTACT_NAME),0) CONTACTS_CNT, IFNULL(SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS CO USING(USER_ID) GROUP BY 1,2,3 ORDER BY 1"
230,Y,N,"SELECT INVOICES.INVOICE_ID ,CUSTOMERS.CUSTOMER_NAME ,INVOICES.PRICE ,COUNT(CONTACT_NAME) AS CONTACTS_CNT ,COUNT(EMAILS.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES INVOICES LEFT JOIN CUSTOMERS CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS CONTACTS ON INVOICES.USER_ID = CONTACTS.USER_ID LEFT JOIN CUSTOMERS EMAILS ON EMAILS.EMAIL = CONTACTS.CONTACT_EMAIL GROUP BY INVOICES.INVOICE_ID,INVOICES.PRICE,CUSTOMERS.CUSTOMER_NAME ORDER BY INVOICE_ID"
231,Y,Y,"SELECT INVOICES.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, COUNT(CONTACTS.CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY 1,2,3 ORDER BY 1"
232,Y,N,"SELECT INVOICES.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, COUNT(TRUSTED_CONTACTS.USER_ID) CONTACTS_CNT, SUM(IFNULL(TRUSTED_CONTACTS.CAN_TRUST, 0)) TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, CASE WHEN CUSTOMERS.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END CAN_TRUST FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME=CUSTOMERS.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL ) TRUSTED_CONTACTS ON CUSTOMERS.CUSTOMER_ID = TRUSTED_CONTACTS.USER_ID GROUP BY INVOICES.INVOICE_ID, INVOICES.USER_ID ORDER BY INVOICES.INVOICE_ID"
233,Y,Y,"SELECT T1.INVOICE_ID, T2.CUSTOMER_NAME, T1.PRICE, IFNULL(SUM(T3.CONTACTS_CNT),0) AS CONTACTS_CNT, IFNULL(SUM(T4.TRUSTED_CONTACTS_CNT),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES T1 JOIN CUSTOMERS T2 ON T1.USER_ID=T2.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1) T3 ON T1.USER_ID=T3.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY 1) T4 ON T1.USER_ID=T4.USER_ID GROUP BY 1,2,3 ORDER BY 1"
234,Y,Y,"SELECT T2.INVOICE_ID, T1.CUSTOMER_NAME, T2.PRICE, IFNULL(COUNT(T3.USER_ID),0) AS CONTACTS_CNT, IFNULL(SUM(CASE WHEN T3.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS T1 JOIN INVOICES AS T2 ON T1.CUSTOMER_ID = T2.USER_ID LEFT JOIN CONTACTS AS T3 ON T1.CUSTOMER_ID = T3.USER_ID GROUP BY T2.INVOICE_ID, T1.CUSTOMER_NAME, T2.PRICE ORDER BY T2.INVOICE_ID"
235,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME,EMAIL, COUNT(C.USER_ID) AS CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS C ON C.USER_ID=CUSTOMER_ID GROUP BY CUSTOMER_ID,CUSTOMER_NAME,EMAIL ), CTE2 AS( SELECT CUSTOMER_ID,CUSTOMER_NAME,EMAIL, CONTACTS_CNT, COUNT(TC.USER_ID) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CONTACTS TC ON TC.USER_ID=CTE.CUSTOMER_ID AND TC.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUSTOMER_ID,CUSTOMER_NAME,EMAIL ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM INVOICES INNER JOIN CTE2 ON CUSTOMER_ID=USER_ID ORDER BY INVOICE_ID"
236,Y,Y,"WITH CONTACT_CT AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, IFNULL(C2.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACT_CT C2 ON C1.CUSTOMER_ID = C2. USER_ID ORDER BY INVOICE_ID"
237,Y,Y,"WITH TC AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ), CC AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CC.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TC.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CC ON I.USER_ID=CC.USER_ID LEFT JOIN TC ON I.USER_ID=TC.USER_ID ORDER BY I.INVOICE_ID ASC"
238,Y,N,"WITH A AS (SELECT USER_ID, COUNT(CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME AND CO.CONTACT_EMAIL = CU.EMAIL GROUP BY USER_ID), B AS (SELECT USER_ID, COUNT(USER_ID) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID LEFT JOIN A ON A.USER_ID = I.USER_ID LEFT JOIN B ON B.USER_ID = I.USER_ID ORDER BY INVOICE_ID"
239,Y,Y,"WITH A AS( SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, I.USER_ID FROM CUSTOMERS C JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID), B AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), C AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, IFNULL(B.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM A LEFT JOIN B ON A.USER_ID = B.USER_ID LEFT JOIN C ON A.USER_ID = C.USER_ID ORDER BY A.INVOICE_ID"
240,Y,Y,"WITH A AS(SELECT USER_ID,IFNULL(COUNT(*),0) AS CONTACTS_ FROM CONTACTS GROUP BY USER_ID) , B AS (SELECT USER_ID, IFNULL(COUNT(USER_ID),0) AS TRUSTED FROM CONTACTS WHERE CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_,0) AS CONTACTS_CNT, IFNULL(TRUSTED,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN A ON A.USER_ID = C.CUSTOMER_ID LEFT JOIN B ON B.USER_ID = C.CUSTOMER_ID ORDER BY 1"
241,Y,Y,"WITH BASE AS ( SELECT I.INVOICE_ID, I.PRICE, C.CUSTOMER_NAME, CT.CONTACT_NAME, CASE WHEN CT.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM INVOICES I LEFT OUTER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT OUTER JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(TRUSTED) AS TRUSTED_CONTACTS_CNT FROM BASE GROUP BY 1,2,3 ORDER BY 1"
242,Y,N,"WITH BB AS (SELECT A.USER_ID AS ID, COUNT(B.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS A LEFT JOIN CUSTOMERS AS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY A.USER_ID), AA AS (SELECT A.CUSTOMER_ID AS ID, A.CUSTOMER_NAME, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS AS A LEFT JOIN CONTACTS AS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY A.CUSTOMER_ID) SELECT A.INVOICE_ID, AA.CUSTOMER_NAME, A.PRICE, IFNULL(AA.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(BB.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN AA ON A.USER_ID=AA.ID LEFT JOIN BB ON A.USER_ID=BB.ID ORDER BY A.INVOICE_ID"
243,Y,Y,"WITH CC AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(DISTINCT CONTACT_NAME) CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY CUSTOMER_ID) , TCC AS (SELECT CUSTOMER_ID, COUNT(DISTINCT CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CC ON A.USER_ID = CC.CUSTOMER_ID LEFT JOIN TCC ON A.USER_ID = TCC.CUSTOMER_ID ORDER BY INVOICE_ID"
244,Y,Y,"WITH CNT AS ( SELECT C.CUSTOMER_NAME, C.CUSTOMER_ID, COUNT(CN.USER_ID) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID=CN.USER_ID GROUP BY C.CUSTOMER_ID ), TRUST AS ( SELECT C.CUSTOMER_NAME, C.CUSTOMER_ID, COUNT(CN.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID=CN.USER_ID WHERE CN.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY C.CUSTOMER_ID ) SELECT I.INVOICE_ID, CNT.CUSTOMER_NAME, I.PRICE, IFNULL(CNT.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUST.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CNT ON I.USER_ID = CNT.CUSTOMER_ID LEFT JOIN TRUST ON I.USER_ID = TRUST.CUSTOMER_ID ORDER BY INVOICE_ID"
245,Y,N,"WITH CNT AS ( SELECT T.USER_ID, COUNT(*) CONTACTS_CNT, SUM(TRUSTED) TRUSTED_CONTACTS_CNT FROM ( SELECT CT.*, CASE WHEN CM.EMAIL IS NULL THEN 0 ELSE 1 END TRUSTED FROM CONTACTS CT LEFT JOIN CUSTOMERS CM ON CT.CONTACT_EMAIL = CM.EMAIL ) T GROUP BY T.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE , COALESCE(CONTACTS_CNT, 0) CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CNT ON I.USER_ID = CNT.USER_ID ORDER BY I.INVOICE_ID"
246,Y,N,"WITH CNTS AS ( SELECT USER_ID, COUNT(*) AS NUM FROM CONTACTS GROUP BY 1 ), TRUSTED_CNTS AS ( SELECT C.USER_ID, COUNT(CUST.EMAIL) AS TRUSTED_COUNT FROM CONTACTS C LEFT JOIN CUSTOMERS CUST ON CUST.EMAIL = C.CONTACT_EMAIL GROUP BY 1 ) SELECT I.INVOICE_ID, CON.CUSTOMER_NAME, I.PRICE, COALESCE(C.NUM,0) AS CONTACTS_CNT, COALESCE(T.TRUSTED_COUNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CON ON CON.CUSTOMER_ID= I.USER_ID LEFT JOIN CNTS C ON C.USER_ID = I.USER_ID LEFT JOIN TRUSTED_CNTS T ON T.USER_ID = I.USER_ID ORDER BY 1"
247,Y,N,"WITH CONT_COUNT AS( SELECT USER_ID, COUNT(*) AS CT_COUNT FROM CONTACTS GROUP BY USER_ID ), TRUST_CONT_COUNT AS( SELECT CT.USER_ID,COUNT(*) AS TRUST_CT_COUNT FROM CONTACTS CT INNER JOIN CUSTOMERS CM ON CT.CONTACT_NAME=CM.CUSTOMER_NAME AND CT.CONTACT_EMAIL=CM.EMAIL GROUP BY CT.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE,IFNULL(C_CT.CT_COUNT,0) AS CONTACTS_CNT, IFNULL(T_CT.TRUST_CT_COUNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONT_COUNT C_CT ON I.USER_ID=C_CT.USER_ID LEFT JOIN TRUST_CONT_COUNT T_CT ON I.USER_ID=T_CT.USER_ID ORDER BY I.INVOICE_ID"
248,Y,Y,"WITH CONTACTCNT AS ( SELECT CUST.CUSTOMER_ID CUSTOMER_ID ,COALESCE(COUNT(CONTACT.CONTACT_EMAIL),0) AS CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CONTACT ON CUST.CUSTOMER_ID = CONTACT.USER_ID GROUP BY CUSTOMER_ID ) , TRUSTCONTACTCNT AS ( SELECT CUST.CUSTOMER_ID CUSTOMER_ID ,COALESCE(COUNT(CONTACT.CONTACT_EMAIL),0) AS CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CONTACT ON CUST.CUSTOMER_ID = CONTACT.USER_ID AND CONTACT.CONTACT_EMAIL IN ( SELECT EMAIL FROM CUSTOMERS ) GROUP BY CUSTOMER_ID ) SELECT INVO.INVOICE_ID AS INVOICE_ID ,CUST.CUSTOMER_NAME AS CUSTOMER_NAME ,COALESCE(SUM(INVO.PRICE),0) AS PRICE ,SUM(CONTACTCNT.CONTACTS_CNT) AS CONTACTS_CNT ,SUM(TRUSTCONTACTCNT.CONTACTS_CNT) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUST JOIN INVOICES INVO ON INVO.USER_ID = CUST.CUSTOMER_ID JOIN CONTACTCNT CONTACTCNT ON CONTACTCNT.CUSTOMER_ID = CUST.CUSTOMER_ID JOIN TRUSTCONTACTCNT TRUSTCONTACTCNT ON TRUSTCONTACTCNT.CUSTOMER_ID = CUST.CUSTOMER_ID GROUP BY CUST.CUSTOMER_ID,INVOICE_ID ORDER BY INVOICE_ID"
249,Y,Y,"WITH CONTACT_COUNT AS ( SELECT CU.CUSTOMER_ID, COUNT(*) AS CONTACTS_CNT FROM CUSTOMERS CU JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY CU.CUSTOMER_ID ), TRUSTED_CONTACT AS ( SELECT CU.CUSTOMER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU JOIN (SELECT * FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)) CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY CU.CUSTOMER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TC.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACT_COUNT CC ON I.USER_ID = CC.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACT TC ON I.USER_ID = TC.CUSTOMER_ID ORDER BY I.INVOICE_ID"
250,Y,Y,"WITH CONTACT_INFO AS (SELECT USER_ID , COUNT(CONTACT_NAME) AS CONTACT_COUNT , SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) AS TRUSTED_COUNT FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID , C2.CUSTOMER_NAME , I.PRICE , IFNULL(C1.CONTACT_COUNT,0) AS CONTACTS_CNT , IFNULL(C1.TRUSTED_COUNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACT_INFO C1 ON I.USER_ID = C1.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.CUSTOMER_ID = I.USER_ID ORDER BY I.INVOICE_ID ASC"
251,Y,N,"WITH CONTACTS_BY_USER AS ( SELECT USER_ID, COUNT(1) AS CONTACTS_CNT, COUNT(CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL = CU.EMAIL GROUP BY 1 ) SELECT I.INVOICE_ID , X.CUSTOMER_NAME , I.PRICE , COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS_BY_USER C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS X ON I.USER_ID = X.CUSTOMER_ID ORDER BY I.INVOICE_ID"
252,Y,N,"WITH CONTACTS_BY_USER AS ( SELECT USER_ID, COUNT(1) AS CONTACTS_CNT, COUNT(CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL = CU.EMAIL GROUP BY 1 ) SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS_BY_USER U ON U.USER_ID = I.USER_ID ORDER BY 1"
253,Y,N,"WITH CONTACTS_CNT AS ( SELECT DISTINCT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), TRUSTED_CONTACTS_CNT AS( SELECT DISTINCT CO.USER_ID, COUNT(CU.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO JOIN CUSTOMERS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY CO.USER_ID) SELECT I.INVOICE_ID,C.CUSTOMER_NAME, I.PRICE, IFNULL(CO.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS_CNT CO ON I.USER_ID= CO.USER_ID LEFT JOIN TRUSTED_CONTACTS_CNT T ON I.USER_ID= T.USER_ID ORDER BY I.INVOICE_ID"
254,Y,Y,"WITH CONTACTS_CNT AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACTS_CNT AS ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN ( SELECT EMAIL FROM CUSTOMERS ) GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TCC.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS_CNT CC ON CC.USER_ID = I.USER_ID LEFT JOIN TRUSTED_CONTACTS_CNT TCC ON TCC.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
255,Y,N,"WITH CONTACTS_CNT AS (SELECT USER_ID, COUNT(1) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1), TRUSTED_CONTACTS_CNT AS (SELECT USER_ID, SUM((CASE WHEN CUSTOMER_NAME IS NULL THEN 0 ELSE 1 END)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL GROUP BY 1) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(TCC.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS_CNT CC ON C.CUSTOMER_ID = CC.USER_ID LEFT JOIN TRUSTED_CONTACTS_CNT TCC ON C.CUSTOMER_ID = TCC.USER_ID ORDER BY I.INVOICE_ID"
256,Y,Y,"WITH CONTACTS_LKP AS ( SELECT CT.*, CASE WHEN CUST_EMAILS.EMAIL IS NOT NULL THEN 1 ELSE 0 END AS IS_TRUSTED FROM CONTACTS AS CT LEFT JOIN ( SELECT EMAIL FROM CUSTOMERS GROUP BY EMAIL ) AS CUST_EMAILS ON CT.CONTACT_EMAIL = CUST_EMAILS.EMAIL ) , CONTACT_INFO AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(IS_TRUSTED) AS TRUSTED_CONTACTS_CNT FROM CONTACTS_LKP GROUP BY USER_ID ) SELECT I.INVOICE_ID, CT.CUSTOMER_NAME, I.PRICE, COALESCE(CI.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(CI.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS CT ON I.USER_ID = CT.CUSTOMER_ID LEFT JOIN CONTACT_INFO AS CI ON I.USER_ID = CI.USER_ID ORDER BY INVOICE_ID"
257,Y,N,"WITH CONTS AS ( SELECT USER_ID, COUNT(1) CONTACTS_CNT, SUM( CASE WHEN CUSTOMER_NAME IS NULL THEN 0 ELSE 1 END ) TRUSTED_CONTACTS_CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_EMAIL = CUS.EMAIL GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, I.PRICE, CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTS C ON I.USER_ID = C.USER_ID INNER JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID ORDER BY INVOICE_ID"
258,Y,Y,"WITH CTE AS ( SELECT DISTINCT EMAIL FROM CUSTOMERS ) SELECT I.INVOICE_ID,C.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT * FROM CTE) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
259,Y,N,"WITH CTE AS ( SELECT I1.*, O.CONTACT_NAME FROM ( SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE,COUNT(C.USER_ID) AS CONTACTS_CNT ,I.USER_ID FROM INVOICES I LEFT JOIN CONTACTS C ON I.USER_ID = C.USER_ID INNER JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID GROUP BY I.INVOICE_ID ) I1 LEFT JOIN CONTACTS O ON I1.USER_ID = O.USER_ID ) SELECT CTE.INVOICE_ID,CTE.CUSTOMER_NAME,CTE.PRICE,CTE.CONTACTS_CNT, COUNT(C2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CUSTOMERS C2 ON CTE.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY CTE.INVOICE_ID ORDER BY CTE.INVOICE_ID"
260,Y,N,"WITH CTE AS ( SELECT * FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME = B.CUSTOMER_NAME ) SELECT A.INVOICE_ID, M.CUSTOMER_NAME, A.PRICE, IFNULL(B.CNT,0) AS CONTACTS_CNT, IFNULL(C.CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS M ON A.USER_ID=M.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CNT FROM CTE GROUP BY USER_ID) B ON A.USER_ID=B.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CNT FROM CTE WHERE CUSTOMER_ID IS NOT NULL GROUP BY USER_ID) C ON B.USER_ID=C.USER_ID ORDER BY INVOICE_ID"
261,Y,N,"WITH CTE AS ( SELECT C.USER_ID, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT , SUM(CASE WHEN CUST.CUSTOMER_NAME IS NULL THEN 0 ELSE 1 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CUST ON C.CONTACT_NAME = CUST.CUSTOMER_NAME GROUP BY 1 ) SELECT I.INVOICE_ID, CUST.CUSTOMER_NAME, I.PRICE, IFNULL(CTE.CONTACTS_CNT,0) AS CONTACTS_CNT , IFNULL(CTE.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CTE ON CTE.USER_ID = I.USER_ID ORDER BY 1 ASC"
262,Y,N,"WITH CTE AS ( SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, IFNULL(COUNT(C2.USER_ID),0) AS CONTACTS_CNT, IFNULL(COUNT(C3.EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON (C1.CUSTOMER_ID = C2.USER_ID) LEFT JOIN CUSTOMERS C3 ON (C3.EMAIL = C2.CONTACT_EMAIL) GROUP BY 1,2 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CTE ON (I.USER_ID = CTE.CUSTOMER_ID) ORDER BY 1"
263,Y,Y,"WITH CTE AS ( SELECT C1.CUSTOMER_ID, MAX(C1.CUSTOMER_NAME) CUSTOMER_NAME,COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CONTACTS C RIGHT JOIN CUSTOMERS C1 ON C.USER_ID = C1.CUSTOMER_ID GROUP BY C1.CUSTOMER_ID ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CTE C ON I.USER_ID=C.CUSTOMER_ID ORDER BY 1"
264,Y,N,"WITH CTE AS ( SELECT CO.USER_ID, COUNT(CO.USER_ID) CNT, COUNT(CU.CUSTOMER_NAME) TRUSTED_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY 1) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CTE.CNT, 0) CONTACTS_CNT, IFNULL(CTE.TRUSTED_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
265,Y,N,"WITH CTE AS ( SELECT CUST1.CUSTOMER_ID, CUST1.CUSTOMER_NAME, CUST1.CONTACT_NAME, CUST1.CONTACT_EMAIL FROM ( SELECT CUST.CUSTOMER_ID, CUST.CUSTOMER_NAME, C.CONTACT_NAME, C.CONTACT_EMAIL FROM CUSTOMERS CUST LEFT JOIN CONTACTS C ON CUST.CUSTOMER_ID=C.USER_ID ) CUST1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, TEMP.CONTACTS_CNT, TEMP.TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN ( SELECT A.CUSTOMER_ID, COUNT(A.CONTACT_NAME) AS CONTACTS_CNT, COUNT(B.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CTE A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL=B.EMAIL GROUP BY A.CUSTOMER_ID ) TEMP ON I.USER_ID = TEMP.CUSTOMER_ID INNER JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
266,Y,N,"WITH CTE AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN TRUSTED = 'YES' THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM (SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME,CO.CONTACT_NAME, (CASE WHEN CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN YES ELSE NO END) AS TRUSTED FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID) AS T GROUP BY CUSTOMER_NAME) SELECT INVOICE_ID, CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE ON I.USER_ID = CTE.CUSTOMER_ID ORDER BY INVOICE_ID ASC"
267,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM CTE C RIGHT JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
268,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID GROUP BY CUSTOMER_ID ) SELECT I.INVOICE_ID, CTE.CUSTOMER_NAME, I.PRICE, CTE.CONTACTS_CNT, CTE.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CTE ON CTE.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
269,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME, COUNT(USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN C1.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C2 LEFT JOIN CONTACTS C1 ON C1.USER_ID = C2.CUSTOMER_ID GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CTE C ON I.USER_ID = C.CUSTOMER_ID ORDER BY 1"
270,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME, COUNT(USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN C1.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C2 LEFT JOIN CONTACTS C1 ON C1.USER_ID = C2.CUSTOMER_ID GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CTE C ON I.USER_ID = C.CUSTOMER_ID ORDER BY 1"
271,Y,Y,"WITH CTE AS ( SELECT I.INVOICE_ID , C.CUSTOMER_NAME , USER_ID , I.PRICE FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID ), CTE2 AS( SELECT USER_ID , COUNT(DISTINCT CONTACT_NAME ) AS CONTACTS_CNT , COUNT(DISTINCT CUSTOMER_NAME ) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY USER_ID ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,IFNULL (CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CTE2 USING(USER_ID) ORDER BY INVOICE_ID ASC"
272,Y,Y,"WITH CTE AS ( SELECT I.INVOICE_ID , C.CUSTOMER_NAME , USER_ID , I.PRICE FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID ), CTE2 AS( SELECT USER_ID , COUNT(DISTINCT CONTACT_NAME ) AS CONTACTS_CNT ,COUNT(DISTINCT CUSTOMER_NAME ) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY USER_ID ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,COALESCE (CONTACTS_CNT,0) AS CONTACTS_CNT,COALESCE (TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CTE2 USING(USER_ID) ORDER BY INVOICE_ID ASC"
273,Y,Y,"WITH CTE AS ( SELECT USER_ID, 1 AS CONTACT_CNT, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED_CONTACTS_CNT FROM CONTACTS ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, SUM(CONTACT_CNT) AS CONTACTS_CNT, SUM(TRUSTED_CONTACTS_CNT) AS TRUSTED_CONTACTS_CNT FROM CTE GROUP BY USER_ID )T ON INVOICES.USER_ID = T.USER_ID ORDER BY INVOICE_ID"
274,Y,Y,"WITH CTE AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1), CTE2 AS ( SELECT CUSTOMER_ID, COUNT(B.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID AND B.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES X LEFT JOIN CUSTOMERS Y ON X.USER_ID = Y.CUSTOMER_ID LEFT JOIN CTE I ON X.USER_ID = I.USER_ID LEFT JOIN CTE2 K ON X.USER_ID = K.CUSTOMER_ID ORDER BY INVOICE_ID"
275,Y,Y,"WITH CTE AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM ( SELECT USER_ID, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED_CONTACT FROM CONTACTS ) AS A GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
276,Y,Y,"WITH CTE AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACTS.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID , CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON CTE.USER_ID = I.USER_ID ORDER BY INVOICE_ID"
277,Y,Y,"WITH CTE AS (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, SUM(CASE WHEN T.USER_ID IS NULL THEN 0 ELSE 1 END) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY C.CUSTOMER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CTE AS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
278,Y,N,"WITH CTE AS (SELECT C.USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(C1.EMAIL IS NOT NULL, 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS C1 ON C.CONTACT_EMAIL = C1.EMAIL GROUP BY C.USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(C1.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(C1.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CTE C1 ON C1.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
279,Y,Y,"WITH CTE AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(B.USER_ID) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CTE B ON A.USER_ID =B.CUSTOMER_ID ORDER BY 1"
280,Y,Y,"WITH CTE AS (SELECT INVOICE_ID, A.USER_ID AS CUSTOMER_ID, CUSTOMER_NAME, PRICE FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID), CTE1 AS ( SELECT A.CUSTOMER_ID, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1), CTE2 AS (SELECT A.CUSTOMER_ID, COUNT(B.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID WHERE B.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE A LEFT JOIN CTE1 B ON A.CUSTOMER_ID = B.CUSTOMER_ID LEFT JOIN CTE2 C ON A.CUSTOMER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID ASC"
281,Y,N,"WITH CTE AS (SELECT INVOICE_ID, CUSTOMER_NAME, CUSTOMER_ID ,PRICE, CONTACT_EMAIL FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID) SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, COALESCE(COUNT(CONTACT_EMAIL),0) AS CONTACTS_CNT, COUNT(B.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CTE A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY 1, A.CUSTOMER_ID ORDER BY 1"
282,Y,N,"WITH CTE AS (SELECT INVOICE_ID, CUSTOMER_NAME, CUSTOMER_ID ,PRICE, CONTACT_EMAIL FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID) SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, COALESCE(COUNT(CONTACT_EMAIL),0) AS CONTACTS_CNT, SUM(CASE WHEN B.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CTE A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY 1, A.CUSTOMER_ID ORDER BY 1"
283,Y,Y,"WITH CTE AS (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CUSTOMER_ID FROM INVOICES A JOIN CUSTOMERS C ON C.CUSTOMER_ID = A.USER_ID ), CTE1 AS (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, USER_ID FROM CTE LEFT JOIN(SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) B ON CTE.CUSTOMER_ID = B.USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUST,0) AS TRUSTED_CONTACTS_CNT FROM CTE1 D LEFT JOIN (SELECT USER_ID, COUNT(USER_ID) AS TRUST FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS ) GROUP BY USER_ID) B ON D.USER_ID = B.USER_ID ORDER BY INVOICE_ID ASC"
284,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(*) AS CT,SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END)AS TRUSTED FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME,I.PRICE,IFNULL(CTE.CT,0)AS CONTACTS_CNT,IFNULL(CTE.TRUSTED,0)AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
285,Y,N,"WITH CTE AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACT_CNT, COUNT(CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS CT LEFT JOIN CUSTOMERS AS CM ON CONTACT_NAME = CUSTOMER_NAME AND CONTACT_EMAIL = EMAIL GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACT_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY INVOICE_ID"
286,Y,N,"WITH CTE AS (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT, COUNT(CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL = CU.EMAIL GROUP BY USER_ID) SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CTE ON CTE.USER_ID = I.USER_ID ORDER BY INVOICE_ID"
287,Y,Y,"WITH CTE AS( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
288,Y,N,"WITH CTE AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT,COUNT(CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL = CU.EMAIL GROUP BY USER_ID ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT,COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CTE C ON I.USER_ID = C.USER_ID ORDER BY INVOICE_ID"
289,Y,N,"WITH CTE AS( SELECT USER_ID, CUSTOMER_NAME, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, SUM(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM( SELECT USER_ID, C2.CUSTOMER_NAME, CONTACT_NAME, IF(C3.EMAIL IS NULL,0,1) AS TRUSTED_CONTACT FROM CONTACTS C1 JOIN CUSTOMERS C2 ON C1.USER_ID = C2.CUSTOMER_ID LEFT JOIN CUSTOMERS C3 ON C1.CONTACT_EMAIL = C3.EMAIL ) SUB GROUP BY USER_ID, CUSTOMER_NAME ) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
290,Y,Y,"WITH CTE AS(SELECT I.INVOICE_ID, I.USER_ID, I.PRICE,C.CUSTOMER_ID, C.CUSTOMER_NAME FROM CUSTOMERS C JOIN INVOICES I ON I.USER_ID = C.CUSTOMER_ID ), CTE2 AS (SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME)AS CONTACTS_CNT , COUNT(DISTINCT CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CN LEFT JOIN CUSTOMERS C ON C.CUSTOMER_NAME = CN.CONTACT_NAME GROUP BY CN.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE LEFT JOIN CTE2 USING (USER_ID) ORDER BY INVOICE_ID"
291,Y,Y,"WITH CTE1 AS ( SELECT A.* , B.* FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID ), CUSTOMER_EMAIL AS ( SELECT DISTINCT EMAIL FROM CUSTOMERS ), CTE3 AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME, COUNT(USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMER_EMAIL) THEN 1 ELSE 0 END) AS TRUSTED FROM CTE1 GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT,TRUSTED AS TRUSTED_CONTACTS_CNT FROM CTE3 AS C RIGHT JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
292,Y,N,"WITH CTE1 AS ( SELECT CON.USER_ID, CON.CONTACT_NAME, CASE WHEN CUS.CUSTOMER_NAME IS NULL THEN 0 ELSE 1 END AS TRUSTED FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_NAME = CUS.CUSTOMER_NAME) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT , COALESCE(SUM(TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CTE1 C ON B.CUSTOMER_ID = C.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
293,Y,Y,"WITH CTE1 AS ( SELECT CUSTOMER_ID, COUNT(DISTINCT CONTACT_NAME) AS NUM1 FROM CUSTOMERS JOIN CONTACTS ON CONTACTS.USER_ID = CUSTOMERS.CUSTOMER_ID GROUP BY CUSTOMER_ID ), CTE2 AS ( SELECT CUSTOMER_ID, COUNT(DISTINCT CONTACT_NAME) AS NUM2 FROM CUSTOMERS JOIN CONTACTS ON CONTACTS.USER_ID = CUSTOMERS.CUSTOMER_ID WHERE CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CTE1.NUM1,0) AS CONTACTS_CNT, COALESCE(CTE2.NUM2,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CTE1 ON INVOICES.USER_ID = CTE1.CUSTOMER_ID LEFT JOIN CTE2 ON INVOICES.USER_ID = CTE2.CUSTOMER_ID ORDER BY 1"
294,Y,N,"WITH CTE1 AS ( SELECT CUSTOMER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CUSTOMERS A JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY CUSTOMER_ID), CTE2 AS ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A JOIN CUSTOMERS B ON A.CONTACT_NAME = B.CUSTOMER_NAME GROUP BY USER_ID) SELECT INV.INVOICE_ID, CUST.CUSTOMER_NAME, INV.PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV JOIN CUSTOMERS CUST ON INV.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CTE1 ON CUST.CUSTOMER_ID = CTE1.CUSTOMER_ID LEFT JOIN CTE2 ON CTE1.CUSTOMER_ID = CTE2.USER_ID ORDER BY INV.INVOICE_ID"
295,Y,N,"WITH CTE1 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) CT FROM CONTACTS GROUP BY USER_ID ), CTE2 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) TRUSTED_CT FROM CONTACTS JOIN CUSTOMERS ON EMAIL=CONTACT_EMAIL GROUP BY USER_ID ), CTE3 AS ( SELECT M.CUSTOMER_ID, CUSTOMER_NAME, IFNULL(C1.CT, 0) CT, IFNULL(C2.TRUSTED_CT, 0) TRUSTED_CT FROM CUSTOMERS M LEFT JOIN CTE1 C1 ON M.CUSTOMER_ID=C1.USER_ID LEFT JOIN CTE2 C2 ON M.CUSTOMER_ID=C2.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CT CONTACTS_CNT, TRUSTED_CT TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CTE3 ON USER_ID = CUSTOMER_ID ORDER BY 1"
296,Y,N,"WITH CTE1 AS (SELECT CT.USER_ID , COUNT(*) CONTACT_CNT, SUM(CASE WHEN C.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CONTACTS CT LEFT OUTER JOIN CUSTOMERS C ON CT.CONTACT_NAME = C.CUSTOMER_NAME AND CT.CONTACT_EMAIL = C.EMAIL GROUP BY CT.USER_ID ) SELECT I.INVOICE_ID INVOICE_ID,C.CUSTOMER_NAME CUSTOMER_NAME,I.PRICE PRICE ,COALESCE(CTE1.CONTACT_CNT,0) CONTACTS_CNT, COALESCE(CTE1.TRUSTED_CONTACTS_CNT,0)TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT OUTER JOIN CTE1 ON C.CUSTOMER_ID = CTE1.USER_ID ORDER BY INVOICE_ID"
297,Y,N,"WITH CTE1 AS (SELECT USER_ID, COUNT(CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C INNER JOIN CUSTOMERS O ON C.CONTACT_NAME = O.CUSTOMER_NAME AND C.CONTACT_EMAIL = O.EMAIL GROUP BY USER_ID), CTE2 AS (SELECT INVOICE_ID, COUNT(C.USER_ID) AS CONTACTS_CNT FROM INVOICES I INNER JOIN CONTACTS C ON I.USER_ID = C.USER_ID GROUP BY INVOICE_ID ) SELECT I.INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE2 ON I.INVOICE_ID = CTE2.INVOICE_ID LEFT JOIN CTE1 ON CTE1.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
298,Y,Y,"WITH CTE_ASSEMBLE AS ( SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM( CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CONT ON I.USER_ID = CONT.USER_ID GROUP BY 1, 2, 3 ORDER BY 1 ) SELECT * FROM CTE_ASSEMBLE"
299,Y,Y,"WITH CTE_CONTACTS AS ( SELECT USER_ID , COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE_INVOICE AS (SELECT INVOICE_ID,PRICE,I.USER_ID, COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE_CONTACTS C ON I.USER_ID = C.USER_ID), CTE_TRUSTED AS ( SELECT USER_ID,COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) SELECT INVOICE_ID, C.CUSTOMER_NAME,PRICE,COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT ,COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE_INVOICE CI LEFT JOIN CUSTOMERS C ON CI.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE_TRUSTED CT ON CT.USER_ID = CI.USER_ID ORDER BY INVOICE_ID"
300,Y,N,"WITH CTE_CUSTOMER_INVOICE AS (SELECT I.INVOICE_ID,C.CUSTOMER_ID,C.CUSTOMER_NAME,I.PRICE FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID), CTE_TOTAL_CONTACTS AS (SELECT USER_ID AS CUSTOMER_ID,COUNT(*)TOT_CONTACTS FROM CONTACTS GROUP BY USER_ID), CTE_TRUSTED_CONTACTS AS (SELECT USER_ID AS CUSTOMER_ID,COUNT(*) TRUSTED_CONTACTS FROM CONTACTS C JOIN CUSTOMERS CC ON C.CONTACT_NAME =CC.CUSTOMER_NAME AND C.CONTACT_EMAIL=CC.EMAIL GROUP BY USER_ID), CTE_CONTACTS_MERGED AS (SELECT C.CUSTOMER_ID,TOT_CONTACTS AS CONTACTS_CNT ,COALESCE(TRUSTED_CONTACTS,0)TRUSTED_CONTACTS_CNT FROM CTE_TOTAL_CONTACTS C LEFT JOIN CTE_TRUSTED_CONTACTS CC ON C.CUSTOMER_ID=CC.CUSTOMER_ID) SELECT I.INVOICE_ID,I.CUSTOMER_NAME,I.PRICE, COALESCE(C.CONTACTS_CNT,0)CONTACTS_CNT,COALESCE(C.TRUSTED_CONTACTS_CNT,0)TRUSTED_CONTACTS_CNT FROM CTE_CUSTOMER_INVOICE I LEFT JOIN CTE_CONTACTS_MERGED C ON I.CUSTOMER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
301,Y,N,"WITH CTE_JOIN_CONTACTS AS ( SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, CONTACT_NAME, CONTACT_EMAIL FROM INVOICES AS I INNER JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CONT ON I.USER_ID = CONT.USER_ID ), CTE_CONTACTS_AGG AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CTE_JOIN_CONTACTS GROUP BY 1, 2, 3 ), CTE_TRUSTED_CONTACTS_AGG AS ( SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CTE_JOIN_CONTACTS AS C1 JOIN CUSTOMERS AS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY 1, 2, 3 ), CTE_ASSEMBLE AS ( SELECT C.INVOICE_ID, C.CUSTOMER_NAME, C.PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CTE_CONTACTS_AGG AS C LEFT JOIN CTE_TRUSTED_CONTACTS_AGG AS TC ON C.INVOICE_ID = TC.INVOICE_ID AND C.CUSTOMER_NAME = TC.CUSTOMER_NAME ORDER BY 1 ) SELECT * FROM CTE_ASSEMBLE"
302,Y,N,"WITH CTE_JOIN_CONTACTS AS ( SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, CONTACT_NAME, CONTACT_EMAIL FROM INVOICES AS I JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CONT ON I.USER_ID = CONT.USER_ID ), CTE_CONTACTS_AGG AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CTE_JOIN_CONTACTS GROUP BY 1, 2, 3 ), CTE_TRUSTED_CONTACTS_AGG AS ( SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CTE_JOIN_CONTACTS AS C1 JOIN CUSTOMERS AS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY 1, 2, 3 ), CTE_ASSEMBLE AS ( SELECT C.INVOICE_ID, C.CUSTOMER_NAME, C.PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CTE_CONTACTS_AGG AS C LEFT JOIN CTE_TRUSTED_CONTACTS_AGG AS TC ON C.INVOICE_ID = TC.INVOICE_ID AND C.CUSTOMER_NAME = TC.CUSTOMER_NAME ORDER BY 1 ) SELECT * FROM CTE_ASSEMBLE"
303,Y,N,"WITH CTE_JOIN_CONTACTS AS ( SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, CONTACT_NAME, CONTACT_EMAIL FROM INVOICES AS I JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CONT ON I.USER_ID = CONT.USER_ID ), CTE_CONTACTS_AGG AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CTE_JOIN_CONTACTS GROUP BY 1, 2, 3 ), CTE_TRUSTED_CONTACTS_AGG AS ( SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CTE_JOIN_CONTACTS AS C1 JOIN CUSTOMERS AS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY 1, 2, 3 ), CTE_ASSEMBLE AS ( SELECT C.INVOICE_ID, C.CUSTOMER_NAME, C.PRICE, CONTACTS_CNT AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CTE_CONTACTS_AGG AS C LEFT JOIN CTE_TRUSTED_CONTACTS_AGG AS TC ON C.INVOICE_ID = TC.INVOICE_ID AND C.CUSTOMER_NAME = TC.CUSTOMER_NAME ORDER BY 1 ) SELECT * FROM CTE_ASSEMBLE"
304,Y,N,"WITH CTE_JOIN_CONTACTS AS ( SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, CONTACT_NAME, CONTACT_EMAIL FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CONT ON I.USER_ID = CONT.USER_ID ), CTE_CONTACTS_AGG AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CTE_JOIN_CONTACTS GROUP BY 1, 2, 3 ), CTE_TRUSTED_CONTACTS_AGG AS ( SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CTE_JOIN_CONTACTS AS C1 JOIN CUSTOMERS AS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY 1, 2, 3 ), CTE_ASSEMBLE AS ( SELECT C.INVOICE_ID, C.CUSTOMER_NAME, C.PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CTE_CONTACTS_AGG AS C LEFT JOIN CTE_TRUSTED_CONTACTS_AGG AS TC ON C.INVOICE_ID = TC.INVOICE_ID AND C.CUSTOMER_NAME = TC.CUSTOMER_NAME ORDER BY 1 ) SELECT * FROM CTE_ASSEMBLE"
305,Y,Y,"WITH CUST_CONTACTS AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY 1,2 ) , TRUSTED_CUST_CONTACTS AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID WHERE EXISTS ( SELECT * FROM CUSTOMERS C1 WHERE C1.CUSTOMER_NAME = CO.CONTACT_NAME AND C1.EMAIL = CO.CONTACT_EMAIL ) GROUP BY 1,2 ) SELECT DISTINCT INVOICE_ID, CC.CUSTOMER_NAME, I.PRICE, CC.CONTACTS_CNT, COALESCE(TCC.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUST_CONTACTS CC ON CC.CUSTOMER_ID = I.USER_ID LEFT JOIN TRUSTED_CUST_CONTACTS TCC ON TCC.CUSTOMER_ID = I.USER_ID ORDER BY 1"
306,Y,N,"WITH CUSTOMERGROUP AS ( SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME , COUNT(B.USER_ID ) CONTACTS_CNT , IFNULL(C.COUNTUSER_ID ,0) TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN (SELECT USER_ID AS VERIFIEDUSER, COUNT(USER_ID) AS COUNTUSER_ID FROM CONTACTS A INNER JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY USER_ID) C ON A.CUSTOMER_ID = C.VERIFIEDUSER GROUP BY A.CUSTOMER_ID , A.CUSTOMER_NAME ) SELECT A.INVOICE_ID , B.CUSTOMER_NAME , A.PRICE , B.CONTACTS_CNT , B.TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERGROUP B ON A.USER_ID = B.CUSTOMER_ID ORDER BY A.INVOICE_ID"
307,Y,N,"WITH E AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CUSTOMERS.EMAIL= CONTACTS.CONTACT_EMAIL GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID= INVOICES.USER_ID LEFT JOIN E ON E.USER_ID = INVOICES.USER_ID ORDER BY INVOICE_ID"
308,Y,N,"WITH INFO AS (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, SUM(CASE WHEN CON.CONTACT_EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN C2.CUSTOMER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL = C2.EMAIL GROUP BY 1) SELECT I.INVOICE_ID, B.CUSTOMER_NAME, I.PRICE, B.CONTACTS_CNT, B.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN INFO B ON I.USER_ID = B.CUSTOMER_ID ORDER BY 1"
309,Y,Y,"WITH PRICE AS( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, USER_ID FROM CUSTOMERS AS C RIGHT JOIN INVOICES AS I ON C.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID), CONTACT_CNT AS( SELECT C.CUSTOMER_ID, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY USER_ID), TRUSTED AS( SELECT USER_ID, CONTACT_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM PRICE AS P LEFT JOIN CONTACT_CNT AS CC ON P.USER_ID = CC.CUSTOMER_ID LEFT JOIN TRUSTED AS T ON P.USER_ID = T.USER_ID"
310,Y,N,"WITH T AS (SELECT C.USER_ID, COUNT(*) AS CONTACTS_CNT, COUNT(CM.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS AS CM ON C.CONTACT_NAME = CM.CUSTOMER_NAME AND C.CONTACT_EMAIL = CM.EMAIL GROUP BY C.USER_ID) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE,IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN T ON I.USER_ID = T.USER_ID INNER JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
311,Y,Y,"WITH T AS( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID, CUS.CUSTOMER_NAME, I.PRICE, IFNULL(T.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(T.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN T ON I.USER_ID = T.USER_ID ORDER BY 1"
312,Y,Y,"WITH T1 AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), T2 AS ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(T1.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN T1 ON A.USER_ID = T1.USER_ID LEFT JOIN T2 ON A.USER_ID = T2.USER_ID ORDER BY 1"
313,Y,N,"WITH T1 AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(TRUSTED_FLAG) AS TRUSTED_CONTACTS_CNT FROM (SELECT A.*, CASE WHEN B.CUSTOMER_NAME IS NOT NULL THEN 1 ELSE 0 END AS TRUSTED_FLAG FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME=B.CUSTOMER_NAME AND A.CONTACT_EMAIL=B.EMAIL) C GROUP BY USER_ID ) SELECT A.INVOICE_ID,B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACTS_CNT,0) AS CONTACTS_CNT , COALESCE(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN T1 C ON A.USER_ID=C.USER_ID ORDER BY A.INVOICE_ID"
314,Y,Y,"WITH T1 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CNT1 FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1), T2 AS (SELECT CUSTOMER_ID, IFNULL(CNT2, 0) AS CNT2 FROM CUSTOMERS A LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CNT2 FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) GROUP BY 1) B ON A.CUSTOMER_ID = B.USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CNT1 AS CONTACTS_CNT, CNT2 AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN T1 ON A.USER_ID = T1.CUSTOMER_ID JOIN T2 ON A.USER_ID = T2.CUSTOMER_ID ORDER BY 1"
315,Y,Y,"WITH T1 AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CUSTOMER_ID FROM INVOICES I RIGHT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID), T2 AS ( SELECT C.CUSTOMER_ID, COUNT(D.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN D.CONTACT_EMAIL IN (SELECT C1.EMAIL FROM CUSTOMERS C1) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C INNER JOIN CONTACTS D ON D.USER_ID = C.CUSTOMER_ID GROUP BY 1 ) SELECT T1.INVOICE_ID, T1.CUSTOMER_NAME, T1.PRICE, IFNULL(T2.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM T1 LEFT JOIN T2 ON T1.CUSTOMER_ID = T2.CUSTOMER_ID WHERE T1.INVOICE_ID IS NOT NULL ORDER BY 1"
316,Y,Y,"WITH T1 AS (SELECT INVOICE_ID, B.USER_ID, CUSTOMER_NAME, PRICE, CUSTOMER_ID FROM CUSTOMERS A JOIN INVOICES B ON A.CUSTOMER_ID = B.USER_ID ), T2 AS (SELECT USER_ID, COUNT(CONTACT_NAME)AS RELATES, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTS FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID,T1.CUSTOMER_NAME,PRICE,IFNULL(RELATES,0) AS CONTACTS_CNT,IFNULL(TRUSTS,0) AS TRUSTED_CONTACTS_CNT FROM T1 LEFT JOIN T2 ON T1.CUSTOMER_ID=T2.USER_ID ORDER BY INVOICE_ID"
317,Y,Y,"WITH T1 AS (SELECT INVOICE_ID,CUSTOMER_ID,CUSTOMER_NAME,PRICE FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID), T2 AS (SELECT USER_ID, COUNT(CONTACT_NAME) RELATES,COUNT(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 END) AS TRUSTS FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID,T1.CUSTOMER_NAME,PRICE,IFNULL(RELATES,0) AS CONTACTS_CNT,IFNULL(TRUSTS,0) AS TRUSTED_CONTACTS_CNT FROM T1 LEFT JOIN T2 ON T1.CUSTOMER_ID=T2.USER_ID ORDER BY INVOICE_ID"
318,Y,Y,"WITH T1 AS (SELECT USER_ID, COUNT(DISTINCT(CONTACT_EMAIL)) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1), T2 AS (SELECT USER_ID, COUNT(DISTINCT(CONTACT_EMAIL)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN T1 ON A.USER_ID = T1.USER_ID LEFT JOIN T2 ON A.USER_ID = T2.USER_ID ORDER BY 1"
319,Y,N,"WITH T1 AS (SELECT USER_ID, COUNT(USER_ID) AS F1 FROM CONTACTS GROUP BY USER_ID), T2 AS (SELECT USER_ID, COUNT(USER_ID) AS F2 FROM CONTACTS CON INNER JOIN CUSTOMERS AS CUS ON CUS.CUSTOMER_NAME =CON.CONTACT_NAME AND CON.CONTACT_EMAIL = CUS.EMAIL GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T1.F1,0) AS CONTACTS_CNT, IFNULL(T2.F2,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN T1 ON T1.USER_ID = I.USER_ID LEFT JOIN T2 ON T2.USER_ID = I.USER_ID ORDER BY INVOICE_ID"
320,Y,N,"WITH T1 AS( SELECT CT.USER_ID,COUNT(CT.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CT LEFT JOIN CUSTOMERS C ON CT.CONTACT_EMAIL = C.EMAIL GROUP BY 1 ), T2 AS ( SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, I.INVOICE_ID,I.PRICE FROM CUSTOMERS C INNER JOIN INVOICES I ON I.USER_ID = C.CUSTOMER_ID) SELECT T2.INVOICE_ID,T2.CUSTOMER_NAME,T2.PRICE, IFNULL(T1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T1.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM T2 LEFT JOIN T1 ON T2.CUSTOMER_ID= T1.USER_ID ORDER BY 1"
321,Y,Y,"WITH TB1 AS( SELECT USER_ID, CONTACT_NAME, CONTACT_EMAIL,CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTCONTACTFLAG FROM CONTACTS ), TB2 AS ( SELECT C2.CUSTOMER_ID, C2.CUSTOMER_NAME, COUNT(C1.CONTACT_EMAIL) CONTACTS_CNT, IFNULL(SUM(C1.TRUSTCONTACTFLAG),0) TRUSTED_CONTACTS_CNT FROM TB1 C1 RIGHT JOIN CUSTOMERS C2 ON C1.USER_ID=C2.CUSTOMER_ID GROUP BY C2.CUSTOMER_ID ) SELECT INVOICE_ID,C.CUSTOMER_NAME, PRICE,C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN TB2 AS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY INVOICE_ID"
322,Y,N,"WITH TEM AS( SELECT USER_ID, CONTACT_NAME, CONTACT_EMAIL, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL AS CONTACT_EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED_CONTACT FROM CONTACTS), TEM1 AS( SELECT A.*, B.* FROM CUSTOMERS A LEFT JOIN TEM B ON A.CUSTOMER_ID = B.USER_ID ), TEM2 AS ( SELECT USER_ID, CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM TEM1 GROUP BY CUSTOMER_NAME ) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(B.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN TEM2 B ON A.USER_ID = B.CUSTOMER_ID ORDER BY INVOICE_ID"
323,Y,Y,"WITH TEMP AS ( SELECT INVOICES.USER_ID AS USER_ID,INVOICE_ID,CUSTOMER_NAME,PRICE,(SELECT COUNT(CONTACT_EMAIL) FROM CONTACTS WHERE CONTACTS.USER_ID=INVOICES.USER_ID) AS CONTACTS_CNT FROM INVOICES INNER JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID ORDER BY 1 ) , TEMP2 AS( SELECT USER_ID, COUNT(DISTINCT EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS INNER JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME=CUSTOMERS.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL=CUSTOMERS.EMAIL GROUP BY 1 ) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM TEMP LEFT OUTER JOIN TEMP2 ON TEMP.USER_ID=TEMP2.USER_ID ORDER BY 1"
324,Y,Y,"WITH TEMP AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT ,SUM(IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID=C2.USER_ID GROUP BY CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM TEMP JOIN INVOICES I ON TEMP.CUSTOMER_ID=I.USER_ID ORDER BY 1"
325,Y,Y,"WITH TEMP AS ( SELECT USER_ID , COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT , 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT , 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN TEMP T ON I.USER_ID = T.USER_ID JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID ORDER BY 1"
326,Y,Y,"WITH TEMP AS( SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS C1) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY C1.CUSTOMER_ID) SELECT I.INVOICE_ID, TEMP.CUSTOMER_NAME, I.PRICE, TEMP.CONTACTS_CNT, TEMP.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN TEMP ON I.USER_ID = TEMP.CUSTOMER_ID ORDER BY INVOICE_ID"
327,Y,N,"WITH TEMP AS(SELECT C.CUSTOMER_NAME, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS ON C.CUSTOMER_ID = CONTACTS.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY C.CUSTOMER_ID ), TEMP2 AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CUSTOMERS AS C JOIN CONTACTS ON C.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY USER_ID ) SELECT DISTINCT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID = C.CUSTOMER_ID LEFT JOIN TEMP ON C.CUSTOMER_NAME = TEMP.CUSTOMER_NAME LEFT JOIN TEMP2 ON C.CUSTOMER_ID = TEMP2.USER_ID ORDER BY INVOICE_ID"
328,Y,Y,"WITH TEMP1 AS (SELECT USER_ID, COUNT(*) CONTACTS_CNT FROM CONTACTS GROUP BY 1), TEMP2 AS (SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1), TEMP3 AS (SELECT T1.USER_ID, IFNULL(T1.CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM TEMP1 T1 LEFT JOIN TEMP2 T2 ON T1.USER_ID=T2.USER_ID) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN TEMP3 T ON I.USER_ID=T.USER_ID JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY 1"
329,Y,N,"WITH TMP AS ( SELECT A.USER_ID, COUNT(DISTINCT A.CONTACT_EMAIL) CONTACTS_CNT, SUM(IF(B.EMAIL IS NULL, 0, 1)) TRUSTED_CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY A.USER_ID ) SELECT A.INVOICE_ID, C.CUSTOMER_NAME, A.PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN TMP B ON A.USER_ID = B.USER_ID JOIN CUSTOMERS C ON A.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
330,Y,N,"WITH TMP AS (SELECT USER_ID, COUNT(B.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY USER_ID), TMP1 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN TMP B ON CUSTOMER_ID = USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN TMP1 B ON USER_ID = CUSTOMER_ID ORDER BY INVOICE_ID"
331,Y,Y,"WITH TMP AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID, CUSTOMER_NAME ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN TMP ON USER_ID = CUSTOMER_ID ORDER BY 1"
332,Y,Y,"WITH TMP AS( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0 ) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (INVOICES JOIN CUSTOMERS ON USER_ID = CUSTOMER_ID) LEFT JOIN TMP ON CUSTOMER_ID = TMP.USER_ID ORDER BY 1"
333,Y,Y,"WITH TMP_TABLE1 AS (SELECT EMAIL FROM CUSTOMERS) SELECT INVOICE_ID, MAX(CUSTOMER_NAME) AS CUSTOMER_NAME, MAX(PRICE) AS PRICE, COUNT(DISTINCT(CONTACT_EMAIL)) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT * FROM TMP_TABLE1) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM ( SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, C.CONTACT_EMAIL FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID ) D GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
334,Y,N,"WITH TRUST AS ( SELECT CON.USER_ID, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CUS.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CUS.EMAIL = CON.CONTACT_EMAIL GROUP BY CON.USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(T.CONTACTS_CNT,0) CONTACTS_CNT, COALESCE(T.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN TRUST T ON I.USER_ID = T.USER_ID ORDER BY INVOICE_ID"
335,Y,N,"WITH TRUST AS ( SELECT CO.*, CASE WHEN CU.EMAIL IS NOT NULL THEN 1 ELSE 0 END AS TRUST_IND FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL = CU.EMAIL ), CTE AS ( SELECT CU.CUSTOMER_ID, CU.CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(T.TRUST_IND),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN TRUST T ON CU.CUSTOMER_ID = T.USER_ID GROUP BY 1, 2 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE ON I.USER_ID = CTE.CUSTOMER_ID ORDER BY INVOICE_ID"
336,Y,Y,"WITH TRUST AS ( SELECT USER_ID, COUNT(*) AS TRUST FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID), CONTACT_CNT AS ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(CT.USER_ID) AS CONTACTS_CNT FROM CUSTOMERS C RIGHT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY C.CUSTOMER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(T.TRUST, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACT_CNT CC ON I.USER_ID = CC.CUSTOMER_ID LEFT JOIN TRUST T ON I.USER_ID = T.USER_ID ORDER BY I.INVOICE_ID"
337,Y,Y,"WITH TRUSTED AS( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUST FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ), CONTACT AS ( SELECT DISTINCT C.USER_ID,COUNT(DISTINCT C.CONTACT_NAME) AS CONTACTS_CNT,CUS.CUSTOMER_NAME FROM CONTACTS AS C RIGHT JOIN CUSTOMERS AS CUS ON C.USER_ID = CUS.CUSTOMER_ID GROUP BY C.USER_ID ) SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, PRICE, IFNULL(CONTACT.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUST,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS INV LEFT JOIN CONTACT ON INV.USER_ID = CONTACT.USER_ID LEFT JOIN TRUSTED ON INV.USER_ID = TRUSTED.USER_ID LEFT JOIN CUSTOMERS ON INV.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY INVOICE_ID"
338,Y,N,"WITH TRUSTED_CON AS ( SELECT CO.USER_ID, COUNT(*) TRUSTED_CONTACTS_CNT FROM CONTACTS CO JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL = CU.EMAIL GROUP BY 1 ), CON AS ( SELECT USER_ID, COUNT(*) CONTACTS_CNT FROM CONTACTS GROUP BY 1 ) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CON.CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CON.TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CON ON I.USER_ID = CON.USER_ID LEFT JOIN TRUSTED_CON ON I.USER_ID = TRUSTED_CON.USER_ID ORDER BY 1"
339,Y,N,"WITH TRUSTED_CONTACTS AS ( SELECT CT.USER_ID,COUNT(CT.CONTACT_EMAIL) CONTACTS_CNT, COUNT(C.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CT LEFT JOIN CUSTOMERS C ON CT.CONTACT_EMAIL = C.EMAIL GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(T.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(T.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN TRUSTED_CONTACTS AS T ON I.USER_ID = T.USER_ID JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
340,Y,Y,"WITH TRUSTED_CONTACTS AS (SELECT T1.CUSTOMER_ID, COUNT(T2.USER_ID) TRUSTED_CONTACTS_CNT FROM CUSTOMERS T1 LEFT JOIN (SELECT USER_ID, CONTACT_NAME, CONTACT_EMAIL FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) )T2 ON T1.CUSTOMER_ID = T2.USER_ID GROUP BY T1.CUSTOMER_ID), CUSTOMER_CONTACTS AS (SELECT T1.CUSTOMER_ID, T1.CUSTOMER_NAME, COUNT(T2.USER_ID) CONTACTS_CNT FROM CUSTOMERS T1 LEFT JOIN CONTACTS T2 ON T1.CUSTOMER_ID = T2.USER_ID GROUP BY T1.CUSTOMER_ID) SELECT T1.INVOICE_ID, T2.CUSTOMER_NAME, T1.PRICE, T2.CONTACTS_CNT , T3.TRUSTED_CONTACTS_CNT FROM INVOICES T1 LEFT JOIN CUSTOMER_CONTACTS T2 ON T1.USER_ID = T2.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACTS T3 ON T1.USER_ID = T3.CUSTOMER_ID ORDER BY 1"
341,Y,Y,"WITH U AS (SELECT T.CUSTOMER_ID, T.CUSTOMER_NAME, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT, COALESCE(SUM(IF(T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0))) AS TRUSTED_CONTACTS_CNT FROM (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, C.EMAIL, C1.CONTACT_NAME, C1.CONTACT_EMAIL FROM CUSTOMERS C LEFT JOIN CONTACTS C1 ON C.CUSTOMER_ID=C1.USER_ID) AS T GROUP BY T.CUSTOMER_ID, T.CUSTOMER_NAME ) SELECT I.INVOICE_ID, U.CUSTOMER_NAME, I.PRICE, U.CONTACTS_CNT, U.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN U ON I.USER_ID= U.CUSTOMER_ID ORDER BY INVOICE_ID"
342,Y,Y,"WITH U AS (SELECT T.CUSTOMER_ID, T.CUSTOMER_NAME, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, C.EMAIL, C1.CONTACT_NAME, C1.CONTACT_EMAIL FROM CUSTOMERS C LEFT JOIN CONTACTS C1 ON C.CUSTOMER_ID=C1.USER_ID) AS T GROUP BY T.CUSTOMER_ID, T.CUSTOMER_NAME ) SELECT I.INVOICE_ID, U.CUSTOMER_NAME, I.PRICE, U.CONTACTS_CNT, U.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN U ON I.USER_ID= U.CUSTOMER_ID ORDER BY INVOICE_ID"
343,Y,Y,"WITH X AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), Y AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END AS CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN X ON INVOICES.USER_ID = X.USER_ID LEFT JOIN Y ON INVOICES.USER_ID = Y.USER_ID ORDER BY 1"
344,Y,Y,"SELECT I.INVOICE_ID, T1.CUSTOMER_NAME, I.PRICE, IFNULL(T1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY C1.CUSTOMER_ID) T1 LEFT JOIN (SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, COUNT(C2.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID WHERE C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY C1.CUSTOMER_ID) T2 ON T1.CUSTOMER_ID=T2.CUSTOMER_ID JOIN INVOICES I ON I.USER_ID = T1.CUSTOMER_ID ORDER BY I.INVOICE_ID"
345,Y,Y,"WITH CTE AS (SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID=CT.USER_ID GROUP BY 1), CTE1 AS (SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID=CT.USER_ID AND CT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT INVOICE_ID, CTE.CUSTOMER_NAME, PRICE, CTE.CONTACTS_CNT, CTE1.TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CTE ON INVOICES.USER_ID=CTE.CUSTOMER_ID JOIN CTE1 ON INVOICES.USER_ID=CTE1.CUSTOMER_ID ORDER BY 1"
346,Y,Y,"WITH RECURSIVE T1 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACT_CNT FROM CONTACTS GROUP BY USER_ID ), T2 AS ( SELECT CO.USER_ID, COUNT(CO.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS CO WHERE CO.CONTACT_NAME IN (SELECT CU.CUSTOMER_NAME FROM CUSTOMERS AS CU) GROUP BY CO.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T1.CONTACT_CNT, 0) AS CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN T1 ON T1.USER_ID = I.USER_ID LEFT JOIN T2 ON T2.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
347,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) TMP ON I.USER_ID = TMP.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
348,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(C,0) AS CONTACTS_CNT, IFNULL(C1,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A INNER JOIN INVOICES B ON A.CUSTOMER_ID= B.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS C FROM CONTACTS GROUP BY 1) T ON A.CUSTOMER_ID=T.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS C1 FROM CONTACTS INNER JOIN CUSTOMERS ON CUSTOMERS.EMAIL=CONTACTS.CONTACT_EMAIL GROUP BY 1) T1 ON T1.USER_ID=A.CUSTOMER_ID ORDER BY 1"
349,Y,N,"WITH INVOICE_CUSTOMER AS (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CUSTOMER_ID FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ), CONTACT_COUNT AS (SELECT CUSTOMER_ID, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT FROM (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) T1 RIGHT JOIN CUSTOMERS ON CUSTOMER_ID = USER_ID), TRUSTED_CONTACT_NUM AS (SELECT CUSTOMER_ID, IFNULL(CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS INNER JOIN CUSTOMERS ON EMAIL = CONTACT_EMAIL GROUP BY USER_ID) T2 RIGHT JOIN CUSTOMERS ON CUSTOMER_ID = USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICE_CUSTOMER LEFT JOIN CONTACT_COUNT ON INVOICE_CUSTOMER.CUSTOMER_ID = CONTACT_COUNT.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACT_NUM ON INVOICE_CUSTOMER.CUSTOMER_ID = TRUSTED_CONTACT_NUM.CUSTOMER_ID ORDER BY INVOICE_ID"
350,Y,Y,"WITH CONTACTS_CNT AS ( SELECT T1.CUSTOMER_ID ,T1.CUSTOMER_NAME ,IFNULL(COUNT(T2.CONTACT_NAME),0) CONTACTS_CNT ,IFNULL(SUM(CASE WHEN T2.CONTACT_EMAIL IN (SELECT EMAIL AS CONTACT_EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END),0) TRUSTED_CONTACTS_CNT FROM CUSTOMERS T1 LEFT JOIN CONTACTS T2 ON T1.CUSTOMER_ID = T2.USER_ID GROUP BY 1 ) SELECT INVOICE_ID ,CUSTOMER_NAME ,PRICE ,CONTACTS_CNT ,TRUSTED_CONTACTS_CNT FROM INVOICES T1 JOIN CONTACTS_CNT T2 ON T1.USER_ID = T2.CUSTOMER_ID ORDER BY INVOICE_ID"
351,Y,N,"WITH TMP AS( SELECT A.USER_ID , COUNT(A.CONTACT_EMAIL) AS CONTACTS_CNT , COUNT(B.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY USER_ID ) SELECT A.INVOICE_ID , B.CUSTOMER_NAME , A.PRICE , CASE WHEN C.CONTACTS_CNT IS NULL THEN 0 ELSE C.CONTACTS_CNT END AS CONTACTS_CNT , CASE WHEN C.TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE C.TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN TMP C ON A.USER_ID = C.USER_ID ORDER BY A.INVOICE_ID"
352,Y,N,"SELECT T2.INVOICE_ID, C.CUSTOMER_NAME, T2.PRICE, T2.CONTACTS_CNT, T2.TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, I.USER_ID, I.PRICE, IFNULL(T.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT C1.USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(IF(C2.EMAIL IS NULL, 0,1)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C1 LEFT JOIN CUSTOMERS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY C1.USER_ID)T ON I.USER_ID = T.USER_ID)T2 INNER JOIN CUSTOMERS C ON T2.USER_ID = C.CUSTOMER_ID ORDER BY T2.INVOICE_ID"
353,Y,N,"WITH CTE AS ( SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, COUNT(DISTINCT C2.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN C3.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID LEFT JOIN CUSTOMERS C3 ON C3.EMAIL = C2.CONTACT_EMAIL GROUP BY 1 ) SELECT INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
354,Y,Y,"WITH BASE AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), BASE2 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT A.INVOICE_ID, D.CUSTOMER_NAME, A.PRICE, IFNULL(B.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN BASE B ON A.USER_ID=B.USER_ID LEFT JOIN BASE2 C ON A.USER_ID=C.USER_ID LEFT JOIN CUSTOMERS D ON A.USER_ID=D.CUSTOMER_ID ORDER BY A.INVOICE_ID"
355,Y,Y,"SELECT INVOICE_ID, T.CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN ( SELECT A.CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY A.CUSTOMER_ID ) T ON I.USER_ID = T.CUSTOMER_ID ORDER BY 1"
356,Y,Y,"WITH TRUSTED_CONTACTS AS (SELECT C1.CUSTOMER_ID, COUNT(C1.EMAIL) AS TRUSTED_C FROM CUSTOMERS C1 JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID WHERE C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1), TOTAL_COUNT AS (SELECT USER_ID, COUNT(*) AS TOTAL_CNT FROM CONTACTS GROUP BY USER_ID) SELECT A1.INVOICE_ID, A2.CUSTOMER_NAME, COALESCE(A1.PRICE,0) AS PRICE, COALESCE(A4.TOTAL_CNT,0) AS CONTACTS_CNT, COALESCE(A3.TRUSTED_C,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A1 LEFT JOIN CUSTOMERS A2 ON A1.USER_ID = A2.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACTS A3 ON A1.USER_ID = A3.CUSTOMER_ID LEFT JOIN TOTAL_COUNT A4 ON A1.USER_ID = A4.USER_ID ORDER BY 1"
357,Y,N,"WITH CTE1 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), CTE2 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) TRUSTED_CONTACTS_CNT FROM CONTACTS CON JOIN CUSTOMERS CST ON CON.CONTACT_EMAIL = CST.EMAIL GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES INV JOIN CUSTOMERS CUS ON INV.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CTE1 USING (USER_ID) LEFT JOIN CTE2 USING (USER_ID) ORDER BY INVOICE_ID"
358,Y,Y,"WITH CONTACTS_CNT AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), TRUSTED_CONTACTS_CNT AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS_CNT C ON A.USER_ID = C.USER_ID LEFT JOIN TRUSTED_CONTACTS_CNT D ON A.USER_ID = D.USER_ID GROUP BY 1 ORDER BY 1"
359,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,USER_ID FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID) AS I LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN CUSTOMER_ID IS NULL THEN 0 ELSE 1 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_EMAIL=CUSTOMERS.EMAIL GROUP BY USER_ID) AS C ON I.USER_ID=C.USER_ID ORDER BY INVOICE_ID"
360,Y,N,"WITH TB1 AS ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(CON.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL = C2.EMAIL GROUP BY C.CUSTOMER_ID, C.CUSTOMER_NAME ) SELECT I.INVOICE_ID, TB1.CUSTOMER_NAME, I.PRICE, TB1.CONTACTS_CNT, TB1.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN TB1 ON I.USER_ID = TB1.CUSTOMER_ID ORDER BY I.INVOICE_ID"
361,Y,Y,"WITH TRUST AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CONTACTS.USER_ID=CUSTOMERS.CUSTOMER_ID GROUP BY 1,2) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM TRUST JOIN INVOICES ON INVOICES.USER_ID=TRUST.CUSTOMER_ID ORDER BY 1"
362,Y,Y,"WITH TRUSTED_CONTACTS AS (SELECT USER_ID, COUNT(*) AS TRUSTED_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID), ALL_CONTACTS AS (SELECT USER_ID, COUNT(*) AS ALL_CNT FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(A.ALL_CNT,0) AS CONTACTS_CNT, IFNULL(T.TRUSTED_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACTS T ON I.USER_ID = T.USER_ID LEFT JOIN ALL_CONTACTS A ON I.USER_ID = A.USER_ID ORDER BY I.INVOICE_ID ASC"
363,Y,N,"WITH CONTACTS_COUNT AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TOTAL_CONTACTS FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACT_COUNTS AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TOTAL_TRUTSED_CONTACTS FROM ( SELECT A.CUSTOMER_ID, A.EMAIL, B.USER_ID, B.CONTACT_EMAIL FROM CUSTOMERS A INNER JOIN CONTACTS B ON A.EMAIL=B.CONTACT_EMAIL ) T1 GROUP BY USER_ID ), INVOICEINFO_JOINED AS ( SELECT INVOICE_ID, PRICE, T1.USER_ID, (CASE WHEN TOTAL_CONTACTS IS NOT NULL THEN TOTAL_CONTACTS ELSE 0 END) AS CONTACTS_CNT , (CASE WHEN TOTAL_TRUTSED_CONTACTS IS NOT NULL THEN TOTAL_TRUTSED_CONTACTS ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM ( SELECT INVOICE_ID, PRICE, A.USER_ID, TOTAL_CONTACTS FROM INVOICES A LEFT JOIN CONTACTS_COUNT B ON A.USER_ID=B.USER_ID) T1 LEFT JOIN TRUSTED_CONTACT_COUNTS T2 ON T1.USER_ID=T2.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICEINFO_JOINED A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID ORDER BY INVOICE_ID ASC"
364,Y,Y,"WITH CUSTOMER_CONTACTS AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS CO GROUP BY 1 ) , TRUSTED_CONTACT AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON (I.USER_ID = C.CUSTOMER_ID) LEFT JOIN CUSTOMER_CONTACTS USING (USER_ID) LEFT JOIN TRUSTED_CONTACT USING (USER_ID) ORDER BY 1"
365,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CO.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID LEFT JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL = CU.EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
366,Y,Y,"WITH TRUSTED_CONTACT AS ( SELECT USER_ID, CONTACT_NAME, CONTACT_EMAIL, IF((SELECT COUNT(1) FROM CUSTOMERS C WHERE CT.CONTACT_EMAIL = C.EMAIL) > 0, 1, 0) AS TRUSTED FROM CONTACTS CT ) SELECT INV.INVOICE_ID, CUST.CUSTOMER_NAME, INV.PRICE, COUNT(CNT.CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(CNT.TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS CUST ON INV.USER_ID = CUST.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACT CNT ON CUST.CUSTOMER_ID = CNT.USER_ID GROUP BY 1,2,3 ORDER BY INVOICE_ID"
367,Y,Y,"WITH TT AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.USER_ID=CUS.CUSTOMER_ID GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN TT ON TT.USER_ID=I.USER_ID ORDER BY INVOICE_ID"
368,Y,N,"SELECT INVOICE_ID, CUS.CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_EMAIL),0) AS CONTACTS_CNT, IFNULL(COUNT(CUS2.EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID LEFT JOIN CUSTOMERS CUS2 ON CONTACT_EMAIL = CUS2.EMAIL GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
369,Y,N,"SELECT I.INVOICE_ID , C1.CUSTOMER_NAME , I.PRICE , IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID=I.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS C2 ON C2.USER_ID=I.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO JOIN CUSTOMERS CU ON CU.EMAIL=CO.CONTACT_EMAIL GROUP BY USER_ID) AS C3 ON C3.USER_ID=I.USER_ID ORDER BY I.INVOICE_ID"
370,Y,Y,"WITH T1 AS( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) C1 FROM CONTACTS GROUP BY USER_ID ), T2 AS( SELECT A.USER_ID, COUNT(DISTINCT A.CONTACT_NAME) C2 FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME=B.CUSTOMER_NAME WHERE B.CUSTOMER_NAME IS NOT NULL GROUP BY A.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T1.C1,0) CONTACTS_CNT, IFNULL(T2.C2,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN T1 ON I.USER_ID=T1.USER_ID LEFT JOIN T2 ON I.USER_ID=T2.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
371,Y,N,"WITH TEMP2 AS ( SELECT CONTACTS.USER_ID, COUNT(CUSTOMERS.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS JOIN CUSTOMERS ON CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(TEMP1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TEMP2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1) TEMP1 ON I.USER_ID = TEMP1.USER_ID LEFT JOIN TEMP2 ON I.USER_ID = TEMP2.USER_ID ORDER BY 1"
372,Y,N,"SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE,IFNULL(C.CNT,0) AS CONTACTS_CNT,IFNULL(D.CNT2,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(USER_ID) AS CNT FROM CONTACTS GROUP BY USER_ID)C ON A.USER_ID=C.USER_ID LEFT JOIN (SELECT USER_ID,COUNT(USER_ID) AS CNT2 FROM CONTACTS P INNER JOIN CUSTOMERS Q ON P.CONTACT_EMAIL=Q.EMAIL GROUP BY USER_ID)D ON A.USER_ID=D.USER_ID ORDER BY 1"
373,Y,N,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT,IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(USER_ID) CONTACTS_CNT,COUNT(EMAIL) TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL=CU.EMAIL GROUP BY USER_ID) A ON I.USER_ID=A.USER_ID ORDER BY INVOICE_ID"
374,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(C.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(C.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID) LEFT JOIN (SELECT D.USER_ID, COUNT(D.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(E.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS D LEFT JOIN CUSTOMERS E ON D.CONTACT_EMAIL = E.EMAIL GROUP BY D.USER_ID) C ON A.USER_ID = C.USER_ID ORDER BY A.INVOICE_ID"
375,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(A.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN A.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS A ON C.CUSTOMER_ID=A.USER_ID GROUP BY 1,2,3 ORDER BY 1"
376,Y,Y,"WITH CNT AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CNT ON I.USER_ID = CNT.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
377,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CO.CC,0) CONTACTS_CNT, IFNULL(CO.TC,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(1) CC, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TC FROM CONTACTS GROUP BY USER_ID) CO ON C.CUSTOMER_ID = CO.USER_ID ORDER BY INVOICE_ID"
378,Y,Y,"WITH CTE AS (SELECT USER_ID, CONTACT_NAME, IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS),'TRUSTED','NOT TRUSTED') AS CREDIBILITY FROM CONTACTS), CTE1 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(CREDIBILITY='TRUSTED',1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CTE ON CUSTOMER_ID=USER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CTE1 ON USER_ID=CUSTOMER_ID ORDER BY INVOICE_ID"
379,Y,Y,"WITH CONTACT_PREP AS ( SELECT CUSTOMER_ID ,CUSTOMER_NAME ,COUNT(USER_ID) AS CONTACTS_CNT ,SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CONT ON CUST.CUSTOMER_ID = CONT.USER_ID GROUP BY 1 ) SELECT INVOICE_ID ,CUSTOMER_NAME ,PRICE ,CONTACTS_CNT ,TRUSTED_CONTACTS_CNT FROM CONTACT_PREP CP JOIN INVOICES I ON CP.CUSTOMER_ID = I.USER_ID ORDER BY 1"
380,Y,Y,"WITH T1 AS ( SELECT C.USER_ID, COUNT(DISTINCT C.CONTACT_NAME, C.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C JOIN CUSTOMERS CU ON CU.CUSTOMER_NAME = C.CONTACT_NAME AND CU.EMAIL = C.CONTACT_EMAIL GROUP BY 1 ), T2 AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME, CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COALESCE(T2.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(T1.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN T2 ON T2.USER_ID = I.USER_ID LEFT JOIN T1 ON T1.USER_ID = I.USER_ID ORDER BY 1"
381,Y,Y,"SELECT C.INVOICE_ID, D.CUSTOMER_NAME, C.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM (SELECT A.INVOICE_ID, A.PRICE, IFNULL(A.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT, A.USER_ID FROM (SELECT I.INVOICE_ID, I.USER_ID, I.PRICE, IFNULL(COUNT(CO.USER_ID),0) AS CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CONTACTS AS CO ON CO.USER_ID = I.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID) AS A LEFT JOIN (SELECT USER_ID, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS B ON A.USER_ID = B.USER_ID ORDER BY INVOICE_ID) AS C JOIN CUSTOMERS AS D ON C.USER_ID = D.CUSTOMER_ID ORDER BY INVOICE_ID"
382,Y,N,"WITH CONTACT_CNT AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACT_CNT AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME WHERE CUSTOMER_NAME IS NOT NULL GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACT_CNT ON C.CUSTOMER_ID = CONTACT_CNT.USER_ID LEFT JOIN TRUSTED_CONTACT_CNT ON CONTACT_CNT.USER_ID = TRUSTED_CONTACT_CNT.USER_ID ORDER BY INVOICE_ID"
383,Y,N,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID=C1.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C1.CUSTOMER_ID=CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL=C2.EMAIL GROUP BY 1 ORDER BY 1"
384,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME , I.PRICE, COUNT(CONTACTS.USER_ID) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
385,Y,N,"WITH CTE AS (SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME,CT.CONTACT_NAME,C2.CUSTOMER_ID ID FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID LEFT JOIN CUSTOMERS C2 ON CT.CONTACT_NAME=C2.CUSTOMER_NAME), CTE2 AS (SELECT I.*, C.* FROM INVOICES I LEFT JOIN CTE C ON I.USER_ID=C.CUSTOMER_ID) SELECT INVOICE_ID,CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) CONTACTS_CNT, COUNT(ID) TRUSTED_CONTACTS_CNT FROM CTE2 GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
386,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE, COUNT(CON.USER_ID)AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID=CU.CUSTOMER_ID GROUP BY 1 ORDER BY 1"
387,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CUST.CUSTOMER_ID = CON.USER_ID GROUP BY 1 ORDER BY 1"
388,Y,N,"SELECT I.INVOICE_ID, CT.CUSTOMER_NAME, I.PRICE, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CST.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CT ON I.USER_ID = CT.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS AS CST ON C.CONTACT_EMAIL = CST.EMAIL GROUP BY 1,2,3 ORDER BY 1"
389,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN (SELECT CUSTOMER_ID,CUSTOMER_NAME,COUNT(CONTACT_NAME) CONTACTS_CNT,SUM(IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS),1,0)) TRUSTED_CONTACTS_CNT FROM (SELECT CUSTOMER_ID,CUSTOMER_NAME,CONTACT_NAME FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID) C GROUP BY CUSTOMER_ID) D ON I.USER_ID = D.CUSTOMER_ID ORDER BY INVOICE_ID"
390,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CONTACTS USING(USER_ID) LEFT JOIN CUSTOMERS ON I.USER_ID = CUSTOMERS.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
391,Y,N,"SELECT T1.INVOICE_ID, T1.CUSTOMER_NAME, T1.PRICE, IFNULL(T2.CNT,0) AS CONTACTS_CNT, IFNULL(T3.CNT,0) AS TRUSTED_CONTACTS_CNT FROM ( SELECT I.INVOICE_ID, C.CUSTOMER_ID, C.CUSTOMER_NAME, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID) T1 LEFT JOIN ( SELECT CUS.CUSTOMER_NAME, COUNT(DISTINCT CON.CONTACT_NAME) AS CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CON.USER_ID = CUS.CUSTOMER_ID GROUP BY CUS.CUSTOMER_ID) T2 ON T1.CUSTOMER_NAME = T2.CUSTOMER_NAME LEFT JOIN ( SELECT CON.USER_ID,COUNT(CUS.CUSTOMER_ID) AS CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_EMAIL = CUS.EMAIL GROUP BY CON.USER_ID) T3 ON T1.CUSTOMER_ID = T3.USER_ID ORDER BY T1.INVOICE_ID ASC"
392,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM (SELECT I.PRICE,I.INVOICE_ID,C.CUSTOMER_ID,C.CUSTOMER_NAME,COUNT(CONTACT_NAME) AS CONTACTS_CNT,SUM(CASE WHEN CONTACT_NAME IN(SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID = CN.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID)FHFH"
393,Y,Y,"SELECT I.INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CON1.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CASE WHEN CON1.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN CON1.CONTACT_EMAIL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON1 ON CON1.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY I.INVOICE_ID"
394,Y,Y,"WITH BASELINE AS ( SELECT I.INVOICE_ID, CUS.CUSTOMER_NAME, CUS.CUSTOMER_ID, I.PRICE FROM INVOICES I INNER JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID), CONTACTS_BASELINE AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS NUM_CONTACT FROM CONTACTS GROUP BY USER_ID), TRUSTED_CONTACTS_BASELINE AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_NUM_CONTACT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT B.INVOICE_ID, B.CUSTOMER_NAME, B.PRICE, IFNULL(CB.NUM_CONTACT,0) AS CONTACTS_CNT, IFNULL(TCB.TRUSTED_NUM_CONTACT,0) AS TRUSTED_CONTACTS_CNT FROM BASELINE B LEFT JOIN CONTACTS_BASELINE CB ON B.CUSTOMER_ID = CB.USER_ID LEFT JOIN TRUSTED_CONTACTS_BASELINE TCB ON CB.USER_ID = TCB.USER_ID ORDER BY INVOICE_ID"
395,Y,Y,"WITH TRUST AS (SELECT CUSTOMER_ID AS CUST_ID , CUSTOMER_NAME, SUM(CASE WHEN CUSTOMER_ID IN (SELECT USER_ID FROM CUSTOMERS) THEN 1 ELSE 0 END) AS CONTACTS_CNT, IFNULL(SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CONTACTS.USER_ID=CUSTOMERS.CUSTOMER_ID GROUP BY 1,2) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM TRUST JOIN INVOICES ON INVOICES.USER_ID=TRUST.CUST_ID ORDER BY 1"
396,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME , I.PRICE, IFNULL(CONTACTS_CNT.CONTACTS_CNT,0) CONTACTS_CNT, TRUSTED.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, COUNT(USER_ID ) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS CONTACTS_CNT ON CONTACTS_CNT.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT B.CUSTOMER_ID,COUNT(A.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS B LEFT JOIN CONTACTS ON CUSTOMER_ID = USER_ID LEFT JOIN CUSTOMERS A ON CONTACT_EMAIL = A.EMAIL GROUP BY B.CUSTOMER_ID ) AS TRUSTED ON TRUSTED.CUSTOMER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
397,Y,Y,"WITH INV AS ( SELECT I.INVOICE_ID, C.CUSTOMER_ID, C.CUSTOMER_NAME, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ), CTCT AS ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY C.CUSTOMER_ID, C.CUSTOMER_NAME ) SELECT INV.INVOICE_ID, INV.CUSTOMER_NAME, INV.PRICE, CTCT.CONTACTS_CNT, CTCT.TRUSTED_CONTACTS_CNT FROM INV JOIN CTCT ON INV.CUSTOMER_ID = CTCT.CUSTOMER_ID ORDER BY INVOICE_ID"
398,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CASE WHEN CONTACT_NAME IS NULL THEN 0 WHEN CONTACT_NAME IS NOT NULL THEN COUNT(CONTACT_NAME) END AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CM LEFT JOIN CONTACTS CT ON CM.CUSTOMER_ID=CT.USER_ID JOIN INVOICES I ON CM.CUSTOMER_ID=I.USER_ID GROUP BY CUSTOMER_NAME, INVOICE_ID ORDER BY INVOICE_ID"
399,Y,N,"SELECT I.INVOICE_ID, CUS0.CUSTOMER_NAME, I.PRICE, IFNULL(TEMP.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TEMP.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS0 ON I.USER_ID = CUS0.CUSTOMER_ID LEFT JOIN (SELECT C.USER_ID, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CUS.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CUS ON C.CONTACT_EMAIL = CUS.EMAIL GROUP BY C.USER_ID) TEMP ON I.USER_ID = TEMP.USER_ID ORDER BY I.INVOICE_ID"
400,Y,Y,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT DISTINCT(EMAIL) FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY 1,2,3 ORDER BY 1"
401,Y,Y,"WITH TEMP AS ( SELECT C.USER_ID, COUNT(*) AS CONTACTS_CNT, SUM( CASE WHEN C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C GROUP BY C.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(T.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT OUTER JOIN TEMP T ON T.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID ASC"
402,Y,N,"WITH CTE1 AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE2 AS( SELECT USER_ID, COUNT(CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME = B.CUSTOMER_NAME GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMER_ID LEFT JOIN CTE1 ON INVOICES.USER_ID = CTE1.USER_ID LEFT JOIN CTE2 ON INVOICES.USER_ID = CTE2.USER_ID ORDER BY INVOICE_ID"
403,Y,Y,"WITH TMP AS( SELECT A.USER_ID USER_ID, A.INVOICE_ID INVOICE_ID, A.PRICE PRICE, C.CUSTOMER_NAME CUSTOMER_NAME, B.CONTACT_NAME CONTACT_NAME FROM INVOICES A LEFT JOIN CONTACTS B ON A.USER_ID=B.USER_ID LEFT JOIN CUSTOMERS C ON A.USER_ID=C.CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM TMP GROUP BY INVOICE_ID,USER_ID ORDER BY INVOICE_ID"
404,Y,N,"SELECT DISTINCT I.INVOICE_ID, M.CUSTOMER_NAME, I.PRICE, CASE WHEN C.USER_ID IS NULL THEN 0 ELSE COUNT(I.INVOICE_ID) END AS CONTACTS_CNT, COUNT(M2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS M ON I.USER_ID = M.CUSTOMER_ID LEFT JOIN CONTACTS C ON C.USER_ID = M.CUSTOMER_ID LEFT JOIN CUSTOMERS M2 ON M2.EMAIL = C.CONTACT_EMAIL GROUP BY I.INVOICE_ID, M.CUSTOMER_NAME ORDER BY I.INVOICE_ID ASC"
405,Y,N,"WITH TMP AS( SELECT CUS.CUSTOMER_ID CUSTOMER_ID, CUS.CUSTOMER_NAME CUS_NAME, CON.CONTACT_NAME AS CONT_NAME, COST.EMAIL AS CONT_EMAIL FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS COST ON CON.CONTACT_NAME = COST.CUSTOMER_NAME ) SELECT INVOICE_ID, TMP.CUS_NAME CUSTOMER_NAME, I.PRICE, COUNT(CONT_NAME) CONTACTS_CNT, COUNT(CONT_EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN TMP ON I.USER_ID = TMP.CUSTOMER_ID GROUP BY INVOICE_ID,CUS_NAME ORDER BY INVOICE_ID"
406,N,N,"( SELECT I.INVOICE_ID, CUS.CUSTOMER_NAME, I.PRICE FROM INVOICES AS I JOIN CUSTOMERS AS CUS ON CUS.CUSTOMER_ID = I.USER_ID ), TEMP2 AS ( SELECT INVOICES.INVOICE_ID, IFNULL(B.CONTACTS_CNT,0) AS CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT CON.USER_ID, COUNT(CON.CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS AS CON GROUP BY CON.USER_ID) B USING(USER_ID) ), TEMP3 AS (SELECT A.INVOICE_ID, COUNT(A.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID, CON.CONTACT_NAME FROM INVOICES AS I LEFT JOIN CONTACTS AS CON USING(USER_ID)) A WHERE A.CONTACT_NAME IN (SELECT CUSTOMERS.CUSTOMER_NAME FROM CUSTOMERS) GROUP BY A.INVOICE_ID ) SELECT TEMP.INVOICE_ID, TEMP.CUSTOMER_NAME, TEMP.PRICE, TEMP2.CONTACTS_CNT, IFNULL(TEMP3.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM TEMP JOIN TEMP2 USING(INVOICE_ID) LEFT JOIN TEMP3 USING(INVOICE_ID) ORDER BY INVOICE_ID"
407,Y,Y,"WITH T1 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), T2 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1 ), T3 AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, USER_ID FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID=B.CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM T3 LEFT JOIN T2 ON T3.USER_ID=T2.USER_ID LEFT JOIN T1 ON T3.USER_ID=T1.USER_ID ORDER BY 1"
408,Y,N,"SELECT INVOICE_ID, CU1.CUSTOMER_NAME, PRICE, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CU.CUSTOMER_ID ) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU1 ON I.USER_ID=CU1.CUSTOMER_ID LEFT JOIN CONTACTS C ON I.USER_ID=C.USER_ID LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL=CU.EMAIL AND C.CONTACT_NAME=CU.CUSTOMER_NAME GROUP BY 1,2,3 ORDER BY 1"
409,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(D.CONTACTS_CNT,0) AS CONTACTS_CNT , IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C JOIN INVOICES I ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN ( SELECT COUNT(USER_ID) AS CONTACTS_CNT, USER_ID FROM CONTACTS GROUP BY USER_ID) D ON D.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT COUNT(USER_ID) AS TRUSTED_CONTACTS_CNT, USER_ID FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS ) GROUP BY USER_ID) B ON B.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
410,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
411,Y,N,"WITH NEW1 AS (SELECT CUSTOMER_NAME, IFNULL(COUNT(DISTINCT CONTACT_NAME),0) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS COA ON C.CUSTOMER_ID=COA.USER_ID GROUP BY CUSTOMER_NAME ), NEW2 AS (SELECT CUSTOMER_NAME, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS COA ON C.CUSTOMER_ID=COA.USER_ID WHERE COA.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUSTOMER_NAME), NEW3 AS (SELECT NEW1.CUSTOMER_NAME, CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM NEW1 LEFT JOIN NEW2 ON NEW1.CUSTOMER_NAME=NEW2.CUSTOMER_NAME), NEW4 AS ( SELECT INVOICE_ID,PRICE, CUSTOMER_NAME FROM INVOICES JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID) SELECT INVOICE_ID, NEW4.CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM NEW4 LEFT JOIN NEW3 ON NEW4.CUSTOMER_NAME=NEW3.CUSTOMER_NAME ORDER BY INVOICE_ID"
412,Y,N,"WITH TEMP AS ( SELECT USER_ID, COUNT(*) AS CNT FROM CONTACTS GROUP BY USER_ID), TEMP2 AS (SELECT INVOICE_ID, PRICE, I.USER_ID, IFNULL(CNT,0) AS CNT FROM INVOICES I LEFT JOIN TEMP T ON I.USER_ID= T.USER_ID), F AS (SELECT TEMP2.INVOICE_ID, C.CUSTOMER_NAME, TEMP2.PRICE, TEMP2.CNT AS CONTACTS_CNT FROM TEMP2 JOIN CUSTOMERS C ON TEMP2.USER_ID = C.CUSTOMER_ID), TIR AS (SELECT CUSTOMER_NAME, CONTACT_NAME FROM CUSTOMERS C1 JOIN CONTACTS C2 ON C1.CUSTOMER_ID= C2.USER_ID), TIRR AS (SELECT TIR.CUSTOMER_NAME AS TIRCNAME,CUSTOMERS.CUSTOMER_NAME AS CCNAME, TIR.CONTACT_NAME FROM CUSTOMERS JOIN TIR ON CUSTOMERS.CUSTOMER_NAME= TIR.CONTACT_NAME), T AS (SELECT TIRR.TIRCNAME, COUNT(*) AS CNT2 FROM TIRR GROUP BY TIRR.TIRCNAME) SELECT F.INVOICE_ID, F.CUSTOMER_NAME, F.PRICE, F.CONTACTS_CNT, IFNULL(T.CNT2,0) AS TRUSTED_CONTACTS_CNT FROM F LEFT JOIN T ON F.CUSTOMER_NAME = T.TIRCNAME ORDER BY F.INVOICE_ID"
413,Y,Y,"WITH CTE AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON USER_ID=CUSTOMER_ID GROUP BY CUSTOMER_ID), CTE1 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACT_NAME),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON USER_ID=CUSTOMER_ID AND CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CTE.CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CTE ON I.USER_ID=CTE.CUSTOMER_ID JOIN CTE1 ON I.USER_ID = CTE1.CUSTOMER_ID ORDER BY INVOICE_ID"
414,Y,Y,"WITH TEMP AS( SELECT DISTINCT USER_ID,COUNT(*) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN(SELECT EMAIL FROM CUSTOMERS)THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN TEMP ON I.USER_ID=TEMP.USER_ID GROUP BY 1,2 ORDER BY 1"
415,Y,Y,"WITH CTE AS( SELECT C.CUSTOMER_ID,COUNT(*) AS CONTACTS_CNT FROM CUSTOMERS C INNER JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID), OUTERCTE AS ( SELECT C.CUSTOMER_ID ,COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C INNER JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID WHERE CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS C1) GROUP BY CUSTOMER_ID) SELECT I.INVOICE_ID,C.CUSTOMER_NAME,PRICE ,CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END AS CONTACTS_CNT ,CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE CT ON CT.CUSTOMER_ID = C.CUSTOMER_ID LEFT JOIN OUTERCTE OT ON OT.CUSTOMER_ID = C.CUSTOMER_ID ORDER BY 1"
416,Y,N,"SELECT INVOICE_ID, CUS2.CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(CUS.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CONTACTS CON ON CON.USER_ID = INV.USER_ID LEFT JOIN CUSTOMERS CUS2 ON CUS2.CUSTOMER_ID = INV.USER_ID LEFT JOIN CUSTOMERS CUS ON CUS.CUSTOMER_NAME = CON.CONTACT_NAME GROUP BY 1 ORDER BY 1"
417,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(DISTINCT T1.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN T2.CUSTOMER_NAME IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T1 ON T1.USER_ID = I.USER_ID LEFT JOIN CUSTOMERS T2 ON T1.CONTACT_NAME = T2.CUSTOMER_NAME GROUP BY 1,2,3"
418,Y,Y,"WITH A AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), B AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1 ) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, IFNULL(A.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN A USING (USER_ID) LEFT JOIN B USING (USER_ID) ORDER BY INVOICE_ID"
419,Y,Y,"SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME,PRICE, COUNT(CONTACTS.USER_ID) CONTACTS_CNT, SUM(CASE WHEN CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID LEFT JOIN CONTACTS ON CONTACTS.USER_ID = INVOICES.USER_ID GROUP BY 1 ORDER BY 1"
420,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C3.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID LEFT JOIN CUSTOMERS C3 ON C2.CONTACT_NAME = C3.CUSTOMER_NAME GROUP BY I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
421,Y,Y,"SELECT B.INVOICE_ID, A.CUSTOMER_NAME,B.PRICE AS PRICE , CNT AS CONTACTS_CNT, COUNT(C.USER_ID) AS TRUSTED_CONTACTS_CNT FROM (SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(CONTACTS.USER_ID),0) AS CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY 1,2) A INNER JOIN INVOICES B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN (SELECT * FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) C ON A.CUSTOMER_ID = C.USER_ID GROUP BY 1,2 ORDER BY 1"
422,Y,Y,"WITH EMAIL_COUNT AS (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT( CO.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID WHERE CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY C.CUSTOMER_ID), COUNT_CONT AS ( SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(CO.CONTACT_EMAIL ) AS CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID ), CONTACT AS(SELECT N1.CUSTOMER_ID , N1.CUSTOMER_NAME, N1.CONTACTS_CNT, N2.TRUSTED_CONTACTS_CNT FROM COUNT_CONT AS N1 LEFT JOIN EMAIL_COUNT AS N2 ON N1.CUSTOMER_ID = N2.CUSTOMER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE,C.CONTACTS_CNT , IFNULL(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CONTACT AS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
423,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(D.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) D ON C.USER_ID = D.USER_ID ORDER BY A.INVOICE_ID"
424,Y,Y,"WITH TRUSTED AS (SELECT COALESCE(COUNT(CONTACT_NAME),0) AS TRUSTED_CONTACTS_CNT, USER_ID FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COALESCE(T.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS C ON C.USER_ID=I.USER_ID LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN TRUSTED T ON T.USER_ID=I.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME,PRICE ORDER BY INVOICE_ID"
425,Y,Y,"WITH CC AS ( SELECT USER_ID, COUNT(*) NUMBER FROM CONTACTS GROUP BY USER_ID ) , TC AS ( SELECT USER_ID, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TCO FROM CONTACTS GROUP BY USER_ID ) , TEMP AS ( SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, A.USER_ID FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID ) SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, CASE WHEN B.NUMBER IS NULL THEN 0 ELSE B.NUMBER END AS CONTACTS_CNT, CASE WHEN C.TCO IS NULL THEN 0 ELSE C.TCO END AS TRUSTED_CONTACTS_CNT FROM TEMP A LEFT JOIN CC B ON A.USER_ID=B.USER_ID LEFT JOIN TC C ON A.USER_ID=C.USER_ID ORDER BY INVOICE_ID"
426,Y,Y,"WITH THREE AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, SUM(I.PRICE) AS PRICE, C.CUSTOMER_ID FROM CUSTOMERS C RIGHT JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY I.INVOICE_ID), CONTACT_NUM AS(SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS C RIGHT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID), TRUST_CONTACT AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID) SELECT T.INVOICE_ID, T.CUSTOMER_NAME, T.PRICE, CASE WHEN CO.CONTACTS_CNT IS NOT NULL THEN CO.CONTACTS_CNT ELSE 0 END AS CONTACTS_CNT, CASE WHEN T2.TRUSTED_CONTACTS_CNT IS NOT NULL THEN T2.TRUSTED_CONTACTS_CNT ELSE 0 END AS TRUSTED_CONTACTS_CNT FROM THREE T LEFT JOIN CONTACT_NUM CO ON T.CUSTOMER_ID = CO.USER_ID LEFT JOIN TRUST_CONTACT T2 ON T.CUSTOMER_ID = T2.USER_ID ORDER BY T.INVOICE_ID"
427,Y,N,"WITH TEMP AS (SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN CUSTOMERS C ON B.CONTACT_EMAIL = C.EMAIL GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN TEMP B ON A.USER_ID = B.CUSTOMER_ID ORDER BY INVOICE_ID"
428,Y,Y,"WITH T AS (SELECT C.CUSTOMER_ID, C.CUSTOMER_NAME, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, T.CUSTOMER_NAME, PRICE, T.CONTACTS_CNT, T.TRUSTED_CONTACTS_CNT FROM T JOIN INVOICES I ON I.USER_ID = T.CUSTOMER_ID ORDER BY INVOICE_ID"
429,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.USER_ID) CONTACTS_CNT, IFNULL(SUM(C.TRUSTED),0) TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, CONTACT_NAME, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS ) C ON B.CUSTOMER_ID = C.USER_ID GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE ORDER BY A.INVOICE_ID"
430,Y,Y,"WITH CONTACTS_COUNT AS ( SELECT CUSTOMER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON (CU.CUSTOMER_ID=CO.USER_ID) GROUP BY 1 ), TRUSTED_COUNT AS ( SELECT CUSTOMER_ID, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON (CU.CUSTOMER_ID=CO.USER_ID) GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CC.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TC.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS_COUNT CC ON I.USER_ID=CC.CUSTOMER_ID LEFT JOIN TRUSTED_COUNT TC ON I.USER_ID=TC.CUSTOMER_ID ORDER BY 1"
431,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS USING(USER_ID) GROUP BY INVOICE_ID, CUSTOMER_NAME, CUSTOMER_ID, PRICE ORDER BY INVOICE_ID"
432,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN C2.EMAIL IS NOT NULL THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID LEFT JOIN CUSTOMERS C2 ON CT.CONTACT_EMAIL = C2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
433,Y,Y,"WITH CONT AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTS FROM CONTACTS GROUP BY 1), TRUST_CONT AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUST_CONTS FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1), APPEND_CONT AS (SELECT A.CUSTOMER_ID,A.CUSTOMER_NAME,IFNULL(B.CONTS,0) AS CONTACTS_CNT,IFNULL(C.TRUST_CONTS,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONT B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN TRUST_CONT C ON A.CUSTOMER_ID = C.USER_ID) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE,B.CONTACTS_CNT, B.TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN APPEND_CONT B ON A.USER_ID = B.CUSTOMER_ID ORDER BY 1"
434,Y,Y,"WITH T1 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T1.CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN T1 ON I.USER_ID = T1.USER_ID ORDER BY 1"
435,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL = C2.EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
436,Y,N,"SELECT C.INVOICE_ID,A.CUSTOMER_NAME,C.PRICE,COUNT(B.USER_ID)CONTACTS_CNT, COUNT(D.CUSTOMER_ID)AS TRUSTED_CONTACTS_CNT FROM INVOICES C JOIN CUSTOMERS A ON A.CUSTOMER_ID = C.USER_ID LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID LEFT JOIN CUSTOMERS D ON B.CONTACT_EMAIL = D.EMAIL GROUP BY C.INVOICE_ID ORDER BY C.INVOICE_ID"
437,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, MAX(I.PRICE) AS PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT OUTER JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY C.CUSTOMER_NAME, I.INVOICE_ID ORDER BY I.INVOICE_ID"
438,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C1.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.CUSTOMER_NAME = CON.CONTACT_NAME GROUP BY 1,2,3 ORDER BY 1"
439,Y,Y,"SELECT INVOICE_ID, D.CUSTOMER_NAME, PRICE, IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN ( SELECT USER_ID,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ) B ON A.USER_ID = B.USER_ID LEFT JOIN ( SELECT USER_ID,COUNT(CONTACT_NAME ) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID )C ON A.USER_ID=C.USER_ID INNER JOIN CUSTOMERS D ON A.USER_ID=D.CUSTOMER_ID ORDER BY INVOICE_ID"
440,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(C.USER_ID), 0) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS C ON CU.CUSTOMER_ID = C.USER_ID GROUP BY 1, 2, 3 ORDER BY 1"
441,Y,Y,"SELECT INVOICE_ID,C1.CUSTOMER_NAME,PRICE,COUNT(DISTINCT C2.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID=I.USER_ID LEFT JOIN CONTACTS C2 ON I.USER_ID=C2.USER_ID GROUP BY 1,2,3 ORDER BY 1"
442,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(*) AS CONTACTS FROM CONTACTS GROUP BY USER_ID), CTE2 AS ( SELECT USER_ID,COUNT(*) AS TRUSTED_CONTACTS FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(D.CONTACTS,0) AS CONTACTS_CNT, IFNULL(E.TRUSTED_CONTACTS,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID=I.USER_ID LEFT JOIN CTE D ON D.USER_ID=I.USER_ID LEFT JOIN CTE2 E ON E.USER_ID=I.USER_ID ORDER BY I.INVOICE_ID"
443,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(COUNT(C2.CUSTOMER_NAME),0)TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = INV.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
444,Y,N,"WITH T1 AS( SELECT A.INVOICE_ID, A.USER_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.USER_ID) CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID=C.USER_ID GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME ), T2 AS( SELECT A.USER_ID, COUNT(B.CUSTOMER_NAME) CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME=B.CUSTOMER_NAME GROUP BY A.USER_ID ) SELECT T1.INVOICE_ID, T1.CUSTOMER_NAME, T1.PRICE, T1.CONTACTS_CNT, IFNULL(T2.CNT,0) AS TRUSTED_CONTACTS_CNT FROM T1 LEFT JOIN T2 ON T1.USER_ID=T2.USER_ID ORDER BY 1"
445,Y,Y,"WITH T1 AS ( SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, COUNT(CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID GROUP BY 1,2 ), T2 AS ( SELECT I.INVOICE_ID, T1.CUSTOMER_NAME, I.PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN T1 ON I.USER_ID = T1.CUSTOMER_ID ) SELECT * FROM T2 ORDER BY 1"
446,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(C2.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(COUNT(C3.CUSTOMER_NAME),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID LEFT JOIN CUSTOMERS C3 ON C2.CONTACT_NAME = C3.CUSTOMER_NAME GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
447,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(COUNT(C.USER_ID), 0) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_EMAIL IN ( SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON A.USER_ID = C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
448,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, IFNULL(C2.CNT,0) AS CONTACTS_CNT, IFNULL(C2.CNT1,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN (SELECT CONTACT_NAME, USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CNT, SUM(IF(CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS),1,0)) AS CNT1 FROM CONTACTS GROUP BY USER_ID) AS C2 ON C1.CUSTOMER_ID = C2.USER_ID ORDER BY I.INVOICE_ID"
449,Y,Y,"WITH CONTACT_CNT AS( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACT_CNT AS ( SELECT USER_ID, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACT_CNT ON C.CUSTOMER_ID = CONTACT_CNT.USER_ID LEFT JOIN TRUSTED_CONTACT_CNT ON CONTACT_CNT.USER_ID = TRUSTED_CONTACT_CNT.USER_ID ORDER BY INVOICE_ID"
450,Y,Y,"SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE,IFNULL(C.CONCT,0) AS CONTACTS_CNT,IFNULL(SUMX,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(1) AS CONCT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)THEN 1 ELSE 0 END) AS SUMX FROM CONTACTS GROUP BY USER_ID) AS C ON A.USER_ID=C.USER_ID ORDER BY 1"
451,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CC.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CC.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CC ON C.CUSTOMER_ID = CC.USER_ID GROUP BY 1,2,3 ORDER BY INVOICE_ID ASC"
452,Y,Y,"WITH T AS (SELECT CUSTOMERS.CUSTOMER_ID, CUSTOMERS.CUSTOMER_NAME, IFNULL(COUNT(CONTACTS.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(COUNT(CASE WHEN CONTACTS.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN CUSTOMER_ID END),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID GROUP BY CUSTOMERS.CUSTOMER_ID ) SELECT INVOICES.INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN T ON T.CUSTOMER_ID = INVOICES.USER_ID ORDER BY INVOICE_ID"
453,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CC ON I.USER_ID = CC.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1) C USING (USER_ID) LEFT JOIN ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1 ) C2 USING(USER_ID) ORDER BY INVOICE_ID"
454,Y,Y,"SELECT INVOICE_ID , C.CUSTOMER_NAME , I.PRICE , COUNT(CC.USER_ID) AS CONTACTS_CNT , SUM(CASE WHEN CC.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL AS TRUSTED_CONTACTS FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID=I.USER_ID LEFT JOIN CONTACTS CC ON CC.USER_ID=I.USER_ID GROUP BY 1,2,3 ORDER BY 1"
455,Y,Y,"WITH CUSTOMER AS (SELECT C.CUSTOMER_ID ,C.CUSTOMER_NAME,COUNT(DISTINCT CO.CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID , C.CUSTOMER_NAME ) SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,C.CONTACTS_CNT,C.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMER C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
456,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,COALESCE(COUNT(CC.USER_ID),0) AS CONTACTS_CNT, SUM(CASE WHEN CC.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CC ON C.CUSTOMER_ID = CC.USER_ID GROUP BY 1,2,3 ORDER BY 1"
457,Y,Y,"WITH TMP AS ( SELECT A.USER_ID, COUNT(DISTINCT A.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT B.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME = B.CUSTOMER_NAME AND A.CONTACT_EMAIL = B.EMAIL GROUP BY 1) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN TMP C ON A.USER_ID = C.USER_ID ORDER BY 1"
458,Y,Y,"SELECT I.INVOICE_ID , CUST.CUSTOMER_NAME , I.PRICE , COUNT(DISTINCT CON.CONTACT_NAME) AS CONTACTS_CNT , SUM(CASE WHEN CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CUST ON CUST.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS CON ON CON.USER_ID = I.USER_ID GROUP BY 1, 2, 3 ORDER BY I.INVOICE_ID"
459,Y,Y,"SELECT I.INVOICE_ID , C1.CUSTOMER_NAME , I.PRICE , COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT , SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS AS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY I.INVOICE_ID , C1.CUSTOMER_NAME , I.PRICE ORDER BY INVOICE_ID"
460,Y,N,"WITH CT1 AS (SELECT USER_ID, COUNT(USER_ID) AS NUM, COUNT(CU.CUSTOMER_NAME) AS NUM1 FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_NAME = CO.CONTACT_NAME GROUP BY 1), CT2 AS (SELECT INVOICE_ID, I.USER_ID, PRICE, IFNULL(NUM,0) AS CONTACTS_CNT, IFNULL(NUM1,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CT1 ON CT1.USER_ID =I.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM CT2 LEFT JOIN CUSTOMERS ON CT2.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY 1"
461,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) CONTACTS_CNT , SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS CON ON CUSTOMERS.CUSTOMER_ID=CON.USER_ID JOIN INVOICES ON CUSTOMERS.CUSTOMER_ID=INVOICES.USER_ID GROUP BY 1 ORDER BY 1"
462,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL = C2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
463,Y,N,"WITH A AS ( SELECT C.USER_ID, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CU.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT JOIN CUSTOMERS CU ON C.CONTACT_EMAIL=CU.EMAIL GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN A ON A.USER_ID=I.USER_ID ORDER BY 1"
464,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY 1,2 ORDER BY 1"
465,Y,Y,"SELECT INVOICE_ID, MAX(CUSTOMER_NAME) AS CUSTOMER_NAME, MIN(PRICE) AS PRICE, COUNT( CN.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CASE WHEN CN.CONTACT_EMAIL IN(SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID=CN.USER_ID JOIN INVOICES I ON I.USER_ID=C.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
466,Y,Y,"SELECT INVOICE_ID, T1.CUSTOMER_NAME, T1.PRICE, T2.CONTACTS_CNT, T2.TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, C.CUSTOMER_NAME,C.CUSTOMER_ID, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID) T1 LEFT JOIN (SELECT CUS.CUSTOMER_ID, IFNULL(COUNT(CON.CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS )THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID)T2 ON T1.CUSTOMER_ID = T2.CUSTOMER_ID ORDER BY INVOICE_ID"
467,Y,N,"SELECT T3.INVOICE_ID ,T5.CUSTOMER_NAME ,T3.PRICE ,IFNULL(T4.CONTACTS_CNT,0) AS CONTACTS_CNT ,IFNULL(T4.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES T3 LEFT JOIN (SELECT T1.USER_ID ,COUNT(T1.CONTACT_NAME) AS CONTACTS_CNT ,COUNT(IF(T2.CUSTOMER_NAME IS NOT NULL,1,NULL)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS T1 LEFT JOIN CUSTOMERS T2 ON T1.CONTACT_NAME = T2.CUSTOMER_NAME GROUP BY T1.USER_ID ORDER BY USER_ID) T4 ON T3.USER_ID = T4.USER_ID LEFT JOIN CUSTOMERS T5 ON T5.CUSTOMER_ID = T3.USER_ID ORDER BY T3.INVOICE_ID"
468,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(A.CT,0) AS CONTACTS_CNT, IFNULL(B.CT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CT FROM CONTACTS GROUP BY USER_ID) A USING (USER_ID) LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) CT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT(EMAIL) FROM CUSTOMERS) GROUP BY USER_ID) B USING (USER_ID) ORDER BY INVOICE_ID"
469,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN ( SELECT T1.CUSTOMER_ID, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM ( SELECT CUSTOMER_ID, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID=CON.USER_ID GROUP BY 1) T1 JOIN (SELECT CUSTOMER_ID, COUNT(CON2.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON2 ON C.CUSTOMER_ID=CON2.USER_ID AND CON2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) T2 ON T1.CUSTOMER_ID=T2.CUSTOMER_ID) X ON I.USER_ID=X.CUSTOMER_ID ORDER BY INVOICE_ID"
470,Y,N,"WITH A1 AS( SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID=I.USER_ID ), A2 AS( SELECT CU.CUSTOMER_NAME, CU.CUSTOMER_ID, IFNULL(COUNT(CO.USER_ID),0) AS CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID=CO.USER_ID GROUP BY CO.USER_ID ), A3 AS( SELECT CU.CUSTOMER_NAME, CU.CUSTOMER_ID, IFNULL(COUNT(CO.USER_ID),0) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID=CO.USER_ID WHERE CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CO.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM A1 LEFT JOIN A2 USING(CUSTOMER_NAME) LEFT JOIN A3 USING(CUSTOMER_NAME) ORDER BY INVOICE_ID"
471,Y,Y,"WITH CTE1 AS (SELECT USER_ID, COUNT(CONTACT_NAME) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), CTE2 AS (SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT I.INVOICE_ID, CUS.CUSTOMER_NAME, I.PRICE, IFNULL(CTE1.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(CTE2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CTE1 ON I.USER_ID = CTE1.USER_ID LEFT JOIN CTE2 ON I.USER_ID = CTE2.USER_ID ORDER BY I.INVOICE_ID"
472,Y,Y,"SELECT I.INVOICE_ID , C.CUSTOMER_NAME AS CUSTOMER_NAME , I.PRICE, COUNT(T.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C RIGHT JOIN INVOICES I ON I.USER_ID =C.CUSTOMER_ID LEFT JOIN CONTACTS T ON T.USER_ID =C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
473,Y,N,"SELECT INVOICE_ID , T.CUSTOMER_NAME , PRICE, COUNT(T.USER_ID) AS CONTACTS_CNT, COUNT(C.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM ( SELECT INVOICE_ID , CU.CUSTOMER_NAME , PRICE, C.USER_ID, CONTACT_NAME FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CONTACTS C ON C.USER_ID=CU.CUSTOMER_ID ) T LEFT JOIN CUSTOMERS C ON C.CUSTOMER_NAME=T.CONTACT_NAME GROUP BY INVOICE_ID, T.USER_ID ORDER BY INVOICE_ID"
474,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY INVOICE_ID, PRICE, CUSTOMER_NAME ORDER BY INVOICE_ID"
475,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) ),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID=C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
476,Y,Y,"WITH CONTACT_TB AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, IFNULL(COUNT(USER_ID),0) AS CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID ), TRUSTED_CONTACT_TB AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS JOIN CONTACTS ON CUSTOMER_ID = USER_ID AND CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUSTOMER_ID ), STATS_TB AS( SELECT C.CUSTOMER_ID,C.CUSTOMER_NAME, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CONTACT_TB C LEFT JOIN TRUSTED_CONTACT_TB T ON C.CUSTOMER_ID = T.CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN STATS_TB S ON I.USER_ID = S.CUSTOMER_ID ORDER BY INVOICE_ID"
477,Y,Y,"SELECT A.INVOICE_ID, C.CUSTOMER_NAME, A.PRICE, SUM(CASE WHEN B.USER_ID IS NULL THEN 0 ELSE 1 END) CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS C ON A.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS B ON A.USER_ID=B.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
478,Y,Y,"WITH T AS ( SELECT CUSTOMERS.CUSTOMER_ID, CUSTOMERS.CUSTOMER_NAME, CUSTOMERS.EMAIL, IFNULL(COUNT(DISTINCT CONTACTS.CONTACT_NAME),0) CONTACTS_CNT, IFNULL(COUNT(DISTINCT TRUST.EMAIL ),0) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID=CONTACTS.USER_ID LEFT JOIN CUSTOMERS TRUST ON CONTACTS.CONTACT_NAME=TRUST.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL=TRUST.EMAIL GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN T ON INVOICES.USER_ID= T.CUSTOMER_ID ORDER BY 1"
479,Y,Y,"SELECT INVOICE_ID,CUST.CUSTOMER_NAME,INVOICE.PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COALESCE(SUM(C.TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES INVOICE JOIN CUSTOMERS CUST ON INVOICE.USER_ID = CUST.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID,CONTACT_NAME, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS ) AS C ON CUST.CUSTOMER_ID = C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
480,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(T.CONTACT_NAME), 0) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON I.USER_ID = T.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_ID ORDER BY INVOICE_ID"
481,Y,N,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, A.CONTACTS_CNT, IFNULL(B.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CU JOIN INVOICES AS I ON CU.CUSTOMER_ID = I.USER_ID JOIN (SELECT CU.CUSTOMER_NAME, IFNULL(COUNT(CO.USER_ID), 0) AS CONTACTS_CNT FROM CUSTOMERS AS CU LEFT JOIN CONTACTS AS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY CU.CUSTOMER_NAME) AS A ON CU.CUSTOMER_NAME = A.CUSTOMER_NAME LEFT JOIN (SELECT CU.CUSTOMER_NAME, COUNT(CO.USER_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CU JOIN CONTACTS AS CO ON CU.CUSTOMER_ID = CO.USER_ID WHERE CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CU.CUSTOMER_NAME) AS B ON CU.CUSTOMER_NAME = B.CUSTOMER_NAME GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
482,Y,N,"WITH CONTACT_COUNT AS( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), TRUSTED_CONTACTS AS( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A INNER JOIN CUSTOMERS B ON B.EMAIL=A.CONTACT_EMAIL GROUP BY 1 ) SELECT DISTINCT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(CC.CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(TC.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID=CT.USER_ID INNER JOIN INVOICES I ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACT_COUNT CC ON C.CUSTOMER_ID=CC.USER_ID LEFT JOIN TRUSTED_CONTACTS TC ON C.CUSTOMER_ID=TC.USER_ID ORDER BY 1"
483,Y,Y,"WITH CTE AS (SELECT CUSTOMER_ID ,CUSTOMER_NAME ,COUNT(CONTACT_NAME) CONTACTS_CNT ,SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS ) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY CUSTOMER_ID,CUSTOMER_NAME) SELECT INVOICE_ID ,CUSTOMER_NAME ,PRICE ,CONTACTS_CNT ,TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CTE C1 ON I.USER_ID = C1.CUSTOMER_ID ORDER BY INVOICE_ID"
484,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), CTE2 AS (SELECT USER_ID, COUNT(USER_ID) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(C1.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(C2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE C1 ON I.USER_ID = C1.USER_ID LEFT JOIN CTE2 C2 ON I.USER_ID = C2.USER_ID ORDER BY INVOICE_ID"
485,Y,Y,"WITH T AS (SELECT *, COUNT(*) CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) TRUSTED_CNT FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T.CNT,0) CONTACTS_CNT, IFNULL(T.TRUSTED_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN T ON I.USER_ID = T.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ORDER BY I.INVOICE_ID"
486,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID=CONTACTS.USER_ID JOIN INVOICES ON CUSTOMERS.CUSTOMER_ID=INVOICES.USER_ID GROUP BY 1 ORDER BY 1"
487,Y,N,"WITH CTE AS ( SELECT USER_ID, SUM(CASE WHEN C1.EMAIL=C.CONTACT_EMAIL THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM CONTACTS C LEFT OUTER JOIN CUSTOMERS C1 ON C1.EMAIL=C.CONTACT_EMAIL GROUP BY USER_ID ) SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,COUNT(C1.USER_ID) CONTACTS_CNT, IFNULL(T.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT OUTER JOIN CUSTOMERS C LEFT OUTER JOIN CONTACTS C1 ON C.CUSTOMER_ID=C1.USER_ID ON C.CUSTOMER_ID=I.USER_ID LEFT OUTER JOIN CTE T ON T.USER_ID=C.CUSTOMER_ID GROUP BY I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE ORDER BY 1"
488,Y,Y,"WITH A AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CT1 FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(A.CT1,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID=C.CUSTOMER_ID LEFT JOIN A ON C.CUSTOMER_ID=A.USER_ID GROUP BY 1,C.CUSTOMER_ID ORDER BY 1"
489,Y,Y,"WITH _CONTACTS AS ( SELECT USER_ID, COUNT(1) AS CNT FROM CONTACTS GROUP BY USER_ID ), _TRUSTED_CONTACTS AS ( SELECT USER_ID, COUNT(1) AS CNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COALESCE(_C.CNT, 0) AS CONTACTS_CNT, COALESCE(_TC.CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN _CONTACTS _C ON _C.USER_ID = I.USER_ID LEFT JOIN _TRUSTED_CONTACTS _TC ON _TC.USER_ID = I.USER_ID ORDER BY 1"
490,Y,Y,"SELECT I.INVOICE_ID , C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME ) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS)THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS T ON C.CUSTOMER_ID =T.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
491,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(USER_ID) AS CONTACTS_CNT, COUNT(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS RIGHT JOIN CUSTOMERS ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID) TEMP ON USER_ID = CUSTOMER_ID ORDER BY INVOICE_ID"
492,Y,Y,"WITH C1 AS (SELECT USER_ID, CONTACT_NAME, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL CONTACT_EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END STATUS FROM CONTACTS), C2 AS (SELECT USER_ID, COUNT(CONTACT_NAME) CNT, SUM(STATUS) TRUST_CNT FROM C1 GROUP BY USER_ID) SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CNT,0) CONTACTS_CNT, IFNULL(TRUST_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN C2 ON C2.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
493,Y,Y,"WITH T AS (SELECT INVOICE_ID, PRICE, INVOICES.USER_ID, CUSTOMER_NAME, EMAIL FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID), T1 AS (SELECT USER_ID, COUNT(*) AS TOTAL_CONTACT FROM CONTACTS GROUP BY 1), T2 AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TOTAL_TRUSTED FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE,IFNULL(TOTAL_CONTACT,0) AS CONTACTS_CNT, IFNULL(TOTAL_TRUSTED,0) AS TRUSTED_CONTACTS_CNT FROM T LEFT JOIN T1 ON T1.USER_ID = T.USER_ID LEFT JOIN T2 ON T2.USER_ID = T1.USER_ID ORDER BY 1"
494,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, IFNULL(COUNT(C2.EMAIL), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID=CON.USER_ID LEFT JOIN CUSTOMERS C2 ON CON.CONTACT_EMAIL=C2.EMAIL GROUP BY INVOICE_ID ORDER BY 1"
495,Y,N,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,IFNULL(COUNT(CO.CONTACT_NAME) ,0) AS CONTACTS_CNT,IFNULL(COUNT(C1.EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID=CO.USER_ID LEFT JOIN CUSTOMERS C1 ON CO.CONTACT_EMAIL=C1.EMAIL GROUP BY I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE ORDER BY I.INVOICE_ID"
496,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CONTACTS_CNT, 0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
497,Y,Y,"SELECT I.INVOICE_ID, T.CUSTOMER_NAME, I.PRICE, T.CONTACTS_CNT, T.TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN (SELECT CUS.CUSTOMER_ID, CUS.CUSTOMER_NAME, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CUS LEFT JOIN CONTACTS AS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID) AS T ON I.USER_ID = T.CUSTOMER_ID ORDER BY I.INVOICE_ID"
498,Y,N,"WITH CUSTOMER_CONTACTS AS ( SELECT C2.USER_ID, COUNT(*) AS TOTAL, SUM(IF(C.CUSTOMER_ID IS NULL, 0, 1)) AS TRUST FROM CONTACTS C2 LEFT JOIN CUSTOMERS C ON C.EMAIL = C2.CONTACT_EMAIL GROUP BY C2.USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CC.TOTAL, 0) AS CONTACTS_CNT, IFNULL(CC.TRUST,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CUSTOMER_CONTACTS CC ON CC.USER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
499,Y,Y,"SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE,IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT ,IFNULL(C.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT , SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) C ON A.USER_ID=C.USER_ID ORDER BY A.INVOICE_ID"
500,Y,Y,"WITH T AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS CUS LEFT JOIN CONTACTS AS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN T ON I.USER_ID = T.CUSTOMER_ID ORDER BY INVOICE_ID"
501,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CN.USER_ID) AS CONTACTS_CNT, SUM(IF(CN.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID=CN.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
502,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, IFNULL(COUNT(C.USER_ID), 0) AS CONTACTS_CNT, IFNULL (SUM(C.CONTACT_EMAIL IN ( SELECT DISTINCT EMAIL FROM CUSTOMERS) ),0)AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON A.USER_ID = C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
503,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1,2 ORDER BY 1"
504,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CT.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CST.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS CST ON CT.CONTACT_EMAIL = CST.EMAIL GROUP BY 1 ORDER BY 1"
505,Y,N,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS C2 ON C.CONTACT_EMAIL = C2.EMAIL GROUP BY 1 ORDER BY 1"
506,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) CONTACTS_CNT , SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1 ORDER BY 1"
507,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT , COUNT(C2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS T ON I.USER_ID = T.USER_ID LEFT JOIN CUSTOMERS C2 ON T.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY I.INVOICE_ID, I.USER_ID ORDER BY I.INVOICE_ID"
508,Y,N,"SELECT INVOICE_ID, TMP.CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES INV JOIN (SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID=B.USER_ID LEFT JOIN CUSTOMERS C ON B.CONTACT_NAME=C.CUSTOMER_NAME GROUP BY A.CUSTOMER_ID ) TMP ON INV.USER_ID=TMP.CUSTOMER_ID ORDER BY INVOICE_ID"
509,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME , I.PRICE , COUNT(DISTINCT CA.CONTACT_EMAIL) AS CONTACTS_CNT , SUM(CASE WHEN CA.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT OUTER JOIN CONTACTS CA ON C.CUSTOMER_ID = CA.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
510,Y,Y,"SELECT INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, B.CONTACTS_CNT, B.TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, C.CUSTOMER_NAME,C.CUSTOMER_ID, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID) A LEFT JOIN (SELECT CUS.CUSTOMER_ID, IFNULL(COUNT(CON.CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS )THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID)B ON A.CUSTOMER_ID = B.CUSTOMER_ID ORDER BY INVOICE_ID"
511,Y,N,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CT.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID = I.USER_ID LEFT JOIN CUSTOMERS C2 ON CT.CONTACT_EMAIL = C2.EMAIL GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
512,Y,N,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS AS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS AS C2 ON C.CONTACT_EMAIL = C2.EMAIL GROUP BY INVOICE_ID, I.USER_ID ORDER BY 1 ASC"
513,Y,N,"WITH CONTACTTYPES AS ( SELECT A.USER_ID, COUNT(A.CONTACT_NAME) AS CONTACTS, COUNT(B.CUSTOMER_NAME) AS TRUSTED_CONTACTS FROM CONTACTS AS A LEFT JOIN CUSTOMERS AS B ON A.CONTACT_EMAIL = B.EMAIL GROUP BY A.USER_ID ) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACTS,0) AS CONTACTS_CNT, COALESCE(C.TRUSTED_CONTACTS,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A JOIN CUSTOMERS AS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTTYPES AS C ON A.USER_ID=C.USER_ID ORDER BY INVOICE_ID"
514,Y,N,"WITH CTE2 AS ( SELECT USER_ID ,COUNT(USER_ID) AS CONTACTS_CNT ,COUNT(EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL GROUP BY CONTACTS.USER_ID ) SELECT INVOICE_ID ,CUSTOMER_NAME ,PRICE ,COALESCE(CTE2.CONTACTS_CNT,0) AS CONTACTS_CNT ,COALESCE(CTE2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM ( SELECT I.INVOICE_ID ,C.CUSTOMER_NAME ,I.PRICE ,C.CUSTOMER_ID AS USER_ID FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ) AS CTE LEFT JOIN CTE2 ON CTE.USER_ID = CTE2.USER_ID ORDER BY INVOICE_ID"
515,Y,Y,"WITH CTE1 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID), CTE2 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS FROM CONTACTS GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CTE2.CONTACTS,0) AS CONTACTS_CNT, IFNULL(CTE1.TRUSTED_CONTACTS,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE2 ON I.USER_ID = CTE2.USER_ID LEFT JOIN CTE1 ON I.USER_ID = CTE1.USER_ID ORDER BY I.INVOICE_ID"
516,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1 ORDER BY 1"
517,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT, COUNT(CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS C1 LEFT JOIN CUSTOMERS AS C2 ON C1.CONTACT_EMAIL = C2.EMAIL GROUP BY USER_ID) K ON I.USER_ID = K.USER_ID ORDER BY INVOICE_ID"
518,Y,Y,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(C2.USER_ID) AS CONTACTS_CNT, SUM(IF(C2.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID RIGHT JOIN INVOICES I ON C1.CUSTOMER_ID = I.USER_ID GROUP BY 1 ORDER BY 1"
519,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
520,Y,Y,"WITH CTE1 AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE2 AS (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C WHERE EXISTS (SELECT EMAIL FROM CUSTOMERS WHERE EMAIL = C.CONTACT_EMAIL) GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CTE1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(CTE2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE1 ON I.USER_ID = CTE1.USER_ID LEFT JOIN CTE2 ON I.USER_ID = CTE2.USER_ID ORDER BY 1"
521,Y,Y,"SELECT I.INVOICE_ID , C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME ) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS)THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS T ON C.CUSTOMER_ID =T.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
522,Y,N,"WITH CUST_CONTACTS AS (SELECT INVOICE_ID,D.CUSTOMER_NAME,PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS D ON A.USER_ID = D.CUSTOMER_ID LEFT JOIN CONTACTS B ON A.USER_ID = B.USER_ID LEFT JOIN CUSTOMERS C ON B.CONTACT_EMAIL = C.EMAIL GROUP BY 1,2,3 ) SELECT * FROM CUST_CONTACTS ORDER BY INVOICE_ID"
523,Y,Y,"WITH T AS( SELECT CUSTOMER_ID USER_ID, CUSTOMER_NAME, COUNT(USER_ID) CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS CT ON C1.CUSTOMER_ID=CT.USER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN T USING (USER_ID) ORDER BY 1"
524,Y,Y,"WITH T1 AS( SELECT *, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TEST_COUNT FROM CONTACTS ), T2 AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, SUM(IF(CO.CONTACT_NAME IS NULL,0,1)) AS CONTACTS_CNT , SUM(IF(TEST_COUNT IS NULL,0, TEST_COUNT)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN T1 CO ON CO.USER_ID=CUSTOMER_ID GROUP BY CUSTOMER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN T2 ON INVOICES.USER_ID=CUSTOMER_ID ORDER BY INVOICE_ID"
525,Y,N,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CU2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS AS CU2 ON CO.CONTACT_EMAIL = CU2.EMAIL GROUP BY 1,2,3 ORDER BY 1"
526,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(K. CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(K.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) K ON I.USER_ID=K.USER_ID ORDER BY 1"
527,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM ( SELECT CUSTOMER_ID, CUSTOMER_NAME, SUM( CASE WHEN CONTACT_NAME IS NOT NULL THEN 1 ELSE 0 END ) AS CONTACTS_CNT, SUM( CASE WHEN USER_ID IS NOT NULL AND CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID ) T RIGHT JOIN INVOICES I ON I.USER_ID = T.CUSTOMER_ID ORDER BY INVOICE_ID"
528,Y,N,"SELECT INVOICE_ID, A.CUSTOMER_NAME, PRICE, CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID=CUS.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID=CON.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID) A LEFT JOIN (SELECT USER_ID, CUSTOMER_NAME, COUNT(EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CON LEFT JOIN CUSTOMERS CUS ON CON.CONTACT_EMAIL=CUS.EMAIL GROUP BY USER_ID) B ON A.CUSTOMER_ID=B.USER_ID"
529,Y,Y,"WITH T1 AS( SELECT INVOICE_ID, CUSTOMER_NAME,PRICE, CONTACT_NAME FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID ), T2 AS( SELECT INVOICE_ID, CUSTOMER_NAME,PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM T1 GROUP BY INVOICE_ID ), T3 AS( SELECT INVOICE_ID,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM T1 WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY INVOICE_ID ) SELECT T2.INVOICE_ID, CUSTOMER_NAME,PRICE,IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM T2 LEFT JOIN T3 ON T2.INVOICE_ID = T3.INVOICE_ID ORDER BY INVOICE_ID"
530,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, IFNULL(C2.CNT,0) AS CONTACTS_CNT, IFNULL(C2.CNT1,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN(SELECT CONTACT_NAME, USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CNT, SUM(IF(CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS),1,0)) AS CNT1 FROM CONTACTS GROUP BY USER_ID) AS C2 ON C1.CUSTOMER_ID = C2.USER_ID ORDER BY 1"
531,Y,Y,"SELECT A.INVOICE_ID, C.CUSTOMER_NAME, A.PRICE, SUM(CASE WHEN B.USER_ID IS NULL THEN 0 ELSE 1 END) CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CONTACTS B ON A.USER_ID=B.USER_ID LEFT JOIN CUSTOMERS C ON A.USER_ID=C.CUSTOMER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
532,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME,I.PRICE, COUNT(CT.CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(CT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CT ON CT.USER_ID = I.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
533,Y,N,"SELECT I.INVOICE_ID, A.CUSTOMER_NAME, I.PRICE, A.CONTACTS_CNT, A.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT CUST.CUSTOMER_ID , CUST.CUSTOMER_NAME , IFNULL(COUNT(CONT.USER_ID), 0) AS CONTACTS_CNT , IFNULL(COUNT(DISTINCT CUST2.EMAIL), 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CONT ON CUST.CUSTOMER_ID = CONT.USER_ID LEFT JOIN CUSTOMERS CUST2 ON CONT.CONTACT_EMAIL = CUST2.EMAIL GROUP BY 1, 2 ) A ON I.USER_ID = A.CUSTOMER_ID ORDER BY INVOICE_ID"
534,Y,Y,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, IFNULL(COUNT(C.USER_ID), 0) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT OUTER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT OUTER JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY 1, 2, 3 ORDER BY 1"
535,Y,Y,"WITH TABLE1 AS ( SELECT CUS.CUSTOMER_ID AS CUSTOMER_ID, CUSTOMER_NAME, PRICE, INVOICE_ID FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID JOIN INVOICES I ON I.USER_ID = CUS.CUSTOMER_ID ), TABLE2 AS ( SELECT CUS.CUSTOMER_ID AS CUSTOMER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUSTOMER_ID ), TABLE3 AS ( SELECT CUSTOMER_ID, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUSTOMER_ID ) SELECT DISTINCT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM TABLE1 LEFT JOIN TABLE2 ON TABLE1.CUSTOMER_ID = TABLE2.CUSTOMER_ID LEFT JOIN TABLE3 ON TABLE3.CUSTOMER_ID = TABLE1.CUSTOMER_ID ORDER BY INVOICE_ID"
536,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(CONTACT_NAME),0) CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS C USING (USER_ID) GROUP BY 1, 2, 3 ORDER BY INVOICE_ID"
537,Y,N,"WITH A AS ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1), B AS ( SELECT C1.USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C1 JOIN CUSTOMERS C2 ON C1.CONTACT_NAME=C2.CUSTOMER_NAME AND C1.CONTACT_EMAIL = C2.EMAIL GROUP BY 1) SELECT INVOICES.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, CASE WHEN CONTACTS_CNT IS NULL THEN 0 ELSE CONTACTS_CNT END AS CONTACTS_CNT, CASE WHEN TRUSTED_CONTACTS_CNT IS NULL THEN 0 ELSE TRUSTED_CONTACTS_CNT END AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID=CUSTOMERS.CUSTOMER_ID LEFT JOIN A ON INVOICES.USER_ID=A.USER_ID LEFT JOIN B ON INVOICES.USER_ID=B.USER_ID ORDER BY INVOICE_ID"
538,Y,Y,"SELECT DISTINCT INVOICE_ID, CUSTOMER_NAME AS CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT, COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) C ON I.USER_ID = C.USER_ID LEFT JOIN (SELECT CU.CUSTOMER_ID, CUSTOMER_NAME, CONTACT_EMAIL FROM CUSTOMERS CU LEFT JOIN (SELECT USER_ID,CONTACT_EMAIL FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)) CC ON CU.CUSTOMER_ID = CC.USER_ID ) B ON B.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE,COALESCE(CONTACTS_CNT,0) ORDER BY INVOICE_ID"
539,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(COUNT(DISTINCT CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON I.USER_ID = C2.USER_ID GROUP BY 1 ORDER BY 1"
540,Y,Y,"WITH CTE AS (SELECT USER_ID, COUNT(*) CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), DTE AS (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IF(CONTACTS_CNT IS NOT NULL, CONTACTS_CNT, 0) AS CONTACTS_CNT , I.USER_ID FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CTE ON CUS.CUSTOMER_ID = CTE.USER_ID ), MTE AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT, DTE.USER_ID FROM DTE LEFT JOIN CONTACTS CON ON CON.USER_ID = DTE.USER_ID WHERE CON.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT ORDER BY INVOICE_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, 0 AS TRUSTED_CONTACTS_CNT FROM DTE WHERE USER_ID NOT IN (SELECT USER_ID FROM MTE) UNION SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM MTE ORDER BY INVOICE_ID"
541,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(TEMP1.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TEMP2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON C.CUSTOMER_ID=I.USER_ID LEFT JOIN ( SELECT T.USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS AS T GROUP BY T.USER_ID ) AS TEMP1 ON I.USER_ID=TEMP1.USER_ID LEFT JOIN ( SELECT T.USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS AS T WHERE T.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY T.USER_ID ) AS TEMP2 ON I.USER_ID=TEMP2.USER_ID ORDER BY I.INVOICE_ID"
542,Y,N,"WITH NUMS AS ( SELECT C.CUSTOMER_ID, CUSTOMER_NAME,IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT , SUM(B.EMAIL IS NOT NULL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL=B.EMAIL GROUP BY USER_ID) D ON C.CUSTOMER_ID=D.USER_ID) SELECT INVOICE_ID,CUSTOMER_NAME,PRICE,CONTACTS_CNT,TRUSTED_CONTACTS_CNT FROM INVOICES E JOIN NUMS F ON E.USER_ID=F.CUSTOMER_ID ORDER BY INVOICE_ID"
543,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CC.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN C2.CUSTOMER_ID IS NULL THEN 0 ELSE 1 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CC ON C.CUSTOMER_ID = CC.USER_ID LEFT JOIN CUSTOMERS C2 ON CC.CONTACT_EMAIL = C2.EMAIL GROUP BY 1, 2, 3 ORDER BY INVOICE_ID"
544,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT( CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS ON INVOICES.USER_ID = CONTACTS.USER_ID GROUP BY INVOICE_ID, INVOICES.USER_ID ORDER BY INVOICE_ID"
545,Y,Y,"WITH TRUSTED AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID WHERE C2.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT, COALESCE(T.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID LEFT JOIN TRUSTED AS T ON I.INVOICE_ID = T.INVOICE_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
546,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID"
547,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL AND C2.CUSTOMER_NAME=CON.CONTACT_NAME GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
548,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY 1 ORDER BY 1"
549,Y,N,"SELECT INVOICE_ID, D.CUSTOMER_NAME, PRICE, COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C.EMAIL IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS D ON A.USER_ID = D.CUSTOMER_ID LEFT JOIN CONTACTS B ON D.CUSTOMER_ID = B.USER_ID LEFT JOIN CUSTOMERS C ON B.CONTACT_EMAIL = C.EMAIL GROUP BY 1,2,3 ORDER BY 1"
550,Y,N,"WITH TRUSTED_CONTACTS_CNT AS ( SELECT CUSTOMER_NAME, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_NAME ) SELECT INVOICE_ID, CU.CUSTOMER_NAME, PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN TRUSTED_CONTACTS_CNT TC ON TC.CUSTOMER_NAME = CU.CUSTOMER_NAME GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
551,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C. CUSTOMER_ID LEFT JOIN CONTACTS C1 ON I.USER_ID = C1.USER_ID LEFT JOIN CUSTOMERS C2 ON C1.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
552,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY C.CUSTOMER_ID, I.INVOICE_ID ORDER BY 1"
553,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CC.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CC ON C.CUSTOMER_ID = CC.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CC.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1,2,3"
554,Y,N,"WITH TRUSTED AS ( SELECT CU.CUSTOMER_NAME, CU.CUSTOMER_ID, COUNT(CO.USER_ID) AS TRUSTED FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID WHERE CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, IFNULL(TRU.TRUSTED, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN TRUSTED TRU ON CU.CUSTOMER_ID = TRU.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
555,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, ROUND(AVG(PRICE),0) AS PRICE, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON USER_ID=CUSTOMER_ID LEFT JOIN CONTACTS USING (USER_ID) GROUP BY INVOICE_ID, CUSTOMER_NAME ORDER BY 1"
556,Y,Y,"SELECT TMP.INVOICE_ID, TMP.CUSTOMER_NAME, TMP.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM ( SELECT I.INVOICE_ID, CUS.CUSTOMER_ID, CUS.CUSTOMER_NAME, I.PRICE FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CUS ON I.USER_ID = CUS.CUSTOMER_ID ) AS TMP LEFT JOIN CONTACTS AS CON ON TMP.CUSTOMER_ID = CON.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
557,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C1.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.CUSTOMER_NAME = CON.CONTACT_NAME GROUP BY 1,2,3 ORDER BY 1"
558,Y,N,"WITH A1 AS ( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID), A2 AS( SELECT CUSTOMER_NAME, COUNT(*) CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU1 ON CO.USER_ID=CU1.CUSTOMER_ID GROUP BY CUSTOMER_NAME), A3 AS (SELECT CUSTOMER_NAME, COUNT(CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID=CONTACTS.USER_ID WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUSTOMER_NAME) SELECT INVOICE_ID, A1.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM A1 LEFT JOIN A2 ON A1.CUSTOMER_NAME=A2.CUSTOMER_NAME LEFT JOIN A3 ON A1.CUSTOMER_NAME=A3.CUSTOMER_NAME ORDER BY INVOICE_ID"
559,Y,N,"WITH A AS (SELECT INVOICE_ID, CUSTOMER_NAME, PRICE FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ), B AS (SELECT CUSTOMER_NAME, SUM(IF(USER_ID IS NULL, 0,1)) AS CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID ), C AS (SELECT CUSTOMER_NAME, SUM(IF(USER_ID IS NULL, 0,1)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUSTOMER_ID = USER_ID WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS ) GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, A.CUSTOMER_NAME, PRICE, CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM A LEFT JOIN B ON A.CUSTOMER_NAME = B.CUSTOMER_NAME LEFT JOIN C ON A.CUSTOMER_NAME = C.CUSTOMER_NAME ORDER BY INVOICE_ID"
560,Y,Y,"WITH TRUSTED AS ( SELECT CUSTOMER_ID, COALESCE(COUNT(DISTINCT CONTACT_NAME),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CC ON C.CUSTOMER_ID = CC.USER_ID WHERE CC.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1 ), REQ AS ( SELECT C.CUSTOMER_ID, COALESCE(T.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN TRUSTED T ON C.CUSTOMER_ID = T.CUSTOMER_ID ), REQ2 AS ( SELECT C.CUSTOMER_ID, COALESCE(COUNT(DISTINCT CONTACT_NAME),0) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CS ON C.CUSTOMER_ID = CS.USER_ID GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, RR.CONTACTS_CNT, R.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID JOIN REQ R ON I.USER_ID = R.CUSTOMER_ID JOIN REQ2 RR ON I.USER_ID = RR.CUSTOMER_ID ORDER BY I.INVOICE_ID"
561,Y,N,"WITH CON AS ( SELECT C.*, CASE WHEN CUU.CUSTOMER_ID IS NULL THEN 0 ELSE 1 END AS TRUSTED FROM CONTACTS C LEFT JOIN CUSTOMERS CUU ON CUU.EMAIL=C.CONTACT_EMAIL ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, COALESCE(SUM(TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID=CU.CUSTOMER_ID LEFT JOIN CON ON CU.CUSTOMER_ID=CON.USER_ID GROUP BY INVOICE_ID,CUSTOMER_NAME,PRICE ORDER BY INVOICE_ID"
562,Y,Y,"WITH A AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1,2), B AS (SELECT USER_ID, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) CONTACTS_CNT , IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN A ON I.USER_ID = A.CUSTOMER_ID LEFT JOIN B ON I.USER_ID = B.USER_ID ORDER BY 1"
563,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, SUM(IF(CONTACTS.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0) ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS JOIN INVOICES ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID LEFT JOIN CONTACTS ON CUSTOMER_ID = CONTACTS.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
564,Y,N,"SELECT INVOICE_ID, C1.CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON I.USER_ID = CO.USER_ID LEFT JOIN CUSTOMERS AS C2 ON CO.CONTACT_EMAIL = C2.EMAIL GROUP BY INVOICE_ID, I.USER_ID ORDER BY 1 ASC"
565,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(C1.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CASE WHEN C1.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN C1.CONTACT_NAME ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C1 ON C.CUSTOMER_ID = C1.USER_ID GROUP BY 1, 2, 3 ORDER BY 1 ASC"
566,Y,N,"SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE,COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(D.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID=C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_NAME=D.CUSTOMER_NAME GROUP BY A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE ORDER BY A.INVOICE_ID"
567,Y,Y,"WITH TEMP AS( SELECT C.CUSTOMER_ID , C.CUSTOMER_NAME , COUNT(CONTACT_EMAIL) AS CONTACTS_CNT , SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C LEFT JOIN CONTACTS AS CONT ON C.CUSTOMER_ID = CONT.USER_ID GROUP BY C.CUSTOMER_ID, C.CUSTOMER_NAME ) SELECT I.INVOICE_ID , T.CUSTOMER_NAME , I.PRICE , T.CONTACTS_CNT , T.TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN TEMP AS T ON T.CUSTOMER_ID = I.USER_ID ORDER BY I.INVOICE_ID"
568,Y,N,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT,COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID=I.USER_ID LEFT JOIN CONTACTS T ON I.USER_ID=T.USER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL=T.CONTACT_EMAIL GROUP BY I.INVOICE_ID, I.USER_ID ORDER BY 1"
569,Y,N,"SELECT INV.INVOICE_ID, MAX(CU.CUSTOMER_NAME) AS CUSTOMER_NAME, MAX(INV.PRICE) AS PRICE, COUNT(CO.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CTS.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV JOIN CUSTOMERS CU ON INV.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS CTS ON CO.CONTACT_EMAIL = CTS.EMAIL GROUP BY INV.INVOICE_ID ORDER BY INV.INVOICE_ID"
570,Y,Y,"WITH ALL_CUSTOMER AS ( SELECT I.INVOICE_ID, I.USER_ID AS CUSTOMER_ID, C.CUSTOMER_NAME, C.EMAIL AS CUSTOMER_EMAIL, I.PRICE FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ), CONTACTS_CNT AS ( SELECT CUST.CUSTOMER_ID, COALESCE(COUNT(DISTINCT CON.CONTACT_EMAIL), 0) AS CONTACTS_CNT FROM ALL_CUSTOMER CUST LEFT JOIN CONTACTS CON ON CUST.CUSTOMER_ID = CON.USER_ID GROUP BY CUST.CUSTOMER_ID ), TRUSTED_CONTACTS AS ( SELECT CUST.CUSTOMER_ID, COALESCE(COUNT(DISTINCT CON.CONTACT_EMAIL), 0) AS TRUSTED_CONTACT_CNT FROM ALL_CUSTOMER CUST LEFT JOIN CONTACTS CON ON CUST.CUSTOMER_ID = CON.USER_ID WHERE CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY CUST.CUSTOMER_ID ) SELECT CUST.INVOICE_ID, CUST.CUSTOMER_NAME, CUST.PRICE, COALESCE(CON.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(T.TRUSTED_CONTACT_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM ALL_CUSTOMER CUST LEFT JOIN CONTACTS_CNT CON ON CUST.CUSTOMER_ID = CON.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACTS T ON CUST.CUSTOMER_ID = T.CUSTOMER_ID ORDER BY INVOICE_ID"
571,Y,Y,"WITH CONTACTSCOUNT AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID), TRUSTCONT AS (SELECT USER_ID, COUNT(*) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTSCOUNT C ON I.USER_ID=C.USER_ID LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN TRUSTCONT T ON I.USER_ID = T.USER_ID ORDER BY INVOICE_ID"
572,Y,Y,"WITH TRUSTED_CONTACTS AS( SELECT CUSTOMER_ID, CUSTOMER_NAME, SUM(CASE WHEN CT.USER_ID IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) AND CT.USER_ID IS NOT NULL THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY 1,2 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN TRUSTED_CONTACTS T ON I.USER_ID=T.CUSTOMER_ID ORDER BY 1"
573,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS O ON C.CUSTOMER_ID = O.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID,CUSTOMER_NAME,PRICE ORDER BY INVOICE_ID"
574,Y,N,"SELECT A.INVOICE_ID, D.CUSTOMER_NAME, MAX(A.PRICE) AS PRICE , IFNULL(COUNT(B.CONTACT_NAME),0) AS CONTACTS_CNT , IFNULL(COUNT(C.EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CONTACTS B ON A.USER_ID = B.USER_ID LEFT JOIN CUSTOMERS C ON B.CONTACT_EMAIL = C.EMAIL LEFT JOIN CUSTOMERS D ON A.USER_ID = D.CUSTOMER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
575,Y,N,"SELECT INVOICE_ID, CU1.CUSTOMER_NAME, PRICE, COUNT(DISTINCT CO1.CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT CU2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU1 ON I.USER_ID = CU1.CUSTOMER_ID LEFT JOIN CONTACTS CO1 ON CU1.CUSTOMER_ID = CO1.USER_ID LEFT JOIN CUSTOMERS CU2 ON CO1.CONTACT_NAME = CU2.CUSTOMER_NAME GROUP BY 1,2,3 ORDER BY 1"
576,Y,Y,"WITH ALL_CONTACTS AS (SELECT USER_ID ,CONTACT_NAME ,CONTACT_EMAIL ,'TRUSTED' AS CATEGORY ,1 AS FLAG FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT DISTINCT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) UNION SELECT USER_ID ,CONTACT_NAME ,CONTACT_EMAIL ,'NOT TRUSTED' AS CATEGORY ,0 AS FLAG FROM CONTACTS WHERE (CONTACT_NAME, CONTACT_EMAIL) NOT IN (SELECT DISTINCT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) ) SELECT I.INVOICE_ID ,C1.CUSTOMER_NAME ,I.PRICE ,COUNT(C2.USER_ID) AS CONTACTS_CNT ,IFNULL(SUM(FLAG),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_ID = I.USER_ID LEFT JOIN ALL_CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY 1,2,3 ORDER BY 1 ASC"
577,Y,N,"SELECT INVOICE_ID, USERS.CUSTOMER_NAME AS CUSTOMER_NAME, PRICE, COUNT(CONTACTS.USER_ID) AS CONTACTS_CNT, COUNT(CUSTOMERS.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS AS USERS ON INVOICES.USER_ID = USERS.CUSTOMER_ID LEFT JOIN CONTACTS ON USERS.CUSTOMER_ID = CONTACTS.USER_ID LEFT JOIN CUSTOMERS ON ( CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL ) GROUP BY INVOICE_ID ORDER BY INVOICE_ID ASC"
578,Y,Y,"WITH A AS ( SELECT DISTINCT CU.CUSTOMER_ID AS CUSTOMER_ID, CU.CUSTOMER_NAME AS CUSTOMER_NAME, COUNT(CO.CONTACT_EMAIL) OVER (PARTITION BY CU.CUSTOMER_ID) AS CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID ), B AS ( SELECT DISTINCT CU.CUSTOMER_ID AS CUSTOMER_ID, CU.CUSTOMER_NAME AS CUSTOMER_NAME, COUNT(CO.CONTACT_EMAIL) OVER (PARTITION BY CU.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN (SELECT * FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) AS CO ON CU.CUSTOMER_ID = CO.USER_ID ) SELECT I.INVOICE_ID AS INVOICE_ID, A.CUSTOMER_NAME AS CUSTOMER_NAME, I.PRICE AS PRICE, A.CONTACTS_CNT AS CONTACTS_CNT, B.TRUSTED_CONTACTS_CNT AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN A ON I.USER_ID = A.CUSTOMER_ID LEFT JOIN B ON I.USER_ID = B.CUSTOMER_ID ORDER BY I.INVOICE_ID"
579,Y,N,"SELECT I.INVOICE_ID, C4.CUSTOMER_NAME, I.PRICE, IFNULL(A.CONTACTS_CNT, 0) AS CONTACTS_CNT , IFNULL(A.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT C3.CUSTOMER_ID, C3.CUSTOMER_NAME, COUNT(C2.CONTACT_NAME) CONTACTS_CNT , COUNT(C1.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 RIGHT JOIN CONTACTS C2 ON C2.CONTACT_EMAIL = C1.EMAIL JOIN CUSTOMERS C3 ON C2.USER_ID = C3.CUSTOMER_ID GROUP BY C2.USER_ID) A ON I.USER_ID = A.CUSTOMER_ID JOIN CUSTOMERS C4 ON I.USER_ID = C4.CUSTOMER_ID ORDER BY I.INVOICE_ID"
580,Y,Y,"WITH T1 AS( SELECT CUSTOMER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS C JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = C.USER_ID GROUP BY CUSTOMER_ID ), T2 AS ( SELECT CUSTOMER_ID, CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUST_STATUS FROM CUSTOMERS CU JOIN CONTACTS C ON CU.CUSTOMER_ID = C.USER_ID ), T3 AS ( SELECT CUSTOMER_ID, SUM(TRUST_STATUS) AS TRUSTED_CONTACTS_CNT FROM T2 GROUP BY CUSTOMER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN T1 ON C.CUSTOMER_ID = T1.CUSTOMER_ID LEFT JOIN T3 ON C.CUSTOMER_ID = T3.CUSTOMER_ID ORDER BY I.INVOICE_ID"
581,Y,Y,"WITH T2 AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(TRUSTED_CONTACT_FLAG) AS TRUSTED_CONTACTS_CNT FROM (SELECT USER_ID, CONTACT_EMAIL, CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED_CONTACT_FLAG FROM CONTACTS) T1 GROUP BY USER_ID) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE,COALESCE(T2.CONTACTS_CNT,0) AS CONTACTS_CNT,COALESCE(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN T2 ON I.USER_ID = T2.USER_ID ORDER BY INVOICE_ID"
582,Y,N,"SELECT INVOICE_ID , C0.CUSTOMER_NAME, PRICE, COUNT(C1.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C0 ON I.USER_ID = C0.CUSTOMER_ID LEFT OUTER JOIN CONTACTS C1 ON C0.CUSTOMER_ID = C1.USER_ID LEFT OUTER JOIN CUSTOMERS C2 ON C2.EMAIL = C1.CONTACT_EMAIL GROUP BY INVOICE_ID , C0.CUSTOMER_NAME , PRICE ORDER BY INVOICE_ID"
583,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME , I.PRICE, COALESCE(COUNT(C1.USER_ID),0) AS CONTACTS_CNT,COALESCE(COUNT(C2.CUSTOMER_NAME),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,CONTACT_NAME FROM CONTACTS) C1 ON I.USER_ID = C1.USER_ID LEFT JOIN CUSTOMERS C2 ON C1.CONTACT_NAME = C2.CUSTOMER_NAME GROUP BY 1,2,3 ORDER BY 1"
584,Y,N,"WITH CUST_INFO AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, C.CUSTOMER_ID, I.PRICE FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID), TOTAL_CONTACTS AS ( SELECT USER_ID, COUNT(CONTACT_NAME) CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), TRUSTED_CONTACTS AS ( SELECT CO.USER_ID, COUNT(CO.CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS CO JOIN CUSTOMERS C ON CO.CONTACT_NAME = C.CUSTOMER_NAME AND CO.CONTACT_EMAIL = C.EMAIL GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM CUST_INFO LEFT JOIN TOTAL_CONTACTS ON CUST_INFO.CUSTOMER_ID = TOTAL_CONTACTS.USER_ID LEFT JOIN TRUSTED_CONTACTS ON CUST_INFO.CUSTOMER_ID = TRUSTED_CONTACTS.USER_ID ORDER BY INVOICE_ID"
585,Y,Y,"WITH T AS (SELECT CUSTOMERS.CUSTOMER_ID, CUSTOMERS.CUSTOMER_NAME, CUSTOMERS.EMAIL, IFNULL(COUNT(DISTINCT CONTACTS.CONTACT_NAME), 0) CONTACTS_CNT, IFNULL(COUNT(DISTINCT TRUST.EMAIL), 0) TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMERS.CUSTOMER_ID = CONTACTS.USER_ID LEFT JOIN CUSTOMERS TRUST ON CONTACTS.CONTACT_EMAIL = TRUST.EMAIL AND CONTACTS.CONTACT_NAME = TRUST.CUSTOMER_NAME GROUP BY 1, 2, 3) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN T ON INVOICES.USER_ID = T.CUSTOMER_ID ORDER BY 1"
586,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN (CONTACT_NAME, CONTACT_EMAIL) IN ( SELECT CUSTOMER_NAME,EMAIL FROM CUSTOMERS ) THEN 1 ELSE 0 END ) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS N ON N.USER_ID = I.USER_ID GROUP BY 1 ORDER BY 1"
587,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, SUM(CASE WHEN C.USER_ID IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME ORDER BY A.INVOICE_ID"
588,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(DISTINCT CON.CONTACT_NAME),0) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
589,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, ROUND(PRICE,0) AS PRICE, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON USER_ID=CUSTOMER_ID LEFT JOIN CONTACTS USING (USER_ID) GROUP BY INVOICE_ID ORDER BY 1"
590,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CN.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CN.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CN ON C.CUSTOMER_ID=CN.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
591,Y,N,"SELECT I.INVOICE_ID, CS1.CUSTOMER_NAME, I.PRICE, COUNT(CT.USER_ID) AS CONTACTS_CNT , COUNT(CS2.CUSTOMER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS CS1 ON I.USER_ID = CS1.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CS1.CUSTOMER_ID = CT.USER_ID LEFT JOIN CUSTOMERS CS2 ON CS2.EMAIL = CT.CONTACT_EMAIL GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
592,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID)CONTACTS_CNT, COUNT(C1.CUSTOMER_NAME)TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS C1 ON C1.CUSTOMER_NAME = CO.CONTACT_NAME GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
593,Y,N,"WITH CTE AS (SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE,CON.USER_ID AS CONTACT_ID , CON.CONTACT_NAME CONTACT_NAME FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID=CON.USER_ID ), CTE_1 AS (SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, A.CONTACT_NAME CONTACT_NAME, B.CUSTOMER_NAME AS TRUSTED_CONTACT FROM CTE A LEFT JOIN CUSTOMERS B ON A.CONTACT_NAME=B.CUSTOMER_NAME ORDER BY INVOICE_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, COUNT(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM CTE_1 GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
594,Y,Y,"WITH TRUSTED AS (SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_COUNT FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY 1), CONTACTS_NUM AS (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CONTACTS_NUM.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED.TRUSTED_COUNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS_NUM ON CONTACTS_NUM.USER_ID=C.CUSTOMER_ID LEFT JOIN TRUSTED ON TRUSTED.USER_ID=CONTACTS_NUM.USER_ID ORDER BY 1"
595,Y,N,"WITH CONTACTS_COUNT AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TOTAL_CONTACTS FROM CONTACTS GROUP BY USER_ID ), TRUSTED_CONTACT_COUNTS AS ( SELECT USER_ID, COUNT(CONTACT_EMAIL) AS TOTAL_TRUTSED_CONTACTS FROM ( SELECT A.CUSTOMER_ID, A.EMAIL, B.USER_ID, B.CONTACT_EMAIL FROM CUSTOMERS A INNER JOIN CONTACTS B ON A.EMAIL=B.CONTACT_EMAIL ) T1 GROUP BY USER_ID ), INVOICEINFO_JOINED AS ( SELECT INVOICE_ID, PRICE, T1.USER_ID, (CASE WHEN TOTAL_CONTACTS IS NOT NULL THEN TOTAL_CONTACTS ELSE 0 END) AS CONTACTS_CNT , (CASE WHEN TOTAL_TRUTSED_CONTACTS IS NOT NULL THEN TOTAL_TRUTSED_CONTACTS ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM ( SELECT INVOICE_ID, PRICE, A.USER_ID, TOTAL_CONTACTS FROM INVOICES A LEFT JOIN CONTACTS_COUNT B ON A.USER_ID=B.USER_ID) T1 LEFT JOIN TRUSTED_CONTACT_COUNTS T2 ON T1.USER_ID=T2.USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICEINFO_JOINED A INNER JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID ORDER BY INVOICE_ID ASC"
596,Y,Y,"SELECT INVOICE_ID, CU.CUSTOMER_NAME AS CUSTOMER_NAME, PRICE, COUNT(DISTINCT CO.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
597,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID ORDER BY INVOICE_ID"
598,Y,Y,"WITH TMP1 AS( SELECT A.INVOICE_ID,B.CUSTOMER_NAME, SUM(A.PRICE) AS PRICE, IFNULL(C.CONTACTS_CNT,0) AS CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CUSTOMERS AS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS C ON A.USER_ID=C.USER_ID GROUP BY A.INVOICE_ID,B.CUSTOMER_NAME, C.CONTACTS_CNT ), TMP2 AS ( SELECT A.INVOICE_ID, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS A LEFT JOIN CONTACTS AS B ON A. USER_ID=B.USER_ID GROUP BY A.INVOICE_ID) SELECT A.*,B.TRUSTED_CONTACTS_CNT FROM TMP1 AS A LEFT JOIN TMP2 AS B ON A.INVOICE_ID=B.INVOICE_ID ORDER BY A.INVOICE_ID"
599,Y,N,"SELECT INVOICE_ID,C1.CUSTOMER_NAME,PRICE ,IFNULL(COUNT(DISTINCT C2.CONTACT_NAME),0) AS CONTACTS_CNT ,IFNULL(COUNT(DISTINCT C3.CUSTOMER_ID),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS AS C1 ON I.USER_ID =C1.CUSTOMER_ID LEFT JOIN CONTACTS AS C2 ON C1.CUSTOMER_ID=C2.USER_ID LEFT JOIN CUSTOMERS AS C3 ON C2.CONTACT_NAME =C3.CUSTOMER_NAME GROUP BY INVOICE_ID, C1.CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
600,Y,Y,"WITH CTE AS ( SELECT A.CUSTOMER_ID, A.CUSTOMER_NAME, COUNT(B.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN B.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY 1,2) SELECT C.INVOICE_ID, D.CUSTOMER_NAME, C.PRICE, D.CONTACTS_CNT, D.TRUSTED_CONTACTS_CNT FROM INVOICES C JOIN CTE D ON C.USER_ID = D.CUSTOMER_ID ORDER BY C.INVOICE_ID"
601,Y,Y,"WITH XYZ AS ( SELECT USER_ID, CONTACT_NAME, COUNT(USER_ID) AS CONTACTS_CNT, SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(C.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(C.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN XYZ C ON C.USER_ID = B.CUSTOMER_ID ORDER BY A.INVOICE_ID"
602,Y,Y,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, COUNT(DISTINCT CASE WHEN FLAG = 1 THEN CONTACT_NAME END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN ( SELECT A.*, CASE WHEN B.CUSTOMER_NAME IS NOT NULL THEN 1 ELSE 0 END AS FLAG FROM CONTACTS A LEFT JOIN CUSTOMERS B ON A.CONTACT_EMAIL = B.EMAIL ) C ON A.USER_ID = C.USER_ID GROUP BY 1,2,3 ORDER BY 1"
603,Y,Y,"WITH COMBINED AS ( SELECT C1.CUSTOMER_ID , C1.CUSTOMER_NAME , COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT , SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS AS C1 LEFT JOIN CONTACTS AS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY C1.CUSTOMER_ID , C1.CUSTOMER_NAME ) SELECT I.INVOICE_ID , C1.CUSTOMER_NAME , I.PRICE , COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT , SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS AS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY I.INVOICE_ID , C1.CUSTOMER_NAME , I.PRICE ORDER BY INVOICE_ID"
604,Y,N,"WITH CTE1 AS ( SELECT CUST.CUSTOMER_ID, CUST.CUSTOMER_NAME, COUNT(DISTINCT CON.CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CON ON CUST.CUSTOMER_ID = CON.USER_ID GROUP BY CUST.CUSTOMER_NAME), CTE2 AS ( SELECT CUST.CUSTOMER_ID, CUST.CUSTOMER_NAME, COUNT(DISTINCT CON.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUST LEFT JOIN CONTACTS CON ON CUST.CUSTOMER_ID = CON.USER_ID WHERE CON.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) GROUP BY CUST.CUSTOMER_NAME) SELECT I.INVOICE_ID, CTE1.CUSTOMER_NAME, I.PRICE, CTE1.CONTACTS_CNT, IFNULL(CTE2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE1 ON I.USER_ID = CTE1.CUSTOMER_ID LEFT JOIN CTE2 ON I.USER_ID = CTE2.CUSTOMER_ID GROUP BY 1 ORDER BY 1"
605,Y,Y,"WITH TC AS ( SELECT USER_ID, COUNT(1) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE EXISTS (SELECT 1 FROM CUSTOMERS WHERE CUSTOMERS.EMAIL=CONTACTS.CONTACT_EMAIL) GROUP BY USER_ID ), C_CNT AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT OUTER JOIN CUSTOMERS CUST ON I.USER_ID=CUST.CUSTOMER_ID LEFT OUTER JOIN C_CNT ON I.USER_ID=C_CNT.USER_ID LEFT OUTER JOIN TC ON I.USER_ID=TC.USER_ID ORDER BY 1"
606,Y,N,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES JOIN ( SELECT CUSTOMERS.CUSTOMER_ID AS USER_ID, CUSTOMERS.CUSTOMER_NAME AS CUSTOMER_NAME, COUNT(TRUSTEDCUSTOMERS.TRUSTED_STATE) AS CONTACTS_CNT, COUNT(IF(TRUSTEDCUSTOMERS.TRUSTED_STATE = TRUE, TRUE, NULL)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN ( SELECT CONTACTS.USER_ID AS CUSTOMER_ID, IF(CUSTOMERS.CUSTOMER_ID IS NULL, FALSE, TRUE) AS TRUSTED_STATE FROM CONTACTS LEFT JOIN CUSTOMERS ON ( CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME AND CONTACTS.CONTACT_EMAIL = CUSTOMERS.EMAIL ) ) AS TRUSTEDCUSTOMERS USING (CUSTOMER_ID) GROUP BY CUSTOMERS.CUSTOMER_ID ) AS COUNTEDCUSTOMERS USING (USER_ID) ORDER BY INVOICE_ID ASC"
607,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CONTACT_NAME) CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY 1"
608,Y,N,"SELECT I.INVOICE_ID AS INVOICE_ID, C.CUSTOMER_NAME AS CUSTOMER_NAME, I.PRICE AS PRICE, COALESCE(S.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(S.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(TRUSTED_CONTACT) AS TRUSTED_CONTACTS_CNT FROM ( SELECT CONT.USER_ID AS USER_ID, CONT.CONTACT_EMAIL AS CONTACT_EMAIL, CUST.CUSTOMER_ID IS NOT NULL AS TRUSTED_CONTACT FROM CONTACTS AS CONT LEFT JOIN CUSTOMERS AS CUST ON CONT.CONTACT_EMAIL = CUST.EMAIL ) AS T GROUP BY USER_ID ) AS S ON I.USER_ID = S.USER_ID ORDER BY INVOICE_ID"
609,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(DISTINCT C.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID =B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
610,Y,N,"WITH TRUST AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ), TRUSTED AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C INNER JOIN CUSTOMERS CU ON C.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY 1 ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(T.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TED.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN TRUST T ON I.USER_ID = T.USER_ID LEFT JOIN TRUSTED TED ON I.USER_ID = TED.USER_ID ORDER BY I.INVOICE_ID"
611,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CT.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT CT2.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID LEFT JOIN ( SELECT DISTINCT CONTACT_EMAIL FROM CONTACTS WHERE CONTACT_EMAIL IN ( SELECT EMAIL FROM CUSTOMERS ) ) CT2 ON CT.CONTACT_EMAIL = CT2.CONTACT_EMAIL GROUP BY 1, 2, 3"
612,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CONTACTS USING (USER_ID) GROUP BY INVOICE_ID, CUSTOMER_NAME ORDER BY INVOICE_ID"
613,Y,Y,"WITH CTE AS ( SELECT CO.*, IF(COUNT(CU.EMAIL) > 0, 1, 0) AS IS_TRUSTED FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL = CU.EMAIL GROUP BY CO.USER_ID, CO.CONTACT_NAME, CO.CONTACT_EMAIL ) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CTE.CONTACT_EMAIL) AS CONTACTS_CNT, IFNULL(SUM(CTE.IS_TRUSTED), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID LEFT JOIN CTE ON CTE.USER_ID = CU.CUSTOMER_ID GROUP BY I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
614,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, SUM(CASE WHEN CONT.USER_ID IS NOT NULL THEN 1 ELSE 0 END) AS CONTACTS_CNT, SUM(CASE WHEN CONT.USER_ID IS NOT NULL AND CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS CUST ON INV.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS CONT ON CUST.CUSTOMER_ID = CONT.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
615,Y,Y,"WITH CTE AS ( SELECT C1.CUSTOMER_ID, C1.CUSTOMER_NAME, COUNT(DISTINCT C2.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT C3.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID LEFT JOIN CUSTOMERS C3 ON C3.EMAIL = C2.CONTACT_EMAIL GROUP BY 1 ) SELECT INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, C.CONTACTS_CNT, C.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE C ON I.USER_ID = C.CUSTOMER_ID ORDER BY INVOICE_ID"
616,Y,Y,"WITH TEMP AS (SELECT *, CASE WHEN (CONTACT_NAME, CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME, EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(T3.USER_ID),0) AS CONTACTS_CNT, IFNULL(SUM(TRUSTED),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES T1 LEFT JOIN CUSTOMERS T2 ON T1.USER_ID = T2.CUSTOMER_ID LEFT JOIN TEMP T3 ON T1.USER_ID= T3.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
617,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID , COUNT(USER_ID) CNT , SUM(IF(CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT , CUSTOMER_NAME FROM CONTACTS CO RIGHT JOIN CUSTOMERS CU ON CO.USER_ID = CU.CUSTOMER_ID GROUP BY 1 ) SELECT I.INVOICE_ID, TMP.CUSTOMER_NAME, I.PRICE, TMP.CNT AS CONTACTS_CNT , TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE AS TMP ON TMP.CUSTOMER_ID = I.USER_ID ORDER BY INVOICE_ID"
618,Y,Y,"SELECT INVOICE_ID, T.CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN ( SELECT A.CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID = B.USER_ID GROUP BY A.CUSTOMER_ID ) T ON I.USER_ID = T.CUSTOMER_ID ORDER BY 1"
619,Y,Y,"WITH CTE AS( SELECT CUSTOMER_ID, COALESCE(COUNT(B.CONTACT_EMAIL),0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID=B.USER_ID WHERE B.CONTACT_EMAIL IN( SELECT EMAIL FROM CUSTOMERS ) GROUP BY 1 ) SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_EMAIL) AS CONTACTS_CNT, COALESCE(D.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID=C.USER_ID LEFT JOIN CTE D ON B.CUSTOMER_ID=D.CUSTOMER_ID GROUP BY 1,2 ORDER BY INVOICE_ID"
620,Y,Y,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, COUNT(DISTINCT C.CONTACT_NAME) CONTACTS_CNT, COUNT(DISTINCT D.CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_NAME = D.CUSTOMER_NAME GROUP BY 1,2,3 ORDER BY 1"
621,Y,Y,"SELECT I.INVOICE_ID, U.CUSTOMER_NAME, I.PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, SUM(IF(C.CONTACT_EMAIL IN(SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS C ON I.USER_ID=C.USER_ID LEFT JOIN CUSTOMERS U ON I.USER_ID=U.CUSTOMER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
622,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUST ON I.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS CON ON I.USER_ID = CON.USER_ID GROUP BY 1 ORDER BY 1"
623,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, ROUND(AVG(PRICE),0) AS PRICE, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT (IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS), CONTACT_EMAIL, NULL))) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CUSTOMERS ON USER_ID=CUSTOMER_ID LEFT JOIN CONTACTS USING (USER_ID) GROUP BY INVOICE_ID ORDER BY 1"
624,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT CT.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(DISTINCT CT2.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID = CT.USER_ID LEFT JOIN ( SELECT DISTINCT CONTACT_EMAIL FROM CONTACTS WHERE CONTACT_EMAIL IN ( SELECT EMAIL FROM CUSTOMERS ) ) CT2 ON CT.CONTACT_EMAIL = CT2.CONTACT_EMAIL GROUP BY 1, 2, 3 ORDER BY 1"
625,Y,N,"SELECT INVOICE_ID, B.CUSTOMER_NAME, PRICE, COUNT(C.USER_ID) AS CONTACTS_CNT, COUNT(D.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS AS D ON D.EMAIL = C.CONTACT_EMAIL GROUP BY A.INVOICE_ID ORDER BY INVOICE_ID"
626,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) CONTACTS_CNT, COUNT(D.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID=C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_EMAIL=D.EMAIL GROUP BY 1, 2, 3 ORDER BY 1"
627,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT,0) AS CONTACTS_CNT,COALESCE(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN (SELECT USER_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY 1) A ON A.USER_ID = I.USER_ID ORDER BY INVOICE_ID"
628,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COALESCE(COUNT(C.USER_ID), 0) AS CONTACTS_CNT, COALESCE(SUM(CASE WHEN B.CUSTOMER_ID IS NOT NULL AND C.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID GROUP BY 1, 2, 3 ORDER BY 1"
629,Y,N,"SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CU2.EMAIL IS NULL THEN 0 ELSE 1 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS CU2 ON CO.CONTACT_EMAIL = CU2.EMAIL GROUP BY I.INVOICE_ID, CO.USER_ID ORDER BY I.INVOICE_ID"
630,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(COUNT(CO.USER_ID),0) AS CONTACTS_CNT, IFNULL(COUNT(C2.CUSTOMER_NAME),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON CO.CONTACT_NAME = C2.CUSTOMER_NAME AND CO.CONTACT_EMAIL = C2.EMAIL GROUP BY 1 ORDER BY 1"
631,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CA.CONTACT_NAME) CONTACTS_CNT , SUM(IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS), 1,0)) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CA ON CA.USER_ID=C.CUSTOMER_ID GROUP BY 1 ORDER BY 1"
632,Y,Y,"WITH B AS ( SELECT I.INVOICE_ID, I.USER_ID, C.CUSTOMER_NAME, I.PRICE, C.EMAIL FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ) SELECT B.INVOICE_ID, B.CUSTOMER_NAME, B.PRICE, IFNULL(COUNT(CO.CONTACT_NAME),0) AS CONTACTS_CNT, IFNULL(SUM(CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)),0) AS TRUSTED_CONTACTS_CNT FROM B LEFT JOIN CONTACTS CO ON B.USER_ID = CO.USER_ID GROUP BY B.INVOICE_ID ORDER BY B.INVOICE_ID"
633,Y,Y,"WITH CTE AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1 ) , CTE2 AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN CUSTOMERS AS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CTE AS C ON I.USER_ID = C.USER_ID LEFT JOIN CTE2 AS C2 ON I.USER_ID = C2.USER_ID ORDER BY 1 ASC"
634,Y,Y,"SELECT T1.INVOICE_ID, T2.CUSTOMER_NAME, T1.PRICE, COUNT(T3.USER_ID) AS CONTACTS_CNT, IFNULL(SUM(T3.TRUSTED),0) TRUSTED_CONTACTS_CNT FROM INVOICES T1 INNER JOIN CUSTOMERS T2 ON T1.USER_ID = T2.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, CONTACT_NAME, CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END AS TRUSTED FROM CONTACTS) T3 ON T3.USER_ID = T2.CUSTOMER_ID GROUP BY T1.INVOICE_ID ORDER BY T1.INVOICE_ID"
635,Y,Y,"SELECT INVOICE_ID, C.CUSTOMER_NAME,PRICE,COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN(SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID= C.CUSTOMER_ID LEFT JOIN CONTACTS O ON C.CUSTOMER_ID= O.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
636,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, SUM(IF(CON.CONTACT_EMAIL IS NOT NULL, 1, 0)) AS CONTACTS_CNT, SUM(IF(CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID = CON.USER_ID GROUP BY 1,2,3 ORDER BY 1"
637,Y,N,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, IFNULL(A.CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(B.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C RIGHT JOIN INVOICES I ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(USER_ID) AS CONTACTS_CNT FROM CONTACTS GROUP BY 1) A ON I.USER_ID=A.USER_ID LEFT JOIN (SELECT X.USER_ID,COUNT(X.USER_ID )AS TRUSTED_CONTACTS_CNT FROM CONTACTS X, CUSTOMERS Y WHERE Y.CUSTOMER_NAME=X.CONTACT_NAME GROUP BY 1) B ON I.USER_ID=B.USER_ID ORDER BY I.INVOICE_ID"
638,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END)AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS CU ON A.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CU.CUSTOMER_ID = CON.USER_ID GROUP BY 1,2,3 ORDER BY 1"
639,Y,N,"WITH A AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(CU.CUSTOMER_NAME IS NOT NULL, 1, 0)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO LEFT JOIN CUSTOMERS CU ON CO.CONTACT_NAME = CU.CUSTOMER_NAME GROUP BY 1 ) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, SUM(IF(CONTACTS_CNT IS NOT NULL, CONTACTS_CNT, 0)) AS CONTACTS_CNT, SUM(IF(TRUSTED_CONTACTS_CNT IS NOT NULL, TRUSTED_CONTACTS_CNT, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN A ON I.USER_ID = A.USER_ID GROUP BY 1, 2, 3 ORDER BY 1"
640,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(A.CONTACT_EMAIL),0) AS CONTACTS_CNT, SUM( IF(A.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0) ) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS A ON C.CUSTOMER_ID = A.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
641,Y,N,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CO.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON CO.CONTACT_EMAIL = C2.EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
642,Y,Y,"WITH T1 AS ( SELECT CUS.CUSTOMER_ID, CUS.CUSTOMER_NAME, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT FROM CUSTOMERS AS CUS LEFT JOIN CONTACTS AS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY CUS.CUSTOMER_ID ), T2 AS ( SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I LEFT JOIN T1 ON I.USER_ID = T1.CUSTOMER_ID LEFT JOIN T2 ON I.USER_ID = T2.USER_ID ORDER BY INVOICE_ID"
643,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN I.USER_ID = CO.USER_ID AND CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON CU.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID GROUP BY INVOICE_ID, I.USER_ID ORDER BY INVOICE_ID"
644,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, IFNULL(COUNT(CT.USER_ID),0) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CM ON I.USER_ID=CM.CUSTOMER_ID LEFT JOIN CONTACTS CT ON CM.CUSTOMER_ID=CT.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
645,Y,Y,"WITH T1 AS ( SELECT I.INVOICE_ID, C.CUSTOMER_NAME, C.CUSTOMER_ID, I.PRICE FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID ), T2 AS ( SELECT C.CUSTOMER_ID, COUNT(T.CONTACT_NAME) AS CONTACTS_CNT FROM CUSTOMERS C INNER JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY C.CUSTOMER_ID ), T3 AS (SELECT C.CUSTOMER_ID, COUNT(T.CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C INNER JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID WHERE T.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) GROUP BY C.CUSTOMER_ID ) SELECT T1.INVOICE_ID, T1.CUSTOMER_NAME, T1.PRICE, IFNULL(T2.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T3.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM T1 LEFT JOIN T2 ON T1.CUSTOMER_ID = T2.CUSTOMER_ID LEFT JOIN T3 ON T1.CUSTOMER_ID = T3.CUSTOMER_ID ORDER BY T1.INVOICE_ID"
646,Y,Y,"SELECT INVOICE_ID, CC.CUSTOMER_NAME, PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(IF(CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS), 1, 0) ), 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CC ON I.USER_ID = CC.CUSTOMER_ID LEFT JOIN CONTACTS C ON CC.CUSTOMER_ID = C.USER_ID GROUP BY 1 ORDER BY 1"
647,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN T.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID"
648,Y,Y,"SELECT DISTINCT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) OVER(PARTITION BY INVOICE_ID) AS CONTACTS_CNT, SUM(IF(CONTACT_NAME IN(SELECT CUSTOMER_NAME FROM CUSTOMERS), 1, 0)) OVER(PARTITION BY INVOICE_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES I RIGHT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS C ON C.USER_ID = CU.CUSTOMER_ID WHERE INVOICE_ID IS NOT NULL ORDER BY INVOICE_ID"
649,Y,Y,"SELECT INVOICE_ID,C.CUSTOMER_NAME,PRICE,IFNULL(X.CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(Y.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) X ON C.CUSTOMER_ID=X.USER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID) Y ON C.CUSTOMER_ID=Y.USER_ID ORDER BY INVOICE_ID"
650,Y,Y,"WITH CTE AS ( SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID GROUP BY 1) SELECT INVOICE_ID, CTE.CUSTOMER_NAME, PRICE, CTE.CONTACTS_CNT, CTE.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CTE ON I.USER_ID = CTE.CUSTOMER_ID ORDER BY 1"
651,Y,Y,"WITH TRUSTED AS (SELECT USER_ID, COUNT(*) AS TRUSTED_CONTACT_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT A.INVOICE_ID, C.CUSTOMER_NAME, A.PRICE, COUNT(B.USER_ID) AS CONTACTS_CNT, IFNULL(D.TRUSTED_CONTACT_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CONTACTS B ON A.USER_ID=B.USER_ID LEFT JOIN CUSTOMERS C ON A.USER_ID=C.CUSTOMER_ID LEFT JOIN TRUSTED D ON B.USER_ID=D.USER_ID GROUP BY 1, 2 ORDER BY 1"
652,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,COUNT(CNT.USER_ID) CONTACTS_CNT, SUM(CASE WHEN CNT.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END ) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CNT ON C.CUSTOMER_ID = CNT.USER_ID GROUP BY 1,2,3 ORDER BY 1"
653,Y,Y,"WITH CTE1 AS ( SELECT A.CUSTOMER_NAME,A.CUSTOMER_ID,B.CONTACT_NAME, COUNT(DISTINCT B.USER_ID,B.CONTACT_NAME) AS CNT, CASE WHEN B.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN COUNT(DISTINCT B.USER_ID,B.CONTACT_NAME) ELSE 0 END AS CNT_2 FROM CUSTOMERS A LEFT JOIN CONTACTS B ON A.CUSTOMER_ID=B.USER_ID GROUP BY A.CUSTOMER_ID,A.CUSTOMER_ID,B.CONTACT_NAME ) SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE, SUM(C.CNT) AS CONTACTS_CNT, SUM(C.CNT_2) AS TRUSTED_CONTACTS_CNT FROM CTE1 AS C INNER JOIN INVOICES AS I ON C.CUSTOMER_ID=I.USER_ID GROUP BY I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE ORDER BY I.INVOICE_ID"
654,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE, IFNULL(COUNT(CONTACT_NAME),0) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID JOIN INVOICES I ON C1.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
655,Y,N,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_EMAIL) CONTACTS_CNT, COUNT(D.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT OUTER JOIN CONTACTS C ON C.USER_ID = B.CUSTOMER_ID LEFT OUTER JOIN CUSTOMERS D ON D.EMAIL = C.CONTACT_EMAIL GROUP BY A.INVOICE_ID , B.CUSTOMER_NAME, A.PRICE ORDER BY A.INVOICE_ID ASC"
656,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
657,Y,Y,"WITH CTE AS ( SELECT INVOICE_ID, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN CONTACT_EMAIL END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CONTACTS C ON I.USER_ID = C.USER_ID GROUP BY 1 ) SELECT INVOICES.INVOICE_ID,CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, IFNULL(CTE.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(CTE.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN CTE ON INVOICES.INVOICE_ID = CTE.INVOICE_ID JOIN CUSTOMERS ON CUSTOMERS.CUSTOMER_ID = INVOICES.USER_ID ORDER BY INVOICES.INVOICE_ID"
658,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COALESCE(COUNT(CT.USER_ID),0) CONTACTS_CNT, COALESCE(COUNT(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 END),0) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON I.USER_ID=CT.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY INVOICE_ID"
659,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CO.CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(CO.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID, COUNT(*) AS CONTACTS_CNT, SUM(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) AS CO ON I.USER_ID = CO.USER_ID ORDER BY INVOICE_ID"
660,Y,Y,"SELECT A.INVOICE_ID ,B.CUSTOMER_NAME ,A.PRICE ,COUNT(DISTINCT C.CONTACT_EMAIL) AS CONTACTS_CNT ,COUNT(DISTINCT D.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES A JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON B.CUSTOMER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_EMAIL = D.EMAIL GROUP BY 1,2,3 ORDER BY 1"
661,Y,N,"SELECT INVOICE_ID, C.CUSTOMER_NAME, PRICE, COUNT(T.CONTACT_NAME) CONTACTS_CNT, COUNT(C1.EMAIL) TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID LEFT JOIN CUSTOMERS C1 ON T.CONTACT_EMAIL = C1.EMAIL GROUP BY 1,2,3 ORDER BY INVOICE_ID"
662,Y,N,"WITH A AS( SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, I.USER_ID FROM INVOICES I JOIN CUSTOMERS CUS ON I.USER_ID = CUS.CUSTOMER_ID ORDER BY 1), B AS( SELECT USER_ID, COUNT(CONTACT_NAME) CONTACTS_CNT FROM CONTACTS GROUP BY 1), C AS ( SELECT USER_ID, COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS CON JOIN CUSTOMERS CUS ON CUS.EMAIL =CON.CONTACT_EMAIL WHERE CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1) SELECT A.INVOICE_ID, A.CUSTOMER_NAME, A.PRICE, IFNULL(B.CONTACTS_CNT,0) CONTACTS_CNT,IFNULL(C.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM A LEFT JOIN B ON A.USER_ID=B.USER_ID LEFT JOIN C ON B.USER_ID=C.USER_ID ORDER BY INVOICE_ID"
663,Y,N,"SELECT T1.INVOICE_ID,T1.CUSTOMER_NAME,T1.PRICE, IFNULL(T2.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM (SELECT I.INVOICE_ID,I.PRICE,I.USER_ID, C.CUSTOMER_NAME FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID) T1 LEFT JOIN (SELECT C1.USER_ID, COUNT(C1.CONTACT_NAME) AS CONTACTS_CNT, COUNT(C2.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS C1 LEFT JOIN CUSTOMERS C2 ON C1.CONTACT_NAME=C2.CUSTOMER_NAME GROUP BY C1.USER_ID) T2 ON T1.USER_ID=T2.USER_ID ORDER BY 1"
664,Y,N,"WITH CUST_CNT AS( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), TRUSTED AS ( SELECT CO.USER_ID, COUNT(CO.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS CO JOIN CUSTOMERS CU ON CO.CONTACT_EMAIL = CU.EMAIL GROUP BY CO.USER_ID ) SELECT I.INVOICE_ID, CU.CUSTOMER_NAME, PRICE, COALESCE(CONTACTS_CNT,0) CONTACTS_CNT, COALESCE (TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CUST_CNT CC ON I.USER_ID = CC.USER_ID LEFT JOIN TRUSTED T ON I.USER_ID = T.USER_ID ORDER BY I.INVOICE_ID"
665,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.CONTACT_NAME) AS CONTACTS_CNT, SUM( CASE WHEN CO.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS AS CO ON CO.USER_ID = C.CUSTOMER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
666,Y,Y,"WITH CTE1 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ), CTE2 AS ( SELECT USER_ID, COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID ) SELECT B.INVOICE_ID, A.CUSTOMER_NAME, B.PRICE , COALESCE(CTE1.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(CTE2.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A LEFT JOIN CTE1 ON A.CUSTOMER_ID = CTE1.USER_ID LEFT JOIN CTE2 ON A.CUSTOMER_ID = CTE2.USER_ID LEFT JOIN INVOICES B ON A.CUSTOMER_ID = B.USER_ID WHERE B.INVOICE_ID IS NOT NULL ORDER BY B.INVOICE_ID"
667,Y,N,"WITH TMP1 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, SUM(IF(CONTACT_NAME IS NULL, 0, 1)) CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_ID = C2.USER_ID GROUP BY CUSTOMER_ID, CUSTOMER_NAME), TMP2 AS (SELECT USER_ID, COUNT(1) TRUSTED_CONTACTS_CNT FROM CUSTOMERS C1 LEFT JOIN CONTACTS C2 ON C1.CUSTOMER_NAME = C2.CONTACT_NAME GROUP BY USER_ID HAVING USER_ID != 0), TMP3 AS (SELECT CUSTOMER_ID, CUSTOMER_NAME, CONTACTS_CNT, COALESCE(TRUSTED_CONTACTS_CNT, 0) TRUSTED_CONTACTS_CNT FROM TMP1 LEFT JOIN TMP2 ON TMP1.CUSTOMER_ID = TMP2.USER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN TMP3 T ON I.USER_ID = T.CUSTOMER_ID ORDER BY INVOICE_ID"
668,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CON.USER_ID) AS CONTACTS_CNT, COUNT(C2.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID = C.CUSTOMER_ID LEFT JOIN CUSTOMERS C2 ON C2.EMAIL = CON.CONTACT_EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
669,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CONTACTS_CNT, TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN (SELECT CUSTOMER_ID, CUSTOMER_NAME, COUNT(USER_ID) AS CONTACTS_CNT, COUNT(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE NULL END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS LEFT JOIN CONTACTS ON CUSTOMER_ID = USER_ID GROUP BY CUSTOMER_ID) TEMP ON USER_ID = CUSTOMER_ID ORDER BY INVOICE_ID"
670,Y,Y,"SELECT DISTINCT SUB1.INVOICE_ID, SUB1.CUSTOMER_NAME, SUB1.PRICE,SUB1.CONTACTS_CNT, IFNULL(SUB2.TRUSTED_CONTACTS_CNT,0)AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE,COUNT(CON.USER_ID) AS CONTACTS_CNT,EMAIL FROM INVOICES A LEFT JOIN CUSTOMERS CU ON A.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CU.CUSTOMER_ID = CON.USER_ID GROUP BY 1,2,3 ORDER BY 1 )SUB1 LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)GROUP BY 1 )AS SUB2 ON SUB1.CUSTOMER_ID = SUB2.USER_ID ORDER BY 1"
671,Y,N,"WITH TEMP1 AS ( SELECT USER_ID, COUNT(DISTINCT CONTACT_NAME) AS CONTACTS_CNT, SUM(EMAIL IS NOT NULL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME GROUP BY USER_ID ) SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, PRICE, IFNULL(CONTACTS_CNT, 0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES LEFT JOIN TEMP1 ON INVOICES.USER_ID = TEMP1.USER_ID LEFT JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY 1"
672,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT , COUNT(C1.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON C.CUSTOMER_ID = C2.USER_ID LEFT JOIN CUSTOMERS C1 ON C2.CONTACT_EMAIL = C1.EMAIL GROUP BY I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
673,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID=CO.USER_ID GROUP BY 1,2,3 ORDER BY 1"
674,Y,N,"SELECT A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE, COUNT(DISTINCT C.CONTACT_NAME) AS CONTACTS_CNT, SUM(D.EMAIL IS NOT NULL) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS D ON C.CONTACT_EMAIL = D.EMAIL GROUP BY A.INVOICE_ID,B.CUSTOMER_NAME,A.PRICE ORDER BY INVOICE_ID"
675,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(DISTINCT N.CONTACT_NAME)AS CONTACTS_CNT, SUM(CASE WHEN N.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CONTACTS N ON I.USER_ID = N.USER_ID JOIN CUSTOMERS C ON C.CUSTOMER_ID = I.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
676,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(U.USER_ID) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS U ON C.CUSTOMER_ID = U.USER_ID GROUP BY INVOICE_ID, CUSTOMER_NAME, PRICE ORDER BY 1 ASC"
677,Y,N,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, COUNT(C1.EMAIL) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CO ON C.CUSTOMER_ID = CO.USER_ID LEFT JOIN CUSTOMERS C1 ON C1.EMAIL = CO.CONTACT_EMAIL GROUP BY 1,2,3 ORDER BY 1"
678,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONTACT_EMAIL) CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0)) TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS CON ON C.CUSTOMER_ID=CON.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID=I.USER_ID GROUP BY 1 ORDER BY 1"
679,Y,Y,"WITH C1 AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME,COUNT(CONTACT_NAME) AS TRUSTED_CONTACTS_CNT FROM ( SELECT CUSTOMER_ID,CUSTOMER_NAME,CONTACT_NAME,CONTACT_EMAIL FROM CUSTOMERS C LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID WHERE (CONTACT_NAME,CONTACT_EMAIL) IN (SELECT CUSTOMER_NAME,EMAIL FROM CUSTOMERS) ) T1 GROUP BY CUSTOMER_ID ), C2 AS ( SELECT CUSTOMER_ID,CUSTOMER_NAME,COUNT(CONTACT_NAME) AS CONTACTS_CNT FROM ( SELECT CUSTOMER_ID,CUSTOMER_NAME,CONTACT_NAME,CONTACT_EMAIL FROM CUSTOMERS C LEFT JOIN CONTACTS T ON C.CUSTOMER_ID = T.USER_ID ) T2 GROUP BY CUSTOMER_ID ) SELECT INVOICE_ID,C.CUSTOMER_NAME,PRICE, IFNULL(CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN C2 ON I.USER_ID = C2.CUSTOMER_ID LEFT JOIN C1 ON I.USER_ID = C1.CUSTOMER_ID ORDER BY INVOICE_ID"
680,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,IFNULL(T1.CONTACTS_CNT,0) AS CONTACTS_CNT,IFNULL(T2.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_EMAIL) AS CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID) T1 ON I.USER_ID=T1.USER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY USER_ID)T2 ON T2.USER_ID=I.USER_ID ORDER BY 1"
681,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT CT.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CT.CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS CT ON C.CUSTOMER_ID = CT.USER_ID GROUP BY I.INVOICE_ID ORDER BY I.INVOICE_ID"
682,Y,Y,"WITH CTE AS ( SELECT T.USER_ID, COUNT(T.CONTACT_NAME) AS CNT FROM CONTACTS T WHERE T.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) GROUP BY 1 ), CTE1 AS ( SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE , I.USER_ID, IFNULL(COUNT(T.CONTACT_NAME),0) AS CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CONTACTS T ON I.USER_ID = T.USER_ID GROUP BY 1 ) SELECT CTE1.INVOICE_ID, CTE1.CUSTOMER_NAME, CTE1.PRICE, CTE1.CNT AS CONTACTS_CNT , IFNULL(CTE.CNT,0) AS TRUSTED_CONTACTS_CNT FROM CTE1 LEFT JOIN CTE ON CTE.USER_ID = CTE1.USER_ID ORDER BY 1"
683,Y,Y,"SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, COUNT(DISTINCT T.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CONTACT_NAME IN (SELECT DISTINCT CUSTOMER_NAME FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I JOIN CUSTOMERS AS C ON C.CUSTOMER_ID = I.USER_ID LEFT JOIN CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID ORDER BY INVOICE_ID ASC"
684,Y,Y,"SELECT I.INVOICE_ID, C1.CUSTOMER_NAME, I.PRICE, COUNT(C2.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN C2.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C1 ON I.USER_ID = C1.CUSTOMER_ID LEFT JOIN CONTACTS C2 ON I.USER_ID = C2.USER_ID GROUP BY 1 ORDER BY 1"
685,Y,Y,"SELECT I.INVOICE_ID,T.CUSTOMER_NAME,I.PRICE,T.CONTACTS_CNT,T.TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN (SELECT CUSTOMER_ID,CUSTOMER_NAME, COUNT(CONTACT_NAME) AS CONTACTS_CNT,SUM(CASE WHEN CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CU LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID = CO.USER_ID GROUP BY CUSTOMER_ID) T ON I.USER_ID = T.CUSTOMER_ID ORDER BY I.INVOICE_ID"
686,Y,Y,"SELECT INVOICE_ID , CUSTOMER_NAME , PRICE , COUNT(T3.USER_ID) AS CONTACTS_CNT , SUM(CASE WHEN T3.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES T1 LEFT JOIN CUSTOMERS T2 ON (T1.USER_ID = T2.CUSTOMER_ID) LEFT JOIN CONTACTS T3 ON (T2.CUSTOMER_ID = T3.USER_ID) GROUP BY 1 ORDER BY 1"
687,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.USER_ID) CONTACTS_CNT, IFNULL(SUM(C.TRUSTED),0) TRUSTED_CONTACTS_CNT FROM INVOICES A INNER JOIN CUSTOMERS B ON A.USER_ID = B.CUSTOMER_ID LEFT JOIN ( SELECT USER_ID, CONTACT_NAME, IF(C.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS), 1, 0) AS TRUSTED FROM CONTACTS C ) C ON B.CUSTOMER_ID = C.USER_ID GROUP BY A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE ORDER BY A.INVOICE_ID"
688,Y,N,"WITH CNT AS (SELECT USER_ID, COUNT(DISTINCT CONTACTS.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(CUSTOMERS.EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CUSTOMERS.EMAIL = CONTACTS.CONTACT_EMAIL GROUP BY CONTACTS.USER_ID ) SELECT INVOICES.INVOICE_ID, CUSTOMERS.CUSTOMER_NAME, INVOICES.PRICE, COALESCE(CNT.CONTACTS_CNT, 0) AS CONTACTS_CNT, COALESCE(CNT.TRUSTED_CONTACTS_CNT, 0) AS TRUSTED_CONTACTS_CNT FROM INVOICES JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID LEFT JOIN CNT ON INVOICES.USER_ID = CNT.USER_ID ORDER BY INVOICE_ID"
689,Y,Y,"WITH CTE AS ( SELECT *, COUNT(CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CONTACTS GROUP BY USER_ID ) SELECT I.INVOICE_ID, C.CUSTOMER_NAME, I.PRICE, IFNULL(CTE.CONTACTS_CNT,0) AS CONTACTS_CNT, IFNULL(CTE.TRUSTED_CONTACTS_CNT,0) AS TRUSTED_CONTACTS_CNT FROM INVOICES I INNER JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN CTE ON I.USER_ID = CTE.USER_ID ORDER BY 1"
690,Y,Y,"SELECT A.INVOICE_ID, B.CUSTOMER_NAME, A.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, IFNULL(SUM(C.CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)),0) AS TRUSTED_CONTACTS_CNT FROM INVOICES A LEFT JOIN CUSTOMERS B ON A.USER_ID=B.CUSTOMER_ID LEFT JOIN CONTACTS C ON A.USER_ID=C.USER_ID GROUP BY A.INVOICE_ID ORDER BY A.INVOICE_ID"
691,Y,Y,"SELECT C.INVOICE_ID,A.CUSTOMER_NAME,C.PRICE,COUNT(B.CONTACT_NAME) AS CONTACTS_CNT, SUM(IF(B.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS A RIGHT JOIN INVOICES C ON A.CUSTOMER_ID = C.USER_ID LEFT JOIN CONTACTS B ON B.USER_ID=A.CUSTOMER_ID GROUP BY C.INVOICE_ID ORDER BY C.INVOICE_ID"
692,Y,Y,"WITH WLS AS( SELECT I.INVOICE_ID,CU.CUSTOMER_NAME,I.PRICE,COUNT(DISTINCT CO.CONTACT_EMAIL) AS CONTACTS_CNT, SUM(CASE WHEN CO.CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON I.USER_ID = CO.USER_ID GROUP BY 1 ORDER BY 1 ASC ) SELECT * FROM WLS"
693,Y,Y,"SELECT INVOICE_ID,CUSTOMER_NAME,PRICE, COUNT(CONTACT_EMAIL) AS CONTACTS_CNT, SUM(IF(CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS),1,0)) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS C LEFT JOIN CONTACTS O ON C.CUSTOMER_ID = O.USER_ID JOIN INVOICES I ON C.CUSTOMER_ID = I.USER_ID GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
694,Y,N,"WITH TEMP AS( SELECT CONTACTS.USER_ID ID, COUNT(*) CONTACTS_CNT, COUNT(CUSTOMERS.CUSTOMER_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS LEFT JOIN CUSTOMERS ON CONTACTS.CONTACT_NAME = CUSTOMERS.CUSTOMER_NAME GROUP BY CONTACTS.USER_ID) SELECT INVOICE_ID, CUSTOMERS.CUSTOMER_NAME,PRICE, IFNULL(TEMP.CONTACTS_CNT,0) CONTACTS_CNT, IFNULL(TEMP.TRUSTED_CONTACTS_CNT,0) TRUSTED_CONTACTS_CNT FROM (INVOICES LEFT JOIN TEMP ON TEMP.ID = INVOICES.USER_ID) JOIN CUSTOMERS ON INVOICES.USER_ID = CUSTOMERS.CUSTOMER_ID ORDER BY INVOICE_ID"
695,Y,N,"WITH TRUSTED_CONTACTS AS ( SELECT C.USER_ID , ISNULL(S.EMAIL) AS TRUSTED FROM CONTACTS AS C LEFT JOIN CUSTOMERS AS S ON C.CONTACT_EMAIL = S.EMAIL ) SELECT I.INVOICE_ID , C.CUSTOMER_NAME , I.PRICE , SUM(IF(T.USER_ID IS NULL, 0, 1)) AS CONTACTS_CNT , SUM(IF(T.TRUSTED IS NOT NULL AND T.TRUSTED = 0, 1, 0)) AS TRUSTED_CONTACTS_CNT FROM INVOICES AS I INNER JOIN CUSTOMERS AS C ON I.USER_ID = C.CUSTOMER_ID LEFT JOIN TRUSTED_CONTACTS AS T ON C.CUSTOMER_ID = T.USER_ID GROUP BY I.INVOICE_ID , C.CUSTOMER_NAME , I.PRICE ORDER BY INVOICE_ID"
696,Y,Y,"SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, COUNT(CONT.USER_ID) AS CONTACTS_CNT, COUNT(ST.USER_ID) AS TRUSTED_CONTACTS_CNT FROM INVOICES INV LEFT JOIN CUSTOMERS CUST ON INV.USER_ID = CUST.CUSTOMER_ID LEFT JOIN CONTACTS CONT ON CUST.CUSTOMER_ID = CONT.USER_ID LEFT JOIN (SELECT USER_ID, CONTACT_NAME FROM CONTACTS WHERE CONTACT_NAME IN (SELECT CUSTOMER_NAME FROM CUSTOMERS)) ST ON CUST.CUSTOMER_ID = ST.USER_ID AND CONT.CONTACT_NAME = ST.CONTACT_NAME GROUP BY INVOICE_ID ORDER BY INVOICE_ID"
697,Y,N,"SELECT I.INVOICE_ID,CU.CUSTOMER_NAME, I.PRICE, COUNT(CO.USER_ID) AS CONTACTS_CNT, IF(AA.TRUSTED_CONTACTS_CNT IS NULL, 0, AA.TRUSTED_CONTACTS_CNT) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CU ON I.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CO ON CU.CUSTOMER_ID= CO.USER_ID LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CONTACTS JOIN CUSTOMERS ON CONTACT_EMAIL=EMAIL GROUP BY USER_ID) AA ON I.USER_ID = AA.USER_ID GROUP BY I.INVOICE_ID,I.PRICE, CU.CUSTOMER_NAME ORDER BY INVOICE_ID;"
698,Y,Y,"SELECT I.INVOICE_ID,C.CUSTOMER_NAME,I.PRICE,COUNT(CON.CONTACT_NAME) AS CONTACTS_CNT, SUM(CASE WHEN CON.CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS) THEN 1 ELSE 0 END) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS C ON I.USER_ID=C.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CON.USER_ID=C.CUSTOMER_ID GROUP BY I.INVOICE_ID,C.CUSTOMER_NAME ORDER BY I.INVOICE_ID"
699,Y,N,"SELECT I.INVOICE_ID, CUS0.CUSTOMER_NAME, I.PRICE, COUNT(C.CONTACT_NAME) AS CONTACTS_CNT, COUNT(CUS.CUSTOMER_NAME) AS TRUSTED_CONTACTS_CNT FROM INVOICES I LEFT JOIN CUSTOMERS CUS0 ON I.USER_ID = CUS0.CUSTOMER_ID LEFT JOIN CONTACTS C ON I.USER_ID = C.USER_ID LEFT JOIN CUSTOMERS CUS ON C.CONTACT_EMAIL = CUS.EMAIL GROUP BY I.INVOICE_ID, CUS0.CUSTOMER_NAME, I.PRICE ORDER BY I.INVOICE_ID"
700,Y,Y,"SELECT SUB1.INVOICE_ID, SUB1.CUSTOMER_NAME, SUB1.PRICE,SUB1.CONTACTS_CNT, IFNULL(SUB2.TRUSTED_CONTACTS_CNT,0)AS TRUSTED_CONTACTS_CNT FROM (SELECT INVOICE_ID, CUSTOMER_ID, CUSTOMER_NAME, PRICE,COUNT(CON.USER_ID) AS CONTACTS_CNT,EMAIL FROM INVOICES A LEFT JOIN CUSTOMERS CU ON A.USER_ID = CU.CUSTOMER_ID LEFT JOIN CONTACTS CON ON CU.CUSTOMER_ID = CON.USER_ID GROUP BY 1,2,3 ORDER BY 1 )SUB1 LEFT JOIN (SELECT USER_ID,COUNT(CONTACT_NAME) TRUSTED_CONTACTS_CNT FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT EMAIL FROM CUSTOMERS)GROUP BY 1 )AS SUB2 ON SUB1.CUSTOMER_ID = SUB2.USER_ID ORDER BY 1"
701,Y,Y,"WITH CNT AS( SELECT CUS.CUSTOMER_ID, COUNT(CON.CONTACT_EMAIL) AS CONTACTS_CNT, COUNT(TMP.CONTACT_EMAIL) AS TRUSTED_CONTACTS_CNT FROM CUSTOMERS CUS LEFT JOIN CONTACTS CON ON CUS.CUSTOMER_ID = CON.USER_ID LEFT JOIN (SELECT USER_ID, CONTACT_EMAIL FROM CONTACTS WHERE CONTACT_EMAIL IN (SELECT DISTINCT EMAIL FROM CUSTOMERS)) TMP ON CON.CONTACT_EMAIL = TMP.CONTACT_EMAIL AND CUS.CUSTOMER_ID = TMP.USER_ID GROUP BY CUSTOMER_ID) SELECT INVOICE_ID, CUSTOMER_NAME, PRICE, CNT.CONTACTS_CNT, CNT.TRUSTED_CONTACTS_CNT FROM INVOICES I JOIN CUSTOMERS C ON I.USER_ID = C.CUSTOMER_ID JOIN CNT ON I.USER_ID = CNT.CUSTOMER_ID ORDER BY INVOICE_ID"
