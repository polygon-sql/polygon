qid,mysql_can_execute?,mysql_correct?,mysql_query
0,N,N,"(SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) ) SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(1.00 * COUNT( DISTINCT B.PLAYER_ID) / COUNT(DISTINCT A.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE1 A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE-1 = A.INSTALL_DT GROUP BY A.INSTALL_DT"
1,Y,N,"SELECT I.INSTALL_DT, I.INSTALLS, ROUND(IFNULL(RETENTION/INSTALLS,0),2) AS DAY1_RETENTION FROM (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A GROUP BY INSTALL_DT) I LEFT JOIN (SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS RETENTION FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS D FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY EVENT_DATE) R ON DATE_ADD(I.INSTALL_DT, INTERVAL 1 DAY) = R.EVENT_DATE"
2,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE + 1 = B.EVENT_DATE GROUP BY A.EVENT_DATE"
3,Y,Y,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE -1 = A1.EVENT_DATE GROUP BY INSTALL_DT"
4,Y,Y,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(*), 2) AS DAY1_RETENTION FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON A1.EVENT_DATE = A2.EVENT_DATE-1 AND A1.PLAYER_ID = A2.PLAYER_ID WHERE (A1.PLAYER_ID ,A1.EVENT_DATE) IN ( SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY 1"
5,Y,Y,"SELECT A1.FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(A1.FIRST_LOGIN + 1 = A2.EVENT_DATE, 1, 0)) / COUNT(DISTINCT A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) AS A1 JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID GROUP BY A1.FIRST_LOGIN"
6,Y,Y,"SELECT ACT1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT ACT1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN ACT2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END) /COUNT(DISTINCT ACT1.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RK, PLAYER_ID FROM ACTIVITY ) ACT1 LEFT JOIN ACTIVITY ACT2 ON ACT1.EVENT_DATE+1 = ACT2.EVENT_DATE AND ACT1.PLAYER_ID = ACT2.PLAYER_ID WHERE RK = 1 GROUP BY 1"
7,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(RETENTION) / COUNT(*),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, CASE WHEN NEXT_DATE - EVENT_DATE = 1 THEN 1 ELSE 0 END AS RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) A WHERE RNK = 1) B GROUP BY 1"
8,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1 THEN 1 ELSE 0 END) * 1.0 / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATE_RANK, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY ) T1 WHERE DATE_RANK = 1 GROUP BY EVENT_DATE ORDER BY 1"
9,Y,Y,"SELECT F.FIRST_DATE AS INSTALL_DT, COUNT(F.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(F.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS F LEFT JOIN ACTIVITY AS A ON F.PLAYER_ID = A.PLAYER_ID AND F.FIRST_DATE = A.EVENT_DATE -1 GROUP BY F.FIRST_DATE"
10,Y,N,"SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE,FIRST_LOGIN)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS FIRST_LOGIN FROM ACTIVITY ) TB1 GROUP BY FIRST_LOGIN"
11,Y,Y,"SELECT FIRST_LOGIN INSTALL_DT,COUNT(*) INSTALLS, ROUND(SUM(PLAYER_STATUS)/COUNT(*),2) DAY1_RETENTION FROM ( SELECT LL.PLAYER_ID,LL.FIRST_LOGIN,CASE WHEN RR.PLAYER_ID IS NULL THEN 0 ELSE 1 END PLAYER_STATUS FROM (SELECT A.PLAYER_ID,MIN(A.EVENT_DATE) FIRST_LOGIN FROM ACTIVITY A GROUP BY A.PLAYER_ID) LL LEFT JOIN (SELECT DISTINCT L.PLAYER_ID FROM ( SELECT B.PLAYER_ID,MIN(B.EVENT_DATE) FIRST_LOGIN FROM ACTIVITY B GROUP BY B.PLAYER_ID) L INNER JOIN ACTIVITY R ON L.PLAYER_ID=R.PLAYER_ID WHERE L.FIRST_LOGIN+1=R.EVENT_DATE ) RR ON LL.PLAYER_ID=RR.PLAYER_ID) T GROUP BY FIRST_LOGIN"
12,Y,Y,"SELECT FISRT_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FISRT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) A LEFT JOIN ACTIVITY B ON A.FISRT_DATE = B.EVENT_DATE - 1 AND A.PLAYER_ID = B.PLAYER_ID GROUP BY INSTALL_DT"
13,Y,N,"SELECT INSTALL_DT, COUNT(*) AS INSTALLS , ROUND(AVG(RETAINED), 2) AS DAY1_RETENTION FROM (SELECT T_INSTALL_DT.PLAYER_ID, T_INSTALL_DT.INSTALL_DT, IF(ISNULL(A1.EVENT_DATE), 0, 1) AS RETAINED FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T_INSTALL_DT LEFT JOIN ACTIVITY A1 ON T_INSTALL_DT.PLAYER_ID = A1.PLAYER_ID AND DATE_ADD(T_INSTALL_DT.INSTALL_DT, INTERVAL 1 DAY) = A1.EVENT_DATE) T1 GROUP BY INSTALL_DT"
14,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT A1.PLAYER_ID), 2) DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A1 JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
15,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY ) X GROUP BY INSTALL_DT"
16,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT SUB.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A.EVENT_DATE IS NULL THEN 0 ELSE 1 END)/COUNT(DISTINCT SUB.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY ) SUB LEFT JOIN ACTIVITY A ON DATE_ADD(SUB.EVENT_DATE, INTERVAL 1 DAY) = A.EVENT_DATE AND SUB.PLAYER_ID = A.PLAYER_ID WHERE SUB.EVENT_DATE = INSTALL_DT GROUP BY INSTALL_DT"
17,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT X.PLAYER_ID) AS INSTALLS, ROUND(CAST(COALESCE(COUNT(DISTINCT A.PLAYER_ID),0) AS DECIMAL)/COUNT(DISTINCT X.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) X LEFT JOIN ACTIVITY A ON X.PLAYER_ID = A.PLAYER_ID AND X.INSTALL_DT + 1 = A.EVENT_DATE GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
18,Y,N,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND( COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2 ) AS DAY1_RETENTION FROM ( SELECT A.PLAYER_ID, A.INSTALL_DT, B.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DT,INTERVAL 1 DAY) ) AS T GROUP BY INSTALL_DT"
19,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A1.INSTALL_DT, A1.PLAYER_ID, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT = A2.EVENT_DATE - 1 ) A GROUP BY A.INSTALL_DT"
20,Y,N,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND SUBDATE(A2.EVENT_DATE, INTERVAL 1 DAY) = A1.INSTALL_DT ) AS T GROUP BY INSTALL_DT"
21,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.INSTALL_DT + 1 ) AS T GROUP BY INSTALL_DT"
22,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(RETENTION)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT + 1 = A2.EVENT_DATE) TMP GROUP BY INSTALL_DT"
23,Y,Y,"SELECT INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/COUNT(T.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT INSTALL_DT, B.PLAYER_ID, A.EVENT_DATE AS NEXT_DAY FROM ACTIVITY A RIGHT JOIN ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = INSTALL_DT + 1 ) T GROUP BY 1"
24,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS INSTALL_ACT ON A.PLAYER_ID = INSTALL_ACT.PLAYER_ID GROUP BY INSTALL_DT"
25,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT(CASE WHEN TIME_GAP = 1 THEN PLAYER_ID ELSE NULL END))*1.00/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT, DATEDIFF(EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)) AS TIME_GAP FROM ACTIVITY) TMP GROUP BY 1 ORDER BY 1"
26,Y,Y,"SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(INSTALL_DT),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS B LEFT JOIN ACTIVITY A ON A.EVENT_DATE = B.INSTALL_DT + 1 AND B.PLAYER_ID = A.PLAYER_ID GROUP BY INSTALL_DT"
27,Y,Y,"SELECT P1.FIRST_LOGIN AS INSTALL_DT, P1.INSTALLS, ROUND(P2.RETAINED/P1.INSTALLS, 2) AS DAY1_RETENTION FROM (SELECT FIRST_LOGIN, COUNT(PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) A GROUP BY FIRST_LOGIN) P1 INNER JOIN (SELECT T1.FIRST_LOGIN, COUNT(T2.PLAYER_ID) AS RETAINED FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.FIRST_LOGIN = T2.EVENT_DATE - 1 GROUP BY T1.FIRST_LOGIN) P2 ON P1.FIRST_LOGIN = P2.FIRST_LOGIN"
28,Y,N,"SELECT T.INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(T.NEXT_DAY) / COUNT(T.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT T1.PLAYER_ID, INSTALL_DT, T2.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS T1 LEFT JOIN ACTIVITY AS T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DT = SUBDATE(T2.EVENT_DATE, INTERVAL 1 DAY) ) AS T GROUP BY INSTALL_DT"
29,Y,N,"SELECT T.INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(T.NEXT_DAY) / COUNT(T.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID=A2.PLAYER_ID AND DATEDIFF(A2.EVENT_DATE,A1.INSTALL_DT)=1 ) AS T GROUP BY T.INSTALL_DT"
30,Y,N,"SELECT T1.D0 AS INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE) / COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS D0 FROM ACTIVITY GROUP BY 1) T1 LEFT JOIN ACTIVITY A ON DATEDIFF(A.EVENT_DATE, T1.D0) = 1 AND T1.PLAYER_ID = A.PLAYER_ID GROUP BY 1"
31,Y,N,"SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COALESCE(AVG(DATEDIFF(SECOND_LOGIN, FIRST_LOGIN) = 1), 0), 2) AS DAY1_RETENTION FROM (SELECT *, (SELECT MIN(EVENT_DATE) FROM ACTIVITY WHERE PLAYER_ID = TMP.PLAYER_ID AND EVENT_DATE != TMP.FIRST_LOGIN) AS SECOND_LOGIN FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) TMP)TMP2 GROUP BY FIRST_LOGIN"
32,Y,N,"SELECT INSTALL_DT, COUNT(INSTALLTBL2.PLAYER_ID) AS INSTALLS, ROUND(COUNT(ACTIVITY.PLAYER_ID)/COUNT(INSTALLTBL2.PLAYER_ID),2) AS DAY1_RETENTION FROM ( ( SELECT INSTALL_DT, DATE_ADD(INSTALL_DT,INTERVAL 1 DAY) AS RETENTION_DT, PLAYER_ID FROM (SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) INSTALLTBL ) INSTALLTBL2 LEFT JOIN ACTIVITY ON INSTALLTBL2.RETENTION_DT = ACTIVITY.EVENT_DATE AND INSTALLTBL2.PLAYER_ID = ACTIVITY.PLAYER_ID ) GROUP BY INSTALL_DT"
33,Y,Y,"WITH ACTIVITY AS ( SELECT T1.PLAYER_ID, T1.EVENT_DATE, IF(T2.EVENT_DATE IS NULL, 0, 1) AS D1R FROM ACTIVITY T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T2.EVENT_DATE - T1.EVENT_DATE = 1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND( SUM(D1R)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, D1R FROM ACTIVITY )T WHERE RNK = 1 GROUP BY EVENT_DATE"
34,Y,N,"WITH C AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(DISTINCT C.PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT C.PLAYER_ID), 2) DAY1_RETENTION FROM C JOIN ACTIVITY A ON C.PLAYER_ID = A.PLAYER_ID GROUP BY INSTALL_DT"
35,Y,N,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS GAMESRANK, LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY ) SELECT INSTALLS.INSTALL_DT,INSTALLS, IF(DAY1_RETENTION IS NULL, 0.00 , ROUND((DAY1_RETENTION/INSTALLS),2)) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE AS INSTALL_DT , COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM CTE WHERE GAMESRANK <2 GROUP BY EVENT_DATE ) AS INSTALLS LEFT JOIN ( SELECT EVENT_DATE AS INSTALL_DT , COUNT(DISTINCT PLAYER_ID) AS DAY1_RETENTION FROM CTE WHERE GAMESRANK <2 AND EVENT_DATE = SUBDATE(NEXT_LOGIN , INTERVAL 1 DAY) GROUP BY EVENT_DATE ) AS DAY1_RETENTION USING (INSTALL_DT)"
36,Y,N,"WITH CTE1 AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RANKING FROM ACTIVITY ) AS SUB WHERE RANKING = 1 GROUP BY EVENT_DATE ), CTE2 AS (SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS CNT_LOGGED_BACK_NEXT_DAY FROM ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS EVENT_DATE_LEAD, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RANKING FROM ACTIVITY ) AS SUB WHERE DATEDIFF(EVENT_DATE_LEAD,EVENT_DATE) = 1 AND RANKING = 1 GROUP BY EVENT_DATE ) SELECT D1.EVENT_DATE AS INSTALL_DT, D1.INSTALLS, ROUND(IFNULL(D2.CNT_LOGGED_BACK_NEXT_DAY,0)/D1.INSTALLS,2) AS DAY1_RETENTION FROM CTE1 AS D1 LEFT JOIN CTE2 AS D2 ON D1.EVENT_DATE = D2.EVENT_DATE"
37,Y,N,"WITH CTE1 AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) EVENT_DATE_LEAD1 FROM ACTIVITY ) SELECT * FROM ( SELECT EVENT_DATE AS INSTALL_DT, SUM(CASE WHEN RN = 1 THEN 1 ELSE 0 END) AS INSTALLS, ROUND(1.00*SUM(CASE WHEN RN = 1 AND DATEDIFF(EVENT_DATE_LEAD1,EVENT_DATE) = 1 THEN 1 ELSE 0 END)/SUM(CASE WHEN RN = 1 THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM CTE1 GROUP BY EVENT_DATE ) AS SUB WHERE INSTALLS != 0"
38,Y,N,"WITH FIRSTDAY AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT FIRSTDAY.INSTL_DATE AS INSTALL_DT, COUNT(1) AS INSTALLS, ROUND(COUNT(ACTIVITY.PLAYER_ID)/COUNT(1), 2) AS DAY1_RETENTION FROM FIRSTDAY LEFT JOIN ACTIVITY ON ACTIVITY.PLAYER_ID = FIRSTDAY.PLAYER_ID AND DATEDIFF(ACTIVITY.EVENT_DATE, FIRSTDAY.INSTL_DATE) = 1 GROUP BY FIRSTDAY.INSTL_DATE ORDER BY 1"
39,Y,N,"WITH I AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1 ), R AS ( SELECT EVENT_DATE, COUNT(*) AS RETENTION FROM ( SELECT A.* FROM I A, ACTIVITY B WHERE A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, B.EVENT_DATE) = -1 ) C GROUP BY 1 ) SELECT A.EVENT_DATE AS INSTALL_DT, A.CNT AS INSTALLS, ROUND(IFNULL(B.RETENTION, 0) / A.CNT, 2) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE, COUNT(*) AS CNT FROM I GROUP BY 1 ) A LEFT JOIN R B ON A.EVENT_DATE = B.EVENT_DATE"
40,Y,Y,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID), INSTALLS AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) INSTALLS FROM INSTALL_DATE GROUP BY EVENT_DATE), RETENTION AS (SELECT PLAYER_ID, EVENT_DATE FROM INSTALL_DATE WHERE (PLAYER_ID, EVENT_DATE+1) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY)) SELECT T1.EVENT_DATE INSTALL_DT, INSTALLS, ROUND(COUNT(T2.PLAYER_ID)/INSTALLS,2) DAY1_RETENTION FROM INSTALLS T1 LEFT JOIN RETENTION T2 ON T1.EVENT_DATE = T2.EVENT_DATE GROUP BY T1.EVENT_DATE"
41,Y,N,"WITH INSTALLDATE AS (SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), INTALLDATEANALYSIS AS (SELECT INSTALL_DT ,COUNT(PLAYER_ID) AS INSTALLS FROM INSTALLDATE GROUP BY INSTALL_DT), NEXTLOGIN AS (SELECT A.PLAYER_ID ,A.EVENT_DATE ,LEAD(EVENT_DATE,1) OVER(PARTITION BY A.PLAYER_ID ORDER BY A.EVENT_DATE ASC) AS NEXTLOGIN FROM ACTIVITY A), 1DAYRETENTIONCOUNTING AS (SELECT NL.PLAYER_ID ,ID.INSTALL_DT ,IF(ABS(DATEDIFF(NL.EVENT_DATE,NL.NEXTLOGIN)) = 1,1,0) AS RETENTION FROM NEXTLOGIN NL INNER JOIN INSTALLDATE ID ON ID.INSTALL_DT = NL.EVENT_DATE AND NL.PLAYER_ID = ID.PLAYER_ID), 1DAYRETENTIONSUMMARY AS (SELECT INSTALL_DT ,SUM(RETENTION) AS RETENTION FROM 1DAYRETENTIONCOUNTING GROUP BY INSTALL_DT) SELECT IAD.INSTALL_DT ,IAD.INSTALLS ,ROUND(1DRS.RETENTION/IAD.INSTALLS,2) AS DAY1_RETENTION FROM 1DAYRETENTIONSUMMARY 1DRS INNER JOIN INTALLDATEANALYSIS IAD ON IAD.INSTALL_DT = 1DRS.INSTALL_DT ORDER BY 1 ASC"
42,Y,Y,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT T1.INSTALL_DT, ROUND(COUNT(T1.PLAYER_ID),2) INSTALLS, ROUND(COUNT(T2.EVENT_DATE)/COUNT(INSTALL_DT),2) DAY1_RETENTION FROM INSTALL_DATE T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DT + 1 = T2.EVENT_DATE GROUP BY T1.INSTALL_DT ORDER BY T1.INSTALL_DT"
43,Y,N,"WITH INSTALL_DAY AS (SELECT MIN(EVENT_DATE) AS INSTALL_DATE, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) SELECT I.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT I.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DAY AS I LEFT JOIN ACTIVITY AS A ON DATEDIFF(I.INSTALL_DATE, A.EVENT_DATE) = -1 AND I.PLAYER_ID = A.PLAYER_ID GROUP BY I.INSTALL_DATE"
44,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(DISTINCT INSTALLS.PLAYER_ID) AS INSTALLS, ROUND( IFNULL(COUNT(ACTIVITY.PLAYER_ID) / COUNT(INSTALLS.PLAYER_ID), 0), 2) AS DAY1_RETENTION FROM INSTALLS LEFT JOIN ACTIVITY ON INSTALLS.PLAYER_ID = ACTIVITY.PLAYER_ID AND INSTALL_DT + INTERVAL 1 DAY = ACTIVITY.EVENT_DATE GROUP BY 1"
45,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(INSTALLS.PLAYER_ID) AS INSTALLS, ROUND( COUNT(ACTIVITY.PLAYER_ID) / COUNT(INSTALLS.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALLS LEFT JOIN ACTIVITY ON INSTALLS.PLAYER_ID = ACTIVITY.PLAYER_ID AND INSTALL_DT + INTERVAL 1 DAY = ACTIVITY.EVENT_DATE GROUP BY 1"
46,Y,N,"WITH PLAYERACTIVITYRANKING AS (SELECT PLAYER_ID ,EVENT_DATE ,RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK ,LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN FROM ACTIVITY ), PLAYER1DAYRETENTION AS (SELECT PLAYER_ID ,EVENT_DATE AS INSTALL_DT ,IF(DATEDIFF(NEXT_LOGIN,EVENT_DATE) = 1,1,0) AS RETENTIONFLAG FROM PLAYERACTIVITYRANKING WHERE RK = 1 ) SELECT INSTALL_DT ,COUNT(PLAYER_ID) AS INSTALLS ,ROUND(SUM(RETENTIONFLAG)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM PLAYER1DAYRETENTION GROUP BY INSTALL_DT ORDER BY 1 ASC"
47,Y,Y,"WITH T1 AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE = INSTALL_DT + 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T1 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
48,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(B.EVENT_DATE) / COUNT(A.INSTALL_DT), 2) AS DAY1_RETENTION FROM TEMP A LEFT JOIN ACTIVITY B ON A.INSTALL_DT = DATE_ADD(B.EVENT_DATE, INTERVAL - 1 DAY) AND A.PLAYER_ID = B.PLAYER_ID GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
49,Y,N,"WITH A AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LAG1_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK FROM ACTIVITY), B AS ( SELECT * FROM A WHERE RK = 1), C AS ( SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, SUM(CASE WHEN DATEDIFF(LAG1_DATE, EVENT_DATE) = 1 THEN 1 ELSE 0 END) AS CT FROM B GROUP BY EVENT_DATE) SELECT INSTALL_DT, INSTALLS, ROUND(CT/INSTALLS, 2) AS DAY1_RETENTION FROM C"
50,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) DAY1_RETENTION FROM CTE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT +1 = B.EVENT_DATE GROUP BY A.INSTALL_DT"
51,Y,Y,"WITH CTE AS (SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT + 1 = A2.EVENT_DATE ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(RETENTION)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY 1 ORDER BY 1"
52,Y,Y,"WITH CTE AS (SELECT T2.INSTALL_DT, COUNT(1) AS DAY2LOG FROM ( SELECT A.PLAYER_ID, A.EVENT_DATE, A.GAMES_PLAYED, T1.INSTALL_DT FROM ACTIVITY A JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 ON T1.PLAYER_ID = A.PLAYER_ID WHERE A.EVENT_DATE = (T1.INSTALL_DT + 1)) T2 GROUP BY T2.INSTALL_DT), CTE2 AS (SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 GROUP BY T1.INSTALL_DT), CTE3 AS (SELECT T3.INSTALL_DT, T3.INSTALLS, ROUND(CTE.DAY2LOG / T3.INSTALLS, 2) AS DAY2_RENTENTION FROM (SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 GROUP BY T1.INSTALL_DT) T3 JOIN CTE ON CTE.INSTALL_DT = T3.INSTALL_DT) SELECT CTE2.INSTALL_DT, CTE2.INSTALLS, IFNULL(CTE3.DAY2_RENTENTION, 0) AS DAY1_RETENTION FROM CTE2 LEFT JOIN CTE3 ON CTE2.INSTALL_DT = CTE3.INSTALL_DT"
53,Y,N,"WITH CTE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), CTE2 AS ( SELECT A2.PLAYER_ID, A2.INSTALL_DT FROM ACTIVITY A1 JOIN CTE A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.EVENT_DATE = DATE_ADD(A2.INSTALL_DT, INTERVAL 1 DAY) ) SELECT C1.INSTALL_DT, COUNT(C1.INSTALL_DT) AS INSTALLS, ROUND(SUM(CASE WHEN C2.INSTALL_DT IS NULL THEN 0 ELSE 1 END) / COUNT(C1.INSTALL_DT), 2) AS DAY1_RETENTION FROM CTE C1 LEFT JOIN CTE2 C2 ON C1.INSTALL_DT = C2.INSTALL_DT AND C1.PLAYER_ID = C2.PLAYER_ID GROUP BY C1.INSTALL_DT"
54,Y,Y,"WITH CTE1 AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS PREV_DAY, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANK_INDEX FROM ACTIVITY ), CTE2 AS ( SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS DR FROM CTE1 WHERE RANK_INDEX = 1 AND (PREV_DAY-EVENT_DATE) = 1 GROUP BY EVENT_DATE ) SELECT TMP.EVENT_DATE AS INSTALL_DT, INSTALLS, IF(DR IS NULL, 0.00, ROUND(DR/INSTALLS, 2)) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM CTE1 WHERE RANK_INDEX = 1 GROUP BY EVENT_DATE ) TMP LEFT JOIN CTE2 ON TMP.EVENT_DATE = CTE2.EVENT_DATE"
55,Y,Y,"WITH DAY0_TABLE AS (SELECT B.FIRST_LOGIN AS INSTALL_DATE, COUNT(B.PLAYER_ID) AS DAY0_NUM FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) B GROUP BY B.FIRST_LOGIN), DAY1_TABLE AS (SELECT T.FIRST_LOGIN AS INSTALL_DATE, COALESCE(COUNT(DISTINCT A.PLAYER_ID),0) AS DAY1_NUM FROM ACTIVITY A RIGHT JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) T ON A.PLAYER_ID =T.PLAYER_ID AND A.EVENT_DATE = T.FIRST_LOGIN + 1 GROUP BY T.FIRST_LOGIN) SELECT DAY0_TABLE.INSTALL_DATE AS INSTALL_DT, DAY0_TABLE.DAY0_NUM AS INSTALLS, ROUND(DAY1_TABLE.DAY1_NUM/DAY0_TABLE.DAY0_NUM, 2) AS DAY1_RETENTION FROM DAY0_TABLE JOIN DAY1_TABLE ON DAY0_TABLE.INSTALL_DATE = DAY1_TABLE.INSTALL_DATE GROUP BY DAY0_TABLE.INSTALL_DATE"
56,Y,N,"WITH FIRST_LOGIN AS (SELECT A.PLAYER_ID, A.EVENT_DATE AS FIRST_LOGIN, B.EVENT_DATE AS LOGBACK FROM ACTIVITY A LEFT JOIN ACTIVITY B ON B.EVENT_DATE = DATE_ADD(A.EVENT_DATE, INTERVAL 1 DAY) AND A.PLAYER_ID = B.PLAYER_ID WHERE (A.PLAYER_ID,A.EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY 1)) SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN LOGBACK IS NOT NULL THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM FIRST_LOGIN GROUP BY 1"
57,Y,N,"WITH FIRST_LOGIN AS (SELECT EVENT_DATE, PLAYER_ID FROM (SELECT EVENT_DATE,PLAYER_ID, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) A WHERE A.RNK = 1) , ONE_PLUS_DAYS AS (SELECT F.PLAYER_ID,F.EVENT_DATE AS FIRST_DATE, A.EVENT_DATE AS SECOND_DATE FROM FIRST_LOGIN F LEFT JOIN ACTIVITY A ON F.PLAYER_ID = A.PLAYER_ID AND F.EVENT_DATE = DATE_ADD(A.EVENT_DATE, INTERVAL -1 DAY)) , CASES AS (SELECT FIRST_DATE,SECOND_DATE, CASE WHEN SECOND_DATE IS NOT NULL THEN 1 ELSE 0 END AS CNT1 FROM ONE_PLUS_DAYS) SELECT FIRST_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CNT1) /COUNT(*),2) AS DAY1_RETENTION FROM CASES GROUP BY FIRST_DATE"
58,Y,N,"WITH FIST_LOG AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1) SELECT SDATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN NDATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM (SELECT F.PLAYER_ID, F.EVENT_DATE AS SDATE, A.EVENT_DATE AS NDATE FROM FIST_LOG F LEFT JOIN ACTIVITY A ON F.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(F.EVENT_DATE, A.EVENT_DATE)=-1) T2 GROUP BY SDATE ORDER BY SDATE"
59,Y,N,"WITH INDIV_INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1), NEXT_LOGIN AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY), RETAINED_PEOPLE AS ( SELECT PLAYER_ID, EVENT_DATE FROM NEXT_LOGIN WHERE NEXT_LOGIN - INTERVAL 1 DAY = EVENT_DATE AND (PLAYER_ID, EVENT_DATE) IN (SELECT * FROM INDIV_INSTALL)), RETAINED AS ( SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS RETAINED_1DAY FROM RETAINED_PEOPLE GROUP BY 1), INSTALLED AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM INDIV_INSTALL GROUP BY 1) SELECT I.INSTALL_DATE AS INSTALL_DT, I.INSTALLS, ROUND(IFNULL(R.RETAINED_1DAY, 0)/I.INSTALLS,2) AS DAY1_RETENTION FROM INSTALLED I LEFT JOIN RETAINED R ON I.INSTALL_DATE=R.EVENT_DATE"
60,Y,Y,"WITH INDIV_INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1), RETAINED_PEOPLE AS ( SELECT I.PLAYER_ID,I.INSTALL_DATE FROM INDIV_INSTALL I JOIN ACTIVITY A ON I.PLAYER_ID=A.PLAYER_ID AND I.INSTALL_DATE=A.EVENT_DATE-1), RETAINED_CT AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) RETAINED_1DAY FROM RETAINED_PEOPLE GROUP BY 1), INSTALLED AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) INSTALLS FROM INDIV_INSTALL GROUP BY 1) SELECT I.INSTALL_DATE INSTALL_DT, I.INSTALLS, ROUND(IFNULL(R.RETAINED_1DAY,0)/I.INSTALLS,2) DAY1_RETENTION FROM INSTALLED I LEFT JOIN RETAINED_CT R ON I.INSTALL_DATE=R.INSTALL_DATE"
61,Y,Y,"WITH INSTALLTABLE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT I.INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(SUM(A.PLAYER_ID IS NOT NULL)/COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALLTABLE I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.INSTALL_DT + 1 = A.EVENT_DATE GROUP BY I.INSTALL_DT"
62,Y,N,"WITH INSTALL_CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/ COUNT(*),2) AS DAY1_RETENTION FROM INSTALL_CTE I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT)=1 GROUP BY INSTALL_DT"
63,Y,N,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT INSTALL_DT, COUNT(DISTINCT INSTALL_DATE.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT ACTIVITY.PLAYER_ID) / COUNT(DISTINCT INSTALL_DATE.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE LEFT JOIN ACTIVITY ON DATE_ADD(INSTALL_DATE.INSTALL_DT, INTERVAL 1 DAY) = ACTIVITY.EVENT_DATE AND INSTALL_DATE.PLAYER_ID = ACTIVITY.PLAYER_ID GROUP BY 1 ORDER BY 1"
64,Y,N,"WITH INSTALL_DATE_DF AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DATE AS INSTALL_DT, COUNT(I.INSTALL_DATE) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE) / COUNT(I.INSTALL_DATE),2) AS DAY1_RETENTION FROM INSTALL_DATE_DF I LEFT JOIN ACTIVITY A ON A.EVENT_DATE = DATE_ADD(I.INSTALL_DATE, INTERVAL 1 DAY) AND I.PLAYER_ID = A.PLAYER_ID GROUP BY I.INSTALL_DATE"
65,Y,N,"WITH INSTALL_DATE_DF AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), RETAIN_DATES AS ( SELECT I.PLAYER_ID, I.INSTALL_DATE, A.EVENT_DATE AS RETAINED_DATE FROM INSTALL_DATE_DF I LEFT JOIN ACTIVITY A ON A.EVENT_DATE = DATE_ADD(I.INSTALL_DATE, INTERVAL 1 DAY) AND I.PLAYER_ID = A.PLAYER_ID ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(INSTALL_DATE) AS INSTALLS, ROUND(COUNT(RETAINED_DATE) / COUNT(INSTALL_DATE),2) AS DAY1_RETENTION FROM RETAIN_DATES GROUP BY INSTALL_DATE"
66,Y,N,"WITH INSTALL_DATE_RECORD AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) INSTALL_DATE FROM ACTIVITY AS A GROUP BY PLAYER_ID) SELECT IDR.INSTALL_DATE AS INSTALL_DT, COUNT(IDR.PLAYER_ID) AS INSTALLS , ROUND(SUM(CASE WHEN A.EVENT_DATE IS NULL THEN 0 ELSE 1 END)/COUNT(IDR.PLAYER_ID),2) DAY1_RETENTION FROM INSTALL_DATE_RECORD AS IDR LEFT JOIN ACTIVITY AS A ON IDR.INSTALL_DATE = DATE_SUB(A.EVENT_DATE,INTERVAL 1 DAY) AND A.PLAYER_ID = IDR.PLAYER_ID GROUP BY INSTALL_DT"
67,Y,N,"WITH INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), ACTIVITY_GROUPED AS ( SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY GROUP BY 1,2 ) SELECT INSTALL_DT, COUNT(*) INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(*),2) DAY1_RETENTION FROM INSTALL_DATES I LEFT JOIN ACTIVITY_GROUPED A ON I.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT) = 1 GROUP BY I.INSTALL_DT"
68,Y,N,"WITH INSTALL_DT AS ( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID ) , INSTALL_NUM AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM INSTALL_DT GROUP BY INSTALL_DT ) , RETENTION_NUM AS ( SELECT COUNT(DISTINCT A.PLAYER_ID) AS RETENTION_NUM, I.INSTALL_DT AS INSTALL_DT FROM INSTALL_DT I LEFT JOIN ACTIVITY A ON DATEDIFF(I.INSTALL_DT, A.EVENT_DATE) = - 1 AND I.PLAYER_ID = A.PLAYER_ID GROUP BY I.INSTALL_DT ) SELECT I.INSTALL_DT AS INSTALL_DT, I.INSTALLS AS INSTALLS, ROUND(IFNULL(R.RETENTION_NUM, 0) / I.INSTALLS, 2) AS DAY1_RETENTION FROM INSTALL_NUM I LEFT JOIN RETENTION_NUM R ON I.INSTALL_DT = R.INSTALL_DT"
69,Y,N,"WITH INSTALL_TBL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE, DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS RETENTION_DATE_DEF FROM ACTIVITY GROUP BY 1 ) SELECT A.INSTALL_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(B.EVENT_DATE)/COUNT(*),2) AS DAY1_RETENTION FROM INSTALL_TBL A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.RETENTION_DATE_DEF = B.EVENT_DATE GROUP BY 1"
70,Y,N,"WITH INSTALLS AS ( SELECT * FROM ( SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN FROM ACTIVITY ) A WHERE RN = 1 ) ,INSTALL_CNT AS ( SELECT EVENT_DATE, COUNT(1) FROM INSTALLS GROUP BY 1) SELECT I.EVENT_DATE AS INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COALESCE(SUM((A.PLAYER_ID IS NOT NULL))/ COUNT(I.PLAYER_ID) ,0),2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON ( I.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.EVENT_DATE) = 1) GROUP BY 1"
71,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DATE AS INSTALL_DT, COUNT(INSTALL_DATE) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(I.INSTALL_DATE),2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.INSTALL_DATE = DATE_ADD(A.EVENT_DATE, INTERVAL -1 DAY) AND I.PLAYER_ID = A.PLAYER_ID GROUP BY 1 ORDER BY 1"
72,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(I.INSTALL_DT),2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.INSTALL_DT = DATE_ADD(A.EVENT_DATE, INTERVAL -1 DAY) AND I.PLAYER_ID = A.PLAYER_ID GROUP BY 1"
73,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE) / COUNT(I.INSTALL_DT), 2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.INSTALL_DT = DATE_ADD(A.EVENT_DATE, INTERVAL - 1 DAY) AND I.PLAYER_ID = A.PLAYER_ID GROUP BY 1 ORDER BY 1"
74,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(I.INSTALL_DT),2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.INSTALL_DT = DATE_ADD(A.EVENT_DATE, INTERVAL -1 DAY) AND I.PLAYER_ID = A.PLAYER_ID GROUP BY 1"
75,Y,N,"WITH INSTALLS_A AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS , ROUND(COUNT(DISTINCT B.PLAYER_ID)/ COUNT(DISTINCT A.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALLS_A A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DT,INTERVAL 1 DAY) GROUP BY A.INSTALL_DT"
76,Y,N,"WITH MAIN AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(MAIN.PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(MAIN.PLAYER_ID),2) AS DAY1_RETENTION FROM MAIN LEFT JOIN ACTIVITY ON MAIN.PLAYER_ID = ACTIVITY.PLAYER_ID AND DATEDIFF(ACTIVITY.EVENT_DATE,MAIN.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
77,Y,N,"WITH PLAYER_LOGIN AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID) / COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM PLAYER_LOGIN A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DT, INTERVAL 1 DAY) GROUP BY 1"
78,Y,N,"WITH RANKING AS (SELECT PLAYER_ID, DEVICE_ID, EVENT_DATE, GAMES_PLAYED, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NUMBER FROM ACTIVITY), INSTALL_TABLE AS (SELECT EVENT_DATE, COUNT(*) AS INST FROM RANKING WHERE NUMBER = 1 GROUP BY EVENT_DATE ), TAB_DAY1 AS (SELECT PLAYER_ID, EVENT_DATE, INSTALLS, NEXTS, NEXTS = EVENT_DATE AS 1_DAY FROM (SELECT PLAYER_ID, EVENT_DATE, LAG(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALLS, DATE_ADD(LAG(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), INTERVAL 1 DAY) AS NEXTS, NUMBER FROM RANKING) TAB1 WHERE NUMBER = 2), TAB_DAY1_GROUP AS (SELECT INSTALLS, COUNT(*) AS DAY1 FROM TAB_DAY1 WHERE 1_DAY = 1 GROUP BY INSTALLS) SELECT EVENT_DATE AS INSTALL_DT, INST AS INSTALLS, ROUND((COALESCE(DAY1,0)*1.) / (INST),2) AS DAY1_RETENTION FROM INSTALL_TABLE LEFT JOIN TAB_DAY1_GROUP ON EVENT_DATE = INSTALLS"
79,Y,N,"WITH RES AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER( PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS RNK, LEAD(EVENT_DATE,1) OVER( PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND( SUM( CASE WHEN NEXT_DATE = DATE_ADD(EVENT_DATE,INTERVAL 1 DAY) THEN 1 ELSE 0 END ) / COUNT(PLAYER_ID), 2 ) AS DAY1_RETENTION FROM RES WHERE RNK = 1 GROUP BY 1"
80,Y,Y,"WITH RETENTION AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) OVER( PARTITION BY EVENT_DATE) AS NUM_RETAINED FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT A1.PLAYER_ID, A1.EVENT_DATE FROM ACTIVITY AS A1, ACTIVITY AS A2 WHERE A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.EVENT_DATE + 1 AND (A1.PLAYER_ID, A1.EVENT_DATE )IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY 1)) ) , INSTALLATION AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) OVER( PARTITION BY EVENT_DATE) AS NUM_INSTALLED FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID )) SELECT DISTINCT I.EVENT_DATE AS INSTALL_DT, I.NUM_INSTALLED AS INSTALLS, COALESCE(ROUND(R.NUM_RETAINED/I.NUM_INSTALLED, 2), 0) AS DAY1_RETENTION FROM INSTALLATION AS I LEFT JOIN RETENTION AS R ON I.EVENT_DATE = R.EVENT_DATE"
81,Y,Y,"WITH SORTING AS ( SELECT *, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) DAY_NUM, (LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) - EVENT_DATE) NEXT_LOGIN_GAP FROM ACTIVITY ), COMING_BACK AS ( SELECT EVENT_DATE, COUNT(*) RETURNED FROM SORTING WHERE DAY_NUM = 1 AND NEXT_LOGIN_GAP = 1 GROUP BY 1 ) SELECT S.EVENT_DATE AS INSTALL_DT, COUNT(*) INSTALLS, ROUND(COALESCE(C.RETURNED / COUNT(*), 0), 2) DAY1_RETENTION FROM SORTING S LEFT JOIN COMING_BACK C ON S.EVENT_DATE = C.EVENT_DATE WHERE S.DAY_NUM = 1 GROUP BY 1 ORDER BY 1"
82,Y,N,"WITH T AS ( SELECT *, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RK, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) NEXTD FROM ACTIVITY ) SELECT EVENT_DATE INSTALL_DT, COUNT(*) INSTALLS, ROUND(COUNT(IF(EVENT_DATE=NEXTD-INTERVAL 1 DAY, PLAYER_ID, NULL)) / COUNT(*),2) DAY1_RETENTION FROM T WHERE RK=1 GROUP BY EVENT_DATE"
83,Y,N,"WITH T AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), T1 AS ( SELECT PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) AS EVENT_DATE FROM T ), INS_CNT AS ( SELECT INSTALL_DT, COUNT(*) AS INSTALLS FROM T GROUP BY INSTALL_DT ), RET_CNT AS ( SELECT DATE_SUB(EVENT_DATE, INTERVAL 1 DAY) AS INSTALL_DT, COUNT(*) AS CNT FROM T1 WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) GROUP BY EVENT_DATE ) SELECT I.INSTALL_DT, INSTALLS, ROUND(COALESCE(CNT / INSTALLS, 0), 2) AS DAY1_RETENTION FROM INS_CNT I LEFT JOIN RET_CNT R ON I.INSTALL_DT = R.INSTALL_DT"
84,Y,N,"WITH T AS (SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RN, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) NEXTDAY FROM ACTIVITY) SELECT T.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(IFNULL(BACK,0)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T LEFT JOIN ( SELECT T.EVENT_DATE, COUNT(*) AS BACK FROM T WHERE RN = 1 AND DATEDIFF(NEXTDAY,EVENT_DATE) = 1 GROUP BY EVENT_DATE) T1 ON T.EVENT_DATE = T1.EVENT_DATE WHERE RN = 1 GROUP BY T.EVENT_DATE"
85,Y,N,"WITH T AS (SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) R FROM ACTIVITY), N AS (SELECT T1.PLAYER_ID PID1, T1.EVENT_DATE D1, T1.R, T2.PLAYER_ID PID2, T2.EVENT_DATE D2, CASE WHEN T2.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END AS STAY FROM T T1 LEFT JOIN T T2 ON DATE_ADD(T1.EVENT_DATE, INTERVAL 1 DAY) = T2.EVENT_DATE AND T1.PLAYER_ID = T2.PLAYER_ID WHERE T1.R = 1) SELECT DISTINCT D1 INSTALL_DT, SUM(R) INSTALLS, ROUND(SUM(STAY)/SUM(R),2) DAY1_RETENTION FROM N GROUP BY D1"
86,Y,N,"WITH T(PLAYER_ID,MINLOGINDATE) AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT T.MINLOGINDATE INSTALL_DT ,COUNT(T.PLAYER_ID) INSTALLS ,ROUND(SUM(CASE WHEN A.PLAYER_ID IS NOT NULL THEN 1.00 ELSE 0.00 END)/ COUNT(T.PLAYER_ID),2) DAY1_RETENTION FROM T LEFT JOIN ACTIVITY A ON T.PLAYER_ID=A.PLAYER_ID AND T.MINLOGINDATE=DATE_ADD(A.EVENT_DATE,INTERVAL -1 DAY) GROUP BY T.MINLOGINDATE"
87,Y,N,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT T1.INSTALL_DATE INSTALL_DT, COUNT(*) INSTALLS, ROUND((COUNT(A.EVENT_DATE)/COUNT(*)),2) DAY1_RETENTION FROM T1 LEFT JOIN ACTIVITY A ON DATE_ADD(T1.INSTALL_DATE, INTERVAL 1 DAY) = A.EVENT_DATE AND T1.PLAYER_ID = A.PLAYER_ID GROUP BY T1.INSTALL_DATE"
88,Y,N,"WITH TEMP1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID) ,TEMP2 AS( SELECT FIRST_LOGIN AS INSTALL_DT , COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM TEMP1 GROUP BY FIRST_LOGIN ) , TEMP3 AS( SELECT B.FIRST_LOGIN, A.PLAYER_ID FROM ACTIVITY A JOIN TEMP1 B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(A.EVENT_DATE,B.FIRST_LOGIN) =1 ) , TEMP4 AS ( SELECT FIRST_LOGIN, COUNT(DISTINCT PLAYER_ID) AS NEXT_DAY FROM TEMP3 GROUP BY FIRST_LOGIN ) SELECT B.INSTALL_DT , B.INSTALLS , ROUND(COALESCE((C.NEXT_DAY/B.INSTALLS),0),2) AS DAY1_RETENTION FROM TEMP2 B LEFT JOIN TEMP4 C ON B.INSTALL_DT = C.FIRST_LOGIN ORDER BY INSTALL_DT"
89,Y,N,"WITH TMP AS (SELECT PLAYER_ID,MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) SELECT * FROM( SELECT EVENT_DATE INSTALL_DT ,SUM(CASE WHEN (PLAYER_ID,EVENT_DATE) IN (SELECT * FROM TMP) THEN 1 ELSE 0 END) INSTALLS, IFNULL(ROUND( SUM(CASE WHEN (PLAYER_ID,EVENT_DATE) IN (SELECT * FROM TMP) AND (PLAYER_ID,EVENT_DATE) IN (SELECT PLAYER_ID, DATE_ADD(EVENT_DATE,INTERVAL -1 DAY) FROM ACTIVITY ) THEN 1 ELSE 0 END)*1.0/ SUM(CASE WHEN (PLAYER_ID,EVENT_DATE) IN (SELECT * FROM TMP) THEN 1 ELSE 0 END) ,2),0) DAY1_RETENTION FROM ACTIVITY GROUP BY EVENT_DATE)T WHERE T.INSTALLS!=0"
90,Y,N,"WITH WA AS (SELECT X.PLAYER_ID ,MIN(X.EVENT_DATE) AS INSTALL_DT FROM ACTIVITY X GROUP BY 1 ) ,WB AS (SELECT X.* ,Y.INSTALL_DT ,CASE WHEN DATEDIFF(X.EVENT_DATE,Y.INSTALL_DT)=1 THEN TRUE ELSE FALSE END AS RETENTION_FLG FROM ACTIVITY X LEFT OUTER JOIN WA Y ON X.PLAYER_ID=Y.PLAYER_ID ) SELECT X.INSTALL_DT ,COUNT(DISTINCT X.PLAYER_ID) AS INSTALLS ,ROUND(COUNT(DISTINCT CASE WHEN X.RETENTION_FLG=TRUE THEN X.PLAYER_ID END)/ COUNT(DISTINCT X.PLAYER_ID),2) AS DAY1_RETENTION FROM WB X GROUP BY 1 ORDER BY 1"
91,Y,Y,"WITH DAY1 AS ( SELECT * FROM ( SELECT * ,ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROWORDERED ,LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) -1 AS COMDATE FROM ACTIVITY ) ORDERED WHERE ROWORDERED = 1 ), DAY1R AS ( SELECT EVENT_DATE,COUNT(PLAYER_ID) R FROM DAY1 WHERE EVENT_DATE = COMDATE GROUP BY EVENT_DATE), DAY1A AS ( SELECT EVENT_DATE,COUNT(PLAYER_ID) A FROM DAY1 GROUP BY EVENT_DATE) SELECT DAY1A.EVENT_DATE AS INSTALL_DT , A AS INSTALLS , ROUND(CASE WHEN R/A IS NULL THEN 0 ELSE R/A END,2) AS DAY1_RETENTION FROM DAY1A LEFT OUTER JOIN DAY1R ON DAY1A.EVENT_DATE = DAY1R.EVENT_DATE ORDER BY DAY1A.EVENT_DATE"
92,Y,N,"WITH RETENTION AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_NUM, LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, CASE WHEN DATEDIFF (LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE) = 1 THEN 1 ELSE 0 END AS DAY1RETENTION FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(DAY1RETENTION) / COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM RETENTION WHERE ROW_NUM = 1 GROUP BY EVENT_DATE"
93,Y,Y,"WITH CTE AS ( SELECT INSTALL_DT, COUNT(T.PLAYER_ID) INSTALLS, IFNULL(COUNT(V.EVENT_DATE),0) RETS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) T LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY ) V ON T.PLAYER_ID = V.PLAYER_ID AND INSTALL_DT = V.EVENT_DATE -1 GROUP BY INSTALL_DT) SELECT INSTALL_DT, INSTALLS, ROUND((RETS/INSTALLS),2) DAY1_RETENTION FROM CTE"
94,Y,N,"WITH NEXTT AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXTDAY FROM ACTIVITY ), MINDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_DATE FROM NEXTT GROUP BY 1 ), MINANDNEXT AS ( SELECT MINDATE.PLAYER_ID,MINDATE.FIRST_DATE, NEXTT.NEXTDAY FROM MINDATE LEFT JOIN NEXTT ON MINDATE.PLAYER_ID = NEXTT.PLAYER_ID AND MINDATE.FIRST_DATE = NEXTT.EVENT_DATE ) SELECT FIRST_DATE AS INSTALL_DT, COUNT(DISTINCT(PLAYER_ID)) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXTDAY,FIRST_DATE) = 1 THEN 1 ELSE 0 END)/COUNT(CASE WHEN DATEDIFF(NEXTDAY,FIRST_DATE) = 1 THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM MINANDNEXT GROUP BY 1"
95,Y,Y,"SELECT TBL.INSTALL_DT, COUNT(TBL.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(TBL.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) TBL LEFT JOIN ACTIVITY A ON TBL.PLAYER_ID = A.PLAYER_ID AND TBL.INSTALL_DT = A.EVENT_DATE -1 GROUP BY 1"
96,Y,N,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1) AS A LEFT JOIN ACTIVITY AS B ON DATEDIFF(B.EVENT_DATE,A.EVENT_DATE)=1 AND A.PLAYER_ID=B.PLAYER_ID GROUP BY 1"
97,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS,ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID,MIN(EVENT_DATE)AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID)A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.EVENT_DATE+1=B.EVENT_DATE GROUP BY A.EVENT_DATE"
98,Y,N,"SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(SUM(CASE WHEN B.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END) / COUNT(DISTINCT A.PLAYER_ID) ,0) ,2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DT, INTERVAL 1 DAY) GROUP BY 1 ORDER BY 1"
99,Y,N,"SELECT A1.EVENT_DATE INSTALL_DT ,COUNT(A1.PLAYER_ID) INSTALLS , ROUND(SUM(CASE WHEN A2.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END)/COUNT(A1.PLAYER_ID),2) DAY1_RETENTION FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID=A2.PLAYER_ID AND DATEDIFF(A2.EVENT_DATE,A1.EVENT_DATE)=1 WHERE (A1.PLAYER_ID,A1.EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY A1.EVENT_DATE ORDER BY A1.EVENT_DATE"
100,Y,Y,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.EVENT_DATE +1 GROUP BY 1"
101,Y,Y,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID)AS INSTALLS, ROUND(SUM(CASE WHEN A2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID,MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID=A2.PLAYER_ID AND A1.EVENT_DATE=A2.EVENT_DATE-1 GROUP BY INSTALL_DT"
102,Y,N,"SELECT A1.MINDATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A2.PLAYER_ID) /COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS MINDATE FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON DATEDIFF( A2.EVENT_DATE, A1.MINDATE) = 1 AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY A1.MINDATE"
103,Y,N,"SELECT A1.MINDATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A2.PLAYER_ID) /COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS MINDATE FROM ACTIVITY) A1 LEFT JOIN ACTIVITY A2 ON DATEDIFF( A2.EVENT_DATE, A1.MINDATE) = 1 AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY A1.MINDATE"
104,Y,N,"SELECT DATE_SUB(A3.EVENT_DATE, INTERVAL 1 DAY) AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(DEVICE_ID)/COUNT(*),2) AS DAY1_RETENTION FROM ACTIVITY A2 RIGHT JOIN (SELECT A1.PLAYER_ID, DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS EVENT_DATE FROM ACTIVITY A1 GROUP BY A1.PLAYER_ID) A3 ON A2.PLAYER_ID= A3.PLAYER_ID AND A2.EVENT_DATE= A3.EVENT_DATE GROUP BY A3.EVENT_DATE"
105,Y,Y,"SELECT DT INSTALL_DT, COUNT(PLAYER_ID) INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID),2) DAY1_RETENTION FROM (SELECT T1.PLAYER_ID, DT, T2.EVENT_DATE NEXT_DAY FROM ( (SELECT *, MIN(EVENT_DATE) DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.DT = T2.EVENT_DATE - 1)) TEMP GROUP BY 1"
106,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(LEAD_DATE,EVENT_DATE)=1 THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS N_ROW, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS LEAD_DATE FROM ACTIVITY GROUP BY 1,2) A WHERE N_ROW=1 GROUP BY 1"
107,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN (DATE_ADD(EVENT_DATE, INTERVAL 1 DAY),A.PLAYER_ID) IN (SELECT EVENT_DATE, PLAYER_ID FROM ACTIVITY) THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A WHERE (A.PLAYER_ID,A.EVENT_DATE) IN (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY EVENT_DATE"
108,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(IF((PLAYER_ID,EVENT_DATE+1) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY), 1, 0))/COUNT(*),2) AS DAY1_RETENTION FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY EVENT_DATE ORDER BY EVENT_DATE"
109,Y,Y,"SELECT FIRST_LOG_PER_PLAYER.EVENT_DATE AS INSTALL_DT, COUNT(FIRST_LOG_PER_PLAYER.PLAYER_ID) AS INSTALLS , ROUND(COUNT(ACTIVITY.PLAYER_ID)/COUNT(FIRST_LOG_PER_PLAYER.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) FIRST_LOG_PER_PLAYER LEFT JOIN ACTIVITY ON FIRST_LOG_PER_PLAYER.PLAYER_ID=ACTIVITY.PLAYER_ID AND FIRST_LOG_PER_PLAYER.EVENT_DATE+1=ACTIVITY.EVENT_DATE GROUP BY FIRST_LOG_PER_PLAYER.EVENT_DATE"
110,Y,Y,"SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(NEXT_DAY_LOGIN)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT A.PLAYER_ID, A.INSTALL_DATE, IFNULL(B.NEXT_DAY_LOGIN,0) AS NEXT_DAY_LOGIN FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE, DATE_FORMAT(MIN(EVENT_DATE)+1,'%Y-%M-%D') AS NEXT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE, 1 AS NEXT_DAY_LOGIN FROM ACTIVITY ) AS B ON A.PLAYER_ID = B.PLAYER_ID AND A.NEXT_DATE = B.EVENT_DATE) AS C GROUP BY INSTALL_DATE"
111,Y,Y,"SELECT INSTALL_DT , COUNT(PLAYER_ID) AS INSTALLS , ROUND(SUM(IF(NXT_DAY, 1, 0))/COUNT(PLAYER_ID), 2) DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NXT_DAY FROM( ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT=A2.EVENT_DATE-1 ) ) AS TEMP GROUP BY INSTALL_DT"
112,Y,N,"SELECT INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN (SELECT DISTINCT PLAYER_ID, EVENT_DATE FROM ACTIVITY) B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE, A.INSTALL_DT) = 1 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
113,Y,N,"SELECT INSTALL_DT, COUNT(B.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(SUM(RETENTION_IND)/COUNT(PLAYER_ID),0),2) AS DAY1_RETENTION FROM( SELECT A.PLAYER_ID, A.INSTALL_DT, CASE WHEN B.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END AS RETENTION_IND FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND DATE_ADD(A.INSTALL_DT,INTERVAL 1 DAY) = B.EVENT_DATE ) AS B GROUP BY 1"
114,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A1.PLAYER_ID)/COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY A1 ON A.PLAYER_ID = A1.PLAYER_ID AND A.INSTALL_DT = A1.EVENT_DATE - 1 GROUP BY INSTALL_DT"
115,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN B.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT A.PLAYER_ID) ,2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND DATE_ADD(A.INSTALL_DT, INTERVAL 1 DAY) = B.EVENT_DATE GROUP BY 1"
116,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(BACK)/SUM(INSTALLS),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT, CASE WHEN MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) = EVENT_DATE THEN 1 ELSE 0 END AS INSTALLS, CASE WHEN (MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID))+1 = EVENT_DATE THEN 1 ELSE 0 END AS BACK FROM ACTIVITY) T GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
117,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN (PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) T1 GROUP BY 1"
118,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID)AS INSTALL_DT FROM ACTIVITY) I GROUP BY INSTALL_DT"
119,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) INSTALLS, ROUND(SUM(DATEDIFF(EVENT_DATE, INSTALL_DT)=1)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM ( SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) INSTALL_DT FROM ACTIVITY ) T GROUP BY 1"
120,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) INSTALLS, ROUND(SUM(IF(INSTALL_DT+1=EVENT_DATE,1,0))/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) INSTALL_DT FROM ACTIVITY ) TMP GROUP BY INSTALL_DT"
121,Y,N,"SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(NEXT_DT) / COUNT(INSTALL_DT), 2) AS DAY1_RETENTION FROM ( SELECT T1.PLAYER_ID, T1.EVENT_DATE AS INSTALL_DT, T2.EVENT_DATE AS NEXT_DT FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) T1 LEFT JOIN ACTIVITY T2 ON T2.PLAYER_ID = T1.PLAYER_ID AND DATEDIFF(T2.EVENT_DATE, T1.EVENT_DATE) = 1 ) T GROUP BY INSTALL_DT ORDER BY INSTALL_DT ASC"
122,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT T.PLAYER_ID, T.INSTALL_DT, A.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS T LEFT JOIN ACTIVITY A ON A.PLAYER_ID = T.PLAYER_ID AND A.EVENT_DATE=INSTALL_DT+1) AS T2 GROUP BY INSTALL_DT"
123,Y,Y,"SELECT INSTALL_DT, INSTALLS, ROUND(SUM(CASE WHEN TEMP2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END) / INSTALLS, 2) AS DAY1_RETENTION FROM ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID ) AS INSTALLS FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID )TEMP GROUP BY INSTALL_DT )TEMP1 LEFT JOIN ( SELECT A.EVENT_DATE AS EVENT_DATE FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID )A JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE + 1 = B.EVENT_DATE )TEMP2 ON TEMP1.INSTALL_DT = TEMP2.EVENT_DATE GROUP BY INSTALL_DT, INSTALLS"
124,Y,N,"SELECT INSTALL_DT,COUNT(DISTINCT PLAYER_ID) AS INSTALLS, COALESCE(ROUND(COUNT(CASE WHEN DATE_ADD(INSTALL_DT,INTERVAL 1 DAY) = LDDT THEN PLAYER_ID END)/COUNT(DISTINCT PLAYER_ID),2),0) AS DAY1_RETENTION FROM (SELECT EVENT_DATE AS INSTALL_DT, PLAYER_ID, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LDDT FROM (SELECT DISTINCT PLAYER_ID, EVENT_DATE FROM ACTIVITY) AS T) AS T WHERE RN = 1 GROUP BY INSTALL_DT"
125,Y,N,"SELECT K.INSTALL_DT, COUNT(K.PLAYER_ID) AS INSTALLS, ROUND(SUM(A.PLAYER_ID IS NOT NULL)/COUNT(K.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT FROM ACTIVITY)K LEFT JOIN ACTIVITY A ON K.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE,K.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
126,Y,N,"SELECT T.INSTALL_DATE AS INSTALL_DT,COUNT(DISTINCT T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A.PLAYER_ID)/COUNT(DISTINCT T.PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A RIGHT JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1) T ON A.PLAYER_ID=T.PLAYER_ID AND A.EVENT_DATE=DATE_ADD(T.INSTALL_DATE,INTERVAL 1 DAY) GROUP BY 1"
127,Y,N,"SELECT T1.EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IF(T2.EVENT_DATE IS NULL, 0, 1)) / COUNT(*), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) T1 LEFT JOIN ACTIVITY T2 ON (T2.PLAYER_ID = T1.PLAYER_ID AND DATEDIFF(T2.EVENT_DATE, T1.EVENT_DATE) = 1) GROUP BY T1.EVENT_DATE"
128,Y,N,"SELECT T1.INSTALL_DATE AS INSTALL_DT, COUNT(T1.INSTALL_DATE) AS INSTALLS, ROUND(COUNT(T2.EVENT_DATE) / COUNT(*), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) T1 LEFT JOIN ACTIVITY T2 ON DATE_ADD(T1.INSTALL_DATE, INTERVAL 1 DAY) = T2.EVENT_DATE AND T1.PLAYER_ID = T2.PLAYER_ID GROUP BY 1 ORDER BY 1"
129,Y,Y,"SELECT T1.INSTALL_DT, COUNT(DISTINCT T1.PLAYER_ID) AS INSTALLS, ROUND(AVG(CASE WHEN A1.GAMES_PLAYED IS NOT NULL THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY A1 ON T1.PLAYER_ID = A1.PLAYER_ID AND T1.INSTALL_DT + 1 = A1.EVENT_DATE GROUP BY T1.INSTALL_DT"
130,Y,N,"SELECT T1.INSTALL_DT, COUNT(DISTINCT(T1.PLAYER_ID)) AS INSTALLS, ROUND(SUM(IF(T2.EVENT_DATE IS NOT NULL, 1, 0))/COUNT(DISTINCT(T1.PLAYER_ID)),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND DATEDIFF(T2.EVENT_DATE, T1. INSTALL_DT) = 1 GROUP BY T1.INSTALL_DT"
131,Y,N,"SELECT TEMP.INSTALL_DT, COUNT(DISTINCT TEMP.PLAYER_ID) AS INSTALLS , ROUND(COUNT(DISTINCT A.PLAYER_ID)/ COUNT(DISTINCT TEMP.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) TEMP LEFT JOIN ACTIVITY A ON TEMP.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE,TEMP.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
132,Y,N,"SELECT TEMP1.INSTALL_DT, TEMP1.INSTALLS AS INSTALLS, ROUND(TEMP2.RETENTION / TEMP1.INSTALLS, 2) AS DAY1_RETENTION FROM (SELECT T.INSTALL_DT, COUNT(DISTINCT T.PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS T GROUP BY T.INSTALL_DT) TEMP1 LEFT JOIN (SELECT T.INSTALL_DT, SUM(IF(A.PLAYER_ID IS NULL, 0, 1)) AS RETENTION FROM ACTIVITY A RIGHT JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS T ON A.PLAYER_ID = T.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, T.INSTALL_DT) = 1 GROUP BY T.INSTALL_DT) TEMP2 ON TEMP1.INSTALL_DT = TEMP2.INSTALL_DT"
133,Y,Y,"SELECT U.EVENT_DATE AS INSTALL_DT, SUM(U.RN) AS INSTALLS, ROUND(SUM(FLAG)/SUM(U.RN),2) AS DAY1_RETENTION FROM (SELECT *, (CASE WHEN T.LD=0 THEN 0 WHEN T.LD - T.EVENT_DATE =1 THEN 1 ELSE 0 END )AS FLAG FROM (SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LD, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN FROM ACTIVITY) T WHERE T.RN=1)U GROUP BY U.EVENT_DATE ORDER BY EVENT_DATE"
134,Y,N,"WITH DATE_CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), RETENTION_CTE AS ( SELECT A.PLAYER_ID FROM ACTIVITY AS A JOIN DATE_CTE AS D ON A.PLAYER_ID = D.PLAYER_ID AND A.EVENT_DATE = DATE_ADD(D.INSTALL_DT, INTERVAL 1 DAY) ) SELECT D.INSTALL_DT, COUNT(D.PLAYER_ID) AS INSTALLS, ROUND((1.0 * COUNT(R.PLAYER_ID)) / COUNT(D.PLAYER_ID), 2) AS DAY1_RETENTION FROM DATE_CTE AS D LEFT JOIN RETENTION_CTE AS R ON D.PLAYER_ID = R.PLAYER_ID GROUP BY D.INSTALL_DT ORDER BY D.INSTALL_DT"
135,Y,Y,"WITH A AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) , B AS (SELECT T.EVENT_DATE, IFNULL(COUNT(T.PLAYER_ID),0) AS CT FROM A LEFT JOIN ACTIVITY T ON T.PLAYER_ID = A.PLAYER_ID WHERE T.EVENT_DATE = A.INSTALL_DT+1 GROUP BY T.EVENT_DATE) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(IFNULL(B.CT,0)/COUNT(*),2) AS DAY1_RETENTION FROM A LEFT JOIN B ON A.INSTALL_DT = B.EVENT_DATE-1 GROUP BY INSTALL_DT"
136,Y,Y,"WITH A AS (SELECT PLAYER_ID,MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A1.PLAYER_ID)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM A LEFT JOIN ACTIVITY A1 ON A.EVENT_DATE+1=A1.EVENT_DATE AND A.PLAYER_ID=A1.PLAYER_ID GROUP BY A.EVENT_DATE"
137,Y,Y,"WITH A AS( SELECT RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS R, PLAYER_ID, EVENT_DATE FROM ACTIVITY), B AS( SELECT A1.PLAYER_ID, A1.EVENT_DATE AS INSTALL_DT, IF(A2.R IS NULL, 0, 1) AS RETENTION FROM A A1 LEFT JOIN A A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.EVENT_DATE = A2.EVENT_DATE -1 WHERE A1.R = 1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(IFNULL(SUM(RETENTION)/COUNT(PLAYER_ID), 0), 2) AS DAY1_RETENTION FROM B GROUP BY INSTALL_DT"
138,Y,N,"WITH ACTIVITY1 AS (SELECT *, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) SELECT D1 AS INSTALL_DT, COUNT(D1) AS INSTALLS, ROUND(COUNT(D2)/COUNT(D1),2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID,A.EVENT_DATE AS D1,B.EVENT_DATE AS D2 FROM ACTIVITY1 A LEFT JOIN ACTIVITY1 B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE,A.EVENT_DATE)=1 WHERE A.RNK=1)C GROUP BY 1"
139,Y,N,"WITH C AS ( SELECT PLAYER_ID , EVENT_DATE , DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) DSEQ FROM ACTIVITY ) SELECT C1.EVENT_DATE AS INSTALL_DT , COUNT(C1.DSEQ) AS INSTALLS ,ROUND(1.0*COUNT(C2.DSEQ)/COUNT(C1.DSEQ),2) AS DAY1_RETENTION FROM C C1 LEFT JOIN C C2 ON C1.PLAYER_ID = C2.PLAYER_ID AND C2.DSEQ = 2 AND DATEDIFF(C2.EVENT_DATE,C1.EVENT_DATE) = 1 WHERE C1.DSEQ = 1 GROUP BY C1.EVENT_DATE ORDER BY 1"
140,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) NEXT , RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RNK FROM ACTIVITY ) SELECT B.EVENT_DATE AS INSTALL_DT, DENOM AS INSTALLS, ROUND(IFNULL(NUM,0)/DENOM,2) DAY1_RETENTION FROM ( SELECT EVENT_DATE, COUNT(PLAYER_ID) NUM FROM CTE WHERE DATE_ADD(EVENT_DATE,INTERVAL 1 DAY) = NEXT AND RNK = 1 GROUP BY EVENT_DATE ) A RIGHT JOIN ( SELECT EVENT_DATE, COUNT(PLAYER_ID) DENOM FROM CTE WHERE RNK = 1 GROUP BY EVENT_DATE ) B ON A.EVENT_DATE = B.EVENT_DATE"
141,Y,Y,"WITH CTE AS ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT = A2.EVENT_DATE - 1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS , ROUND(COUNT(NEXT_DAY)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
142,Y,Y,"WITH CTE AS ( SELECT DISTINCT MIN(EVENT_DATE) AS E_DATE, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) SELECT E_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT CASE WHEN EVENT_DATE= E_DATE+1 THEN A.PLAYER_ID END)/ COUNT(DISTINCT A.PLAYER_ID), 2) AS DAY1_RETENTION FROM ACTIVITY AS A, CTE AS B WHERE A.PLAYER_ID = B.PLAYER_ID GROUP BY 1"
143,Y,N,"WITH CTE AS ( SELECT DISTINCT PLAYER_ID, FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY ), CTE2 AS ( SELECT CTE.*, IF(A.EVENT_DATE, 1, 0) AS RETENSION FROM CTE LEFT JOIN ACTIVITY A ON CTE.PLAYER_ID = A.PLAYER_ID AND CTE.INSTALL_DATE = DATE_SUB(A.EVENT_DATE, INTERVAL 1 DAY) ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(RETENSION)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DATE"
144,Y,N,"WITH CTE AS ( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY 2 ) SELECT INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT = DATE_SUB(A2.EVENT_DATE, INTERVAL 1 DAY) AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY 1"
145,Y,N,"WITH CTE AS ( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT = DATE_SUB(A2.EVENT_DATE, INTERVAL 1 DAY) AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
146,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DATE FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, INSTALLS, ROUND(IFNULL(RETENTION/INSTALLS, 0), 2) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE, SUM(CASE WHEN RNK = 1 THEN 1 ELSE 0 END ) AS INSTALLS, SUM(CASE WHEN RNK = 1 AND NEXT_DATE = DATE_ADD(EVENT_DATE, INTERVAL 1 DAY) THEN 1 ELSE 0 END) AS RETENTION FROM CTE WHERE RNK = 1 GROUP BY EVENT_DATE )T"
147,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK1, COALESCE(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE ) AS LEAD_DATE FROM ACTIVITY ), CTE2 AS ( SELECT PLAYER_ID, EVENT_DATE,LEAD_DATE, CASE WHEN (LEAD_DATE -EVENT_DATE) = 1 THEN 1 ELSE 0 END AS DAY_RET FROM CTE WHERE RNK1 = 1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(DAY_RET)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE2 GROUP BY EVENT_DATE"
148,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RN FROM ACTIVITY ) SELECT * FROM ( SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COALESCE(COUNT(ID2) / COUNT(PLAYER_ID), 0), 2) AS DAY1_RETENTION FROM ( SELECT C1.EVENT_DATE, C1.RN, CASE WHEN C1.RN = 1 THEN C1.PLAYER_ID ELSE NULL END AS PLAYER_ID, CASE WHEN C1.RN = 1 THEN C2.PLAYER_ID ELSE NULL END AS ID2 FROM CTE C1 LEFT JOIN CTE C2 ON C1.PLAYER_ID = C2.PLAYER_ID AND DATE_ADD(C1.EVENT_DATE, INTERVAL 1 DAY) = C2.EVENT_DATE ) TEMP GROUP BY INSTALL_DT ) TEMP2 WHERE INSTALLS > 0 ORDER BY INSTALL_DT"
149,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), CTE2 AS ( SELECT DISTINCT CTE.PLAYER_ID AS INSTALLED, A.PLAYER_ID AS RETURNED, CTE.INSTALL_DATE FROM CTE LEFT JOIN ACTIVITY A ON ADDDATE(A.EVENT_DATE ,INTERVAL -1 DAY)=CTE.INSTALL_DATE AND CTE.PLAYER_ID=A.PLAYER_ID ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(INSTALLED) AS INSTALLS, ROUND(COUNT(RETURNED)/COUNT(INSTALLED),2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DATE"
150,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(CTE.PLAYER_ID) AS INSTALLS, ROUND(AVG(CASE WHEN A.PLAYER_ID THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM CTE LEFT JOIN ACTIVITY AS A ON CTE.PLAYER_ID = A.PLAYER_ID AND DATE_ADD(CTE.INSTALL_DATE, INTERVAL 1 DAY) = EVENT_DATE GROUP BY INSTALL_DATE"
151,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT A1.INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT = DATE_SUB(A2.EVENT_DATE, INTERVAL 1 DAY) AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY 1"
152,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), CTE2 AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM CTE GROUP BY INSTALL_DT ), CTE3 AS ( SELECT COUNT(A.PLAYER_ID) AS CNT, C.INSTALL_DT FROM ACTIVITY A JOIN CTE C ON A.EVENT_DATE = C.INSTALL_DT + 1 AND A.PLAYER_ID = C.PLAYER_ID GROUP BY C.INSTALL_DT ) SELECT CTE2.INSTALL_DT, CTE2.INSTALLS, ROUND(IFNULL((CTE3.CNT/CTE2.INSTALLS),0),2) AS DAY1_RETENTION FROM CTE2 LEFT JOIN CTE3 ON CTE2.INSTALL_DT = CTE3.INSTALL_DT"
153,Y,N,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE,RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN FROM ACTIVITY ),CTE1 AS ( SELECT T1.EVENT_DATE,T1.PLAYER_ID AS T1P,CASE WHEN T2.PLAYER_ID IS NULL THEN 0 ELSE 1 END AS T2P FROM (SELECT EVENT_DATE,PLAYER_ID FROM CTE WHERE RN = 1)T1 LEFT JOIN (SELECT EVENT_DATE,PLAYER_ID FROM CTE WHERE RN = 2 )T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND DATE_ADD(T1.EVENT_DATE,INTERVAL 1 DAY) = T2.EVENT_DATE ) SELECT EVENT_DATE AS INSTALL_DT,COUNT(*) AS INSTALLS,ROUND(SUM(T2P)/COUNT(*),2) AS DAY1_RETENTION FROM CTE1 GROUP BY EVENT_DATE"
154,Y,N,"WITH CTE AS (SELECT * FROM (SELECT PLAYER_ID,EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY)T1 WHERE RNK<3) , CTE2 AS (SELECT PLAYER_ID, MAX(CASE WHEN RNK=1 THEN EVENT_DATE END) AS INSTALL_DATE, MAX(CASE WHEN RNK=2 THEN EVENT_DATE END) AS DAY2 FROM CTE GROUP BY PLAYER_ID) SELECT INSTALL_DATE AS INSTALL_DT,COUNT(PLAYER_ID) AS INSTALLS, ROUND((SUM(CASE WHEN DAY2 IS NOT NULL AND DATEDIFF(DAY2,INSTALL_DATE)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID)),2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DATE ORDER BY INSTALL_DATE"
155,Y,N,"WITH CTE AS (SELECT *, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK FROM ACTIVITY) SELECT DISTINCT C.MIN_DT AS INSTALL_DT, COUNT(*)AS INSTALLS, ROUND(SUM(DATE_1)/COUNT(*),2) AS DAY1_RETENTION FROM ( (SELECT A.PLAYER_ID, A.MIN_DT, B.SEC_DT, CASE WHEN ABS(DATEDIFF(A.MIN_DT, B.SEC_DT))=1 THEN 1 ELSE 0 END AS DATE_1 FROM (SELECT DISTINCT PLAYER_ID, EVENT_DATE AS MIN_DT FROM CTE WHERE RK=1) A LEFT JOIN (SELECT DISTINCT PLAYER_ID, EVENT_DATE AS SEC_DT FROM CTE WHERE RK =2) B ON A.PLAYER_ID=B.PLAYER_ID) )C GROUP BY 1"
156,Y,N,"WITH CTE AS (SELECT A1.PLAYER_ID, A1.EVENT_DATE AS FIRST_LOGIN, A2.EVENT_DATE AS SECOND_LOGIN, RANK()OVER(PARTITION BY A1.PLAYER_ID ORDER BY A1.EVENT_DATE) AS RANKING FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND DATEDIFF(A2.EVENT_DATE,A1.EVENT_DATE) = 1), CTE_1 AS (SELECT PLAYER_ID, FIRST_LOGIN, SECOND_LOGIN FROM CTE WHERE RANKING = 1) SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(SECOND_LOGIN)/COUNT(FIRST_LOGIN),2) AS DAY1_RETENTION FROM CTE_1 GROUP BY FIRST_LOGIN"
157,Y,N,"WITH CTE AS (SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(IFNULL((B_PLAYER/COUNT(A.PLAYER_ID)),0),2) AS DAY1_RETENTION FROM CTE A LEFT JOIN (SELECT COUNT(PLAYER_ID) AS B_PLAYER, EVENT_DATE FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) FROM CTE) GROUP BY EVENT_DATE) B ON A.INSTALL_DT=DATE_ADD(B.EVENT_DATE, INTERVAL -1 DAY) GROUP BY A.INSTALL_DT"
158,Y,N,"WITH CTE AS (SELECT PLAYER_ID , MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT( DISTINCT B.PLAYER_ID) AS INSTALLS , ROUND(SUM(CASE WHEN (DATEDIFF(A.EVENT_DATE, B.INSTALL_DT)=1) THEN 1 ELSE 0 END) / (COUNT( DISTINCT B.PLAYER_ID)),2) AS DAY1_RETENTION FROM CTE B JOIN ACTIVITY A ON B.PLAYER_ID = A.PLAYER_ID GROUP BY INSTALL_DT"
159,Y,N,"WITH CTE AS (SELECT PLAYER_ID, EVENT_DATE , LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DAY, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROWNUM FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS , ROUND(SUM(CASE WHEN DATEDIFF(NEXT_DAY,EVENT_DATE)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE WHERE ROWNUM=1 GROUP BY INSTALL_DT"
160,Y,Y,"WITH CTE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = B.EVENT_DATE - 1 GROUP BY 1"
161,Y,Y,"WITH CTE AS( SELECT *, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXT_DATE = EVENT_DATE+1 THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM CTE WHERE RNK = 1 GROUP BY 1 ORDER BY 1"
162,Y,Y,"WITH CTE AS( SELECT EVENT_DATE, PLAYER_ID FROM( SELECT EVENT_DATE, PLAYER_ID, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN FROM ACTIVITY ) TEMP WHERE RN = 1 ), CTE2 AS( SELECT A.EVENT_DATE AS EVENT_DATE1, B.EVENT_DATE AS EVENT_DATE2, A.PLAYER_ID FROM CTE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE - A.EVENT_DATE = 1 ) SELECT EVENT_DATE1 AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE2 IS NOT NULL THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE2 GROUP BY EVENT_DATE1"
163,Y,N,"WITH CTE1 AS ( SELECT * FROM ACTIVITY WHERE (PLAYER_ID,EVENT_DATE) IN (SELECT PLAYER_ID,MIN(EVENT_DATE) FROM ACTIVITY GROUP BY 1) ), CTE2 AS ( SELECT CTE1.EVENT_DATE,COUNT(*) AS RETENTION_COUNT FROM CTE1 JOIN ACTIVITY A ON CTE1.PLAYER_ID=A.PLAYER_ID WHERE DATEDIFF(A.EVENT_DATE, CTE1.EVENT_DATE)=1 GROUP BY 1 ) SELECT CTE1.EVENT_DATE AS INSTALL_DT,COUNT(CTE1.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(CTE2.RETENTION_COUNT/COUNT(CTE1.PLAYER_ID),0),2) AS DAY1_RETENTION FROM CTE1 LEFT JOIN CTE2 ON CTE1.EVENT_DATE=CTE2.EVENT_DATE GROUP BY 1 ORDER BY 1"
164,Y,N,"WITH CTE1 AS ( SELECT * FROM ACTIVITY WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY 1)), CTE2 AS ( SELECT C1.EVENT_DATE, COUNT(*) AS RETENTION FROM CTE1 C1 JOIN ACTIVITY A ON C1.PLAYER_ID=A.PLAYER_ID WHERE DATEDIFF(A.EVENT_DATE, C1.EVENT_DATE)=1 GROUP BY 1) SELECT C1.EVENT_DATE AS INSTALL_DT, COUNT(C1.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(RETENTION/COUNT(C1.PLAYER_ID),0),2) AS DAY1_RETENTION FROM CTE1 C1 LEFT JOIN CTE2 C2 ON C1.EVENT_DATE=C2.EVENT_DATE GROUP BY 1 ORDER BY 1"
165,Y,N,"WITH CTE1 AS ( SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM ( SELECT EVENT_DATE, PLAYER_ID, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_NUM FROM ACTIVITY ) TMP WHERE ROW_NUM=1 GROUP BY 1 ), CTE2 AS ( SELECT A.INSTALL_DT, SUM(CASE WHEN DATE_SUB(B.EVENT_DATE, INTERVAL 1 DAY)= A.INSTALL_DT THEN 1 ELSE 0 END) AS DAY1RETENTION FROM (SELECT EVENT_DATE AS INSTALL_DT, PLAYER_ID, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_NUM FROM ACTIVITY ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID=B.PLAYER_ID WHERE A.ROW_NUM=1 GROUP BY 1 ) SELECT A.INSTALL_DT, A.INSTALLS, ROUND(B.DAY1RETENTION/A.INSTALLS,2) AS DAY1_RETENTION FROM CTE1 AS A INNER JOIN CTE2 AS B ON A.INSTALL_DT=B.INSTALL_DT"
166,Y,Y,"WITH CTE1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), CTE2 AS ( SELECT C1.PLAYER_ID, C1.EVENT_DATE FROM CTE1 C1 JOIN ACTIVITY A1 ON C1.PLAYER_ID=A1.PLAYER_ID WHERE C1.EVENT_DATE=A1.EVENT_DATE AND (SELECT A2.EVENT_DATE FROM ACTIVITY A2 WHERE A2.EVENT_DATE=C1.EVENT_DATE+1 AND A2.PLAYER_ID=C1.PLAYER_ID) IS NOT NULL ), CTE3 AS ( SELECT C1.EVENT_DATE AS INSTALL_DT, COUNT(C1.PLAYER_ID) AS INSTALLS, ROUND((SELECT COUNT(C2.PLAYER_ID) FROM CTE2 C2 WHERE C2.EVENT_DATE=C1.EVENT_DATE)/COUNT(C1.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE1 C1 GROUP BY C1.EVENT_DATE ) SELECT * FROM CTE3"
167,Y,Y,"WITH CTE1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), CTE2 AS ( SELECT CTE1.PLAYER_ID, INSTALL_DATE, CASE WHEN EVENT_DATE IS NULL THEN 0 ELSE 1 END AS RETENTION FROM CTE1 LEFT JOIN ACTIVITY ON CTE1.PLAYER_ID = ACTIVITY.PLAYER_ID AND INSTALL_DATE + 1 = EVENT_DATE ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(AVG(RETENTION) ,2) AS DAY1_RETENTION FROM CTE2 GROUP BY 1 ORDER BY 1"
168,Y,Y,"WITH CTE1 AS (SELECT * FROM (SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DAY FROM ACTIVITY) T WHERE RNK = 1) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, (ROUND(SUM(CASE WHEN EVENT_DATE = NEXT_DAY-1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT PLAYER_ID),2)) AS DAY1_RETENTION FROM CTE1 GROUP BY 1"
169,Y,N,"WITH CTE1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), CTE2 AS (SELECT PLAYER_ID, INSTALL_DT, (CASE WHEN (PLAYER_ID, INSTALL_DT + INTERVAL 1 DAY) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) THEN YES ELSE NO END) AS RETURNED FROM CTE1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN RETURNED = 'YES' THEN 1 ELSE 0 END) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DT ORDER BY INSTALL_DT ASC"
170,Y,N,"WITH CTE1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), CTE2 AS (SELECT PLAYER_ID, INSTALL_DT, (CASE WHEN (PLAYER_ID, INSTALL_DT + INTERVAL 1 DAY) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) THEN YES ELSE NO END) AS RETURNED FROM CTE1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(RETURNED = 'YES') / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DT"
171,Y,N,"WITH DAY1RETAINED AS ( SELECT A.EVENT_DATE, COUNT(A.PLAYER_ID) AS X FROM ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATEORDER FROM ACTIVITY ) AS A WHERE A.DATEORDER=1 AND IF(IFNULL(A.NEXT_DATE, 0)=ADDDATE(A.EVENT_DATE, 1), TRUE, FALSE) GROUP BY A.EVENT_DATE ), DAY1LOGINS AS ( SELECT B.EVENT_DATE, COUNT(B.PLAYER_ID) AS X FROM ( SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATEORDER FROM ACTIVITY ) AS B WHERE B.DATEORDER=1 GROUP BY B.EVENT_DATE ) SELECT DAY1LOGINS.EVENT_DATE AS INSTALL_DT, DAY1LOGINS.X AS INSTALLS, ROUND(IFNULL(DAY1RETAINED.X, 0)/DAY1LOGINS.X, 2) AS DAY1_RETENTION FROM DAY1LOGINS LEFT JOIN DAY1RETAINED ON DAY1LOGINS.EVENT_DATE=DAY1RETAINED.EVENT_DATE"
172,Y,N,"WITH EARLIEST_DATE AS ( SELECT * FROM ( SELECT *, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RN FROM ACTIVITY ) A WHERE RN = 1 ), RETAINED AS ( SELECT B.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT B.PLAYER_ID) AS DAY1_RETAINED FROM ACTIVITY A INNER JOIN EARLIEST_DATE B ON A.PLAYER_ID = B.PLAYER_ID AND DATE_ADD(B.EVENT_DATE, INTERVAL 1 DAY) = A.EVENT_DATE GROUP BY B.EVENT_DATE ), INSTALLED_ON_FIRST_DAY AS ( SELECT B.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT B.PLAYER_ID) AS INSTALLED_ON_FIRST_DAY FROM ACTIVITY A INNER JOIN EARLIEST_DATE B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = A.EVENT_DATE GROUP BY B.EVENT_DATE ), AGG_ACTIVITY AS ( SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS FROM ACTIVITY A INNER JOIN EARLIEST_DATE B USING (PLAYER_ID, EVENT_DATE) GROUP BY A.EVENT_DATE ) SELECT A.INSTALL_DT, A.INSTALLS, COALESCE(ROUND(B.DAY1_RETAINED/C.INSTALLED_ON_FIRST_DAY, 2), 0) AS DAY1_RETENTION FROM AGG_ACTIVITY A LEFT JOIN RETAINED B USING(INSTALL_DT) LEFT JOIN INSTALLED_ON_FIRST_DAY C USING(INSTALL_DT)"
173,Y,Y,"WITH FIRST_ACTIVITY AS ( SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT FROM ( SELECT PLAYER_ID ,EVENT_DATE , RANK ( ) OVER ( PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS RANK_NUM FROM ACTIVITY ) A WHERE RANK_NUM = 1 ) SELECT INSTALL_DT, COUNT( DISTINCT A.PLAYER_ID ) AS INSTALLS, ROUND (COUNT(CASE WHEN EVENT_DATE -1 = INSTALL_DT THEN A.PLAYER_ID END ) /COUNT( DISTINCT A.PLAYER_ID ) , 2) AS DAY1_RETENTION FROM ACTIVITY B LEFT JOIN FIRST_ACTIVITY A ON B.PLAYER_ID = A.PLAYER_ID GROUP BY INSTALL_DT"
174,Y,N,"WITH FIRST_DAY AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) DATE_RANK FROM ACTIVITY GROUP BY 1, 2 ) SELECT F.EVENT_DATE INSTALL_DT , COUNT(F.PLAYER_ID) INSTALLS , ROUND(COUNT(A.PLAYER_ID) / COUNT(F.PLAYER_ID), 2) DAY1_RETENTION FROM FIRST_DAY F LEFT JOIN ACTIVITY A ON F.EVENT_DATE = DATE_SUB(A.EVENT_DATE, INTERVAL 1 DAY) AND F.PLAYER_ID = A.PLAYER_ID WHERE F.DATE_RANK = 1 GROUP BY 1"
175,Y,N,"WITH FIRST_DAY AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) DATE_RANK FROM ACTIVITY GROUP BY 1, 2 ) SELECT INSTALL_DT, INSTALLS, ROUND(SECOND_DAY_COUNT / INSTALLS, 2) DAY1_RETENTION FROM (SELECT F.EVENT_DATE INSTALL_DT , COUNT(F.PLAYER_ID) INSTALLS , COUNT(A.PLAYER_ID) SECOND_DAY_COUNT FROM FIRST_DAY F LEFT JOIN ACTIVITY A ON F.EVENT_DATE = DATE_SUB(A.EVENT_DATE, INTERVAL 1 DAY) AND F.PLAYER_ID = A.PLAYER_ID WHERE F.DATE_RANK = 1 GROUP BY 1 ) RESULT_TABLE"
176,Y,N,"WITH FIRST_INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT A.FIRST_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_INSTALL AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE=DATE_ADD(A.FIRST_DATE, INTERVAL 1 DAY) GROUP BY A.FIRST_DATE ORDER BY COUNT(A.PLAYER_ID) DESC"
177,Y,N,"WITH FIRST_LOGIN AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) AS FIRST_LOGIN , DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS THENEXTDAY FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT FL.FIRST_LOGIN AS INSTALL_DT , COUNT(FL.FIRST_LOGIN) AS INSTALLS , ROUND(COUNT(A.EVENT_DATE)/COUNT(FL.FIRST_LOGIN), 2) AS DAY1_RETENTION FROM ACTIVITY A RIGHT JOIN FIRST_LOGIN FL ON A.EVENT_DATE=THENEXTDAY AND A.PLAYER_ID=FL.PLAYER_ID GROUP BY 1"
178,Y,N,"WITH FIRST_LOGIN AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT FL.FIRST_LOGIN AS INSTALL_DT , COUNT(FL.FIRST_LOGIN) AS INSTALLS , ROUND(COUNT(A.EVENT_DATE)/COUNT(FL.FIRST_LOGIN), 2) AS DAY1_RETENTION FROM ACTIVITY A RIGHT JOIN FIRST_LOGIN FL ON A.EVENT_DATE=DATE_ADD(FIRST_LOGIN, INTERVAL 1 DAY) AND A.PLAYER_ID=FL.PLAYER_ID GROUP BY 1"
179,Y,N,"WITH FIRST_LOGIN AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) , CONSECUTIVE_SECOND_LOGIN AS ( SELECT A.PLAYER_ID, F.FIRST_EVENT_DATE FROM ACTIVITY A INNER JOIN FIRST_LOGIN F ON A.PLAYER_ID = F.PLAYER_ID AND A.EVENT_DATE = DATE_ADD(F.FIRST_EVENT_DATE, INTERVAL 1 DAY) GROUP BY A.PLAYER_ID, F.FIRST_EVENT_DATE ) , COUNT_USERS_BY_EVENT_DATE AS ( SELECT FIRST_EVENT_DATE,COUNT(*) AS USERCOUNT FROM FIRST_LOGIN GROUP BY FIRST_EVENT_DATE ) , COUNT_CONSECUTIVE_SECONDLOGIN_USERS_BY_EVENT_DATE AS ( SELECT FIRST_EVENT_DATE,COUNT(*) AS SECONDUSERCOUNT FROM CONSECUTIVE_SECOND_LOGIN GROUP BY FIRST_EVENT_DATE ) SELECT C.FIRST_EVENT_DATE AS INSTALL_DT , C.USERCOUNT AS INSTALLS , ROUND(COALESCE(C2.SECONDUSERCOUNT,0)/C.USERCOUNT,2) AS DAY1_RETENTION FROM COUNT_USERS_BY_EVENT_DATE C LEFT JOIN COUNT_CONSECUTIVE_SECONDLOGIN_USERS_BY_EVENT_DATE C2 ON C.FIRST_EVENT_DATE = C2.FIRST_EVENT_DATE"
180,Y,N,"WITH FIRST_LOGIN AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1), DAY1 AS ( SELECT F.PLAYER_ID,F.INSTALL_DATE FROM FIRST_LOGIN F JOIN ACTIVITY A ON F.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE,F.INSTALL_DATE)=1 ) SELECT F.INSTALL_DATE AS INSTALL_DT,COUNT(F.PLAYER_ID) AS INSTALLS,ROUND(COUNT(DAY1.PLAYER_ID)/COUNT(F.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_LOGIN F LEFT JOIN DAY1 ON DAY1.PLAYER_ID=F.PLAYER_ID AND F.INSTALL_DATE=DAY1.INSTALL_DATE GROUP BY 1"
181,Y,N,"WITH FIRST_LOGIN AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A1 GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(DISTINCT F.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A.PLAYER_ID)/COUNT(DISTINCT F.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_LOGIN F LEFT JOIN ACTIVITY A ON F.INSTALL_DT = DATE_SUB(A.EVENT_DATE,INTERVAL 1 DAY) AND F.PLAYER_ID = A.PLAYER_ID GROUP BY 1"
182,Y,N,"WITH FIRST_LOGIN_CTE AS ( SELECT PLAYER_ID,EVENT_DATE, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT(DISTINCT F.PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(A.EVENT_DATE,F.INSTALL_DT)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT F.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_LOGIN_CTE F JOIN ACTIVITY A ON F.PLAYER_ID = A.PLAYER_ID GROUP BY 1"
183,Y,N,"WITH I AS ( SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, EVENT_DATE FROM (SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) AS T0 WHERE RNK=1) AS T1 GROUP BY EVENT_DATE), L AS ( SELECT INSTALL_DT, LOG_BACK_DT, COUNT(IF(DATEDIFF(LOG_BACK_DT, INSTALL_DT)=1, PLAYER_ID, NULL)) AS DIVIDEND FROM (SELECT I1.PLAYER_ID, L1.LOG_BACK_DT, I1.INSTALL_DT FROM (SELECT PLAYER_ID, EVENT_DATE AS LOG_BACK_DT FROM (SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) AS T2 WHERE RNK=2) AS L1 RIGHT JOIN (SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT FROM (SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY) AS T3 WHERE RNK=1) AS I1 ON L1.PLAYER_ID=I1.PLAYER_ID) AS T4 GROUP BY INSTALL_DT) SELECT I.INSTALL_DT, I.INSTALLS, ROUND(L.DIVIDEND/I.INSTALLS,2) AS DAY1_RETENTION FROM I LEFT JOIN L ON I.INSTALL_DT = L.INSTALL_DT"
184,Y,N,"WITH IDT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), RET AS ( SELECT IDT.*, EVENT_DATE FROM IDT LEFT JOIN ACTIVITY A ON IDT.PLAYER_ID = A.PLAYER_ID AND IDT.INSTALL_DT + INTERVAL 1 DAY = A.EVENT_DATE ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(*)*1.0,2) AS DAY1_RETENTION FROM RET GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
185,Y,N,"WITH IN_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY A GROUP BY 1 ) , RETENT AS ( SELECT DISTINCT I.PLAYER_ID, FIRST_LOGIN FROM IN_DT I INNER JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND DATE_ADD(I.FIRST_LOGIN, INTERVAL 1 DAY) = A.EVENT_DATE ) SELECT I.FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT R.PLAYER_ID)/COUNT(DISTINCT I.PLAYER_ID),2) AS DAY1_RETENTION FROM IN_DT I LEFT JOIN RETENT R ON R.PLAYER_ID = I.PLAYER_ID GROUP BY 1 ORDER BY 1 ASC"
186,Y,Y,"WITH INST AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) , RETENTION AS ( SELECT I.PLAYER_ID, I.INSTALL_DATE FROM INST I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID WHERE A.EVENT_DATE - I.INSTALL_DATE = 1 ) SELECT L.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT L.PLAYER_ID) AS INSTALLS, ROUND( (COUNT(DISTINCT R.PLAYER_ID) / COUNT(DISTINCT L.PLAYER_ID)),2) AS DAY1_RETENTION FROM INST L LEFT JOIN RETENTION R ON L.PLAYER_ID = R.PLAYER_ID GROUP BY 1"
187,Y,N,"WITH INSTALL AS (SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND( SUM(CASE WHEN (PLAYER_ID,DATE_ADD(INSTALL_DT,INTERVAL 1 DAY)) IN (SELECT PLAYER_ID,EVENT_DATE FROM ACTIVITY) THEN 1 ELSE 0 END) / COUNT(PLAYER_ID) , 2 ) AS DAY1_RETENTION FROM INSTALL GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
188,Y,N,"WITH INSTALL AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALLDATE FROM ACTIVITY GROUP BY 1 ) SELECT INSTALLDATE AS INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(COUNT(A.PLAYER_ID),0)/COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND EVENT_DATE=DATE_ADD(INSTALLDATE,INTERVAL 1 DAY) GROUP BY INSTALLDATE"
189,Y,N,"WITH INSTALL_ACTIVITY AS ( SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ),COUNT_RETENTION AS( SELECT IACT.INSTALL_DATE AS INSTALL_DATE ,COUNT(ACT.PLAYER_ID) AS CNT FROM ACTIVITY ACT JOIN INSTALL_ACTIVITY IACT ON ACT.PLAYER_ID = IACT.PLAYER_ID AND ACT.EVENT_DATE = DATE_ADD(IACT.INSTALL_DATE,INTERVAL 1 DAY) GROUP BY INSTALL_DATE ) SELECT IA.INSTALL_DATE AS INSTALL_DT ,COUNT(IA.INSTALL_DATE) AS INSTALLS ,ROUND(IFNULL(CR.CNT,0)/COUNT(IA.INSTALL_DATE),2) AS DAY1_RETENTION FROM INSTALL_ACTIVITY IA LEFT JOIN COUNT_RETENTION CR ON IA.INSTALL_DATE = CR.INSTALL_DATE GROUP BY INSTALL_DT"
190,Y,N,"WITH INSTALL_ACTIVITY AS ( SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ),COUNT_RETENTION AS( SELECT IACT.INSTALL_DATE AS INSTALL_DATE ,COUNT(ACT.PLAYER_ID) AS CNT FROM ACTIVITY ACT JOIN INSTALL_ACTIVITY IACT ON ACT.PLAYER_ID = IACT.PLAYER_ID AND ACT.EVENT_DATE = DATE_ADD(IACT.INSTALL_DATE,INTERVAL 1 DAY) GROUP BY INSTALL_DATE ) SELECT IA.INSTALL_DATE AS INSTALL_DT ,COUNT(IA.PLAYER_ID) AS INSTALLS ,ROUND(IFNULL(CR.CNT,0)/COUNT(IA.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL_ACTIVITY IA LEFT JOIN COUNT_RETENTION CR ON IA.INSTALL_DATE = CR.INSTALL_DATE GROUP BY INSTALL_DT"
191,Y,N,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT,SUM(IF(I.INSTALL_DT=A.EVENT_DATE,1,0)) AS INSTALLS, ROUND(SUM(IF(A.EVENT_DATE=DATE_ADD(I.INSTALL_DT,INTERVAL 1 DAY),1,0))/SUM(IF(I.INSTALL_DT=A.EVENT_DATE,1,0)),2) AS DAY1_RETENTION FROM ACTIVITY A JOIN INSTALL_DATE I ON A.PLAYER_ID=I.PLAYER_ID GROUP BY INSTALL_DT"
192,Y,N,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), RETAIN AS (SELECT PLAYER_ID, INSTALL_DT, (CASE WHEN (PLAYER_ID, INSTALL_DT + INTERVAL 1 DAY) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) THEN Y ELSE N END) AS RETAIN FROM INSTALL_DATE) SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(SUM(CASE WHEN RETAIN = 'Y' THEN 1 ELSE 0 END)/COUNT(INSTALL_DT), 2) AS DAY1_RETENTION FROM RETAIN GROUP BY INSTALL_DT"
193,Y,N,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), INSTALL_NUM AS ( SELECT INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM INSTALL_DT GROUP BY 1 ), RET AS ( SELECT INSTALL_DATE, COUNT(DISTINCT INSTALL_DT.PLAYER_ID) AS RETURN_N FROM ACTIVITY INNER JOIN INSTALL_DT ON ACTIVITY.PLAYER_ID = INSTALL_DT.PLAYER_ID AND DATEDIFF(ACTIVITY.EVENT_DATE, INSTALL_DT.INSTALL_DATE) = 1 GROUP BY 1 ) SELECT INSTALL_NUM.INSTALL_DATE AS INSTALL_DT, INSTALLS, IFNULL(ROUND(RETURN_N/INSTALLS,2),0.00) AS DAY1_RETENTION FROM INSTALL_NUM LEFT JOIN RET ON INSTALL_NUM.INSTALL_DATE = RET.INSTALL_DATE ORDER BY 1"
194,Y,N,"WITH INSTALL_DT AS (SELECT DISTINCT EVENT_DATE AS INSTALL_DT, PLAYER_ID FROM (SELECT PLAYER_ID, EVENT_DATE ,DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC ) AS RANK_ FROM ACTIVITY) AS TMP WHERE RANK_ = 1) SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(T2.PLAYER_ID)*1.0/COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL_DT AS T1 LEFT JOIN ACTIVITY AS T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND DATE_ADD(T1.INSTALL_DT, INTERVAL 1 DAY) = T2.EVENT_DATE GROUP BY T1.INSTALL_DT"
195,Y,Y,"WITH INSTALLATION AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM( R_FLAG)/COUNT(*),2) AS DAY1_RETENTION FROM (SELECT I.EVENT_DATE, I.PLAYER_ID, CASE WHEN A.PLAYER_ID IS NULL THEN 0 ELSE 1 END AS R_FLAG FROM INSTALLATION I LEFT JOIN ACTIVITY A ON I.PLAYER_ID =A.PLAYER_ID AND A.EVENT_DATE-I.EVENT_DATE = 1) TEMP GROUP BY EVENT_DATE"
196,Y,N,"WITH INSTALLDATE AS ( SELECT PLAYER_ID,MIN( EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), NUMPLAYER AS ( SELECT INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM INSTALLDATE GROUP BY INSTALL_DATE ), RETENTION AS ( SELECT EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN_DATE, PLAYER_ID FROM ACTIVITY ) SELECT INSTALL_DATE AS INSTALL_DT, INSTALLS, ROUND( IFNULL(DAY1_LOGINS / INSTALLS, 0 ), 2 ) AS DAY1_RETENTION FROM NUMPLAYER LEFT JOIN ( SELECT EVENT_DATE, COUNT(DISTINCT I.PLAYER_ID) AS DAY1_LOGINS FROM RETENTION R RIGHT JOIN INSTALLDATE I ON R.EVENT_DATE = I.INSTALL_DATE AND R.PLAYER_ID = I.PLAYER_ID WHERE DATEDIFF(NEXT_LOGIN_DATE, EVENT_DATE) = 1 AND I.PLAYER_ID IS NOT NULL GROUP BY EVENT_DATE )T ON NUMPLAYER.INSTALL_DATE = T.EVENT_DATE ORDER BY NUMPLAYER.INSTALL_DATE"
197,Y,N,"WITH INSTALLDATE AS( SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INS.INSTALL_DATE AS INSTALL_DT ,COUNT(INS.PLAYER_ID) AS INSTALLS ,ROUND(SUM(CASE WHEN ACT.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(INS.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALLDATE INS LEFT JOIN ACTIVITY ACT ON DATEDIFF(ACT.EVENT_DATE,INS.INSTALL_DATE)=1 AND INS.PLAYER_ID = ACT.PLAYER_ID GROUP BY INS.INSTALL_DATE"
198,Y,N,"WITH INSTALLDATEPLAYER AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALLDATEPLAYER.INSTALL_DATE AS INSTALL_DT, COUNT(1) AS INSTALLS,ROUND(COALESCE(TEMP.RETENTION,0)/COUNT(1),2) AS DAY1_RETENTION FROM INSTALLDATEPLAYER LEFT OUTER JOIN (SELECT I2.INSTALL_DATE,COUNT(I2.PLAYER_ID) AS RETENTION FROM INSTALLDATEPLAYER I2 INNER JOIN ACTIVITY ON ACTIVITY.PLAYER_ID = I2.PLAYER_ID AND DATE_ADD(I2.INSTALL_DATE, INTERVAL 1 DAY) = ACTIVITY.EVENT_DATE GROUP BY I2.INSTALL_DATE) TEMP ON INSTALLDATEPLAYER.INSTALL_DATE = TEMP.INSTALL_DATE GROUP BY INSTALLDATEPLAYER.INSTALL_DATE"
199,Y,N,"WITH INSTALLDAY AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT USERID_RETENT)*1.0/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A.*, B.PLAYER_ID AS USERID_RETENT FROM INSTALLDAY A LEFT JOIN ACTIVITY B ON A.INSTALL_DT = DATE_ADD(EVENT_DATE, INTERVAL -1 DAY) AND A.PLAYER_ID = B.PLAYER_ID ) TEMP GROUP BY 1"
200,Y,N,"WITH INSTALLDT AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), DAY1 AS (SELECT ACTIVITY.PLAYER_ID, INSTALLDT.INSTALL_DT FROM ACTIVITY INNER JOIN INSTALLDT ON ACTIVITY.PLAYER_ID = INSTALLDT.PLAYER_ID AND DATE_SUB(ACTIVITY.EVENT_DATE, INTERVAL 1 DAY) = INSTALLDT.INSTALL_DT ) SELECT INSTALLDT.INSTALL_DT, COUNT(INSTALLDT.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DAY1.PLAYER_ID)/COUNT(INSTALLDT.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALLDT LEFT JOIN DAY1 ON DAY1.INSTALL_DT = INSTALLDT.INSTALL_DT AND DAY1.PLAYER_ID = INSTALLDT.PLAYER_ID GROUP BY INSTALLDT.INSTALL_DT"
201,Y,Y,"WITH INSTALLED AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1), RETENTION AS (SELECT INSTALL_DATE, A1.PLAYER_ID FIRST_DAY, A2.PLAYER_ID NEXT_DAY FROM INSTALLED A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DATE + 1 = A2.EVENT_DATE ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(FIRST_DAY) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(FIRST_DAY) ,2) AS DAY1_RETENTION FROM RETENTION GROUP BY 1"
202,Y,Y,"WITH INSTALLS AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS DATE FROM ACTIVITY GROUP BY 1) SELECT DATE AS INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.DATE = A.EVENT_DATE - 1 GROUP BY 1 ORDER BY 1"
203,Y,N,"WITH IST AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DATE INSTALL_DT, COUNT(I.PLAYER_ID) INSTALLS, ROUND(COUNT(A.PLAYER_ID) /COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM IST I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND DATE_ADD(I.INSTALL_DATE,INTERVAL 1 DAY) = A.EVENT_DATE GROUP BY I.INSTALL_DATE"
204,Y,N,"WITH MIN_DATE AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(CASE WHEN DATEDIFF(EVENT_DATE,INSTALL_DT)=1 THEN 1 END)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM MIN_DATE GROUP BY INSTALL_DT"
205,Y,Y,"WITH MIN_DATE AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) AS MIN_DAY FROM ACTIVITY GROUP BY PLAYER_ID) SELECT B.MIN_DAY AS INSTALL_DT,COUNT(B.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(B.PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A RIGHT JOIN MIN_DATE B ON A.EVENT_DATE=B.MIN_DAY+1 AND A.PLAYER_ID=B.PLAYER_ID GROUP BY 1"
206,Y,Y,"WITH PLAYER_DATES AS ( SELECT DISTINCT PLAYER_ID ,EVENT_DATE ,FIRST_VALUE(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT FROM ACTIVITY ) ,PLAYERS AS ( SELECT PLAYER_ID ,INSTALL_DT ,CASE WHEN EVENT_DATE = INSTALL_DT + 1 THEN PLAYER_ID ELSE NULL END AS RETAINED_PLAYER_ID FROM PLAYER_DATES ) SELECT INSTALL_DT ,COUNT(DISTINCT PLAYER_ID) AS INSTALLS ,ROUND(COUNT(DISTINCT RETAINED_PLAYER_ID)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM PLAYERS GROUP BY 1 ORDER BY 1"
207,Y,N,"WITH PREP AS ( SELECT * , ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RN , IF( DATEDIFF(LEAD(EVENT_DATE,1)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE) =1, 1,0) ISLOGINNEXTDAY FROM ACTIVITY ) SELECT EVENT_DATE INSTALL_DT , COUNT(DISTINCT PLAYER_ID) INSTALLS , ROUND(SUM(ISLOGINNEXTDAY)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM PREP WHERE RN=1 GROUP BY EVENT_DATE"
208,Y,N,"WITH PREP AS ( SELECT * , ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RN , IF( DATEDIFF(LEAD(EVENT_DATE,1)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE) =1, 1,0) ISLOGINNEXTDAY FROM ACTIVITY ) SELECT EVENT_DATE INSTALL_DT , COUNT(DISTINCT PLAYER_ID) INSTALLS , ROUND(SUM(ISLOGINNEXTDAY)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM PREP WHERE RN=1 GROUP BY INSTALL_DT"
209,Y,N,"WITH PREP AS ( SELECT *, MIN(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) INSTALL_DT, LEAD(EVENT_DATE, 1)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) NEXTDAY, ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)RN FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN NEXTDAY IS NOT NULL AND DATEDIFF(NEXTDAY,INSTALL_DT)=1 THEN 1 ELSE 0 END )/COUNT(*),2) AS DAY1_RETENTION FROM PREP WHERE RN=1 GROUP BY INSTALL_DT"
210,Y,N,"WITH PREP AS( SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RNK, IF( DATEDIFF(LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE)=1,1,0 ) NEXTDAYLOGIN FROM ACTIVITY ) SELECT EVENT_DATE INSTALL_DT, COUNT(DISTINCT PLAYER_ID) INSTALLS, ROUND(SUM(NEXTDAYLOGIN)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM PREP WHERE RNK =1 GROUP BY INSTALL_DT"
211,Y,N,"WITH RANKED_EVENT_DATE AS( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS EVENT_DATE_RANK FROM ACTIVITY ) SELECT DATE1 AS INSTALL_DT, COUNT(DAY_ONE.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(DATE2,DATE1)=1 THEN 1 ELSE 0 END)/COUNT(DAY_ONE.PLAYER_ID),2) AS DAY1_RETENTION FROM( SELECT EVENT_DATE AS DATE1, PLAYER_ID FROM RANKED_EVENT_DATE WHERE EVENT_DATE_RANK = 1 ) AS DAY_ONE LEFT JOIN ( SELECT EVENT_DATE AS DATE2, PLAYER_ID FROM RANKED_EVENT_DATE WHERE EVENT_DATE_RANK = 2 ) AS DAY_TWO ON DAY_ONE.PLAYER_ID = DAY_TWO.PLAYER_ID GROUP BY DATE1"
212,Y,Y,"WITH RETENTION AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) NEXT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) ROWNUM FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND((SUM(CASE WHEN (NEXT_DATE - EVENT_DATE = 1) THEN 1 ELSE 0 END) / COUNT(DISTINCT PLAYER_ID)), 2) AS DAY1_RETENTION FROM RETENTION WHERE ROWNUM = 1 GROUP BY INSTALL_DT"
213,Y,Y,"WITH RETENTION AS( SELECT PLAYER_ID, INSTALL_DT FROM (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) T WHERE EVENT_DATE - INSTALL_DT = 1 ), INSTALL_DATE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID) / COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE A LEFT JOIN RETENTION B ON A.INSTALL_DT = B.INSTALL_DT AND A.PLAYER_ID = B.PLAYER_ID GROUP BY A.INSTALL_DT"
214,Y,Y,"WITH RETENTION AS( SELECT PLAYER_ID, INSTALL_DT FROM (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) T WHERE EVENT_DATE - INSTALL_DT = 1 ), INSTALL_DATE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID) / COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE A LEFT JOIN RETENTION B ON A.PLAYER_ID = B.PLAYER_ID GROUP BY A.INSTALL_DT"
215,Y,N,"WITH T AS ( SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK , IF( DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE)=1, 1,0) AS RETENTION FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(RETENTION)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM T WHERE RNK=1 GROUP BY EVENT_DATE"
216,Y,N,"WITH T AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK , IF(DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE),EVENT_DATE)=1, 1, 0) AS RETENTION FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS , ROUND(SUM(RETENTION)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T WHERE RNK=1 GROUP BY EVENT_DATE"
217,Y,N,"WITH T1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), T2 AS ( SELECT T1.PLAYER_ID, T1.INSTALL_DATE, COALESCE(MIN(DATEDIFF(A.EVENT_DATE, T1.INSTALL_DATE)), 0) NEXT_LOGIN_AFTER_DAYS FROM ACTIVITY A RIGHT OUTER JOIN T1 ON A.PLAYER_ID=T1.PLAYER_ID AND A.EVENT_DATE>T1.INSTALL_DATE GROUP BY A.PLAYER_ID, T1.INSTALL_DATE ) SELECT INSTALL_DATE INSTALL_DT, COUNT(1) INSTALLS, ROUND(SUM(CASE WHEN NEXT_LOGIN_AFTER_DAYS=1 THEN 1 ELSE 0 END)/COUNT(1),2) DAY1_RETENTION FROM T2 GROUP BY INSTALL_DATE"
218,Y,Y,"WITH T1 AS ( SELECT PLAYER_ID,EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NXT FROM ACTIVITY )SELECT DISTINCT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NXT= INSTALL_DT+1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2)DAY1_RETENTION FROM T1 WHERE RK = 1 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
219,Y,N,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1), T2 AS (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM T1 GROUP BY 1), T3 AS (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS RETENTION FROM T1 WHERE (PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) GROUP BY 1) SELECT T2.INSTALL_DT, INSTALLS, ROUND(IFNULL(RETENTION, 0)/INSTALLS, 2) AS DAY1_RETENTION FROM T2 LEFT JOIN T3 ON T2.INSTALL_DT = T3.INSTALL_DT"
220,Y,N,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), T2 AS (SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM T1 GROUP BY INSTALL_DT), T3 AS (SELECT INSTALL_DT, COUNT(*) AS NEXT_DAY_LOGIN FROM T1 WHERE (PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) GROUP BY 1) SELECT T2.INSTALL_DT, INSTALLS, ROUND(IFNULL(NEXT_DAY_LOGIN/INSTALLS, 0), 2) AS DAY1_RETENTION FROM T2 LEFT JOIN T3 ON T2.INSTALL_DT = T3.INSTALL_DT"
221,Y,Y,"WITH T1 AS( SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NXT FROM ACTIVITY) SELECT DISTINCT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NXT=EVENT_DATE+1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T1 WHERE RNK = 1 GROUP BY 1 ORDER BY 1"
222,Y,Y,"WITH T1 AS( SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NXT FROM ACTIVITY) SELECT DISTINCT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NXT=INSTALL_DT+1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T1 WHERE RNK = 1 GROUP BY 1 ORDER BY 1"
223,Y,Y,"WITH T1 AS( SELECT A.PLAYER_ID, MIN(A.EVENT_DATE) AS INSTALL_DT, CASE WHEN MIN(A.EVENT_DATE)+1 IN (SELECT A1.EVENT_DATE FROM ACTIVITY A1 WHERE A1.PLAYER_ID=A.PLAYER_ID) THEN 1 ELSE 0 END AS SEC_IND FROM ACTIVITY A GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(SEC_IND)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM T1 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
224,Y,N,"WITH T2 AS ( SELECT PLAYER_ID, MIN(CASE WHEN RNUM = 1 THEN EVENT_DATE ELSE NULL END) INSTALL_DT, MIN(CASE WHEN RNUM = 2 THEN EVENT_DATE ELSE NULL END) NEXT_LOGIN FROM ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER ( PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) RNUM FROM ACTIVITY ) T1 WHERE RNUM<=2 GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(1) INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXT_LOGIN, INSTALL_DT)=1 THEN 1 ELSE 0 END)/COUNT(1), 2) DAY1_RETENTION FROM T2 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
225,Y,N,"WITH TB1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM TB1 A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT = DATE_SUB(A2.EVENT_DATE, INTERVAL 1 DAY) AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY 1"
226,Y,Y,"WITH TB1 AS (SELECT PLAYER_ID, EVENT_DATE, RANK()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM ACTIVITY) ,TB2 AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALL FROM TB1 WHERE RK=1 GROUP BY EVENT_DATE) , TB3 AS( SELECT A.EVENT_DATE,COUNT(A.PLAYER_ID) AS RET FROM TB1 A, TB1 B WHERE A.PLAYER_ID=B.PLAYER_ID AND A.EVENT_DATE+1=B.EVENT_DATE AND A.RK=1 GROUP BY A.EVENT_DATE) SELECT TB2. EVENT_DATE AS INSTALL_DT, INSTALL AS INSTALLS, ROUND(IFNULL(RET/INSTALL,0),2) AS DAY1_RETENTION FROM TB2 LEFT JOIN TB3 ON TB2.EVENT_DATE=TB3.EVENT_DATE"
227,Y,N,"WITH TBDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), TBTCNT AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM TBDATE GROUP BY EVENT_DATE ), TBCNT AS ( SELECT TBDATE.EVENT_DATE AS INSTALL_DT, TBTCNT.INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/TBTCNT.INSTALLS,2) AS DAY1_RETENTION FROM TBDATE JOIN TBTCNT ON TBTCNT.EVENT_DATE = TBDATE.EVENT_DATE LEFT JOIN ACTIVITY AS A2 ON DATEDIFF(A2.EVENT_DATE, TBDATE.EVENT_DATE) = 1 AND A2.PLAYER_ID = TBDATE.PLAYER_ID GROUP BY TBDATE.EVENT_DATE ) SELECT * FROM TBCNT"
228,Y,N,"WITH TBDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), TBTCNT AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM TBDATE GROUP BY EVENT_DATE ), TBCNT AS ( SELECT TBDATE.EVENT_DATE AS INSTALL_DT, TBTCNT.INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/TBTCNT.INSTALLS,2) AS DAY1_RETENTION FROM TBDATE LEFT JOIN TBTCNT ON TBTCNT.EVENT_DATE = TBDATE.EVENT_DATE LEFT JOIN ACTIVITY AS A2 ON DATEDIFF(A2.EVENT_DATE, TBDATE.EVENT_DATE) = 1 AND A2.PLAYER_ID = TBDATE.PLAYER_ID GROUP BY TBDATE.EVENT_DATE ) SELECT * FROM TBCNT"
229,Y,N,"WITH TBDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), TBTCNT AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM TBDATE GROUP BY EVENT_DATE ), TBCNT AS ( SELECT TBDATE.EVENT_DATE, COUNT(A2.PLAYER_ID) AS INSTALL FROM TBDATE LEFT JOIN ACTIVITY AS A2 ON DATEDIFF(A2.EVENT_DATE, TBDATE.EVENT_DATE) = 1 AND A2.PLAYER_ID = TBDATE.PLAYER_ID GROUP BY TBDATE.EVENT_DATE ) SELECT TBTCNT.EVENT_DATE AS INSTALL_DT, TBTCNT.INSTALLS, ROUND(TBCNT.INSTALL/TBTCNT.INSTALLS,2) AS DAY1_RETENTION FROM TBTCNT JOIN TBCNT ON TBTCNT.EVENT_DATE = TBCNT.EVENT_DATE"
230,Y,N,"WITH TBDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), TBTCNT AS ( SELECT TBDATE.EVENT_DATE, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS FROM ACTIVITY AS A1 JOIN TBDATE ON A1.EVENT_DATE = TBDATE.EVENT_DATE AND A1.PLAYER_ID = TBDATE.PLAYER_ID GROUP BY TBDATE.EVENT_DATE ), TBCNT AS ( SELECT TBDATE.EVENT_DATE, COUNT(A2.PLAYER_ID) AS INSTALL FROM TBDATE LEFT JOIN ACTIVITY AS A2 ON DATEDIFF(A2.EVENT_DATE, TBDATE.EVENT_DATE) = 1 AND A2.PLAYER_ID = TBDATE.PLAYER_ID GROUP BY TBDATE.EVENT_DATE ) SELECT TBTCNT.EVENT_DATE AS INSTALL_DT, TBTCNT.INSTALLS, ROUND(TBCNT.INSTALL/TBTCNT.INSTALLS,2) AS DAY1_RETENTION FROM TBTCNT JOIN TBCNT ON TBTCNT.EVENT_DATE = TBCNT.EVENT_DATE"
231,Y,N,"WITH TEMP AS ( SELECT A.PLAYER_ID, A.EVENT_DATE FROM ACTIVITY AS A JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID WHERE A.EVENT_DATE >= B.EVENT_DATE GROUP BY A.PLAYER_ID, A.EVENT_DATE HAVING COUNT(B.EVENT_DATE) = 1 ), TEMP1 AS ( SELECT TEMP.PLAYER_ID, TEMP.EVENT_DATE, CASE WHEN A.EVENT_DATE IS NULL THEN 0 ELSE 1 END AS RETENT FROM TEMP LEFT JOIN ACTIVITY AS A ON TEMP.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, TEMP.EVENT_DATE) = 1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(RETENT)/COUNT(*), 2) AS DAY1_RETENTION FROM TEMP1 GROUP BY EVENT_DATE ORDER BY INSTALL_DT"
232,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS FIRST_DAY FROM ACTIVITY ) SELECT A.FIRST_DAY AS INSTALL_DT , A.TOTAL AS INSTALLS , ROUND(IFNULL(RETENTION/TOTAL,0),2) AS DAY1_RETENTION FROM ( SELECT FIRST_DAY, COUNT(DISTINCT PLAYER_ID) AS TOTAL FROM TEMP GROUP BY FIRST_DAY) AS A LEFT JOIN (SELECT FIRST_DAY, SUM(CASE WHEN DATEDIFF(EVENT_DATE, FIRST_DAY) = 1 THEN 1 ELSE 0 END) AS RETENTION FROM TEMP GROUP BY FIRST_DAY) AS B ON A.FIRST_DAY = B.FIRST_DAY"
233,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANKING FROM ACTIVITY ), TEMP1 AS ( SELECT T.PLAYER_ID, T.EVENT_DATE AS INSTALL_DT FROM TEMP AS T JOIN TEMP AS U ON T.PLAYER_ID = U.PLAYER_ID AND DATEDIFF(U.EVENT_DATE, T.EVENT_DATE) = 1 WHERE T.RANKING = 1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(TEMP.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN TEMP1.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END)/COUNT(TEMP.PLAYER_ID), 2) AS DAY1_RETENTION FROM TEMP LEFT JOIN TEMP1 ON TEMP.EVENT_DATE = TEMP1.INSTALL_DT AND TEMP1.PLAYER_ID = TEMP.PLAYER_ID WHERE TEMP.RANKING = 1 GROUP BY EVENT_DATE"
234,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANKING FROM ACTIVITY ), TEMP1 AS ( SELECT T.PLAYER_ID, T.EVENT_DATE AS INSTALL_DT FROM TEMP AS T JOIN TEMP AS U ON T.PLAYER_ID = U.PLAYER_ID AND DATEDIFF(U.EVENT_DATE, T.EVENT_DATE) = 1 WHERE T.RANKING = 1 ), TEMP2 AS ( SELECT PLAYER_ID, EVENT_DATE FROM TEMP WHERE RANKING = 1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(TEMP2.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN TEMP1.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END)/COUNT(TEMP2.PLAYER_ID), 2) AS DAY1_RETENTION FROM TEMP2 LEFT JOIN TEMP1 ON TEMP2.EVENT_DATE = TEMP1.INSTALL_DT AND TEMP1.PLAYER_ID = TEMP2.PLAYER_ID GROUP BY EVENT_DATE"
235,Y,N,"WITH TEMP AS (SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE,1,NULL) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_VISIT_DT, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS DATE_RANK FROM ACTIVITY), INSTALLATION AS (SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT, DATEDIFF(NEXT_VISIT_DT,EVENT_DATE) AS DATE_DIFF FROM TEMP WHERE DATE_RANK = 1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(CASE WHEN DATE_DIFF = 1 THEN 1 END)/COUNT(*),2) AS DAY1_RETENTION FROM INSTALLATION GROUP BY INSTALL_DT"
236,Y,Y,"WITH TEMP AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DATE AS INSTALL_DT, SUM(CASE WHEN INSTALL_DATE=EVENT_DATE THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM(CASE WHEN INSTALL_DATE+1=EVENT_DATE THEN 1 ELSE 0 END )/SUM(CASE WHEN INSTALL_DATE=EVENT_DATE THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM TEMP JOIN ACTIVITY A ON TEMP.PLAYER_ID=A.PLAYER_ID GROUP BY INSTALL_DATE"
237,Y,N,"WITH TEMP AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT, DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS NEXT_DAY FROM ACTIVITY GROUP BY PLAYER_ID) , TEMP2 AS (SELECT TEMP.*, ACTIVITY.DEVICE_ID FROM TEMP LEFT JOIN ACTIVITY ON TEMP.PLAYER_ID = ACTIVITY.PLAYER_ID AND TEMP.NEXT_DAY = ACTIVITY.EVENT_DATE ) SELECT INSTALL_DT,COUNT(PLAYER_ID) AS INSTALLS,ROUND(COUNT(DEVICE_ID)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM TEMP2 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
238,Y,Y,"WITH TEMP AS (SELECT T1.PLAYER_ID, DT, A.EVENT_DATE NEXT_DAY FROM (SELECT *, MIN(EVENT_DATE) DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID AND DT = A.EVENT_DATE - 1) SELECT DT INSTALL_DT, COUNT(DT) INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) DAY1_RETENTION FROM TEMP GROUP BY 1"
239,Y,Y,"WITH TEMP AS (SELECT T1.PLAYER_ID, DT, A.EVENT_DATE NEXT_DAY FROM (SELECT *, MIN(EVENT_DATE) DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID AND T1.DT = A.EVENT_DATE - 1) SELECT DT INSTALL_DT, COUNT(DT) INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) DAY1_RETENTION FROM TEMP GROUP BY 1"
240,Y,N,"WITH TMP1 AS ( SELECT *, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS ROW_INDEX FROM ACTIVITY ) , TMP2 AS (SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM TMP1 WHERE ROW_INDEX =1 GROUP BY 1), TMP3 AS (SELECT T2.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT T1.PLAYER_ID) AS DAY1_INSTALLS FROM (SELECT * FROM TMP1 WHERE ROW_INDEX = 2) T1 LEFT JOIN (SELECT * FROM TMP1 WHERE ROW_INDEX = 1) T2 ON T1.PLAYER_ID=T2.PLAYER_ID AND DATEDIFF(T1.EVENT_DATE,T2.EVENT_DATE)=1 GROUP BY 1) SELECT TMP2.INSTALL_DT, TMP2.INSTALLS, CAST(COALESCE(TMP3.DAY1_INSTALLS * 1.0 / TMP2.INSTALLS , 0) AS DEC(10,2)) AS DAY1_RETENTION FROM TMP2 LEFT JOIN TMP3 ON TMP2.INSTALL_DT=TMP3.INSTALL_DT"
241,Y,Y,"WITH USER_INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) SELECT UID.INSTALL_DATE AS INSTALL_DT, COUNT(1) AS INSTALLS, ROUND(SUM(A.PLAYER_ID IS NOT NULL) / COUNT(1), 2) AS DAY1_RETENTION FROM USER_INSTALL_DATE UID LEFT JOIN ACTIVITY A ON A.PLAYER_ID = UID.PLAYER_ID AND A.EVENT_DATE = (UID.INSTALL_DATE + 1) GROUP BY 1"
242,Y,Y,"SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(INSTALL_DT), 2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.INSTALL_DT + 1 ) AS T GROUP BY INSTALL_DT"
243,Y,Y,"WITH INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(DISTINCT I.PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN A.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END)/COUNT(DISTINCT I.PLAYER_ID), 2) DAY1_RETENTION FROM INSTALL I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND I.INSTALL_DT=A.EVENT_DATE-1 GROUP BY INSTALL_DT"
244,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.INSTALL_DT + 1) T GROUP BY INSTALL_DT"
245,Y,Y,"WITH CTE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS MIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT CTE.MIN_DATE AS INSTALL_DT, COUNT(CTE.PLAYER_ID) AS INSTALLS, ROUND(COUNT(ACTIVITY.PLAYER_ID)/COUNT(CTE.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE LEFT JOIN ACTIVITY ON CTE.MIN_DATE +1 = ACTIVITY.EVENT_DATE AND CTE.PLAYER_ID = ACTIVITY.PLAYER_ID GROUP BY CTE.MIN_DATE"
246,Y,N,"WITH FIRST_LOGIN AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT FIRST_LOGIN_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(AVG(CASE WHEN B.PLAYER_ID IS NULL THEN 0 ELSE 1 END),2) AS DAY1_RETENTION FROM FIRST_LOGIN A LEFT JOIN ACTIVITY B ON B.EVENT_DATE = A.FIRST_LOGIN_DATE + INTERVAL 1 DAY AND A.PLAYER_ID = B.PLAYER_ID GROUP BY FIRST_LOGIN_DATE"
247,Y,N,"WITH CTE AS ( SELECT *, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LOGIN_RANK FROM ACTIVITY ), CTE2 AS ( SELECT PLAYER_ID, MAX(CASE WHEN LOGIN_RANK=1 THEN EVENT_DATE ELSE NULL END) AS INSTALL_DT , MAX(CASE WHEN LOGIN_RANK=2 THEN EVENT_DATE ELSE NULL END) AS SECOND_LOGIN_DT FROM CTE WHERE LOGIN_RANK <= 2 GROUP BY 1 ) SELECT INSTALL_DT , COUNT(PLAYER_ID) AS INSTALLS , ROUND(AVG(CASE WHEN DATEDIFF(SECOND_LOGIN_DT, INSTALL_DT)=1 THEN 1 ELSE 0 END), 2) AS DAY1_RETENTION FROM CTE2 GROUP BY 1 ORDER BY 1"
248,Y,N,"WITH INSTALL_DETAILS AS ( SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT , SUM(INSTALL) AS INSTALLS , ROUND(SUM(RETENTION)/SUM(INSTALL),2) AS DAY1_RETENTION FROM ( SELECT I.PLAYER_ID ,INSTALL_DT ,1 AS INSTALL ,CASE WHEN A.PLAYER_ID THEN 1 ELSE 0 END AS RETENTION FROM INSTALL_DETAILS I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND A.EVENT_DATE = I.INSTALL_DT + INTERVAL 1 DAY ) C GROUP BY INSTALL_DT"
249,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.INSTALL_DT = A.EVENT_DATE - INTERVAL 1 DAY GROUP BY 1 ORDER BY 1"
250,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/ COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT + 1 = A2.EVENT_DATE ) T GROUP BY INSTALL_DT"
251,Y,N,"WITH CET1 AS ( SELECT DISTINCT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) T1 GROUP BY INSTALL_DT ), CET2 AS ( SELECT EVENT_DATE, COUNT(*) AS SECOND_LOGIN FROM ACTIVITY WHERE (PLAYER_ID, DATE_SUB(EVENT_DATE, INTERVAL 1 DAY)) IN ( SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID ) GROUP BY EVENT_DATE ) SELECT INSTALL_DT, INSTALLS, ROUND(IFNULL(SECOND_LOGIN, 0) / INSTALLS, 2) AS DAY1_RETENTION FROM CET1 LEFT JOIN CET2 ON CET1.INSTALL_DT = DATE_SUB(CET2.EVENT_DATE, INTERVAL 1 DAY)"
252,Y,Y,"SELECT C.INSTALL_DATE AS INSTALL_DT ,COUNT(DISTINCT C.PLAYER_ID) AS INSTALLS ,CAST(COUNT(DISTINCT CASE WHEN C.INSTALL_DATE +1 = C.EVENT_DATE THEN C.PLAYER_ID END)/COUNT(DISTINCT C.PLAYER_ID) AS DECIMAL(18,2))AS DAY1_RETENTION FROM ( SELECT A.* ,B.EVENT_DATE ,RANK()OVER(PARTITION BY A.PLAYER_ID, A.INSTALL_DATE ORDER BY B.EVENT_DATE ASC) AS EVENT_DT_RANK FROM ( SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE >A.INSTALL_DATE ) C WHERE C.EVENT_DT_RANK = 1 GROUP BY 1 ORDER BY 1 ASC"
253,Y,Y,"WITH T1 AS ( SELECT PLAYER_ID AS OG_PLAYER_ID, MIN(EVENT_DATE) AS LOGIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID), T2 AS ( SELECT * FROM T1 LEFT JOIN ACTIVITY A ON T1.LOGIN_DATE+1=A.EVENT_DATE AND T1.OG_PLAYER_ID=A.PLAYER_ID), T3 AS ( SELECT LOGIN_DATE AS INSTALL_DT, COUNT(OG_PLAYER_ID) AS INSTALLS, ROUND((COUNT(PLAYER_ID)/COUNT(OG_PLAYER_ID)),2) AS DAY1_RETENTION FROM T2 GROUP BY LOGIN_DATE) SELECT * FROM T3"
254,Y,N,"WITH PLAYER_MIN_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), RETAINED_OR_NOT AS ( SELECT A.PLAYER_ID, MIN(A.EVENT_DATE) AS INSTALL_DT, MAX(CASE WHEN P.INSTALL_DT IS NULL THEN 0 ELSE 1 END) AS RETAINED FROM ACTIVITY A LEFT JOIN PLAYER_MIN_DATE P ON A.PLAYER_ID = P.PLAYER_ID AND DATE_ADD(A.EVENT_DATE, INTERVAL -1 DAY) = INSTALL_DT GROUP BY 1 ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(AVG(RETAINED), 2) AS DAY1_RETENTION FROM RETAINED_OR_NOT GROUP BY 1"
255,Y,Y,"WITH CTE AS ( SELECT TB.*, A.EVENT_DATE AS RETEN FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) TB LEFT JOIN ACTIVITY A ON TB.PLAYER_ID = A.PLAYER_ID AND TB.INSTALL_DT +1 = A.EVENT_DATE) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(RETEN)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY 1"
256,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT T.INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(*), 2) AS DAY1_RETENTION FROM TEMP T LEFT JOIN ACTIVITY A ON T.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, T.INSTALL_DT)=1 GROUP BY T.INSTALL_DT"
257,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A1 JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
258,Y,N,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM T1 LEFT JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID AND DATE_ADD(T1.INSTALL_DT, INTERVAL 1 DAY) = A.EVENT_DATE GROUP BY T1.INSTALL_DT"
259,Y,Y,"WITH INSTALL_ AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), INSTALL_DT AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM INSTALL_ GROUP BY INSTALL_DT ), RETENTION AS ( SELECT I.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS RETENTION FROM INSTALL_ I JOIN ACTIVITY A ON I.INSTALL_DT = A.EVENT_DATE - 1 AND I.PLAYER_ID = A.PLAYER_ID GROUP BY I.INSTALL_DT ) SELECT I.INSTALL_DT AS INSTALL_DT, I.INSTALLS AS INSTALLS, ROUND((CASE WHEN R.RETENTION IS NULL THEN 0 ELSE R.RETENTION END)/I.INSTALLS,2) AS DAY1_RETENTION FROM INSTALL_DT I LEFT JOIN RETENTION R ON I.INSTALL_DT = R.INSTALL_DT"
260,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY AS A GROUP BY 1) SELECT CTE.INSTALL_DT, COUNT(DISTINCT CTE.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT C.PLAYER_ID)/COUNT(DISTINCT CTE.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE LEFT JOIN ACTIVITY AS C ON CTE.PLAYER_ID = C.PLAYER_ID AND DATEDIFF(C.EVENT_DATE,CTE.INSTALL_DT) = 1 GROUP BY 1 ORDER BY 1"
261,Y,N,"SELECT A.DAY_X AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS DAY_X FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(A.DAY_X, B.EVENT_DATE)=-1 GROUP BY A.DAY_X ORDER BY A.DAY_X"
262,Y,N,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT A.PLAYER_ID), 2) AS DAY1_RETENTION FROM ACTIVITY A JOIN INSTALL_DT I ON A.PLAYER_ID = I.PLAYER_ID GROUP BY 1"
263,Y,Y,"SELECT T1.INSTALL_DT, COUNT(T1.INSTALL_DT) AS INSTALLS, ROUND(COUNT(T2.EVENT_DATE)/COUNT(T1.INSTALL_DT), 2) AS DAY1_RETENTION FROM (SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID )AS T1 LEFT JOIN ACTIVITY AS T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DT+1 = T2.EVENT_DATE GROUP BY T1.INSTALL_DT"
264,Y,N,"WITH INSTALL_DT_PER_PLAYER AS ( SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT, ADDDATE(MIN(EVENT_DATE), INTERVAL 1 DAY) AS DAY_AFTER_INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT_PER_PLAYER.INSTALL_DT, COUNT(DISTINCT INSTALL_DT_PER_PLAYER.PLAYER_ID) AS INSTALLS, IFNULL( ROUND(NUM_RETAINED_PLAYERS / COUNT(DISTINCT INSTALL_DT_PER_PLAYER.PLAYER_ID), 2), 0 ) AS DAY1_RETENTION FROM INSTALL_DT_PER_PLAYER LEFT JOIN ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS NUM_RETAINED_PLAYERS FROM INSTALL_DT_PER_PLAYER WHERE (INSTALL_DT_PER_PLAYER.PLAYER_ID, INSTALL_DT_PER_PLAYER.DAY_AFTER_INSTALL_DT) IN ( SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY ) GROUP BY 1 ) T ON INSTALL_DT_PER_PLAYER.INSTALL_DT = T.INSTALL_DT GROUP BY INSTALL_DT"
265,Y,Y,"SELECT A.INSTALL_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN ACTIVITY B ON A.INSTALL_DATE + 1 = B.EVENT_DATE AND A.PLAYER_ID=B.PLAYER_ID GROUP BY A.INSTALL_DATE"
266,Y,N,"WITH T1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), T2 AS ( SELECT T1.PLAYER_ID, T1.INSTALL_DATE FROM T1, ACTIVITY A WHERE T1.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, T1.INSTALL_DATE)=1 ), T3 AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM T1 GROUP BY INSTALL_DATE ), T4 AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM T2 GROUP BY INSTALL_DATE ), T5 AS ( SELECT T3.INSTALL_DATE, T3.INSTALLS, COALESCE(T4.INSTALLS,0) AS R_COUNT FROM T3 LEFT JOIN T4 ON T3.INSTALL_DATE=T4.INSTALL_DATE ) SELECT INSTALL_DATE AS INSTALL_DT, INSTALLS, ROUND(R_COUNT/INSTALLS,2) AS DAY1_RETENTION FROM T5"
267,Y,N,"SELECT DISTINCT INSTALL_DT, COUNT(B.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE)/ COUNT(B.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) B LEFT JOIN ACTIVITY A ON B.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE,B.INSTALL_DT)=1 GROUP BY INSTALL_DT"
268,Y,N,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE,A.EVENT_DATE)=1 GROUP BY A.EVENT_DATE"
269,Y,Y,"SELECT C.INSTALL_DATE AS INSTALL_DT,COUNT(C.PLAYER_ID) AS INSTALLS ,ROUND(COUNT(D.PLAYER_ID)/COUNT(C.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) C LEFT OUTER JOIN ACTIVITY D ON C.PLAYER_ID=D.PLAYER_ID AND C.INSTALL_DATE+1=D.EVENT_DATE GROUP BY C.INSTALL_DATE"
270,Y,N,"WITH DATES_BY_PLAYER AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC ) AS RN FROM ACTIVITY), FIRST_JOIN AS ( SELECT PLAYER_ID, EVENT_DATE FROM DATES_BY_PLAYER WHERE RN = 1), INSTALL_RETENTION AS ( SELECT T1.EVENT_DATE AS INSTALL_DT, T2.EVENT_DATE RETENTION_DATE FROM DATES_BY_PLAYER T1 LEFT JOIN DATES_BY_PLAYER T2 ON T1.EVENT_DATE + INTERVAL 1 DAY = T2.EVENT_DATE AND T1.PLAYER_ID = T2.PLAYER_ID WHERE T1.RN = 1) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM( CASE WHEN RETENTION_DATE IS NOT NULL THEN 1 ELSE 0 END) * 1.00 / COUNT(*) ,2) AS DAY1_RETENTION FROM INSTALL_RETENTION GROUP BY INSTALL_DT"
271,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DT , COUNT(*) INSTALLS , ROUND(COUNT(EVENT_DATE) / COUNT(*),2) DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
272,Y,N,"WITH CTE AS ( SELECT A.PLAYER_ID,A.EVENT_DATE,B.INSTALL_DT, CASE WHEN DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) = EVENT_DATE THEN Y ELSE N END AS RETURNED FROM ACTIVITY A LEFT JOIN ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) B ON A.PLAYER_ID = B.PLAYER_ID ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(CASE WHEN RETURNED = 'Y' THEN 1 ELSE NULL END) / COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE GROUP BY 1"
273,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), DAILY_INSTALLS AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS D_INSTALLS FROM INSTALLS GROUP BY INSTALL_DATE ), VALID_PLAYERS AS ( SELECT ID.INSTALL_DATE, COUNT(DISTINCT ID.PLAYER_ID) AS GOOD_PLAYERS FROM ACTIVITY A LEFT JOIN INSTALLS ID ON A.PLAYER_ID = ID.PLAYER_ID AND A.EVENT_DATE = DATE_ADD(ID.INSTALL_DATE, INTERVAL 1 DAY) GROUP BY 1 ) SELECT D.INSTALL_DATE AS INSTALL_DT, D.D_INSTALLS AS INSTALLS, ROUND( IFNULL(GOOD_PLAYERS / D.D_INSTALLS, 0), 2) AS DAY1_RETENTION FROM DAILY_INSTALLS D LEFT JOIN ACTIVITY A ON A.EVENT_DATE = D.INSTALL_DATE LEFT JOIN VALID_PLAYERS VP ON D.INSTALL_DATE = VP.INSTALL_DATE GROUP BY D.INSTALL_DATE, D.D_INSTALLS"
274,Y,Y,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT(DISTINCT I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE) / COUNT(DISTINCT I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DT I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.INSTALL_DT + 1 = A.EVENT_DATE GROUP BY 1"
275,Y,N,"WITH ALLFIRSTDATE AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_DATE FROM ACTIVITY GROUP BY 1 ), FISTDATECOUNT AS ( SELECT FIRST_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM ALLFIRSTDATE GROUP BY 1 ), NEXTDAYPLAYS AS ( SELECT F.FIRST_DATE, COUNT(DISTINCT A.PLAYER_ID) AS PLAYS, COUNT(DISTINCT F.PLAYER_ID) AS INSTALLS FROM ALLFIRSTDATE AS F LEFT OUTER JOIN ACTIVITY AS A ON DATE_ADD(F.FIRST_DATE, INTERVAL 1 DAY) = A.EVENT_DATE AND F.PLAYER_ID = A.PLAYER_ID GROUP BY 1 ) SELECT FIRST_DATE AS INSTALL_DT, INSTALLS, ROUND( (1.00 * PLAYS)/ (1.00 * INSTALLS), 2) AS DAY1_RETENTION FROM NEXTDAYPLAYS"
276,Y,N,"WITH WF AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT COUNT(DISTINCT T1.PLAYER_ID) AS INSTALLS, T1.EVENT_DATE AS INSTALL_DT, ROUND (COUNT(DISTINCT T2.PLAYER_ID)/COUNT(DISTINCT T1.PLAYER_ID),2) AS DAY1_RETENTION FROM WF AS T1 LEFT JOIN ACTIVITY AS T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND DATEDIFF(T2.EVENT_DATE, T1.EVENT_DATE) = 1 GROUP BY INSTALL_DT"
277,Y,N,"WITH FIRST_DAY AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), RETENTION AS ( SELECT COUNT(PLAYER_ID) AS NUM_RETAIN, INSTALL_DT FROM FIRST_DAY WHERE (PLAYER_ID, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) GROUP BY INSTALL_DT) SELECT FD.INSTALL_DT, COUNT(DISTINCT FD.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(R.NUM_RETAIN,0)/COUNT(DISTINCT FD.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_DAY FD LEFT JOIN RETENTION R ON FD.INSTALL_DT = R.INSTALL_DT GROUP BY FD.INSTALL_DT"
278,Y,Y,"WITH TEMP1 AS ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RN FROM ACTIVITY) SELECT INSTALL_DT,INSTALLS, ROUND(NUM/INSTALLS,2) AS DAY1_RETENTION FROM( SELECT INSTALL_DT,COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, IFNULL(COUNT(DISTINCT B.PLAYER_ID),0) AS NUM FROM (SELECT DISTINCT A.EVENT_DATE AS INSTALL_DT,T.PLAYER_ID FROM ACTIVITY A LEFT JOIN TEMP1 T ON A.EVENT_DATE=T.EVENT_DATE WHERE T.RN=1 ) A LEFT JOIN ( SELECT DISTINCT EVENT_DATE,PLAYER_ID FROM TEMP1 WHERE RN=2 ) B ON A.INSTALL_DT=B.EVENT_DATE-1 AND A.PLAYER_ID=B.PLAYER_ID GROUP BY INSTALL_DT ) X"
279,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS FIRST_LOGIN FROM ACTIVITY ) SELECT DISTINCT FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE = DATE_ADD(FIRST_LOGIN, INTERVAL 1 DAY) THEN 1 ELSE 0 END) / COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY 1"
280,Y,Y,"SELECT T.EVENT_DATE AS INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, CAST(SUM(CASE WHEN T.DATE_ONE IS NULL THEN 0 ELSE 1 END)/COUNT(T.PLAYER_ID) AS DECIMAL(10,2)) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, A.EVENT_DATE, B.EVENT_DATE AS DATE_ONE FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) AS B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = A.EVENT_DATE + 1) AS T GROUP BY T.EVENT_DATE"
281,Y,N,"WITH INSTALL_DETAILS AS ( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, SUM(INSTALLS) AS INSTALLS, ROUND(SUM(RETENTION)/SUM(INSTALLS),2) AS DAY1_RETENTION FROM ( SELECT INSTALL_DT, 1 AS INSTALLS, CASE WHEN A.PLAYER_ID THEN 1 ELSE 0 END AS RETENTION FROM INSTALL_DETAILS I LEFT JOIN ACTIVITY A ON I.PLAYER_ID=A.PLAYER_ID AND DATE_ADD(I.INSTALL_DT, INTERVAL 1 DAY)=A.EVENT_DATE) T GROUP BY INSTALL_DT"
282,Y,N,"WITH T1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), T2 AS ( SELECT T0.PLAYER_ID, T0.INSTALL_DT, CASE WHEN A.PLAYER_ID IS NOT NULL THEN A.PLAYER_ID ELSE NULL END AS RETAINED_PLAYER_ID FROM ( SELECT PLAYER_ID, INSTALL_DT, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) AS NEXT_DATE FROM T1 ) T0 LEFT JOIN ACTIVITY A ON T0.PLAYER_ID = A.PLAYER_ID AND T0.NEXT_DATE = A.EVENT_DATE ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT RETAINED_PLAYER_ID)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM T2 GROUP BY INSTALL_DT"
283,Y,N,"SELECT INSTALL_DT,INSTALLS,ROUND(COUNT(O.PLAYER_ID)/INSTALLS,2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT, COUNT(*) OVER (PARTITION BY MIN(EVENT_DATE)) AS INSTALLS FROM ACTIVITY GROUP BY 1) A LEFT JOIN ACTIVITY O ON A.PLAYER_ID = O.PLAYER_ID AND A.INSTALL_DT = DATE_SUB(O.EVENT_DATE,INTERVAL 1 DAY) GROUP BY 1,2"
284,Y,Y,"SELECT DISTINCT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.RETENTION_DT)/COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) A LEFT JOIN ( SELECT DISTINCT A.PLAYER_ID, A.EVENT_DATE AS INSTALL_DT, B.EVENT_DATE AS RETENTION_DT FROM ACTIVITY A, ACTIVITY B WHERE A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE+1 = B.EVENT_DATE ) B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = B.INSTALL_DT GROUP BY 1"
285,Y,N,"SELECT SUB.INSTALL_DATE INSTALL_DT, COUNT(*) INSTALLS, ROUND(SUM(CASE WHEN ACT.EVENT_DATE IS NULL THEN 0 ELSE 1 END )/COUNT(*),2) DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SUB LEFT JOIN (SELECT DISTINCT PLAYER_ID, EVENT_DATE FROM ACTIVITY) ACT ON ACT.PLAYER_ID = SUB.PLAYER_ID AND ACT.EVENT_DATE = SUB.INSTALL_DATE + INTERVAL 1 DAY GROUP BY SUB.INSTALL_DATE ORDER BY SUB.INSTALL_DATE"
286,Y,N,"WITH TEMP1 AS ( SELECT *, DATEDIFF(EVENT_DATE,LOGIN_DATE)AS DIFF FROM( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE)OVER(PARTITION BY PLAYER_ID) AS LOGIN_DATE FROM ACTIVITY )T1 ) SELECT T1.LOGIN_DATE AS INSTALL_DT, INSTALLS, ROUND(IFNULL(DAY_RETENTION/INSTALLS,0),2) AS DAY1_RETENTION FROM (SELECT LOGIN_DATE, COUNT(DISTINCT PLAYER_ID)AS INSTALLS, IFNULL(COUNT(IF(DIFF=1,1,NULL)),0) AS DAY_RETENTION FROM TEMP1 GROUP BY LOGIN_DATE) T1"
287,Y,Y,"SELECT INSTALL_DT, SUM(CASE WHEN EVENT_DATE=INSTALL_DT THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE-INSTALL_DT = 1 THEN 1 ELSE 0 END)/ SUM(CASE WHEN EVENT_DATE = INSTALL_DT THEN 1 ELSE 0 END), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT FROM ACTIVITY) AS TEMP GROUP BY INSTALL_DT"
288,Y,Y,"SELECT INSTALL_DT,INSTALLS, ROUND( CAST(RETENTIONS AS DECIMAL(10,2) )/ CAST(INSTALLS AS DECIMAL(10,2) ) ,2 ) AS DAY1_RETENTION FROM ( SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, COUNT(DISTINCT B.PLAYER_ID) AS RETENTIONS FROM ( SELECT EVENT_DATE,PLAYER_ID,RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK,LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY )A LEFT OUTER JOIN ACTIVITY B ON A.EVENT_DATE = B.EVENT_DATE-1 AND A.PLAYER_ID = B.PLAYER_ID WHERE A.RNK=1 GROUP BY 1 )TBL"
289,Y,Y,"WITH RE AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS RETEN FROM ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) T WHERE EVENT_DATE = INSTALL_DT + 1 GROUP BY INSTALL_DT ), INSTALLS AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM ( SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) TEMP GROUP BY INSTALL_DT ) SELECT A.INSTALL_DT, A.INSTALLS, IFNULL(ROUND(B.RETEN/A.INSTALLS,2),0.00) AS DAY1_RETENTION FROM INSTALLS A LEFT JOIN RE B ON A.INSTALL_DT = B.INSTALL_DT"
290,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE,LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DAY, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXT_DAY-1=EVENT_DATE THEN 1 ELSE 0 END ) * 1.0/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE WHERE RK=1 GROUP BY EVENT_DATE"
291,Y,N,"WITH CTE1 AS (SELECT MIN(EVENT_DATE) AS INSTALL_DT , PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID), CTE2 AS (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM CTE1 GROUP BY INSTALL_DT), CTE3 AS (SELECT CTE1.PLAYER_ID, INSTALL_DT, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) AS SECOND_DAY FROM CTE1), CTE4 AS (SELECT CTE3.PLAYER_ID, CTE3.INSTALL_DT FROM CTE3 JOIN ACTIVITY A ON CTE3.PLAYER_ID=A.PLAYER_ID AND CTE3.SECOND_DAY=A.EVENT_DATE), CTE5 AS (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS NUM1 FROM CTE4 GROUP BY INSTALL_DT) SELECT CTE2.INSTALL_DT, INSTALLS, ROUND(IFNULL(NUM1, 0)/INSTALLS, 2) AS DAY1_RETENTION FROM CTE2 LEFT JOIN CTE5 ON CTE2.INSTALL_DT=CTE5.INSTALL_DT"
292,Y,Y,"WITH PLAYER_INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) , DAY1_LOGIN AS ( SELECT A.PLAYER_ID, A.INSTALL_DATE, CASE WHEN B.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END AS DAY1_LOGIN FROM ( SELECT * FROM PLAYER_INSTALL_DATES ) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DATE + 1 = B.EVENT_DATE ) SELECT A.INSTALL_DATE AS INSTALL_DT, B.INSTALLS, ROUND(A.DAY1_LOGINS / B.INSTALLS,2) AS DAY1_RETENTION FROM ( SELECT INSTALL_DATE, SUM(DAY1_LOGIN) AS DAY1_LOGINS FROM DAY1_LOGIN GROUP BY 1 ) A LEFT JOIN ( SELECT INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM PLAYER_INSTALL_DATES GROUP BY 1 ) B ON A.INSTALL_DATE = B.INSTALL_DATE"
293,Y,N,"SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT DISTINCT PLAYER_ID, FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT FROM ACTIVITY ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE, A.INSTALL_DT) = 1 GROUP BY A.INSTALL_DT"
294,Y,Y,"WITH T1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), T2 AS ( SELECT A.PLAYER_ID, B.INSTALL_DT, A.EVENT_DATE FROM ACTIVITY A LEFT JOIN T1 B ON A.PLAYER_ID=B.PLAYER_ID WHERE A.EVENT_DATE = B.INSTALL_DT + 1 ), T3 AS ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM T1 GROUP BY INSTALL_DT ), T4 AS ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS DAY1 FROM T2 GROUP BY INSTALL_DT ) SELECT A.INSTALL_DT, A.INSTALLS, CASE WHEN B.DAY1 IS NOT NULL THEN ROUND(B.DAY1/A.INSTALLS, 2) ELSE ROUND(0, 2) END AS DAY1_RETENTION FROM T3 A LEFT JOIN T4 B ON A.INSTALL_DT=B.INSTALL_DT"
295,Y,N,"WITH T0 AS (SELECT * FROM (SELECT *, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN_DATE FROM ACTIVITY) T WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID , MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID)) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND((SUM(CASE WHEN DATEDIFF(NEXT_LOGIN_DATE, EVENT_DATE) = 1 THEN 1 ELSE 0 END))/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM T0 GROUP BY EVENT_DATE"
296,Y,Y,"SELECT INSTALL_DATE AS INSTALL_DT , COUNT(*) AS INSTALLS , ROUND(COUNT(B.PLAYER_ID)/COUNT(*),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.INSTALL_DATE=B.EVENT_DATE-1 GROUP BY INSTALL_DATE"
297,Y,Y,"WITH INSTALLDATE AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT ,COUNT(DISTINCT PLAYER_ID) FROM ACTIVITY A GROUP BY PLAYER_ID ), NEXTDAY AS ( SELECT A.PLAYER_ID, A.INSTALL_DT, B.EVENT_DATE AS NEXT_DAY FROM INSTALLDATE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND B.EVENT_DATE=A.INSTALL_DT+1 ) SELECT INSTALL_DT ,COUNT(PLAYER_ID) AS INSTALLS ,ROUND(COUNT(NEXT_DAY)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM NEXTDAY GROUP BY INSTALL_DT"
298,Y,N,"WITH FIRST_LOGINS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(FIRST_LOGINS.INSTALL_DT) AS INSTALLS, ROUND(1.0 * COUNT(DISTINCT ACTIVITY.PLAYER_ID)/COUNT(INSTALL_DT), 2) AS DAY1_RETENTION FROM FIRST_LOGINS LEFT JOIN ACTIVITY ON FIRST_LOGINS.PLAYER_ID = ACTIVITY.PLAYER_ID AND FIRST_LOGINS.INSTALL_DT = ACTIVITY.EVENT_DATE - INTERVAL 1 DAY GROUP BY 1"
299,Y,Y,"WITH TABLE1 AS (SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANK_DATE FROM ACTIVITY) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXTD-INSTALL_DT = 1 THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, A.EVENT_DATE AS INSTALL_DT, B.EVENT_DATE AS NEXTD FROM (SELECT PLAYER_ID, EVENT_DATE FROM TABLE1 WHERE RANK_DATE=1)A LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE FROM TABLE1 WHERE RANK_DATE=2)B ON A.PLAYER_ID=B.PLAYER_ID)C GROUP BY 1 ORDER BY 1"
300,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT T1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT T1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS T1 JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID GROUP BY INSTALL_DT"
301,Y,Y,"WITH CTE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), CTE1 AS (SELECT CTE.PLAYER_ID, INSTALL_DT, EVENT_DATE FROM CTE LEFT JOIN ACTIVITY A ON CTE.PLAYER_ID=A.PLAYER_ID AND A.EVENT_DATE=CTE.INSTALL_DT+1) SELECT DISTINCT INSTALL_DT, COUNT(PLAYER_ID) OVER(PARTITION BY INSTALL_DT) AS INSTALLS, ROUND(COUNT(EVENT_DATE) OVER(PARTITION BY INSTALL_DT)/(COUNT(PLAYER_ID) OVER(PARTITION BY INSTALL_DT) ),2) AS DAY1_RETENTION FROM CTE1"
302,Y,N,"SELECT INSTALL_DT,COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM(SELECT A.*,B.EVENT_DATE FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE,A.INSTALL_DT)=1) C GROUP BY INSTALL_DT"
303,Y,N,"WITH CTE AS ( SELECT *, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ACTIVITY_RANK, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE),EVENT_DATE) AS DATE_DIFFRENCE FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT , COUNT(PLAYER_ID) AS INSTALLS , ROUND(SUM(CASE WHEN DATE_DIFFRENCE=1 THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE WHERE ACTIVITY_RANK=1 GROUP BY 1"
304,Y,Y,"WITH CTE1 AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), CTE2 AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM CTE1 GROUP BY INSTALL_DT ), CTE3 AS ( SELECT B.INSTALL_DT, A.PLAYER_ID FROM CTE1 AS B LEFT JOIN ACTIVITY AS A ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE-1 = B.INSTALL_DT WHERE B.INSTALL_DT IS NOT NULL ), CTE4 AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS NUM_RETENTION FROM CTE3 GROUP BY INSTALL_DT ) SELECT A.INSTALL_DT, A.INSTALLS, ROUND(IFNULL(B.NUM_RETENTION/A.INSTALLS,0),2) AS DAY1_RETENTION FROM CTE2 AS A LEFT JOIN CTE4 AS B ON A.INSTALL_DT = B.INSTALL_DT"
305,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.INSTALL_DT + 1) T GROUP BY INSTALL_DT"
306,Y,N,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE, INSTALL_DATE, DATEDIFF(EVENT_DATE,INSTALL_DATE) DATEDIFF FROM ( SELECT PLAYER_ID,EVENT_DATE, MIN(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) INSTALL_DATE FROM ACTIVITY) X ) SELECT INSTALL_DATE INSTALL_DT, COUNT(DISTINCT PLAYER_ID) INSTALLS , ROUND( SUM(CASE WHEN DATEDIFF = 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM CTE GROUP BY INSTALL_DATE"
307,Y,N,"WITH CTE AS ( SELECT *, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS EVENT_ID, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(NEXT_LOGIN = DATE_ADD(EVENT_DATE, INTERVAL 1 DAY), 1, 0))/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM CTE WHERE EVENT_ID = 1 GROUP BY 1"
308,Y,Y,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A1.EVENT_DATE+1 = A1.NEXT_DATE THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE FROM ACTIVITY ) A1 WHERE A1.RN=1 GROUP BY A1.EVENT_DATE"
309,Y,N,"WITH INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(A.PLAYER_ID) INSTALLS, ROUND(COUNT(B.PLAYER_ID) / COUNT(A.PLAYER_ID), 2) DAY1_RETENTION FROM INSTALL_DATES A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = DATE_ADD(B.EVENT_DATE, INTERVAL -1 DAY) GROUP BY INSTALL_DT"
310,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END )/ COUNT(DISTINCT A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A1 JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
311,Y,N,"WITH CTE AS ( SELECT PLAYER_ID AS PLAYER_ID , EVENT_DATE AS EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS INSTALL_DT_RANK, IFNULL(LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC), EVENT_DATE) AS NEXT_EVENT_DATE FROM ACTIVITY ORDER BY EVENT_DATE ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(DATE_ADD(EVENT_DATE,INTERVAL 1 DAY) =NEXT_EVENT_DATE, 1,0))/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE AS CTE WHERE INSTALL_DT_RANK =1 GROUP BY EVENT_DATE"
312,Y,N,"WITH RK AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS F_DATE FROM ACTIVITY GROUP BY PLAYER_ID), MPP AS (SELECT PLAYER_ID, F_DATE, DATE_ADD(F_DATE ,INTERVAL 1 DAY) AS S_DATE FROM RK), FP AS (SELECT A.PLAYER_ID, A.F_DATE, A.S_DATE, CASE WHEN B.EVENT_DATE IS NULL THEN 0 ELSE 1 END AS ACT FROM MPP A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.S_DATE=B.EVENT_DATE) SELECT F_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(ACT)/COUNT(ACT),2) AS DAY1_RETENTION FROM FP GROUP BY INSTALL_DT"
313,Y,Y,"WITH CTE AS (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, EVENT_DATE FROM ACTIVITY) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(EVENT_DATE-INSTALL_DT=1,1,0))/ COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
314,Y,N,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, EVENT_DATE FROM (SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) ROW_ID FROM ACTIVITY) TEMP WHERE ROW_ID = 1) SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID) * 1.0 / COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND DATE_ADD(B.EVENT_DATE, INTERVAL -1 DAY) = A.EVENT_DATE GROUP BY A.EVENT_DATE"
315,Y,N,"WITH PLAYER_FIRST_LOGIN AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY 1 ), PLAYER_SECOND_DAY AS ( SELECT A.PLAYER_ID, A.FIRST_LOGIN, B.EVENT_DATE FROM PLAYER_FIRST_LOGIN AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE, A.FIRST_LOGIN) = 1 ) SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT CASE WHEN EVENT_DATE IS NOT NULL THEN PLAYER_ID END)/ COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM PLAYER_SECOND_DAY GROUP BY 1"
316,Y,N,"WITH INSTALL AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1), RETAINTED_USERS AS ( SELECT B.INSTALL_DATE , COUNT(DISTINCT A.PLAYER_ID) AS CNT_RETAINERS FROM ACTIVITY A JOIN INSTALL B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = B.INSTALL_DATE + INTERVAL 1 DAY GROUP BY 1) SELECT A.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COALESCE(CNT_RETAINERS,0) * 1.0 / COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL A LEFT JOIN RETAINTED_USERS B ON A.INSTALL_DATE = B.INSTALL_DATE GROUP BY 1, CNT_RETAINERS"
317,Y,Y,"WITH FIRSTINSTALL AS (SELECT MIN(EVENT_DATE) FIRSTINSTALLDT,PLAYER_ID FROM ACTIVITY GROUP BY 2) SELECT FI.FIRSTINSTALLDT INSTALL_DT, COUNT(FI.PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN AC.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END) /COUNT(FI.PLAYER_ID),2) DAY1_RETENTION FROM FIRSTINSTALL FI LEFT JOIN ACTIVITY AC ON FI.PLAYER_ID=AC.PLAYER_ID AND AC.EVENT_DATE-FI.FIRSTINSTALLDT=1 GROUP BY 1"
318,Y,N,"SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(B.EVENT_DATE, INSTALL_DT)=1 THEN 1 ELSE 0 END)/ COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID GROUP BY INSTALL_DT"
319,Y,N,"WITH T AS (SELECT PLAYER_ID, EVENT_DATE, GAMES_PLAYED, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATE_NEXT_LOGIN, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(DATE_NEXT_LOGIN, EVENT_DATE) = 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM T WHERE RK = 1 GROUP BY 1"
320,Y,N,"WITH AGG_T AS (SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RN, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NXT_DAY FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NXT_DAY, EVENT_DATE)=1 THEN 1 ELSE 0 END)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM AGG_T WHERE RN = 1 GROUP BY EVENT_DATE ORDER BY EVENT_DATE"
321,Y,Y,"SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS,ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) AS A LEFT JOIN ACTIVITY AS B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT + 1 = B.EVENT_DATE GROUP BY INSTALL_DT"
322,Y,Y,"WITH CTE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1), CTE2 AS (SELECT A.PLAYER_ID, A.INSTALL_DT, B.EVENT_DATE NXTDAY FROM CTE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT + 1 = B.EVENT_DATE) SELECT INSTALL_DT, COUNT(PLAYER_ID) INSTALLS, ROUND(COUNT(NXTDAY) / COUNT(PLAYER_ID), 2) DAY1_RETENTION FROM CTE2 GROUP BY 1"
323,Y,N,"WITH FIRST_LOG AS ( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY 2 ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(IFNULL(COUNT(RETENTION_DT), 0) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT F.PLAYER_ID, F.INSTALL_DT, A.EVENT_DATE AS RETENTION_DT FROM FIRST_LOG F LEFT JOIN ACTIVITY A ON F.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, F.INSTALL_DT) = 1 ) SUB GROUP BY 1"
324,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/COUNT(PLAYER), 2) AS DAY1_RETENTION FROM (SELECT B.PLAYER_ID AS PLAYER, B.FIRST_DATE AS INSTALL_DT, A.EVENT_DATE AS NEXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_DATE FROM ACTIVITY GROUP BY PLAYER_ID) B LEFT JOIN ACTIVITY A ON (A.PLAYER_ID = B.PLAYER_ID) AND (A.EVENT_DATE = B.FIRST_DATE + 1)) T GROUP BY T.INSTALL_DT"
325,Y,Y,"WITH FIRST_LOGIN AS ( SELECT *, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN, LAG(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS PREV_LOGIN FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IF(NEXT_LOGIN = EVENT_DATE + 1, 1, 0)) / (COUNT(*)),2) AS DAY1_RETENTION FROM FIRST_LOGIN WHERE PREV_LOGIN IS NULL GROUP BY EVENT_DATE ORDER BY EVENT_DATE"
326,Y,N,"WITH TEMP1 AS ( SELECT *, DATEDIFF(EVENT_DATE,LOGIN_DATE)AS DIFF FROM( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE)OVER(PARTITION BY PLAYER_ID) AS LOGIN_DATE FROM ACTIVITY )T1 ) SELECT T1.LOGIN_DATE AS INSTALL_DT, INSTALLS, ROUND(IFNULL(DAY_RETENTION/INSTALLS,0),2) AS DAY1_RETENTION FROM (SELECT LOGIN_DATE, COUNT(DISTINCT PLAYER_ID)AS INSTALLS FROM TEMP1 GROUP BY LOGIN_DATE)T1 LEFT JOIN( SELECT LOGIN_DATE, IFNULL(COUNT(IF(DIFF=1,1,NULL)),0) AS DAY_RETENTION FROM TEMP1 GROUP BY LOGIN_DATE) T2 ON T1.LOGIN_DATE=T2.LOGIN_DATE"
327,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, EVENT_DATE FROM( SELECT *, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANKING FROM ACTIVITY )A WHERE A.RANKING =1 ), TEMP2 AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM TEMP GROUP BY EVENT_DATE ), TEMP3 AS ( SELECT T.EVENT_DATE, COUNT(A.PLAYER_ID) AS CT FROM TEMP AS T LEFT JOIN ACTIVITY AS A ON T.PLAYER_ID = A.PLAYER_ID AND T.EVENT_DATE = A.EVENT_DATE - INTERVAL 1 DAY GROUP BY T.EVENT_DATE ) SELECT TEMP2.EVENT_DATE AS INSTALL_DT, TEMP2.INSTALLS, ROUND((TEMP3.CT/TEMP2.INSTALLS),2) AS DAY1_RETENTION FROM TEMP2 JOIN TEMP3 ON TEMP2.EVENT_DATE = TEMP3.EVENT_DATE"
328,Y,N,"WITH TMP4 AS (WITH TMP3 AS (WITH TMP2 AS (WITH TMP AS (SELECT PLAYER_ID, MIN(EVENT_DATE) START FROM ACTIVITY GROUP BY PLAYER_ID) SELECT A.PLAYER_ID, A.EVENT_DATE, TMP.START, LEAD(EVENT_DATE, 1, EVENT_DATE) OVER (PARTITION BY A.PLAYER_ID ORDER BY EVENT_DATE) AS NXT FROM ACTIVITY A LEFT JOIN TMP ON A.EVENT_DATE = TMP.START AND A.PLAYER_ID = TMP.PLAYER_ID ORDER BY A.PLAYER_ID, A.EVENT_DATE) SELECT *, SUM(CASE WHEN DATEDIFF(NXT, EVENT_DATE) = 1 AND START IS NOT NULL THEN 1 ELSE 0 END) OVER (PARTITION BY PLAYER_ID) AS CNT FROM TMP2) SELECT PLAYER_ID, EVENT_DATE, CNT FROM TMP3 WHERE START IS NOT NULL) SELECT DISTINCT EVENT_DATE INSTALL_DT,SUM(1) OVER (PARTITION BY EVENT_DATE) AS INSTALLS, ROUND((SUM(CNT) OVER (PARTITION BY EVENT_DATE))/(SUM(1) OVER (PARTITION BY EVENT_DATE)),2) DAY1_RETENTION FROM TMP4"
329,Y,N,"WITH CTE AS ( SELECT *, CASE WHEN DATEDIFF(MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)) = -1 THEN 1 ELSE 0 END AS RETENTION, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID) AS ROWNUM FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS ,ROUND(SUM(RETENTION)/COUNT(EVENT_DATE),2) AS DAY1_RETENTION FROM CTE C1 WHERE ROWNUM = 1 GROUP BY EVENT_DATE"
330,Y,N,"SELECT C.EVENT_DATE AS INSTALL_DT, SUM(FIRST_DAY) AS INSTALLS, ROUND(SUM(CASE WHEN DAYS=1 AND FIRST_DAY=1 THEN 1 ELSE 0 END)/SUM(FIRST_DAY),2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, DATEDIFF(A.NEXT_DATE, A.EVENT_DATE) AS DAYS,A.EVENT_DATE, CASE WHEN A.EVENT_DATE=B.MIN_DATE THEN 1 ELSE 0 END AS FIRST_DAY FROM (SELECT PLAYER_ID, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, EVENT_DATE FROM ACTIVITY) AS A INNER JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS MIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS B ON A.PLAYER_ID=B.PLAYER_ID) AS C WHERE C.FIRST_DAY=1 GROUP BY C.EVENT_DATE ORDER BY C.EVENT_DATE"
331,Y,Y,"WITH CTE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT C.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT C.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(COUNT(DISTINCT A.PLAYER_ID), 0)/COUNT(DISTINCT C.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE C LEFT JOIN ACTIVITY A ON C.INSTALL_DATE = A.EVENT_DATE - 1 AND C.PLAYER_ID = A.PLAYER_ID GROUP BY INSTALL_DT"
332,Y,N,"WITH T1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), T2 AS ( SELECT *, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) AS DAY_AFTER FROM T1 ), T3 AS ( SELECT T2.INSTALL_DT, COUNT(T2.PLAYER_ID) AS NUM_RETURN FROM ACTIVITY A INNER JOIN T2 ON A.PLAYER_ID = T2.PLAYER_ID AND A.EVENT_DATE = T2.DAY_AFTER GROUP BY T2.INSTALL_DT ) SELECT TEMP.INSTALL_DT, INSTALLS, COALESCE(ROUND(NUM_RETURN/INSTALLS,2),0) AS DAY1_RETENTION FROM (SELECT INSTALL_DT, COUNT(*) AS INSTALLS FROM T1 GROUP BY INSTALL_DT) TEMP LEFT JOIN T3 ON TEMP.INSTALL_DT = T3.INSTALL_DT"
333,Y,Y,"WITH PREP AS ( SELECT PLAYER_ID, EVENT_DATE, EVENT_DATE+1 AS NEXT_DAY, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) LEAD_DAY, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RANKING FROM ACTIVITY ) SELECT EVENT_DATE INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT CASE WHEN NEXT_DAY=LEAD_DAY THEN PLAYER_ID ELSE NULL END)*1.0/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM PREP WHERE RANKING=1 GROUP BY 1"
334,Y,N,"WITH CTE1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A GROUP BY PLAYER_ID) SELECT A.INSTALL_DT, COUNT(A.INSTALL_DT) AS INSTALLS, ROUND(COUNT(B.EVENT_DATE) / COUNT(A.INSTALL_DT), 2) AS DAY1_RETENTION FROM CTE1 A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = B.EVENT_DATE - INTERVAL 1 DAY GROUP BY A.INSTALL_DT"
335,Y,N,"WITH PLAYERINFO AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), PLAYERRET AS ( SELECT INSTALL_DATE, PI.PLAYER_ID FROM PLAYERINFO PI JOIN ACTIVITY ACT ON PI.PLAYER_ID = ACT.PLAYER_ID AND DATEDIFF(ACT.EVENT_DATE, INSTALL_DATE) = 1 ) SELECT PI.INSTALL_DATE AS INSTALL_DT, INSTALLS, ROUND(COALESCE(RETENTION, 0) / INSTALLS, 2) AS DAY1_RETENTION FROM (SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM PLAYERINFO GROUP BY 1) PI LEFT JOIN (SELECT INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS RETENTION FROM PLAYERRET GROUP BY 1) PR USING (INSTALL_DATE) GROUP BY PI.INSTALL_DATE ORDER BY 1"
336,Y,N,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(*), 2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT)=1 GROUP BY INSTALL_DT"
337,Y,N,"WITH CTE AS (SELECT PLAYER_ID ,EVENT_DATE ,LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RETEND_DATE ,RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS DATE_RANK FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT ,COUNT(DISTINCT PLAYER_ID) AS INSTALLS ,ROUND(1.00*COUNT(DISTINCT CASE WHEN DATEDIFF(RETEND_DATE,EVENT_DATE)=1 THEN PLAYER_ID END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT * FROM CTE WHERE DATE_RANK = 1) TEMP GROUP BY 1"
338,Y,Y,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), CTE AS ( SELECT A.PLAYER_ID, INSTALL_DT, B.EVENT_DATE FROM INSTALL_DT A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT+1 = B.EVENT_DATE ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END) /COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
339,Y,Y,"SELECT INSTALL_DT, COUNT(D1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(D2.PLAYER_ID)/CAST(COUNT(D1.PLAYER_ID) AS DECIMAL), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) D1 LEFT JOIN ACTIVITY D2 ON D1.PLAYER_ID = D2.PLAYER_ID AND D1.INSTALL_DT + 1 = D2.EVENT_DATE GROUP BY 1"
340,Y,N,"SELECT INSTALL_DT, COUNT(D1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(CASE WHEN D2.PLAYER_ID THEN D2.PLAYER_ID ELSE NULL END)/CAST(COUNT(D1.PLAYER_ID) AS DECIMAL), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) D1 LEFT JOIN ACTIVITY D2 ON D1.PLAYER_ID = D2.PLAYER_ID AND D1.INSTALL_DT + 1 = D2.EVENT_DATE GROUP BY 1"
341,Y,Y,"WITH ACTIVITY_UPDATED AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DATE, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_PLAY_DATE FROM ACTIVITY ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXT_PLAY_DATE - INSTALL_DATE = 1 THEN 1 ELSE 0 END) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ACTIVITY_UPDATED WHERE EVENT_DATE = INSTALL_DATE GROUP BY 1 ORDER BY 1"
342,Y,Y,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT( I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(EVENT_DATE) / COUNT(DISTINCT I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DT I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.INSTALL_DT + 1 = A.EVENT_DATE GROUP BY 1"
343,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY) / COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DAY FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A1 LEFT JOIN ACTIVITY AS A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A2.EVENT_DATE = A1.INSTALL_DT + 1 ) AS T GROUP BY INSTALL_DT"
344,Y,Y,"WITH CTE1 AS(SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), CTE2 AS( SELECT CTE1.PLAYER_ID,INSTALL_DT, CASE WHEN A.PLAYER_ID IS NULL THEN 0 ELSE 1 END AS RN1 FROM CTE1 LEFT JOIN ACTIVITY A ON CTE1.PLAYER_ID=A.PLAYER_ID AND CTE1.INSTALL_DT+1=A.EVENT_DATE ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(RN1)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DT"
345,Y,N,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS , ROUND(COUNT(DISTINCT A2.PLAYER_ID)/ COUNT(DISTINCT A1.PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON DATEDIFF(A2.EVENT_DATE,A1.EVENT_DATE) = 1 AND A1.PLAYER_ID = A2.PLAYER_ID WHERE (A1.PLAYER_ID,A1.EVENT_DATE) IN ( SELECT PLAYER_ID,EVENT_DATE FROM (SELECT PLAYER_ID , MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) J ) GROUP BY A1.EVENT_DATE"
346,Y,Y,"WITH INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(INSTALL_DT) INSTALLS, ROUND(COUNT(A.EVENT_DATE-1)/COUNT(INSTALL_DT), 2) DAY1_RETENTION FROM INSTALL I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND I.INSTALL_DT=A.EVENT_DATE-1 GROUP BY INSTALL_DT"
347,Y,Y,"SELECT DISTINCT INSTALL_DT, SUM(CASE WHEN INSTALL_DT=EVENT_DATE THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM( CASE WHEN EVENT_DATE-INSTALL_DT=1 THEN 1 ELSE 0 END)/ SUM(CASE WHEN INSTALL_DT=EVENT_DATE THEN 1 ELSE 0 END),2)AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT, EVENT_DATE FROM ACTIVITY ) AS TEMP GROUP BY INSTALL_DT"
348,Y,Y,"SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID)A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = B.EVENT_DATE-1 GROUP BY A.INSTALL_DT"
349,Y,N,"SELECT A1.EVENT_DATE AS INSTALL_DT , COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS ,IFNULL(ROUND(COUNT(DISTINCT A2.PLAYER_ID) / COUNT(DISTINCT A1.PLAYER_ID ),2),0) AS DAY1_RETENTION FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON DATEDIFF(A2.EVENT_DATE,A1.EVENT_DATE) = 1 AND A1.PLAYER_ID = A2.PLAYER_ID WHERE (A1.PLAYER_ID ,A1.EVENT_DATE) IN (SELECT PLAYER_ID , MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY A1.EVENT_DATE"
350,Y,Y,"WITH INSTALLS AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(DAY_1_ACTIVITY)/COUNT(*), 2) AS DAY1_RETENTION FROM( SELECT A.PLAYER_ID, A.INSTALL_DT, B.PLAYER_ID AS DAY_1_ACTIVITY FROM INSTALLS A LEFT JOIN ACTIVITY B ON( A.PLAYER_ID=B.PLAYER_ID AND INSTALL_DT+1 = B.EVENT_DATE ) ) AA GROUP BY INSTALL_DT"
351,Y,Y,"WITH CT1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1 ) SELECT CT1.EVENT_DATE AS INSTALL_DT, COUNT(CT1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(CT1.PLAYER_ID),2) AS DAY1_RETENTION FROM CT1 LEFT JOIN ACTIVITY A ON A.PLAYER_ID = CT1.PLAYER_ID AND A.EVENT_DATE = CT1.EVENT_DATE +1 GROUP BY 1"
352,Y,N,"WITH TMP AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1), TMP2 AS (SELECT T.PLAYER_ID, T.INSTALL_DT, A.EVENT_DATE FROM TMP T LEFT JOIN ACTIVITY A ON DATEDIFF(T.INSTALL_DT, A.EVENT_DATE) = -1 AND T.PLAYER_ID = A.PLAYER_ID) SELECT INSTALL_DT, COUNT(INSTALL_DT) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/ COUNT(INSTALL_DT), 2) AS DAY1_RETENTION FROM TMP2 GROUP BY 1"
353,Y,N,"SELECT A1.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS , ROUND(COUNT(DISTINCT A2.PLAYER_ID)/ COUNT(*),2) AS DAY1_RETENTION FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON DATEDIFF(A2.EVENT_DATE,A1.EVENT_DATE) = 1 AND A1.PLAYER_ID = A2.PLAYER_ID WHERE (A1.PLAYER_ID,A1.EVENT_DATE) IN ( SELECT PLAYER_ID,EVENT_DATE FROM (SELECT PLAYER_ID , MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) J ) GROUP BY A1.EVENT_DATE"
354,Y,Y,"WITH TEMP AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(RET_PLAYER)/ COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT T.PLAYER_ID, T.INSTALL_DT, CASE WHEN A.EVENT_DATE = T.INSTALL_DT +1 THEN 1 ELSE 0 END AS RET_PLAYER FROM TEMP T JOIN ACTIVITY A ON T.PLAYER_ID = A.PLAYER_ID) MAIN GROUP BY INSTALL_DT"
355,Y,N,"SELECT INSTALL_DATE INSTALL_DT, COUNT(DISTINCT T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT (CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DATE) = 1 THEN T2.PLAYER_ID END ))/COUNT(DISTINCT T1.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) T2 USING(PLAYER_ID) GROUP BY INSTALL_DT"
356,Y,Y,"WITH CTE AS (SELECT MIN(EVENT_DATE) AS FIRST, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) SELECT B.FIRST AS INSTALL_DT, COUNT(FIRST)AS INSTALLS, ROUND(COUNT(NEXT)/COUNT(FIRST),2)AS DAY1_RETENTION FROM (SELECT CTE.PLAYER_ID, CTE.FIRST, A.EVENT_DATE AS NEXT FROM CTE LEFT JOIN ACTIVITY A ON CTE.PLAYER_ID = A.PLAYER_ID AND CTE.FIRST + 1 = A.EVENT_DATE)B GROUP BY 1"
357,Y,Y,"SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND( COUNT(RETURNED_USERS)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT T1.PLAYER_ID, T1.INSTALL_DT, T2.PLAYER_ID AS RETURNED_USERS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DT + 1 = T2.EVENT_DATE) T GROUP BY INSTALL_DT"
358,Y,Y,"WITH TB AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS MIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID), TB2 AS( SELECT B.MIN_DATE, COUNT(*) AS INSTALLS FROM TB B JOIN ACTIVITY A ON A.EVENT_DATE = B.MIN_DATE AND A.PLAYER_ID = B.PLAYER_ID GROUP BY B.MIN_DATE), TB3 AS (SELECT B.MIN_DATE, COUNT(*) AS NUM FROM TB B JOIN ACTIVITY A ON A.EVENT_DATE = B.MIN_DATE+1 AND A.PLAYER_ID = B.PLAYER_ID GROUP BY B.MIN_DATE), TB4 AS (SELECT * FROM TB3 A UNION SELECT TB.MIN_DATE, 0 FROM TB WHERE TB.MIN_DATE NOT IN(SELECT MIN_DATE FROM TB3)) SELECT B.MIN_DATE AS INSTALL_DT, B.INSTALLS, ROUND(C.NUM/B.INSTALLS,2) AS DAY1_RETENTION FROM TB2 B JOIN TB4 C ON B.MIN_DATE = C.MIN_DATE"
359,Y,N,"WITH CTE AS (SELECT *,RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANK , LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY) SELECT INSTALL_DT,INSTALLS,ROUND(IFNULL(RETENTION,0)/INSTALLS,2) DAY1_RETENTION FROM (SELECT EVENT_DATE INSTALL_DT ,COUNT(PLAYER_ID) INSTALLS FROM CTE WHERE CTE.RANK=1 GROUP BY EVENT_DATE) A LEFT JOIN (SELECT EVENT_DATE INSTALL_DT,COUNT(DISTINCT PLAYER_ID) RETENTION FROM CTE WHERE CTE.RANK=1 AND DATEDIFF(NEXT_LOGIN,EVENT_DATE)=1 GROUP BY EVENT_DATE) B USING(INSTALL_DT) ORDER BY INSTALL_DT"
360,Y,N,"WITH CTE1 AS (SELECT DISTINCT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(DISTINCT CTE1.PLAYER_ID) AS INSTALLS , ROUND(COUNT(A.PLAYER_ID)/COUNT(DISTINCT CTE1.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE1 LEFT JOIN ACTIVITY AS A ON A.PLAYER_ID = CTE1.PLAYER_ID AND A.EVENT_DATE = CTE1.INSTALL_DT + INTERVAL 1 DAY GROUP BY INSTALL_DT"
361,Y,Y,"WITH T AS ( SELECT A.PLAYER_ID, A.INSTALL_DT, B.EVENT_DATE AS NXT_DAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT + 1 = B.EVENT_DATE ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(NXT_DAY) / COUNT(*),2) AS DAY1_RETENTION FROM T GROUP BY 1"
362,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/ COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1 )A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = B.EVENT_DATE-1 GROUP BY 1"
363,Y,N,"WITH CTE AS( SELECT PLAYER_ID, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID) AS NEXT_DAY FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXT_DAY, EVENT_DATE) = 1 THEN 1 ELSE 0 END)/COUNT(*), 2) AS DAY1_RETENTION FROM CTE WHERE RK = 1 GROUP BY 1"
364,Y,Y,"SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT B.PLAYER_ID)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) AS A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT + 1 = B.EVENT_DATE GROUP BY 1"
365,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = B.EVENT_DATE - 1 GROUP BY 1"
366,Y,N,"WITH INFO AS( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, LEAD(EVENT_DATE,1,'2024-01-01') OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN_DATE FROM ACTIVITY), INSTALL_INFO AS( SELECT PLAYER_ID, EVENT_DATE, NEXT_LOGIN_DATE FROM INFO WHERE RN=1 ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXT_LOGIN_DATE, EVENT_DATE)=1 THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM INSTALL_INFO GROUP BY 1"
367,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN B.PLAYER_ID = A.PLAYER_ID THEN 1 ELSE 0 END)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE+1 = B.EVENT_DATE GROUP BY 1"
368,Y,N,"WITH CTE1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_EVENT FROM ACTIVITY ), CTE2 AS ( SELECT PLAYER_ID, INSTALL_DT, IF(NEXT_EVENT = DATE_ADD(INSTALL_DT, INTERVAL 1 DAY), 1, NULL) AS FLAG_RETENTION FROM CTE1 ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT(FLAG_RETENTION) / COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE2 GROUP BY INSTALL_DT"
369,Y,N,"WITH INSTALLDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), RELOGINPLAYERS AS ( SELECT DISTINCT ACTIVITY.PLAYER_ID, 1 AS RELOGIN FROM ACTIVITY JOIN INSTALLDATE ON INSTALLDATE.PLAYER_ID = ACTIVITY.PLAYER_ID AND DATE_ADD(INSTALLDATE.INSTALL_DT, INTERVAL 1 DAY) = ACTIVITY.EVENT_DATE ), JOINED AS ( SELECT INSTALLDATE.PLAYER_ID, INSTALL_DT, IFNULL(RELOGIN, 0) AS RELOGIN FROM INSTALLDATE LEFT JOIN RELOGINPLAYERS ON RELOGINPLAYERS.PLAYER_ID = INSTALLDATE.PLAYER_ID ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS , ROUND(AVG(RELOGIN), 2) AS DAY1_RETENTION FROM JOINED GROUP BY INSTALL_DT"
370,Y,Y,"WITH CTE AS (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS FIRST_LOGIN FROM ACTIVITY) SELECT FIRST_LOGIN AS INSTALL_DT,COUNT(DISTINCT PLAYER_ID) INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE=FIRST_LOGIN+1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM CTE GROUP BY FIRST_LOGIN"
371,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXT_DATE-EVENT_DATE=1 THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS DATE_R FROM ACTIVITY) T WHERE DATE_R=1 GROUP BY EVENT_DATE"
372,Y,N,"SELECT TABLE2.EVENT_DATE AS INSTALL_DT, COUNT(TABLE2.PLAYER_ID) AS INSTALLS, ROUND((COUNT(IF(TABLE2.RETENTION = 1, 1, NULL))/COUNT(TABLE2.PLAYER_ID)), 2) AS DAY1_RETENTION FROM (SELECT TABLE1.PLAYER_ID, TABLE1.EVENT_DATE, DATEDIFF(TABLE1.LEAD_EVENT_DATE, TABLE1.EVENT_DATE) AS RETENTION FROM( SELECT *, LEAD(EVENT_DATE, 1, EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS LEAD_EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROWNUM FROM ACTIVITY ) TABLE1 WHERE TABLE1.ROWNUM = 1) TABLE2 GROUP BY TABLE2.EVENT_DATE"
373,Y,N,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), D2 AS ( SELECT I.PLAYER_ID, I.INSTALL_DATE, MAX(IF(D2.EVENT_DATE IS NOT NULL, 1, 0)) AS D2_ACTIVE FROM INSTALL_DATE I LEFT JOIN ACTIVITY D2 ON I.PLAYER_ID = D2.PLAYER_ID AND I.INSTALL_DATE + INTERVAL 1 DAY = D2.EVENT_DATE GROUP BY 1,2 ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(AVG(D2_ACTIVE),2) AS DAY1_RETENTION FROM D2 GROUP BY 1"
374,Y,N,"WITH CTE_1 AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS PLAYER_SEQ, LEAD(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DATE FROM ACTIVITY ), CTE_2 AS ( SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM CTE_1 WHERE PLAYER_SEQ = 1 GROUP BY EVENT_DATE ), CTE_3 AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS RETENTION_COUNT FROM CTE_1 WHERE PLAYER_SEQ = 1 AND DATEDIFF(NEXT_DATE, EVENT_DATE) = 1 GROUP BY EVENT_DATE ) SELECT A.INSTALL_DT, A.INSTALLS, ROUND(COALESCE(B.RETENTION_COUNT,0)*1.0/A.INSTALLS, 2) AS DAY1_RETENTION FROM CTE_2 AS A LEFT JOIN CTE_3 AS B ON A.INSTALL_DT = B.EVENT_DATE"
375,Y,N,"WITH INSTALL_DATES AS( SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATE_RANK, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE FROM ACTIVITY ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND( SUM( CASE WHEN ABS(DATEDIFF(EVENT_DATE, NEXT_DATE)) = 1 THEN 1 ELSE 0 END ) / (1.0 * COUNT(DISTINCT PLAYER_ID)) , 2) AS DAY1_RETENTION FROM INSTALL_DATES WHERE DATE_RANK = 1 GROUP BY EVENT_DATE"
376,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY ), TEMP2 AS ( SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS TOTAL_INSTALLS, COUNT(DISTINCT IF(DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1, PLAYER_ID, NULL)) NEXT_DAY_RETURN FROM CTE WHERE RNK = 1 GROUP BY 1 ORDER BY 1 ) SELECT EVENT_DATE INSTALL_DT, TOTAL_INSTALLS INSTALLS, ROUND(NEXT_DAY_RETURN/TOTAL_INSTALLS,2) AS DAY1_RETENTION FROM TEMP2 ORDER BY 1"
377,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(NEXT_DAY, EVENT_DATE) = 1 THEN 1 ELSE 0 END)/COUNT(*), 2) AS DAY1_RETENTION FROM( SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RK, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS NEXT_DAY FROM ACTIVITY) AS T WHERE RK = 1 GROUP BY 1"
378,Y,Y,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) SELECT I.INSTALL_DATE AS INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID) / COUNT(I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND A.EVENT_DATE = I.INSTALL_DATE + 1 GROUP BY INSTALL_DATE"
379,Y,N,"WITH FIRST_INSTALL AS (SELECT PLAYER_ID,MIN(EVENT_DATE) AS FIRST_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT FI.FIRST_DATE AS INSTALL_DT, COUNT(FI.FIRST_DATE) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(FI.PLAYER_ID),2) AS DAY1_RETENTION FROM FIRST_INSTALL FI LEFT JOIN ACTIVITY A ON FI.PLAYER_ID=A.PLAYER_ID AND DATE_ADD(FI.FIRST_DATE,INTERVAL 1 DAY)=A.EVENT_DATE GROUP BY FI.FIRST_DATE"
380,Y,Y,"WITH CTE AS( SELECT T.INSTALL_DT, B.EVENT_DATE AS NEXT_DAY FROM(SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T LEFT JOIN ACTIVITY B ON T.PLAYER_ID = B.PLAYER_ID AND T.INSTALL_DT+1 = B.EVENT_DATE ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/COUNT(*),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
381,Y,N,"WITH T AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/ COUNT(T.PLAYER_ID),2) AS DAY1_RETENTION FROM T LEFT JOIN ACTIVITY A ON T.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, T.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
382,Y,Y,"WITH INSTALL AS (SELECT PLAYER_ID, MIN(EVENT_DATE) INS_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INS_DT INSTALL_DT, COUNT(1) INSTALLS, ROUND(COUNT(D1LOGDT)/COUNT(1),2) AS DAY1_RETENTION FROM (SELECT I.PLAYER_ID, INS_DT, A.EVENT_DATE AS D1LOGDT FROM INSTALL I LEFT JOIN ACTIVITY A ON I.INS_DT=A.EVENT_DATE-1 AND I.PLAYER_ID=A.PLAYER_ID) T GROUP BY 1"
383,Y,N,"SELECT INSTALL_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(EVENT_DATE)/COUNT(*),2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, A.INSTALL_DATE, ACT.EVENT_DATE FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1)A LEFT JOIN ACTIVITY ACT ON A.PLAYER_ID = ACT.PLAYER_ID AND DATEDIFF(EVENT_DATE,INSTALL_DATE)=1)B GROUP BY 1"
384,Y,Y,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), T2 AS (SELECT T1.INSTALL_DT, T1.PLAYER_ID, A.PLAYER_ID AS DAY_ONE_ID FROM T1 LEFT JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID AND T1.INSTALL_DT = A.EVENT_DATE - 1 ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS , ROUND(IFNULL(COUNT(DISTINCT DAY_ONE_ID)/COUNT(DISTINCT PLAYER_ID), 0), 2) AS DAY1_RETENTION FROM T2 GROUP BY INSTALL_DT"
385,Y,N,"WITH INSTALL_DAY AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_INSTALL FROM ACTIVITY GROUP BY 1 ), RETENTION AS ( SELECT I.PLAYER_ID, FIRST_INSTALL, CASE WHEN EVENT_DATE IS NOT NULL THEN TRUE ELSE FALSE END AS DAY_AFTER_LOGGIN FROM INSTALL_DAY I LEFT JOIN ACTIVITY A ON ADDDATE(FIRST_INSTALL, INTERVAL 1 DAY) = EVENT_DATE AND I.PLAYER_ID = A.PLAYER_ID ) SELECT FIRST_INSTALL AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(COUNT( DISTINCT CASE WHEN DAY_AFTER_LOGGIN THEN PLAYER_ID END) / COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM RETENTION GROUP BY 1"
386,Y,N,"SELECT I.INSTALL_DT, COUNT(I.INSTALL_DT) AS INSTALLS, ROUND(SUM(IF(A.EVENT_DATE,1,0))/COUNT(I.INSTALL_DT), 2) AS DAY1_RETENTION FROM( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) I LEFT JOIN ACTIVITY AS A ON I.PLAYER_ID=A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT)=1 GROUP BY I.INSTALL_DT"
387,Y,N,"WITH CTE AS( SELECT A.PLAYER_ID, A.EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY A.PLAYER_ID ORDER BY A.EVENT_DATE ASC) AS RANK_DATE, LEAD(A.EVENT_DATE, 1) OVER(PARTITION BY A.PLAYER_ID ORDER BY A.EVENT_DATE ASC) AS NEXT_DATE FROM ACTIVITY A) SELECT R.EVENT_DATE AS INSTALL_DT, COUNT(R.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN R.NEXT_DATE = DATE_ADD(R.EVENT_DATE,INTERVAL 1 DAY) THEN 1 ELSE 0 END)*1.0/COUNT(R.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE R WHERE R.RANK_DATE = 1 GROUP BY R.EVENT_DATE"
388,Y,Y,"WITH TEMP AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT T2.INSTALL_DT , COUNT(DISTINCT T2.PLAYER_ID) INSTALLS , ROUND(COUNT(DISTINCT T1.PLAYER_ID) / COUNT(DISTINCT T2.PLAYER_ID), 2) DAY1_RETENTION FROM ACTIVITY T1 RIGHT JOIN TEMP T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.EVENT_DATE = T2.INSTALL_DT + 1 GROUP BY T2.INSTALL_DT"
389,Y,N,"WITH I AS ( SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) , R AS ( SELECT I.INSTALL_DT AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS RETENTION FROM ACTIVITY A JOIN I ON DATEDIFF(A.EVENT_DATE, I.INSTALL_DT)=1 AND A.PLAYER_ID=I.PLAYER_ID GROUP BY I.INSTALL_DT ) SELECT T.*, ROUND(IFNULL(R.RETENTION,0)/T.INSTALLS,2) AS DAY1_RETENTION FROM (SELECT INSTALL_DT, COUNT(DISTINCT I.PLAYER_ID) AS INSTALLS FROM I GROUP BY INSTALL_DT) T LEFT JOIN R ON T.INSTALL_DT=R.INSTALL_DT"
390,Y,Y,"WITH A AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_NUM, FIRST_VALUE(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)- LEAD(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DATE_DIFF FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, SUM(CASE WHEN INSTALL_NUM =1 THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM(CASE WHEN DATE_DIFF =-1 THEN 1 ELSE 0 END)/SUM(CASE WHEN INSTALL_NUM =1 THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM A WHERE INSTALL_NUM=1 GROUP BY INSTALL_DT"
391,Y,N,"WITH CTE AS(SELECT *, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NUM FROM ACTIVITY) ,CTE2 AS (SELECT CTE1.PLAYER_ID, CTE1.EVENT_DATE, CTE.EVENT_DATE AS DAYAFTER FROM (SELECT PLAYER_ID, EVENT_DATE FROM CTE WHERE NUM = 1) AS CTE1 LEFT JOIN CTE ON CTE1.PLAYER_ID = CTE.PLAYER_ID AND DATEDIFF(CTE.EVENT_DATE, CTE1.EVENT_DATE) = 1) SELECT A.EVENT_DATE AS INSTALL_DT, DEN AS INSTALLS, ROUND(IFNULL(B.NUM,0)/A.DEN,2) AS DAY1_RETENTION FROM (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS DEN FROM CTE2 GROUP BY EVENT_DATE) AS A LEFT JOIN (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS NUM FROM (SELECT * FROM CTE2 WHERE DAYAFTER IS NOT NULL) AS C GROUP BY EVENT_DATE ) AS B ON A.EVENT_DATE = B.EVENT_DATE"
392,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT C.INSTALL_DT, COUNT(C.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID) /COUNT(C.PLAYER_ID),2) AS DAY1_RETENTION FROM CTE C LEFT JOIN ACTIVITY A ON A.PLAYER_ID = C.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, C.INSTALL_DT) = 1 GROUP BY 1"
393,Y,N,"WITH TBL_INSTALL AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A1.INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM TBL_INSTALL A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND DATEDIFF(A2.EVENT_DATE, A1.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
394,Y,Y,"WITH F AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRSTDAY FROM ACTIVITY GROUP BY PLAYER_ID) SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT F.PLAYER_ID) AS INSTALLS, IFNULL(ROUND(COUNT(DISTINCT S.PLAYER_ID) / COUNT(DISTINCT F.PLAYER_ID),2),0) AS DAY1_RETENTION FROM ACTIVITY A JOIN F ON A.EVENT_DATE = F.FIRSTDAY LEFT JOIN ACTIVITY S ON F.PLAYER_ID = S.PLAYER_ID AND S.EVENT_DATE = F.FIRSTDAY+1 GROUP BY A.EVENT_DATE"
395,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, IFNULL(ROUND(SUM(NEXT_DAY-EVENT_DATE = 1)/COUNT(DISTINCT PLAYER_ID), 2), 0) AS DAY1_RETENTION FROM (SELECT EVENT_DATE, PLAYER_ID, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DAY FROM ACTIVITY) T2 WHERE (PLAYER_ID, EVENT_DATE) IN (SELECT PLAYER_ID, MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY EVENT_DATE"
396,Y,N,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, DEVICE_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_NUM FROM ACTIVITY), DAY_INSTALLS AS (SELECT EVENT_DATE, PLAYER_ID FROM INSTALL_DATE WHERE ROW_NUM = 1), SECOND_LOG AS (SELECT PLAYER_ID, EVENT_DATE AS SECOND_LOG FROM INSTALL_DATE WHERE ROW_NUM = 2), INSTALL_COUNTS AS (SELECT DI.EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM DAY_INSTALLS AS DI GROUP BY 1), ALMOST AS (SELECT I.PLAYER_ID, I.EVENT_DATE, SECOND_LOG, DATEDIFF(SECOND_LOG,EVENT_DATE) AS DIFF FROM DAY_INSTALLS I LEFT JOIN SECOND_LOG S ON S.PLAYER_ID = I.PLAYER_ID), FINAL AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS PLAYERS FROM ALMOST WHERE DIFF = 1 GROUP BY 1) SELECT IC.EVENT_DATE AS INSTALL_DT, INSTALLS, ROUND((IFNULL(PLAYERS, 0)/INSTALLS),2) AS DAY1_RETENTION FROM INSTALL_COUNTS IC LEFT JOIN FINAL F ON IC.EVENT_DATE = F.EVENT_DATE"
397,Y,N,"WITH INTERMEDIATE_TABLE AS( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS FOR_INSTALLED_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DATE FROM ACTIVITY GROUP BY 1, 2 ) SELECT INSTALL_DT, SUM(FOR_INSTALLED_DATE) AS INSTALLS, ROUND((SUM(CASE WHEN DATEDIFF(NEXT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END ) / SUM(FOR_INSTALLED_DATE)), 2) AS DAY1_RETENTION FROM INTERMEDIATE_TABLE WHERE INSTALL_DT = EVENT_DATE GROUP BY 1"
398,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT B.PLAYER_ID)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID,MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.INSTALL_DT+1=B.EVENT_DATE GROUP BY INSTALL_DT"
399,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IF(DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1, 1, 0))/COUNT(*) ,2) AS DAY1_RETENTION FROM (SELECT *, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM (SELECT DISTINCT PLAYER_ID, EVENT_DATE FROM ACTIVITY)A)TMP WHERE TMP.RK = 1 GROUP BY EVENT_DATE"
400,Y,N,"WITH C AS ( SELECT A.PLAYER_ID,A.INSTALL_DT,B.EVENT_DATE AS FOLLOWDAY FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE,A.INSTALL_DT)=1) SELECT INSTALL_DT,COUNT(*)AS INSTALLS ,ROUND(COUNT(FOLLOWDAY)/COUNT(*),2) AS DAY1_RETENTION FROM C GROUP BY INSTALL_DT"
401,Y,N,"WITH RANKED AS( SELECT EVENT_DATE, PLAYER_ID, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LOGIN_SEQUENCE FROM ACTIVITY), AGGREGATED AS( SELECT EVENT_DATE, COUNT(EVENT_DATE) AS TOTAL_FIRST_LOGIN, COUNT(CASE WHEN DATEDIFF(NEXT_DATE, EVENT_DATE) = 1 THEN 1 ELSE NULL END) AS TOTAL_NEXTDAY_LOG FROM RANKED WHERE LOGIN_SEQUENCE = 1 GROUP BY EVENT_DATE ) SELECT EVENT_DATE AS INSTALL_DT, TOTAL_FIRST_LOGIN AS INSTALLS, ROUND( TOTAL_NEXTDAY_LOG / TOTAL_FIRST_LOGIN , 2) AS DAY1_RETENTION FROM AGGREGATED"
402,Y,N,"WITH CTE AS ( SELECT ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LEAD_DATE FROM ACTIVITY ), CTE2 AS ( SELECT RN, EVENT_DATE, COALESCE(DATEDIFF(LEAD_DATE, EVENT_DATE), 'NA') AS DATEDIFF FROM CTE ) SELECT DISTINCT EVENT_DATE AS INSTALL_DT, COUNT(*) OVER (PARTITION BY EVENT_DATE) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF = 1 THEN 1 ELSE 0 END) OVER (PARTITION BY EVENT_DATE) / COUNT(*) OVER (PARTITION BY EVENT_DATE), 2) AS DAY1_RETENTION FROM CTE2 WHERE RN = 1"
403,Y,Y,"WITH FA AS ( SELECT MIN(EVENT_DATE) INSTALL_DT, PLAYER_ID FROM ACTIVITY A GROUP BY PLAYER_ID ), IA AS ( SELECT INSTALL_DT, COUNT(1) INSTALLS FROM FA GROUP BY INSTALL_DT ) SELECT FA.INSTALL_DT, IA.INSTALLS, ROUND((SUM(IF(A.PLAYER_ID IS NULL,0,1))/IA.INSTALLS),2) DAY1_RETENTION FROM FA JOIN IA ON IA.INSTALL_DT = FA.INSTALL_DT LEFT JOIN ACTIVITY A ON A.PLAYER_ID = FA.PLAYER_ID AND FA.INSTALL_DT+1 = A.EVENT_DATE GROUP BY FA.INSTALL_DT, IA.INSTALLS"
404,Y,N,"WITH PLAYERS_RANKED_DAYS AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS LOGIN_DAY_RANK FROM ACTIVITY ), FIRST_DAY_LOGINS AS ( SELECT PLAYER_ID, EVENT_DATE FROM PLAYERS_RANKED_DAYS WHERE LOGIN_DAY_RANK = 1 ), INSTALLS_BY_DATE AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM FIRST_DAY_LOGINS GROUP BY EVENT_DATE ), DAY_DIFFERENCE AS ( SELECT PLAYER_ID, EVENT_DATE, DATEDIFF(EVENT_DATE, NEXT_DAY) AS NEXT_DAY_DIFF FROM ( SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_DAY FROM PLAYERS_RANKED_DAYS WHERE LOGIN_DAY_RANK = 1 OR LOGIN_DAY_RANK = 2 ) T1 ), ONE_DAY_RETAINERS AS ( SELECT EVENT_DATE, COUNT(PLAYER_ID) AS ONE_DAY_RETAINED_PLAYERS FROM ( SELECT PLAYER_ID, EVENT_DATE FROM DAY_DIFFERENCE WHERE NEXT_DAY_DIFF=-1 ) T1 GROUP BY EVENT_DATE ) SELECT EVENT_DATE AS INSTALL_DT, INSTALLS, (CASE WHEN DAY1_RETENTION IS NULL THEN 0.00 ELSE DAY1_RETENTION END) AS DAY1_RETENTION FROM ( SELECT A.EVENT_DATE, INSTALLS, ROUND(ONE_DAY_RETAINED_PLAYERS/INSTALLS, 2) AS DAY1_RETENTION FROM INSTALLS_BY_DATE A LEFT JOIN ONE_DAY_RETAINERS B ON A.EVENT_DATE=B.EVENT_DATE ) T1"
405,Y,N,"WITH PLAYER_INSTALL_DATE AS ( SELECT A.PLAYER_ID, MIN(A.EVENT_DATE) INSTALL_DATE FROM ACTIVITY A GROUP BY A.PLAYER_ID ), PLAYERS_SAME_INSTALL_DATE AS ( SELECT PID.INSTALL_DATE, COUNT(DISTINCT PID.PLAYER_ID) TOTAL FROM PLAYER_INSTALL_DATE PID GROUP BY PID.INSTALL_DATE ), PLAYERS_RETURN_DAY_AFTER AS ( SELECT PID.INSTALL_DATE, COUNT(DISTINCT A.PLAYER_ID) RETURNED FROM ACTIVITY A JOIN PLAYER_INSTALL_DATE PID ON A.PLAYER_ID = PID.PLAYER_ID WHERE A.EVENT_DATE - INTERVAL 1 DAY = PID.INSTALL_DATE GROUP BY A.EVENT_DATE ) SELECT PSID.INSTALL_DATE INSTALL_DT, PSID.TOTAL INSTALLS, IFNULL(ROUND(PRDA.RETURNED / PSID.TOTAL,2),0) DAY1_RETENTION FROM PLAYERS_SAME_INSTALL_DATE PSID LEFT JOIN PLAYERS_RETURN_DAY_AFTER PRDA ON PSID.INSTALL_DATE = PRDA.INSTALL_DATE"
406,Y,Y,"SELECT INSTALL_DT, COUNT(A1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.PLAYER_ID)/COUNT(A1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A1 GROUP BY 1) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT +1 = A2.EVENT_DATE GROUP BY 1"
407,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE +1 = B.EVENT_DATE GROUP BY INSTALL_DT"
408,Y,N,"WITH CTE AS (SELECT SUB.EVENT_DATE, COUNT(SUB.PLAYER_ID) AS COUNTED FROM (SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANKED FROM ACTIVITY) SUB WHERE SUB.RANKED = 1 GROUP BY SUB.EVENT_DATE), CTE2 AS (SELECT SUB.EVENT_DATE, COUNT(SUB.PLAYER_ID) AS COUNTED FROM (SELECT PLAYER_ID, EVENT_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RANKED, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LED FROM ACTIVITY) SUB WHERE SUB.RANKED = 1 AND DATEDIFF(SUB.LED, SUB.EVENT_DATE) = 1 GROUP BY SUB.EVENT_DATE) SELECT CTE.EVENT_DATE AS INSTALL_DT, CTE.COUNTED AS INSTALLS, ROUND(IFNULL(CTE2.COUNTED, 0)/CTE.COUNTED, 2) AS DAY1_RETENTION FROM CTE LEFT JOIN CTE2 ON CTE.EVENT_DATE = CTE2.EVENT_DATE"
409,Y,N,"WITH FIRST_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DATE FROM ACTIVITY) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(DATEDIFF(NEXT_DATE, INSTALL_DT)=1, 1, 0)) / COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM FIRST_DATE GROUP BY INSTALL_DT"
410,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) - EVENT_DATE AS DATE_DIFF, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS RNK FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(IF(DATE_DIFF = 1, 1 ,0 )) / COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE WHERE RNK = 1 GROUP BY 1"
411,Y,N,"WITH INTER AS (SELECT PLAYER_ID,EVENT_DATE,RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LEAD1 FROM ACTIVITY) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(AVG(CASE WHEN LEAD1 = DATE_ADD(EVENT_DATE,INTERVAL 1 DAY) THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM INTER WHERE RNK = 1 GROUP BY 1"
412,Y,Y,"WITH FIRST_LOG AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT(DISTINCT F.PLAYER_ID) INSTALLS, ROUND( SUM(CASE WHEN EVENT_DATE-1=INSTALL_DT THEN 1 ELSE 0 END) / COUNT(DISTINCT F.PLAYER_ID) ,2) DAY1_RETENTION FROM FIRST_LOG F JOIN ACTIVITY A ON F.PLAYER_ID=A.PLAYER_ID GROUP BY INSTALL_DT"
413,Y,N,"WITH CTE AS (SELECT *, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RNK FROM ACTIVITY), CTE2 AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS TOTAL_LOGINS, SUM(DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1) AS REPEAT_LOGINS FROM CTE WHERE RNK = 1 GROUP BY EVENT_DATE) SELECT EVENT_DATE AS INSTALL_DT, TOTAL_LOGINS AS INSTALLS, IFNULL(ROUND(REPEAT_LOGINS/ TOTAL_LOGINS,2),0) AS DAY1_RETENTION FROM CTE2 GROUP BY 1,2,3"
414,Y,N,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.DT AS INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(IFNULL(COUNT(A.PLAYER_ID)/COUNT(I.PLAYER_ID), 0), 2) AS DAY1_RETENTION FROM INSTALL_DT I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.DT = A.EVENT_DATE - INTERVAL 1 DAY GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
415,Y,Y,"SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(T2.PLAYER_ID)/COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DT = T2.EVENT_DATE - 1 GROUP BY T1.INSTALL_DT"
416,Y,N,"WITH INSTALL_DATES AS (SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT A.INSTALL_DT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) INSTALLS, ROUND(COUNT(DISTINCT CASE WHEN B.PLAYER_ID IS NOT NULL THEN B.PLAYER_ID END)/ COUNT(DISTINCT A.PLAYER_ID) , 2) DAY1_RETENTION FROM INSTALL_DATES A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND (A.INSTALL_DT + INTERVAL 1 DAY) = B.EVENT_DATE GROUP BY 1"
417,Y,N,"WITH T1 AS ( SELECT A.EVENT_DATE, SUM(CASE WHEN B.GAMES_PLAYED > 0 THEN 1 ELSE 0 END ) AS DAY1_COUNT FROM ACTIVITY A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID WHERE DATE_ADD(A.EVENT_DATE, INTERVAL 1 DAY) = B.EVENT_DATE AND (A.PLAYER_ID,A.EVENT_DATE) IN (SELECT PLAYER_ID,MIN(EVENT_DATE) FROM ACTIVITY GROUP BY PLAYER_ID) GROUP BY A.EVENT_DATE ), T2 AS ( SELECT INSTALL_DT, COUNT(*) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A GROUP BY INSTALL_DT ) SELECT T2.*, ROUND((CASE WHEN T1.DAY1_COUNT > 0 THEN T1.DAY1_COUNT/T2.INSTALLS ELSE 0.0 END),2) AS DAY1_RETENTION FROM T2 LEFT JOIN T1 ON T2.INSTALL_DT = T1.EVENT_DATE"
418,Y,N,"SELECT INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(F.PLAYER_ID)/ COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) I LEFT JOIN ACTIVITY F ON I.PLAYER_ID = F.PLAYER_ID AND DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
419,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT A1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT A1.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A1 JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
420,Y,Y,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT B.PLAYER_ID)/COUNT(A.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DATE A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT + 1 = B.EVENT_DATE GROUP BY 1"
421,Y,N,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN NEXT_LOGIN IS NULL THEN 0 WHEN DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1 THEN 1 ELSE 0 END)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT *, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM ACTIVITY)T WHERE RK = 1 GROUP BY INSTALL_DT"
422,Y,Y,"SELECT B.INSTALL_DT,COUNT(DISTINCT B.PLAYER_ID) AS INSTALLS, ROUND(SUM(B.INSTALL_DT+1=B.EVENT_DATE)/COUNT(DISTINCT B.PLAYER_ID),2) AS DAY1_RETENTION FROM( SELECT *,MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) B GROUP BY B.INSTALL_DT"
423,Y,N,"SELECT MIN(A.EVENT_DATE) AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT MIN(EVENT_DATE) AS EVENT_DATE, PLAYER_ID FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND DATEDIFF(B.EVENT_DATE,A.EVENT_DATE)=1 GROUP BY A.EVENT_DATE"
424,Y,Y,"WITH BASE_DATA AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) , INSTALLS AS( SELECT A.PLAYER_ID, B.INSTALL_DT, SUM(CASE WHEN EVENT_DATE = INSTALL_DT THEN 1 ELSE 0 END) AS INSTALLS FROM ACTIVITY AS A JOIN BASE_DATA AS B ON A.PLAYER_ID = B.PLAYER_ID GROUP BY 1 ) , NEXT_DATE AS( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_NUM FROM ACTIVITY ) SELECT A.INSTALL_DT, SUM(INSTALLS) AS INSTALLS, ROUND(SUM(CASE WHEN B.EVENT_DATE - A.INSTALL_DT = 1 THEN 1 ELSE 0 END)/COUNT(*),2) AS DAY1_RETENTION FROM INSTALLS AS A LEFT JOIN NEXT_DATE B ON A.PLAYER_ID = B.PLAYER_ID AND B.ROW_NUM = 2 GROUP BY 1"
425,Y,Y,"WITH P AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DATE AS INSTALL_DT,COUNT(1) AS INSTALLS,ROUND(COUNT(A.EVENT_DATE)/COUNT(INSTALL_DATE),2) AS DAY1_RETENTION FROM P LEFT JOIN ACTIVITY A ON P.PLAYER_ID = A.PLAYER_ID AND P.INSTALL_DATE = A.EVENT_DATE - 1 GROUP BY 1"
426,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(EVENT_DATE) AS INSTALLS, ROUND(SUM(CASE WHEN RETAINED = 1 THEN 1 ELSE 0 END)/COUNT(EVENT_DATE), 2) AS DAY1_RETENTION FROM ( SELECT EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS ROW_COUNT, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) - EVENT_DATE AS RETAINED FROM ACTIVITY ) S WHERE ROW_COUNT = 1 GROUP BY 1"
427,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT,COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2)AS DAY1_RETENTION FROM (SELECT PLAYER_ID,MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON B.PLAYER_ID= A.PLAYER_ID AND ABS(B.EVENT_DATE-A.EVENT_DATE=1) GROUP BY A.EVENT_DATE"
428,Y,N,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID) / COUNT(I.PLAYER_ID), 2) AS DAY1_RETENTION FROM INSTALL_DT I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND A.EVENT_DATE = I.INSTALL_DT + INTERVAL 1 DAY GROUP BY 1"
429,Y,N,"WITH T1 AS (SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A GROUP BY PLAYER_ID) SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS , ROUND(SUM(IF(A.EVENT_DATE IS NULL,0,1))/COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM T1 LEFT JOIN ACTIVITY A ON A.PLAYER_ID = T1.PLAYER_ID AND EVENT_DATE = (T1.INSTALL_DT + INTERVAL 1 DAY) GROUP BY T1.INSTALL_DT"
430,Y,N,"WITH TEMP AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT, DATEDIFF(LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC), MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID)) AS N_DAYS FROM ACTIVITY ) SELECT A.INSTALL_DT, A.INSTALLS, ROUND(IFNULL((B.DAY1_USERS_CNT/A.INSTALLS),0), 2) AS DAY1_RETENTION FROM ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS FROM TEMP GROUP BY INSTALL_DT ) A LEFT JOIN ( SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS DAY1_USERS_CNT FROM TEMP WHERE N_DAYS = 1 GROUP BY INSTALL_DT ) B ON A.INSTALL_DT = B.INSTALL_DT"
431,Y,N,"WITH D AS (SELECT EVENT_DATE AS INSTALL_DT, PLAYER_ID, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALLS, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS CONSECUTIVE_DATE, DATEDIFF(LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE) AS OTHER_DIFFERENCE FROM ACTIVITY) SELECT INSTALL_DT, COUNT(INSTALLS) INSTALLS, ROUND(SUM(CASE WHEN OTHER_DIFFERENCE = 1 THEN 1 ELSE 0 END)/COUNT(INSTALLS),2) AS DAY1_RETENTION FROM D WHERE INSTALLS = 1 GROUP BY INSTALL_DT"
432,Y,N,"SELECT ACTIVITY.EVENT_DATE AS INSTALL_DT, COUNT(ACTIVITY.PLAYER_ID) AS INSTALLS, ROUND(SUM(PLAYERS.IS_CONSECUTIVE) / COUNT(ACTIVITY.PLAYER_ID), 2) AS DAY1_RETENTION FROM ACTIVITY LEFT JOIN (SELECT PLAYER_ID, EVENT_DATE, IFNULL(LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) = DATE_ADD(EVENT_DATE, INTERVAL 1 DAY), 0) AS IS_CONSECUTIVE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DATE FROM ACTIVITY) AS PLAYERS ON ACTIVITY.PLAYER_ID=PLAYERS.PLAYER_ID AND ACTIVITY.EVENT_DATE=PLAYERS.EVENT_DATE WHERE PLAYERS.INSTALL_DATE = ACTIVITY.EVENT_DATE GROUP BY ACTIVITY.EVENT_DATE"
433,Y,N,"WITH DATE_DIFF AS (SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN, DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE), EVENT_DATE) AS DATE_DIFF FROM ACTIVITY) , INSTALL_DT AS (SELECT PLAYER_ID, DATE_DIFF, MIN(EVENT_DATE) AS INSTALL_DT FROM DATE_DIFF GROUP BY PLAYER_ID) , RETENTION AS (SELECT INSTALL_DT, COUNT(PLAYER_ID) AS RETENTION_PLAYERS FROM INSTALL_DT WHERE DATE_DIFF = 1 GROUP BY INSTALL_DT) , INSTALLS AS (SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM INSTALL_DT GROUP BY INSTALL_DT) SELECT INSTALLS.INSTALL_DT, INSTALLS.INSTALLS, CASE WHEN ROUND(RETENTION.RETENTION_PLAYERS/INSTALLS.INSTALLS,2) IS NULL THEN 0.00 ELSE ROUND(RETENTION.RETENTION_PLAYERS/INSTALLS.INSTALLS,2) END AS DAY1_RETENTION FROM INSTALLS LEFT OUTER JOIN RETENTION ON INSTALLS.INSTALL_DT = RETENTION.INSTALL_DT"
434,Y,N,"WITH TEMP1 AS( SELECT *, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY), TEMP2 AS( SELECT PLAYER_ID, EVENT_DATE,INSTALL_DT,CASE WHEN DATEDIFF(EVENT_DATE,INSTALL_DT)=1 THEN 1 ELSE 0 END AS DAY1 FROM TEMP1) SELECT INSTALL_DT,COUNT(DISTINCT PLAYER_ID) AS INSTALLS,ROUND(SUM(DAY1)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM TEMP2 GROUP BY 1"
435,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(DAY_1_RETENTION)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT DISTINCT PLAYER_ID, FIRST_VALUE(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT, CASE WHEN DATEDIFF(EVENT_DATE, FIRST_VALUE(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)) = 1 THEN 1 ELSE 0 END AS DAY_1_RETENTION FROM ACTIVITY) TEMP GROUP BY 1"
436,Y,N,"WITH A AS (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY GROUP BY 1,2), B AS (SELECT PLAYER_ID, INSTALL_DT FROM A WHERE DATEDIFF(EVENT_DATE,INSTALL_DT)=1) SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT B.PLAYER_ID) /COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM A LEFT JOIN B ON A.INSTALL_DT=B.INSTALL_DT GROUP BY 1"
437,Y,N,"WITH T1 AS (SELECT PLAYER_ID,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A GROUP BY PLAYER_ID), T2 AS (SELECT INSTALL_DT,COUNT(PLAYER_ID) AS INSTALLS FROM T1 GROUP BY INSTALL_DT) SELECT T1.INSTALL_DT, INSTALLS, ROUND(SUM(IF(A.EVENT_DATE IS NULL,0,1))/INSTALLS,2) AS DAY1_RETENTION FROM T1 JOIN T2 ON T2.INSTALL_DT = T1.INSTALL_DT LEFT JOIN ACTIVITY A ON A.PLAYER_ID = T1.PLAYER_ID AND EVENT_DATE = (T1.INSTALL_DT + INTERVAL 1 DAY) GROUP BY T1.INSTALL_DT"
438,Y,N,"WITH A AS (SELECT PLAYER_ID, MIN(EVENT_DATE) MD FROM ACTIVITY GROUP BY 1) SELECT MD INSTALL_DT, COUNT(PLAYER_ID) INSTALLS, ROUND((SELECT COUNT(PLAYER_ID) FROM A A2 WHERE A.MD=A2.MD AND PLAYER_ID IN (SELECT PLAYER_ID FROM ACTIVITY WHERE EVENT_DATE=MD + INTERVAL 1 DAY))/COUNT(PLAYER_ID),2) DAY1_RETENTION FROM A GROUP BY 1"
439,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF(SECOND_LOGIN, INSTALL_DT)=1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_RANK, LEAD(EVENT_DATE,1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS SECOND_LOGIN FROM ACTIVITY) T WHERE INSTALL_RANK=1 GROUP BY INSTALL_DT"
440,Y,Y,"WITH T1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT T1.INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.PLAYER_ID)/COUNT(T1.PLAYER_ID),2) AS DAY1_RETENTION FROM T1 LEFT JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID AND T1.INSTALL_DT = A.EVENT_DATE - 1 GROUP BY 1"
441,Y,Y,"WITH INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DT , COUNT(I.PLAYER_ID) AS INSTALLS , ROUND(COUNT(A.PLAYER_ID) / COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL_DATES I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND A.EVENT_DATE = I.INSTALL_DT + 1 GROUP BY I.INSTALL_DT ORDER BY I.INSTALL_DT"
442,Y,Y,"WITH CTE AS (SELECT B.*, A.INSTALL_DATE, IF(INSTALL_DATE = EVENT_DATE-1, 1, 0) AS DAY_1_RET FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A INNER JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(DAY_1_RET)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DATE"
443,Y,Y,"SELECT INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN A2.EVENT_DATE IS NULL THEN 0 ELSE 1 END)/COUNT(T1.PLAYER_ID)*1.0,2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, MIN(A1.EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A1 GROUP BY A1.PLAYER_ID) T1 LEFT JOIN ACTIVITY A2 ON T1.PLAYER_ID=A2.PLAYER_ID AND T1.INSTALL_DT=A2.EVENT_DATE-1 GROUP BY INSTALL_DT"
444,Y,Y,"SELECT DS1.FIRST_LOGIN_DATE AS INSTALL_DT, SUM(CASE WHEN DS1.EVENT_DATE=DS1.FIRST_LOGIN_DATE THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM(CASE WHEN DS1.EVENT_DATE-DS1.FIRST_LOGIN_DATE=1 THEN 1 ELSE 0 END)/ SUM(CASE WHEN DS1.EVENT_DATE=DS1.FIRST_LOGIN_DATE THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM ( SELECT A1.PLAYER_ID, A1.EVENT_DATE, MIN(A1.EVENT_DATE) OVER (PARTITION BY A1.PLAYER_ID)AS FIRST_LOGIN_DATE FROM ACTIVITY A1 ) DS1 GROUP BY DS1.FIRST_LOGIN_DATE"
445,Y,N,"SELECT INSTALL_DT ,COUNT(DISTINCT PLAYER_ID) AS INSTALLS ,ROUND(SUM( CASE WHEN DAYS_BETWEEN_LOGIN = 1 THEN 1.0 ELSE 0.0 END ) / COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM( SELECT DISTINCT PLAYER_ID ,FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DT ,DATEDIFF(EVENT_DATE, FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE)) AS DAYS_BETWEEN_LOGIN FROM ACTIVITY ) A GROUP BY INSTALL_DT"
446,Y,N,"WITH TBL_INSTALL AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) TMP_INSTALL GROUP BY INSTALL_DT ), TBL_DAY1_RETENTION AS( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM (SELECT A1.INSTALL_DT, A1.PLAYER_ID FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1, ACTIVITY A2 WHERE A1.PLAYER_ID = A2.PLAYER_ID AND DATEDIFF(A2.EVENT_DATE, A1.INSTALL_DT) = 1) TMP_RET GROUP BY INSTALL_DT ) SELECT A1.INSTALL_DT, A1.INSTALLS, ROUND(COALESCE(A2.INSTALLS, 0)/A1.INSTALLS, 2) AS DAY1_RETENTION FROM TBL_INSTALL A1 LEFT JOIN TBL_DAY1_RETENTION A2 ON A1.INSTALL_DT = A2.INSTALL_DT"
447,Y,N,"WITH NEW AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SELECT INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM NEW A LEFT JOIN ACTIVITY B ON B.PLAYER_ID=A.PLAYER_ID AND B.EVENT_DATE=A.INSTALL_DT +INTERVAL 1 DAY GROUP BY A.INSTALL_DT"
448,Y,N,"WITH INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), PLAYERS_INSTALLED AS ( SELECT INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS INSTALL_COUNT FROM INSTALL_DATES GROUP BY INSTALL_DATE ), PLAYERS_LOGGEDBACK AS ( SELECT A.INSTALL_DATE, COUNT(DISTINCT B.PLAYER_ID) AS RETENTION_COUNT FROM INSTALL_DATES A JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DATE, INTERVAL 1 DAY) GROUP BY A.INSTALL_DATE ) SELECT A.INSTALL_DATE AS INSTALL_DT, A.INSTALL_COUNT AS INSTALLS, ROUND(IFNULL(B.RETENTION_COUNT / A.INSTALL_COUNT, 0), 2) AS DAY1_RETENTION FROM PLAYERS_INSTALLED A LEFT JOIN PLAYERS_LOGGEDBACK B ON A.INSTALL_DATE = B.INSTALL_DATE"
449,Y,N,"WITH CTE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT, DATE_ADD(MIN(EVENT_DATE), INTERVAL 1 DAY) AS NEXT_DT FROM ACTIVITY GROUP BY 1 ), CTE2 AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM CTE GROUP BY 1 ), CTE3 AS ( SELECT INSTALL_DT, COUNT(C.PLAYER_ID) AS TARGET_PLAYER_CNT FROM CTE C INNER JOIN ACTIVITY A ON C.PLAYER_ID = A.PLAYER_ID AND C.NEXT_DT = A.EVENT_DATE GROUP BY 1 ) SELECT C2.INSTALL_DT, INSTALLS, ROUND(COALESCE(TARGET_PLAYER_CNT,0) / (CASE WHEN INSTALLS = 0 THEN 1 ELSE INSTALLS END),2) AS DAY1_RETENTION FROM CTE2 C2 LEFT JOIN CTE3 C3 ON C2.INSTALL_DT = C3.INSTALL_DT"
450,Y,Y,"SELECT A1.INSTALL_DT ,COUNT(A1.PLAYER_ID) INSTALLS ,IFNULL(ROUND(SUM(A2.GAMES_PLAYED!=0)/COUNT(A1.PLAYER_ID),2),0) AS DAY1_RETENTION FROM (SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT = A2.EVENT_DATE - 1 AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY INSTALL_DT"
451,Y,N,"WITH CTE AS (SELECT *, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM ACTIVITY), CTE2 AS (SELECT EVENT_DATE, COUNT(PLAYER_ID) AS NUM_LOGINS, SUM(DATEDIFF(NEXT_LOGIN, EVENT_DATE) = 1) AS REPEAT_LOGINS FROM CTE WHERE RK = 1 GROUP BY EVENT_DATE) SELECT EVENT_DATE AS INSTALL_DT, NUM_LOGINS AS INSTALLS, IFNULL(ROUND(REPEAT_LOGINS / NUM_LOGINS,2),0) AS DAY1_RETENTION FROM CTE2 GROUP BY EVENT_DATE, INSTALLS, DAY1_RETENTION"
452,Y,N,"WITH CTE AS (SELECT *, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS LOGIN_DATE, LEAD(EVENT_DATE, 1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_LOGIN, ROW_NUMBER() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RK FROM ACTIVITY), CTE2 AS (SELECT LOGIN_DATE, COUNT(PLAYER_ID) AS NUM_LOGINS, SUM(DATEDIFF(NEXT_LOGIN, LOGIN_DATE) = 1) AS REPEAT_LOGINS FROM CTE WHERE RK = 1 GROUP BY LOGIN_DATE) SELECT LOGIN_DATE AS INSTALL_DT, NUM_LOGINS AS INSTALLS, IFNULL(ROUND(REPEAT_LOGINS / NUM_LOGINS,2),0) AS DAY1_RETENTION FROM CTE2 GROUP BY LOGIN_DATE, INSTALLS, DAY1_RETENTION"
453,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) INSTALLS, ROUND(SUM(DAY_1)/COUNT(DISTINCT PLAYER_ID),2) DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT, DATEDIFF(EVENT_DATE,MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID)) = 1 AS DAY_1 FROM ACTIVITY ) A GROUP BY 1"
454,Y,N,"WITH LOG AS (SELECT * , MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DATE , LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS NEXT_GAME FROM ACTIVITY) , LOG2 AS ( SELECT PLAYER_ID, INSTALL_DATE, NEXT_GAME , (CASE WHEN DATEDIFF(NEXT_GAME, INSTALL_DATE) = 1 THEN 1 ELSE 0 END)AS RET FROM LOG) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS , ROUND((SUM(RET)/COUNT(DISTINCT PLAYER_ID)),2) AS DAY1_RETENTION FROM LOG2 GROUP BY INSTALL_DATE"
455,Y,N,"SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND((SUM(CASE WHEN DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID)), 2) AS DAY1_RETENTION FROM (SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY) TMP GROUP BY INSTALL_DT"
456,Y,N,"WITH T1 AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ), T2 AS( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM T1 GROUP BY 1 ), T3 AS( SELECT INSTALL_DT, COUNT(EVENT_DATE) AS RETURN_NUM FROM( SELECT T1.PLAYER_ID, INSTALL_DT, EVENT_DATE FROM T1 JOIN ACTIVITY A ON T1.PLAYER_ID = A.PLAYER_ID WHERE DATEDIFF(EVENT_DATE, INSTALL_DT) = 1 ) TEMP GROUP BY 1 ) SELECT T2.INSTALL_DT, INSTALLS, ROUND(IFNULL(RETURN_NUM,0)/INSTALLS,2) AS DAY1_RETENTION FROM T2 LEFT JOIN T3 USING(INSTALL_DT)"
457,Y,N,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS EVENT_RANK, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_EVENT_DATE, DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE),EVENT_DATE) AS DATE_DIFFRENCE FROM ACTIVITY), CTE_2 AS ( SELECT EVENT_DATE AS INSTALL_DATE, COUNT(DISTINCT PLAYER_ID) AS NUM_INSTALL, COUNT(DISTINCT CASE WHEN DATE_DIFFRENCE=1 THEN PLAYER_ID ELSE NULL END) AS RENTENTION FROM CTE WHERE EVENT_RANK=1 GROUP BY 1) SELECT INSTALL_DATE AS INSTALL_DT, NUM_INSTALL AS INSTALLS, ROUND((RENTENTION*1.0/NUM_INSTALL),2) AS DAY1_RETENTION FROM CTE_2 WHERE NUM_INSTALL<>0"
458,Y,Y,"SELECT INSTALL_DT, COUNT(T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A2.EVENT_DATE)/COUNT(T1.PLAYER_ID)*1.0,2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, MIN(A1.EVENT_DATE) AS INSTALL_DT FROM ACTIVITY A1 GROUP BY A1.PLAYER_ID) T1 LEFT JOIN ACTIVITY A2 ON T1.PLAYER_ID=A2.PLAYER_ID AND T1.INSTALL_DT=A2.EVENT_DATE-1 GROUP BY INSTALL_DT"
459,Y,N,"WITH ADD_INSTALL_DT AS ( SELECT *, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY ), ADD_DAY_1_IND AS ( SELECT *, CASE WHEN EVENT_DATE = DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) THEN 1 ELSE 0 END AS DAY_1_ACTIVITY FROM ADD_INSTALL_DT ), PLAYER_RETENTION AS ( SELECT PLAYER_ID, INSTALL_DT, MAX(DAY_1_ACTIVITY) AS DAY_1_RETAINED FROM ADD_DAY_1_IND GROUP BY PLAYER_ID, INSTALL_DT ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(DAY_1_RETAINED) / COUNT(*), 2) AS DAY1_RETENTION FROM PLAYER_RETENTION GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
460,Y,N,"WITH STG1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT STG1.INSTALL_DATE AS INSTALL_DT, COUNT(STG1.PLAYER_ID) AS INSTALLS, ROUND(AVG(CASE WHEN AC.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM STG1 LEFT JOIN ACTIVITY AC ON STG1.PLAYER_ID=AC.PLAYER_ID AND DATEDIFF(AC.EVENT_DATE, STG1.INSTALL_DATE)=1 GROUP BY STG1.INSTALL_DATE"
461,Y,N,"WITH CTE AS ( SELECT *, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK FROM ACTIVITY ) , CTE2 AS ( SELECT EVENT_DATE AS INSTALL_DT, PLAYER_ID FROM CTE WHERE RNK = 1 ) , CTE3 AS ( SELECT C.INSTALL_DT, A.EVENT_DATE, A.PLAYER_ID FROM CTE2 C LEFT JOIN ACTIVITY A ON DATEDIFF(A.EVENT_DATE, C.INSTALL_DT) = 1 AND A.PLAYER_ID = C.PLAYER_ID ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(PLAYER_ID)/COUNT(*), 2) AS DAY1_RETENTION FROM CTE3 GROUP BY 1"
462,Y,N,"WITH ALL_LOGINS AS ( SELECT PLAYER_ID, EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LOGGIN_RANK, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN FROM ACTIVITY ), FIRST_LOGINS AS ( SELECT PLAYER_ID, EVENT_DATE, CASE WHEN DATEDIFF(NEXT_LOGIN,EVENT_DATE) = 1 THEN 1 ELSE 0 END AS IS_DAY1_RETENTION FROM ALL_LOGINS WHERE LOGGIN_RANK = 1) SELECT EVENT_DATE AS INSTALL_DT, COUNT(1) AS INSTALLS, ROUND(SUM(IS_DAY1_RETENTION) / COUNT(1),2) AS DAY1_RETENTION FROM FIRST_LOGINS GROUP BY EVENT_DATE ORDER BY EVENT_DATE"
463,Y,Y,"SELECT DISTINCT INSTALL_DT, SUM(C1) AS INSTALLS, ROUND((SUM(C2)/ SUM(C1)), 2) AS DAY1_RETENTION FROM (SELECT *, CASE WHEN EVENT_DATE = INSTALL_DT THEN 1 ELSE 0 END AS C1, CASE WHEN EVENT_DATE = INSTALL_DT + 1 THEN 1 ELSE 0 END AS C2 FROM (SELECT *, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS INSTALL_DT FROM ACTIVITY AS A) AS T1) AS T2 GROUP BY 1"
464,Y,Y,"WITH CTE AS( SELECT MIN(EVENT_DATE) AS INSTALL_DT, PLAYER_ID FROM ACTIVITY GROUP BY 2), CTE1 AS( SELECT C.PLAYER_ID, C.INSTALL_DT, A.EVENT_DATE AS NEXT_DAY FROM CTE C LEFT JOIN ACTIVITY A ON C.PLAYER_ID = A.PLAYER_ID AND A.EVENT_DATE = C.INSTALL_DT + 1) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(COUNT(NEXT_DAY)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE1 GROUP BY 1"
465,Y,Y,"WITH INSTALLS AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INSTALL_DATE AS INSTALL_DT, SUM(CASE WHEN EVENT_DATE = INSTALL_DATE THEN 1 ELSE 0 END) AS INSTALLS , ROUND((SUM(CASE WHEN EVENT_DATE = INSTALL_DATE + 1 THEN 1 ELSE 0 END) / SUM(CASE WHEN EVENT_DATE = INSTALL_DATE THEN 1 ELSE 0 END) ) , 2) AS DAY1_RETENTION FROM INSTALLS LEFT JOIN ACTIVITY ON INSTALLS.PLAYER_ID = ACTIVITY.PLAYER_ID GROUP BY INSTALL_DATE"
466,Y,Y,"WITH CTE AS (SELECT *,ROW_NUMBER()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ASC) AS RANK FROM ACTIVITY) SELECT T1.EVENT_DATE AS INSTALL_DT, T1.INSTALLS, ROUND(T2.RETENT/T1.INSTALLS,2) AS DAY1_RETENTION FROM (SELECT EVENT_DATE, COUNT(*) AS INSTALLS FROM CTE WHERE CTE.RANK=1 GROUP BY EVENT_DATE)T1 JOIN (SELECT CTE.EVENT_DATE,SUM(CASE WHEN CTE.EVENT_DATE=ACTIVITY.EVENT_DATE-1 THEN 1 ELSE 0 END) AS RETENT FROM CTE LEFT JOIN ACTIVITY ON CTE.PLAYER_ID=ACTIVITY.PLAYER_ID WHERE CTE.RANK=1 GROUP BY CTE.EVENT_DATE)T2 ON T1.EVENT_DATE=T2.EVENT_DATE"
467,Y,Y,"WITH FI AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) FIRST_DATE, DATE(MIN(EVENT_DATE)+1) SECOND_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT FIRST_DATE INSTALL_DT, COUNT(DISTINCT B.PLAYER_ID) INSTALLS, ROUND ( IFNULL(COUNT(DISTINCT A.PLAYER_ID),0) * 1.00/ COUNT(DISTINCT B.PLAYER_ID) ,2) DAY1_RETENTION FROM FI B LEFT JOIN ACTIVITY A ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = SECOND_DATE GROUP BY FIRST_DATE"
468,Y,N,"WITH CTE AS ( SELECT PLAYER_ID,EVENT_DATE, DENSE_RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS EVENT_RANK, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_EVENT_DATE, DATEDIFF(LEAD(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE),EVENT_DATE) AS DATE_DIFFRENCE FROM ACTIVITY), CTE_2 AS ( SELECT EVENT_DATE AS INSTALL_DATE, COUNT(DISTINCT CASE WHEN EVENT_RANK=1 THEN PLAYER_ID ELSE NULL END) AS NUM_INSTALL, COUNT(DISTINCT CASE WHEN DATE_DIFFRENCE=1 AND EVENT_RANK=1 THEN PLAYER_ID ELSE NULL END) AS RENTENTION FROM CTE GROUP BY 1) SELECT INSTALL_DATE AS INSTALL_DT, NUM_INSTALL AS INSTALLS, ROUND((RENTENTION*1.0/NUM_INSTALL),2) AS DAY1_RETENTION FROM CTE_2 WHERE NUM_INSTALL<>0"
469,Y,N,"WITH PLAYER_INSTALL_DATES AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), INSTALL_DATE_COUNTS AS( SELECT INSTALL_DATE, COUNT(DISTINCT(PLAYER_ID)) AS INSTALL_DATE_COUNT FROM PLAYER_INSTALL_DATES GROUP BY 1 ), DAY_ONE_RETENTION AS( SELECT PLAYER_ID, INSTALL_DATE, CASE WHEN INSTALL_DATE + INTERVAL 1 DAY IN (SELECT EVENT_DATE FROM ACTIVITY WHERE ACTIVITY.PLAYER_ID = PLAYER_INSTALL_DATES.PLAYER_ID) THEN 1 ELSE 0 END AS DAY_ONE_FLAG FROM PLAYER_INSTALL_DATES ), RETENTION_RATIO AS ( SELECT I.INSTALL_DATE AS INSTALL_DT, INSTALL_DATE_COUNT AS INSTALLS, ROUND(SUM(DAY_ONE_FLAG) / INSTALL_DATE_COUNT,2) AS DAY1_RETENTION FROM INSTALL_DATE_COUNTS AS I JOIN DAY_ONE_RETENTION AS D ON I.INSTALL_DATE = D.INSTALL_DATE GROUP BY 1,2 ) SELECT * FROM RETENTION_RATIO"
470,Y,N,"SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(NEXT_DAY)/COUNT(*), 2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, A.EVENT_DATE AS INSTALL_DT, (A.PLAYER_ID, DATE_ADD(A.EVENT_DATE, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) AS NEXT_DAY FROM ACTIVITY A INNER JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS T1 ON (A.PLAYER_ID, A.EVENT_DATE) = (T1.PLAYER_ID, T1.EVENT_DATE)) AS T GROUP BY INSTALL_DT ORDER BY INSTALL_DT"
471,Y,N,"WITH CTE AS ( SELECT DISTINCT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT, COALESCE(DATEDIFF(EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID)),0) AS RETAINED FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN RETAINED = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
472,Y,Y,"WITH HEL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT C.INSTALL_DATE AS INSTALL_DT , INSTALLS, ROUND(IFNULL(REN,0)/INSTALLS,2) AS DAY1_RETENTION FROM( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM HEL GROUP BY INSTALL_DATE) C LEFT JOIN (SELECT A.INSTALL_DATE,COUNT(B.EVENT_DATE) AS REN FROM HEL A JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.INSTALL_DATE-B.EVENT_DATE=-1 GROUP BY B.EVENT_DATE) D ON C.INSTALL_DATE=D.INSTALL_DATE"
473,Y,Y,"WITH INS_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT INS.INSTALL_DT , COUNT(DISTINCT INS.PLAYER_ID) AS INSTALLS , ROUND( SUM(CASE WHEN A.EVENT_DATE = INS.INSTALL_DT + 1 THEN 1 ELSE 0 END) / COUNT(DISTINCT INS.PLAYER_ID), 2) AS DAY1_RETENTION FROM ACTIVITY A RIGHT JOIN INS_DATE INS ON A.PLAYER_ID = INS.PLAYER_ID AND A.EVENT_DATE > INS.INSTALL_DT GROUP BY INS.INSTALL_DT ORDER BY INS.INSTALL_DT"
474,Y,N,"WITH FIRST_LOGIN AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT INSTALL_DT, COUNT(DISTINCT F.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A.PLAYER_ID) / COUNT(DISTINCT F.PLAYER_ID), 2) AS DAY1_RETENTION FROM FIRST_LOGIN F LEFT JOIN ACTIVITY A ON A.PLAYER_ID = F.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, F.INSTALL_DT) = 1 GROUP BY 1"
475,Y,N,"SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(NEXT_DAY)/COUNT(*), 2) AS DAY1_RETENTION FROM (SELECT A.PLAYER_ID, A.EVENT_DATE AS INSTALL_DT, (A.PLAYER_ID, DATE_ADD(A.EVENT_DATE, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY) AS NEXT_DAY FROM ACTIVITY A INNER JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) AS T1 ON (A.PLAYER_ID, A.EVENT_DATE) = (T1.PLAYER_ID, T1.EVENT_DATE)) AS T GROUP BY INSTALL_DT"
476,Y,Y,"WITH HEL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID) SELECT C.INSTALL_DATE AS INSTALL_DT , INSTALLS, ROUND(IFNULL(REN,0)/INSTALLS,2) AS DAY1_RETENTION FROM( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS INSTALLS FROM HEL GROUP BY INSTALL_DATE) C LEFT JOIN (SELECT A.INSTALL_DATE,COUNT(B.EVENT_DATE) AS REN FROM HEL A JOIN ACTIVITY B ON A.PLAYER_ID=B.PLAYER_ID AND A.INSTALL_DATE-B.EVENT_DATE=-1 GROUP BY A.INSTALL_DATE) D ON C.INSTALL_DATE=D.INSTALL_DATE"
477,Y,N,"WITH FIRST_INSTALL AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1 ), NEXT_DAY AS ( SELECT DISTINCT F.PLAYER_ID, 1 AS NEXT_DAY FROM FIRST_INSTALL F JOIN ACTIVITY A ON F.PLAYER_ID = A.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, F.INSTALL_DATE) = 1 ) SELECT F.INSTALL_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IFNULL(N.NEXT_DAY, 0)) / COUNT(*), 2) AS DAY1_RETENTION FROM FIRST_INSTALL F LEFT JOIN NEXT_DAY N ON F.PLAYER_ID = N.PLAYER_ID GROUP BY 1"
478,Y,N,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(B.PLAYER_ID)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY 1) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = DATE_SUB(B.EVENT_DATE, INTERVAL 1 DAY) GROUP BY 1"
479,Y,Y,"WITH INSTALLED AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ), RETENTED AS (SELECT I.PLAYER_ID,I.INSTALL_DT, CASE WHEN A.PLAYER_ID IS NULL THEN 0 ELSE 1 END AS BACKED FROM INSTALLED I LEFT JOIN (SELECT DISTINCT PLAYER_ID, EVENT_DATE FROM ACTIVITY) A ON I.PLAYER_ID=A.PLAYER_ID AND I.INSTALL_DT+1=A.EVENT_DATE ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(BACKED)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM RETENTED GROUP BY 1"
480,Y,N,"WITH CTE1 AS( SELECT A.PLAYER_ID AS DAY1_RETENTION, B.FIRST_INSTALL AS INSTALL_DT FROM ACTIVITY AS A JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_INSTALL FROM ACTIVITY GROUP BY PLAYER_ID) AS B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, B.FIRST_INSTALL) = 1 ), CTE2 AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT CTE2.INSTALL_DT AS INSTALL_DT, COUNT(CTE2.PLAYER_ID) AS INSTALLS, ROUND(COUNT(CTE1.DAY1_RETENTION)/COUNT(CTE2.PLAYER_ID), 2) AS DAY1_RETENTION FROM CTE2 LEFT JOIN CTE1 ON CTE2.PLAYER_ID = CTE1.DAY1_RETENTION GROUP BY CTE2.INSTALL_DT"
481,Y,Y,"WITH INSTALL_DT AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) , DAY1_RETENTION AS ( SELECT ID.PLAYER_ID FROM INSTALL_DT ID JOIN ACTIVITY A ON ID.PLAYER_ID = A.PLAYER_ID AND ID.INSTALL_DT + 1 = A.EVENT_DATE ) SELECT ID.INSTALL_DT, COUNT(*) AS INSTALLS, IFNULL(ROUND(COUNT(DR.PLAYER_ID)/COUNT(ID.PLAYER_ID), 2), 0) AS DAY1_RETENTION FROM INSTALL_DT ID LEFT JOIN DAY1_RETENTION DR ON ID.PLAYER_ID = DR.PLAYER_ID GROUP BY 1"
482,Y,N,"SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(PLAYERS_RETENTION) / COUNT(*), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, INSTALL_DT, MAX(RETENTION) AS PLAYERS_RETENTION FROM ( SELECT PLAYER_ID, FIRST_VALUE(EVENT_DATE) OVER W AS INSTALL_DT, ( LAG(EVENT_DATE, 1) OVER W = FIRST_VALUE(EVENT_DATE) OVER W AND DATEDIFF(EVENT_DATE, FIRST_VALUE(EVENT_DATE) OVER W) = 1 ) AS RETENTION FROM ACTIVITY WINDOW W AS (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) ) AS PLAYERS_INSTALL_DATES GROUP BY PLAYER_ID, INSTALL_DT ) INSTALL_STATS GROUP BY INSTALL_DT"
483,Y,N,"SELECT INSTALL_DATE AS INSTALL_DT, SUM(CASE WHEN EVENT_DATE = INSTALL_DATE THEN 1 ELSE 0 END) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE = DATE_ADD(INSTALL_DATE, INTERVAL 1 DAY) THEN 1 ELSE 0 END)/ SUM(CASE WHEN EVENT_DATE = INSTALL_DATE THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DATE FROM ACTIVITY) INSTALL GROUP BY INSTALL_DATE"
484,Y,Y,"SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(DISTINCT T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A.PLAYER_ID) / COUNT(DISTINCT T.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID) AS FIRST_LOGIN FROM ACTIVITY ) AS T LEFT JOIN ACTIVITY A ON T.PLAYER_ID = A.PLAYER_ID AND FIRST_LOGIN = A.EVENT_DATE - 1 GROUP BY FIRST_LOGIN"
485,Y,Y,"SELECT A.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT B.PLAYER_ID)*1.0/COUNT(DISTINCT A.PLAYER_ID), 2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DATE = B.EVENT_DATE - 1 GROUP BY 1"
486,Y,Y,"SELECT EVENT_DATE AS INSTALL_DT, COUNT(DAY1PLAYER) AS INSTALLS, ROUND(COUNT(DAY2PLAYER)/COUNT(DAY1PLAYER), 2.0)AS DAY1_RETENTION FROM (SELECT A1.EVENT_DATE, A1.PLAYER_ID AS DAY1PLAYER, ROW_NUMBER()OVER(PARTITION BY A1.PLAYER_ID ORDER BY A1.EVENT_DATE) AS DAYRANK, A2.PLAYER_ID AS DAY2PLAYER FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID=A2.PLAYER_ID AND A1.EVENT_DATE+1=A2.EVENT_DATE ) AS TEMP WHERE DAYRANK=1 GROUP BY EVENT_DATE"
487,Y,N,"SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) INSTALLS, ROUND(COUNT(B.EVENT_DATE) / COUNT(A.PLAYER_ID), 2) DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = DATE_ADD(A.INSTALL_DT, INTERVAL 1 DAY) GROUP BY A.INSTALL_DT"
488,Y,Y,"SELECT A.INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN (B.EVENT_DATE - A.INSTALL_DT) = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT < B.EVENT_DATE GROUP BY A.INSTALL_DT"
489,Y,Y,"WITH TEMP1 AS (SELECT *,MIN(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_DATE, LEAD(EVENT_DATE,1) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DT FROM ACTIVITY ) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND((SUM(CASE WHEN(INSTALL_DATE-NEXT_DT)=-1 THEN 1 ELSE 0 END))/(COUNT(DISTINCT PLAYER_ID)),2) AS DAY1_RETENTION FROM TEMP1 GROUP BY INSTALL_DATE"
490,Y,N,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), NEXTDAY AS ( SELECT INSTALL_DT, DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) AS NEXTDAY FROM INSTALL_DATE GROUP BY INSTALL_DT ), PLAYERS_NEXTDAY AS ( SELECT X.PLAYER_ID, Y.NEXTDAY FROM INSTALL_DATE AS X JOIN NEXTDAY AS Y ON X.INSTALL_DT = Y.INSTALL_DT ), PLAYERS_LOGGED_BACK AS ( SELECT A.PLAYER_ID FROM PLAYERS_NEXTDAY AS Z JOIN ACTIVITY AS A ON Z.PLAYER_ID = A.PLAYER_ID AND Z.NEXTDAY = A.EVENT_DATE ) SELECT D.INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IF(P.PLAYER_ID IS NULL, 0, 1))/COUNT(*), 2) AS DAY1_RETENTION FROM INSTALL_DATE AS D LEFT JOIN PLAYERS_LOGGED_BACK AS P ON D.PLAYER_ID = P.PLAYER_ID GROUP BY D.INSTALL_DT"
491,Y,N,"WITH REGISTER_INFO AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS REGISTER_DATE FROM ACTIVITY A1 GROUP BY PLAYER_ID ) SELECT R1.REGISTER_DATE AS INSTALL_DT, COUNT(R1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT A1.PLAYER_ID) / COUNT(DISTINCT R1.PLAYER_ID), 2) AS DAY1_RETENTION FROM REGISTER_INFO R1 LEFT JOIN ACTIVITY A1 ON R1.PLAYER_ID = A1.PLAYER_ID AND DATEDIFF(A1.EVENT_DATE, R1.REGISTER_DATE) = 1 GROUP BY R1.REGISTER_DATE"
492,Y,Y,"SELECT INSTALL_DT, COUNT(DISTINCT A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN EVENT_DATE=INSTALL_DT+1 THEN 1 ELSE 0 END)/COUNT(DISTINCT A.PLAYER_ID),2) AS DAY1_RETENTION FROM ACTIVITY A LEFT JOIN (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) I ON A.PLAYER_ID=I.PLAYER_ID GROUP BY INSTALL_DT"
493,Y,N,"SELECT T.INSTALL_DT, COUNT(T.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A.EVENT_DATE) / COUNT(T.PLAYER_ID), 2) AS DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) T LEFT JOIN ACTIVITY A ON DATEDIFF(A.EVENT_DATE, T.INSTALL_DT) = 1 AND T.PLAYER_ID = A.PLAYER_ID GROUP BY T.INSTALL_DT"
494,Y,N,"WITH CTE AS ( SELECT (D.PLAYER_ID),MIN(D.EVENT_DATE) AS INSTALL_DT FROM ACTIVITY D GROUP BY D.PLAYER_ID) SELECT Y.INSTALL_DT, COUNT( Y.PLAYER_ID) AS INSTALLS , ROUND(COUNT(A.PLAYER_ID)/COUNT( Y.PLAYER_ID),2)AS DAY1_RETENTION FROM CTE Y LEFT JOIN ACTIVITY A ON A.PLAYER_ID = Y.PLAYER_ID AND A.EVENT_DATE = Y.INSTALL_DT + INTERVAL 1 DAY GROUP BY 1"
495,Y,N,"WITH T AS (SELECT PLAYER_ID, EVENT_DATE, DENSE_RANK()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK, LEAD(EVENT_DATE, 1)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_DAY FROM ACTIVITY), T1 AS (SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS TOTAL FROM T WHERE RNK = 1 GROUP BY 1), T2 AS (SELECT EVENT_DATE, COUNT(DISTINCT PLAYER_ID) AS RETENTION FROM (SELECT PLAYER_ID, EVENT_DATE, RNK, DATEDIFF(NEXT_DAY, EVENT_DATE) AS DATE_DIFF FROM T)TEMP WHERE DATE_DIFF = 1 AND RNK = 1 GROUP BY 1) SELECT T1.EVENT_DATE AS INSTALL_DT, TOTAL AS INSTALLS, ROUND(IFNULL(RETENTION/TOTAL,0),2) AS DAY1_RETENTION FROM T1 LEFT JOIN T2 ON T1.EVENT_DATE = T2.EVENT_DATE"
496,Y,N,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(SUM(CASE WHEN B.PLAYER_ID>0 THEN 1 ELSE 0 END)/COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL_DATE A LEFT JOIN (SELECT ID.INSTALL_DT, ID.PLAYER_ID FROM INSTALL_DATE ID JOIN ACTIVITY A ON ID.INSTALL_DT=A.EVENT_DATE-1 AND ID.PLAYER_ID = A.PLAYER_ID ) B ON A.INSTALL_DT=B.INSTALL_DT AND A.PLAYER_ID = B.PLAYER_ID GROUP BY 1"
497,N,N,"WITH INSTALLDT AS ( SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DT, ADDDATE( MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID), 1) AS NEXT_DT FROM ACTIVITY ), CTE AS( SELECT I.PLAYER_ID, I.INSTALL_DT, I.NEXT_DT, COALESCE(A.GAMES_PLAYED, 0) AS GAMES_PLAYED, COALESCE(A.PLAYER_ID,0) AS PLAYER_ID2 FROM INSTALLDT I LEFT JOIN ACTIVITY A ON I.PLAYER_ID = A.PLAYER_ID AND I.NEXT_DT = A.EVENT_DATE WHERE I.EVENT_DATE = I.INSTALL_DT ) SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(SUM((PLAYER_ID=PLAYER_ID2)&AMP;(GAMES_PLAYED!=0))/COUNT(DISTINCT PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
498,Y,N,"WITH T1 AS ( SELECT A.*, B.EVENT_DATE AS NEXT_DAY, B.GAMES_PLAYED AS NEXT_DAY_GAMES_PLAYED FROM ACTIVITY A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND A.EVENT_DATE = DATE_ADD(B.EVENT_DATE, INTERVAL -1 DAY)) ,T2 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM T1 GROUP BY 1) ,T3 AS ( SELECT A.*, B.NEXT_DAY FROM T2 A LEFT JOIN T1 B ON A.PLAYER_ID = B.PLAYER_ID AND A.INSTALL_DT = B.EVENT_DATE) ,T4 AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM T2 GROUP BY 1) ,T5 AS ( SELECT INSTALL_DT, COUNT(*) AS RETENTION FROM T3 WHERE NEXT_DAY IS NOT NULL GROUP BY 1) SELECT A.*, IFNULL(ROUND((B.RETENTION / A.INSTALLS), 2), 0.00) AS DAY1_RETENTION FROM T4 A LEFT JOIN T5 B ON A.INSTALL_DT = B.INSTALL_DT"
499,Y,N,"WITH CTE AS ( SELECT ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN, PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LEAD_DATE FROM ACTIVITY ), CTE2 AS ( SELECT RN, PLAYER_ID, EVENT_DATE, COALESCE(DATEDIFF(LEAD_DATE, EVENT_DATE), 'NA') AS DATEDIFF FROM CTE ) SELECT DISTINCT EVENT_DATE AS INSTALL_DT, COUNT(*) OVER (PARTITION BY EVENT_DATE) AS INSTALLS, ROUND(SUM(CASE WHEN DATEDIFF = 1 THEN 1 ELSE 0 END) OVER (PARTITION BY EVENT_DATE) / COUNT(*) OVER (PARTITION BY EVENT_DATE), 2) AS DAY1_RETENTION FROM CTE2 WHERE RN = 1"
500,Y,Y,"SELECT A1.INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(IF(A2.EVENT_DATE IS NULL, 0, 1)) / COUNT(*),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) A1 LEFT JOIN ACTIVITY A2 ON A1.INSTALL_DT + 1 = A2.EVENT_DATE AND A1.PLAYER_ID = A2.PLAYER_ID GROUP BY A1.INSTALL_DT"
501,Y,Y,"WITH CT1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS MIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), CT2 AS ( SELECT A.PLAYER_ID FROM ACTIVITY A JOIN CT1 C ON A.PLAYER_ID = C.PLAYER_ID AND A.EVENT_DATE = C.MIN_DATE + 1 ) SELECT C1.MIN_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(C2.PLAYER_ID) * 1.0 / COUNT(*), 2) AS DAY1_RETENTION FROM CT1 C1 LEFT JOIN CT2 C2 ON C1.PLAYER_ID = C2.PLAYER_ID GROUP BY C1.MIN_DATE"
502,Y,Y,"WITH D1 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), D2 AS ( SELECT INSTALL_DT, COUNT(*) AS INSTALLS FROM D1 GROUP BY INSTALL_DT), D3 AS (SELECT D1.INSTALL_DT, COUNT(A1.PLAYER_ID) AS DAY1_RETENTION FROM ACTIVITY AS A1 INNER JOIN D1 ON A1.PLAYER_ID = D1.PLAYER_ID AND A1.EVENT_DATE = D1.INSTALL_DT + 1 GROUP BY INSTALL_DT) SELECT D2.INSTALL_DT, D2.INSTALLS, ROUND(COALESCE(D3.DAY1_RETENTION,0)/D2.INSTALLS,2) AS DAY1_RETENTION FROM D2 LEFT JOIN D3 ON D3.INSTALL_DT = D2.INSTALL_DT"
503,Y,Y,"SELECT A.EVENT_DATE AS INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS , ROUND(COUNT(B.PLAYER_ID) / COUNT(A.PLAYER_ID),2) AS DAY1_RETENTION FROM( (SELECT PLAYER_ID, MIN(EVENT_DATE) AS EVENT_DATE FROM ACTIVITY GROUP BY PLAYER_ID) A LEFT JOIN ACTIVITY B ON A.PLAYER_ID = B.PLAYER_ID AND B.EVENT_DATE = A.EVENT_DATE + 1 ) GROUP BY A.EVENT_DATE ORDER BY A.EVENT_DATE"
504,Y,Y,"WITH CTE AS ( SELECT PLAYER_ID, EVENT_DATE AS INSTALL_DT, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) - EVENT_DATE AS DATE_DIFF, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS RNK FROM ACTIVITY ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(1.00* SUM(CASE WHEN DATE_DIFF = 1 THEN 1 ELSE 0 END) / COUNT(PLAYER_ID) ,2) AS DAY1_RETENTION FROM CTE WHERE RNK = 1 GROUP BY 1"
505,Y,N,"WITH A AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ), B AS ( SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM A GROUP BY INSTALL_DT ), C AS ( SELECT INSTALL_DT, COUNT(A0.PLAYER_ID) AS RET FROM A JOIN ACTIVITY A0 ON A0.PLAYER_ID = A.PLAYER_ID AND A0.EVENT_DATE = A.INSTALL_DT + INTERVAL 1 DAY GROUP BY INSTALL_DT ) SELECT B.INSTALL_DT, INSTALLS, ROUND(IFNULL(RET,0)/INSTALLS,2) AS DAY1_RETENTION FROM B LEFT JOIN C ON B.INSTALL_DT = C.INSTALL_DT ORDER BY B.INSTALL_DT"
506,Y,N,"WITH A2 AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT A2.INSTALL_DT, COUNT(A2.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A1.EVENT_DATE)/COUNT(A2.PLAYER_ID),2) AS DAY1_RETENTION FROM A2 LEFT JOIN ACTIVITY AS A1 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.EVENT_DATE = DATE_ADD(A2.INSTALL_DT, INTERVAL 1 DAY) GROUP BY A2.INSTALL_DT"
507,Y,Y,"WITH A AS ( SELECT PLAYER_ID , MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1 ) , B AS( SELECT A.INSTALL_DT , A.PLAYER_ID , CASE WHEN A2.EVENT_DATE IS NOT NULL THEN 1 ELSE 0 END AS DAY_ONE_RETENTION_DUMMY FROM A LEFT JOIN ACTIVITY A2 ON A.PLAYER_ID = A2.PLAYER_ID AND (A2.EVENT_DATE-A.INSTALL_DT)=1 ) SELECT INSTALL_DT , COUNT(PLAYER_ID) AS INSTALLS , ROUND(SUM(DAY_ONE_RETENTION_DUMMY)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM B GROUP BY 1 ORDER BY 1"
508,Y,N,"WITH INSTALLS AS (SELECT EVENT_DATE AS INSTALL_DATE, PLAYER_ID FROM (SELECT EVENT_DATE, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS DAY_N, PLAYER_ID FROM ACTIVITY) T WHERE DAY_N = 1), INS AS (SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS CNT FROM INSTALLS GROUP BY INSTALL_DATE), RETENTIONS AS (SELECT PLAYER_ID, INSTALL_DATE, CASE WHEN DATE_ADD(INSTALL_DATE, INTERVAL 1 DAY) IN (SELECT EVENT_DATE FROM ACTIVITY WHERE PLAYER_ID = T.PLAYER_ID) THEN 1 ELSE 0 END AS RETENTION FROM INSTALLS T), RET AS (SELECT INSTALL_DATE, SUM(RETENTION) AS CNT FROM RETENTIONS GROUP BY INSTALL_DATE) SELECT I.INSTALL_DATE AS INSTALL_DT, I.CNT AS INSTALLS, ROUND(R.CNT/I.CNT,2) AS DAY1_RETENTION FROM INS I JOIN RET R ON I.INSTALL_DATE = R.INSTALL_DATE"
509,Y,Y,"WITH DT AS (SELECT DISTINCT PLAYER_ID,EVENT_DATE, DENSE_RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE ) AS RANK1 FROM ACTIVITY ), RETEN AS (SELECT DISTINCT A.PLAYER_ID,A.EVENT_DATE,B.EVENT_DATE AS ED1, CASE WHEN ROUND(B.EVENT_DATE-A.EVENT_DATE)=1 THEN 1 ELSE 0 END AS PLAYER1 FROM DT A LEFT JOIN DT B ON A.PLAYER_ID=B.PLAYER_ID AND A.RANK1=1 AND B.RANK1=2 WHERE A.RANK1=1) SELECT EVENT_DATE AS INSTALL_DT,COUNT(DISTINCT(PLAYER_ID)) AS INSTALLS, ROUND(SUM(PLAYER1)/COUNT(DISTINCT(PLAYER_ID)),2) AS DAY1_RETENTION FROM RETEN GROUP BY 1"
510,Y,N,"WITH INSTALLDATE AS (SELECT PLAYER_ID, EVENT_DATE INSTALL_DATE FROM (SELECT PLAYER_ID, EVENT_DATE, RANK() OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) RK FROM ACTIVITY) A WHERE A.RK=1), RETENTION AS (SELECT PLAYER_ID, INSTALL_DATE, IF((PLAYER_ID, DATE_ADD(INSTALL_DATE, INTERVAL 1 DAY)) IN (SELECT PLAYER_ID, EVENT_DATE FROM ACTIVITY), 1, 0) HAS_NEXT FROM INSTALLDATE) SELECT INSTALL_DATE INSTALL_DT, COUNT(*) INSTALLS, ROUND(SUM(HAS_NEXT)/COUNT(*), 2) DAY1_RETENTION FROM RETENTION GROUP BY INSTALL_DT"
511,Y,N,"WITH CTE AS ( SELECT SEED.*, CASE WHEN A.EVENT_DATE IS NULL THEN 0 ELSE 1 END AS DAY_1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) SEED LEFT JOIN ACTIVITY A ON SEED.PLAYER_ID = A.PLAYER_ID AND DATE_ADD(SEED.INSTALL_DT, INTERVAL 1 DAY) = A.EVENT_DATE ) SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(DAY_1_RETENTION)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM CTE GROUP BY INSTALL_DT"
512,Y,N,"SELECT INSTALL_DATE AS INSTALL_DT, SUM(INSTALL_DT) AS INSTALLS, ROUND((SUM(RETENTION)/SUM(INSTALL_DT)),2) AS DAY1_RETENTION FROM (SELECT INSTALL_DATE, CASE WHEN DATEDIFF(EVENT_DATE,INSTALL_DATE) = 1 THEN 1 ELSE 0 END AS RETENTION, CASE WHEN EVENT_DATE=INSTALL_DATE THEN 1 ELSE 0 END AS INSTALL_DT FROM (SELECT * FROM (SELECT PLAYER_ID,EVENT_DATE AS INSTALL_DATE, RANK() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS INSTALL_RANK FROM ACTIVITY)INSTALL_RNK WHERE INSTALL_RANK=1)INSTALL_DT LEFT JOIN ACTIVITY B ON INSTALL_DT.PLAYER_ID= B.PLAYER_ID)A GROUP BY INSTALL_DATE"
513,Y,Y,"WITH DF1 AS (SELECT PLAYER_ID, EVENT_DATE, MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS INSTALL_DATE, EVENT_DATE - MIN(EVENT_DATE) OVER (PARTITION BY PLAYER_ID) AS GAP FROM ACTIVITY) SELECT INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS INSTALLS, ROUND(1.00*SUM(CASE WHEN GAP = 1 THEN 1 ELSE 0 END)/COUNT(DISTINCT PLAYER_ID), 2) AS DAY1_RETENTION FROM DF1 GROUP BY 1"
514,Y,N,"WITH CTE1 AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), CTE2 AS (SELECT COUNT(1) AS RETENTION, B.INSTALL_DT FROM ACTIVITY A INNER JOIN CTE1 B ON A.PLAYER_ID = B.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, B.INSTALL_DT) = 1 GROUP BY EVENT_DATE), CTE3 AS (SELECT INSTALL_DT, COUNT(1) AS INSTALLS FROM CTE1 GROUP BY INSTALL_DT) SELECT A.*, ROUND(COALESCE(B.RETENTION, 0) / A.INSTALLS,2) AS DAY1_RETENTION FROM CTE3 A LEFT OUTER JOIN CTE2 B ON A.INSTALL_DT = B.INSTALL_DT ORDER BY INSTALL_DT"
515,Y,N,"WITH INSTALL_DATE_TABLE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID), INSTALL_DATE_NUM_TABLE AS ( SELECT INSTALL_DATE, COUNT(PLAYER_ID) AS PLAYER_NUM FROM INSTALL_DATE_TABLE GROUP BY INSTALL_DATE), NEW_ACTIVITY AS ( SELECT A.PLAYER_ID, EVENT_DATE, IDT.INSTALL_DATE, PLAYER_NUM, CASE WHEN EVENT_DATE = DATE_ADD(IDT.INSTALL_DATE, INTERVAL 1 DAY) THEN 1 ELSE 0 END AS RETAINED FROM ACTIVITY A LEFT JOIN INSTALL_DATE_TABLE IDT ON A.PLAYER_ID = IDT.PLAYER_ID LEFT JOIN INSTALL_DATE_NUM_TABLE IDNT ON IDT.INSTALL_DATE = IDNT.INSTALL_DATE) SELECT INSTALL_DATE AS INSTALL_DT, MAX(PLAYER_NUM) AS INSTALLS, ROUND(SUM(RETAINED)/MAX(PLAYER_NUM), 2) AS DAY1_RETENTION FROM NEW_ACTIVITY GROUP BY INSTALL_DATE"
516,Y,Y,"WITH FIRST_LOGIN AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_LOGIN FROM ACTIVITY GROUP BY PLAYER_ID), TEMP AS (SELECT F.PLAYER_ID,FIRST_LOGIN FROM FIRST_LOGIN F JOIN ACTIVITY A ON F.PLAYER_ID=A.PLAYER_ID AND F.FIRST_LOGIN=A.EVENT_DATE-1), TEMP1 AS (SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM FIRST_LOGIN GROUP BY FIRST_LOGIN), TEMP2 AS (SELECT FIRST_LOGIN AS INSTALL_DT, COUNT(PLAYER_ID) AS NUM_REN FROM TEMP GROUP BY FIRST_LOGIN) SELECT T1.INSTALL_DT,T1.INSTALLS, IFNULL(ROUND(T2.NUM_REN/T1.INSTALLS,2),0) AS DAY1_RETENTION FROM TEMP1 T1 LEFT JOIN TEMP2 T2 ON T1.INSTALL_DT=T2.INSTALL_DT"
517,Y,N,"SELECT INSTALL_DT, COUNT(*) INSTALLS, ROUND(COUNT(A.EVENT_DATE)/COUNT(*),2) DAY1_RETENTION FROM ( SELECT PLAYER_ID, MIN(EVENT_DATE) INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) I LEFT JOIN ACTIVITY A ON A.PLAYER_ID = I.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, I.INSTALL_DT) = 1 GROUP BY INSTALL_DT"
518,Y,Y,"SELECT A3.INSTALL_DT, COUNT(A3.PLAYER_ID) AS INSTALLS, ROUND(COUNT(A3.NEXT_DATE)/COUNT(PLAYER_ID),2) AS DAY1_RETENTION FROM (SELECT A1.PLAYER_ID, A1.INSTALL_DT, A2.EVENT_DATE AS NEXT_DATE FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID) A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.INSTALL_DT+1 = A2.EVENT_DATE) A3 GROUP BY A3.INSTALL_DT"
519,Y,N,"WITH DEMO AS ( SELECT A.PLAYER_ID, A.DEVICE_ID, A.EVENT_DATE,CASE WHEN DATEDIFF(A.LEADDATE,A.EVENT_DATE)=1 THEN 1 ELSE 0 END AS CNT FROM ( SELECT PLAYER_ID, DEVICE_ID, EVENT_DATE, RANK()OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RNK,LEAD(EVENT_DATE)OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LEADDATE FROM ACTIVITY)A WHERE A.RNK=1) SELECT DEMO.EVENT_DATE AS INSTALL_DT, COUNT(DEMO.PLAYER_ID) AS INSTALLS, ROUND(SUM(DEMO.CNT)/COUNT(DEMO.PLAYER_ID),2) AS DAY1_RETENTION FROM DEMO GROUP BY DEMO.EVENT_DATE"
520,Y,Y,"SELECT DISTINCT FIRST_DAY AS INSTALL_DT , SUM(CASE WHEN EVENT_DATE = FIRST_DAY THEN 1 ELSE 0 END) AS INSTALLS , ROUND(SUM(CASE WHEN EVENT_DATE - FIRST_DAY = 1 THEN 1 ELSE 0 END)/SUM(CASE WHEN EVENT_DATE = FIRST_DAY THEN 1 ELSE 0 END),2) AS DAY1_RETENTION FROM( SELECT PLAYER_ID , FIRST_VALUE(EVENT_DATE) OVER(PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS FIRST_DAY , EVENT_DATE FROM ACTIVITY ) AS TBL GROUP BY FIRST_DAY"
521,Y,N,"WITH FIRSTPLAYDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS FIRST_PLAY_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), INSTALLS AS ( SELECT FIRST_PLAY_DATE AS INSTALL_DT , COUNT(*) AS INSTALLS FROM FIRSTPLAYDATE GROUP BY FIRST_PLAY_DATE ), RETENTIONS AS ( SELECT EVENT_DATE - INTERVAL 1 DAY AS INSTALL_DT , COUNT(*) AS RETENTIONS FROM ACTIVITY WHERE CONCAT(PLAYER_ID, ',', EVENT_DATE) IN ( SELECT CONCAT(PLAYER_ID, ',', FIRST_PLAY_DATE + INTERVAL 1 DAY) FROM FIRSTPLAYDATE ) GROUP BY EVENT_DATE ) SELECT I.INSTALL_DT, I.INSTALLS, ROUND(COALESCE(R.RETENTIONS, 0) / I.INSTALLS, 2) AS DAY1_RETENTION FROM INSTALLS I LEFT JOIN RETENTIONS R ON I.INSTALL_DT = R.INSTALL_DT"
522,Y,N,"WITH MIN_DATES AS( SELECT PLAYER_ID, MIN(EVENT_DATE) AS MIN_DATE FROM ACTIVITY GROUP BY PLAYER_ID ), NEXT_DAYS AS ( SELECT A1.PLAYER_ID, A1.EVENT_DATE, CASE WHEN A2.PLAYER_ID IS NOT NULL THEN 1 ELSE 0 END AS LOGGED_IN_NEXT_DAY FROM ACTIVITY A1 LEFT JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND A1.EVENT_DATE = DATE_ADD(A2.EVENT_DATE, INTERVAL -1 DAY) WHERE EXISTS (SELECT NULL FROM MIN_DATES WHERE A1.PLAYER_ID = PLAYER_ID AND A1.EVENT_DATE = MIN_DATE) ) SELECT EVENT_DATE AS INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS, ROUND(SUM(LOGGED_IN_NEXT_DAY)/COUNT(PLAYER_ID), 2) AS DAY1_RETENTION FROM NEXT_DAYS GROUP BY EVENT_DATE"
523,Y,N,"SELECT T.INSTALL_DATE AS INSTALL_DT, COUNT(T.INSTALL_DATE) AS INSTALLS, ROUND( COUNT(T1.EVENT_DATE)/ COUNT(*),2) AS DAY1_RETENTION FROM (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY 1)T LEFT JOIN ACTIVITY T1 ON DATE_ADD(T.INSTALL_DATE, INTERVAL 1 DAY)=T1.EVENT_DATE AND T.PLAYER_ID=T1.PLAYER_ID GROUP BY 1 ORDER BY 1"
524,Y,N,"WITH C AS (SELECT PLAYER_ID, MIN(EVENT_DATE) 1ST FROM ACTIVITY GROUP BY 1) SELECT 1ST INSTALL_DT, COUNT(DISTINCT C.PLAYER_ID) INSTALLS, ROUND(COUNT(DISTINCT A.PLAYER_ID)/COUNT(DISTINCT C.PLAYER_ID),2) DAY1_RETENTION FROM C LEFT JOIN ACTIVITY A ON A.PLAYER_ID = C.PLAYER_ID AND DATEDIFF(A.EVENT_DATE, 1ST) = 1 GROUP BY 1"
525,Y,N,"WITH LEAD_EVENT AS (SELECT PLAYER_ID, EVENT_DATE, LEAD(EVENT_DATE) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS LEAD_DATE FROM ACTIVITY GROUP BY 1,2), MIN_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY 1) SELECT A.INSTALL_DT, COUNT(A.PLAYER_ID) AS INSTALLS, ROUND(COUNT(CASE WHEN B.EVENT_DATE=DATE_ADD(LEAD_DATE, INTERVAL -1 DAY) THEN 1 END) / COUNT(A.PLAYER_ID) ,2) AS DAY1_RETENTION FROM MIN_DATE A LEFT JOIN LEAD_EVENT B ON A.PLAYER_ID=B.PLAYER_ID AND A.INSTALL_DT=B.EVENT_DATE GROUP BY A.INSTALL_DT"
526,Y,N,"WITH INSTALL_DATE AS (SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID), INSTALL_CNT AS (SELECT INSTALL_DT, COUNT(PLAYER_ID) AS INSTALLS FROM INSTALL_DATE GROUP BY INSTALL_DT), RETENTION AS (SELECT A1.PLAYER_ID, A1.INSTALL_DT FROM INSTALL_DATE A1 INNER JOIN ACTIVITY A2 ON A1.PLAYER_ID = A2.PLAYER_ID AND DATEDIFF(A1.INSTALL_DT, A2.EVENT_DATE) = -1), RETENTION_CNT AS (SELECT INSTALL_DT, COUNT(DISTINCT PLAYER_ID) AS RETENTION FROM RETENTION GROUP BY INSTALL_DT) SELECT I.INSTALL_DT, INSTALLS, CASE WHEN RETENTION IS NULL THEN 0.00 ELSE ROUND(RETENTION/INSTALLS,2) END AS DAY1_RETENTION FROM INSTALL_CNT I LEFT JOIN RETENTION_CNT R ON I.INSTALL_DT = R.INSTALL_DT ORDER BY I.INSTALL_DT"
527,Y,N,"SELECT T1.EVENT_DATE AS INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(SUM(T1.RETENTION)/COUNT(*),2) AS DAY1_RETENTION FROM ( SELECT T.EVENT_DATE, CASE WHEN DATEDIFF(T.NEXT_LOGIN, T.EVENT_DATE) = 1 THEN 1 ELSE 0 END AS RETENTION, T.RN FROM (SELECT EVENT_DATE, LEAD(EVENT_DATE, 1) OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS NEXT_LOGIN, ROW_NUMBER() OVER (PARTITION BY PLAYER_ID ORDER BY EVENT_DATE) AS RN FROM ACTIVITY) T ) T1 WHERE T1.RN = 1 GROUP BY EVENT_DATE"
528,Y,Y,"WITH INSTALL_DATES AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) ,DAY_ONE AS ( SELECT A.PLAYER_ID FROM ACTIVITY A JOIN INSTALL_DATES I ON A.PLAYER_ID = I.PLAYER_ID AND A.EVENT_DATE = I.INSTALL_DT + 1 ) SELECT INSTALL_DT, COUNT(*) AS INSTALLS, ROUND(COUNT(D.PLAYER_ID)/COUNT(*),2) AS DAY1_RETENTION FROM INSTALL_DATES I LEFT OUTER JOIN DAY_ONE D ON I.PLAYER_ID = D.PLAYER_ID GROUP BY INSTALL_DT"
529,Y,Y,"WITH INSTALL_DATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT T1.INSTALL_DATE AS INSTALL_DT, COUNT(DISTINCT T1.PLAYER_ID) AS INSTALLS, ROUND(COUNT(DISTINCT CASE WHEN T2.PLAYER_ID IS NOT NULL THEN T1.PLAYER_ID ELSE NULL END) / COUNT(DISTINCT T1.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALL_DATE T1 LEFT JOIN ACTIVITY T2 ON T1.PLAYER_ID = T2.PLAYER_ID AND T1.INSTALL_DATE + 1 = T2.EVENT_DATE GROUP BY T1.INSTALL_DATE"
530,Y,N,"WITH BASE AS (SELECT PLAYER_ID ,MIN(EVENT_DATE) AS INSTALL_DATE FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT B.INSTALL_DATE AS INSTALL_DT ,COUNT(B.PLAYER_ID) AS INSTALLS ,ROUND(1.0 * COUNT(EVENT_DATE) / COUNT(B.PLAYER_ID), 2) AS DAY1_RETENTION FROM BASE B LEFT JOIN ACTIVITY A ON B.PLAYER_ID = A.PLAYER_ID AND A.EVENT_DATE = DATE_ADD(B.INSTALL_DATE, INTERVAL 1 DAY) GROUP BY B.INSTALL_DATE ORDER BY B.INSTALL_DATE"
531,Y,N,"WITH INSTALLDATE AS ( SELECT PLAYER_ID, MIN(EVENT_DATE) AS INSTALL_DT FROM ACTIVITY GROUP BY PLAYER_ID ) SELECT I.INSTALL_DT, COUNT(I.PLAYER_ID) AS INSTALLS, ROUND(COUNT(R.PLAYER_ID)/COUNT(I.PLAYER_ID),2) AS DAY1_RETENTION FROM INSTALLDATE I LEFT JOIN ACTIVITY R ON I.PLAYER_ID = R.PLAYER_ID AND R.EVENT_DATE = DATE_ADD(INSTALL_DT, INTERVAL 1 DAY) GROUP BY I.INSTALL_DT"
